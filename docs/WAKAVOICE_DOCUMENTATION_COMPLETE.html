<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Technique Compl√®te - Waka Voice | Plateforme d'Agents IA Multimodaux</title>
    <meta name="description" content="Documentation technique exhaustive de Waka Voice - Plateforme d'agents conversationnels IA multimodaux avec voix, avatars et chat textuel.">
    <meta name="keywords" content="Waka Voice, AI Agents, Voice AI, Azure, Conversational AI, Text-to-Speech, Speech-to-Text">
    <meta name="author" content="Waka AI">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../static/images/logo.png">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <!-- Mermaid -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

    <style>
        :root {
            --waka-primary: #4A148C;
            --waka-primary-light: #7B1FA2;
            --waka-primary-dark: #1A0033;
            --waka-primary-pale: #E1BEE7;
            --waka-accent-yellow: #FFC107;
            --waka-accent-orange: #FF6F00;
            --waka-accent-gold: #FFD700;
            --waka-white: #FFFFFF;
            --waka-off-white: #F8F9FA;
            --waka-bg-light: #F3E5F5;
            --waka-text: #2C003E;
            --waka-text-light: #6A1B9A;
            --waka-text-muted: #9C27B0;
            --waka-border: #CE93D8;
            --waka-shadow: rgba(74, 20, 140, 0.15);
            --waka-glass: rgba(255, 255, 255, 0.1);
            --waka-glass-border: rgba(255, 255, 255, 0.2);
            --code-bg: #1e1e3f;
            --code-text: #e0e0ff;
            --gradient-primary: linear-gradient(135deg, #4A148C 0%, #7B1FA2 100%);
            --gradient-accent: linear-gradient(135deg, #FFC107 0%, #FF6F00 100%);
            --gradient-gold: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --error-color: #f44336;
            --info-color: #2196F3;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--gradient-primary);
            color: var(--waka-white);
            min-height: 100vh;
            line-height: 1.8;
            font-size: 16px;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background:
                radial-gradient(circle at 20% 50%, rgba(255, 193, 7, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 111, 0, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(123, 31, 162, 0.1) 0%, transparent 50%);
            animation: backgroundShift 30s ease-in-out infinite alternate;
            z-index: 0;
            pointer-events: none;
        }

        @keyframes backgroundShift {
            0% { transform: translate(0, 0) rotate(0deg); }
            100% { transform: translate(2%, 2%) rotate(1deg); }
        }

        /* SIDEBAR */
        .sidebar {
            position: fixed;
            left: 0; top: 0;
            width: 340px;
            height: 100vh;
            background: rgba(26, 0, 51, 0.98);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--waka-glass-border);
            overflow-y: auto;
            z-index: 1000;
            padding: 2rem 0;
        }

        .sidebar-header {
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid var(--waka-glass-border);
            margin-bottom: 1.5rem;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .sidebar-logo img {
            width: 50px; height: 50px;
            border-radius: 12px;
        }

        .sidebar-logo h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            font-weight: 900;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sidebar-version {
            font-size: 0.75rem;
            color: var(--waka-accent-yellow);
            background: rgba(255, 193, 7, 0.15);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            display: inline-block;
            margin-right: 0.5rem;
        }

        .sidebar-date {
            font-size: 0.7rem;
            color: rgba(255,255,255,0.5);
        }

        .nav-section { margin-bottom: 1.5rem; }

        .nav-section-title {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--waka-accent-yellow);
            padding: 0 1.5rem;
            margin-bottom: 0.75rem;
            font-weight: 700;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.6rem 1.5rem;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--waka-white);
            border-left-color: var(--waka-accent-yellow);
        }

        .nav-link.active {
            background: rgba(255, 193, 7, 0.1);
            color: var(--waka-accent-yellow);
            border-left-color: var(--waka-accent-yellow);
        }

        .nav-link i { font-size: 1rem; width: 22px; }

        /* MAIN CONTENT */
        .main-content {
            margin-left: 340px;
            padding: 3rem 4rem;
            position: relative;
            z-index: 1;
            max-width: 1400px;
        }

        /* PAGE HEADER */
        .page-header {
            background: var(--waka-glass);
            backdrop-filter: blur(30px);
            border: 1px solid var(--waka-glass-border);
            border-radius: 30px;
            padding: 4rem;
            margin-bottom: 3rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37), inset 0 0 60px rgba(255, 255, 255, 0.05);
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
            animation: headerShine 6s linear infinite;
        }

        @keyframes headerShine {
            0% { transform: rotate(0deg) translate(-50%, -50%); }
            100% { transform: rotate(360deg) translate(-50%, -50%); }
        }

        .page-header h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ffffff 0%, #f0e6ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5)); }
            50% { filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.8)); }
        }

        .page-header .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .page-header .description {
            font-size: 1rem;
            opacity: 0.7;
            max-width: 800px;
            margin: 0 auto 2rem;
            position: relative;
            z-index: 1;
            line-height: 1.8;
        }

        .header-stats {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .header-stat {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 1rem 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 120px;
        }

        .header-stat-value {
            font-size: 1.8rem;
            font-weight: 900;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.8;
        }

        /* CONTENT SECTIONS */
        .content-section {
            background: rgba(255, 255, 255, 0.97);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 3rem 4rem;
            margin-bottom: 2rem;
            color: var(--waka-text);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .content-section.dark {
            background: rgba(26, 0, 51, 0.95);
            color: var(--waka-white);
            border-color: var(--waka-glass-border);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--waka-primary-pale);
        }

        .content-section.dark .section-header {
            border-bottom-color: var(--waka-glass-border);
        }

        .section-icon {
            width: 70px; height: 70px;
            background: var(--gradient-primary);
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
            flex-shrink: 0;
        }

        .content-section.dark .section-icon {
            background: var(--gradient-accent);
        }

        .section-title-group { flex: 1; }

        .section-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--waka-primary);
            margin: 0;
        }

        .content-section.dark .section-title {
            color: var(--waka-white);
        }

        .section-subtitle {
            font-size: 1rem;
            color: var(--waka-text-light);
            margin-top: 0.25rem;
        }

        .content-section.dark .section-subtitle {
            color: rgba(255,255,255,0.7);
        }

        /* TYPOGRAPHY */
        h2 {
            font-size: 1.6rem;
            color: var(--waka-primary);
            border-left: 4px solid var(--waka-accent-yellow);
            padding-left: 1rem;
            margin: 2.5rem 0 1.5rem;
        }

        .content-section.dark h2 {
            color: var(--waka-accent-yellow);
        }

        h3 {
            font-size: 1.3rem;
            color: var(--waka-primary-light);
            margin: 2rem 0 1rem;
        }

        .content-section.dark h3 {
            color: var(--waka-primary-pale);
        }

        h4 {
            font-size: 1.1rem;
            color: var(--waka-text-light);
            margin: 1.5rem 0 0.75rem;
        }

        p { margin-bottom: 1.2rem; }

        ul, ol {
            margin-bottom: 1.5rem;
            padding-left: 2rem;
        }

        li { margin-bottom: 0.6rem; }

        strong {
            color: var(--waka-primary);
            font-weight: 700;
        }

        .content-section.dark strong {
            color: var(--waka-accent-yellow);
        }

        /* INTRO PARAGRAPH */
        .intro-text {
            font-size: 1.1rem;
            line-height: 1.9;
            color: var(--waka-text);
            background: linear-gradient(135deg, rgba(74, 20, 140, 0.05) 0%, rgba(123, 31, 162, 0.03) 100%);
            padding: 2rem;
            border-radius: 15px;
            border-left: 4px solid var(--waka-primary);
            margin-bottom: 2rem;
        }

        .content-section.dark .intro-text {
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.9);
            border-left-color: var(--waka-accent-yellow);
        }

        /* TABLES */
        .table-wrapper {
            overflow-x: auto;
            margin: 1.5rem 0;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
        }

        .content-section.dark table {
            background: rgba(255, 255, 255, 0.05);
        }

        th {
            background: var(--gradient-primary);
            color: white;
            padding: 1rem 1.5rem;
            text-align: left;
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--waka-primary-pale);
            font-size: 0.95rem;
            vertical-align: top;
        }

        .content-section.dark td {
            border-bottom-color: var(--waka-glass-border);
            color: rgba(255, 255, 255, 0.9);
        }

        tr:last-child td { border-bottom: none; }

        tr:hover td { background: rgba(74, 20, 140, 0.03); }

        .content-section.dark tr:hover td { background: rgba(255, 255, 255, 0.03); }

        /* CODE BLOCKS */
        pre {
            background: var(--code-bg);
            border-radius: 15px;
            padding: 1.5rem 2rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        code {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            color: var(--code-text);
        }

        p code, li code, td code {
            background: rgba(74, 20, 140, 0.1);
            color: var(--waka-primary);
            padding: 0.2rem 0.5rem;
            border-radius: 5px;
            font-size: 0.85rem;
        }

        .content-section.dark p code,
        .content-section.dark li code,
        .content-section.dark td code {
            background: rgba(255, 193, 7, 0.15);
            color: var(--waka-accent-yellow);
        }

        /* MERMAID */
        .mermaid {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            display: flex;
            justify-content: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .content-section.dark .mermaid {
            background: rgba(255, 255, 255, 0.08);
        }

        /* CALLOUTS */
        .callout {
            padding: 1.5rem 2rem;
            border-radius: 15px;
            margin: 2rem 0;
            display: flex;
            gap: 1.25rem;
            align-items: flex-start;
        }

        .callout-info {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(33, 150, 243, 0.05) 100%);
            border-left: 4px solid #2196F3;
        }

        .callout-warning {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.15) 0%, rgba(255, 193, 7, 0.05) 100%);
            border-left: 4px solid #FFC107;
        }

        .callout-success {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%);
            border-left: 4px solid #4CAF50;
        }

        .callout-danger {
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.1) 0%, rgba(244, 67, 54, 0.05) 100%);
            border-left: 4px solid #f44336;
        }

        .callout-icon { font-size: 1.5rem; flex-shrink: 0; }
        .callout-content { flex: 1; }
        .callout-title { font-weight: 700; margin-bottom: 0.5rem; }

        /* CARDS */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--waka-primary-pale);
            transition: all 0.3s ease;
        }

        .content-section.dark .feature-card {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--waka-glass-border);
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(74, 20, 140, 0.15);
        }

        .feature-card-icon {
            width: 55px; height: 55px;
            background: var(--gradient-primary);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-bottom: 1.25rem;
        }

        .feature-card h4 {
            margin-top: 0;
            color: var(--waka-primary);
            font-size: 1.15rem;
        }

        .content-section.dark .feature-card h4 {
            color: var(--waka-accent-yellow);
        }

        .feature-card p {
            font-size: 0.95rem;
            color: var(--waka-text-light);
            margin-bottom: 0;
        }

        .content-section.dark .feature-card p {
            color: rgba(255, 255, 255, 0.8);
        }

        /* COMPARISON BOX */
        .comparison-box {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }

        .comparison-item {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid var(--waka-primary-pale);
        }

        .comparison-item.positive {
            border-left: 4px solid var(--success-color);
        }

        .comparison-item.negative {
            border-left: 4px solid var(--error-color);
        }

        .comparison-title {
            font-weight: 700;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* TIMELINE */
        .timeline {
            position: relative;
            padding-left: 3rem;
            margin: 2rem 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--gradient-primary);
            border-radius: 3px;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 2rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -3rem;
            top: 0.25rem;
            width: 16px;
            height: 16px;
            background: var(--waka-accent-yellow);
            border-radius: 50%;
            border: 3px solid var(--waka-primary);
        }

        .timeline-title {
            font-weight: 700;
            color: var(--waka-primary);
            margin-bottom: 0.5rem;
        }

        /* STATS ROW */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-box {
            background: linear-gradient(135deg, rgba(74, 20, 140, 0.08) 0%, rgba(123, 31, 162, 0.04) 100%);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--waka-primary-pale);
        }

        .stat-box-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--waka-primary);
        }

        .stat-box-label {
            font-size: 0.85rem;
            color: var(--waka-text-light);
            margin-top: 0.5rem;
        }

        /* TECH STACK */
        .tech-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(74, 20, 140, 0.1);
            color: var(--waka-primary);
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 0.25rem;
        }

        .content-section.dark .tech-badge {
            background: rgba(255, 193, 7, 0.15);
            color: var(--waka-accent-yellow);
        }

        /* BACK TO TOP */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(74, 20, 140, 0.4);
            transition: all 0.3s ease;
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            border: none;
        }

        .back-to-top.visible { opacity: 1; visibility: visible; }
        .back-to-top:hover { transform: translateY(-5px); }

        /* FOOTER */
        .doc-footer {
            background: rgba(26, 0, 51, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 4rem;
            text-align: center;
            margin-top: 3rem;
            border: 1px solid var(--waka-glass-border);
        }

        .footer-logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .footer-tagline { font-size: 1.2rem; opacity: 0.8; margin-bottom: 2rem; }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .footer-link {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-link:hover { color: var(--waka-accent-yellow); }

        .footer-meta { font-size: 0.85rem; opacity: 0.5; }

        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .sidebar { width: 300px; }
            .main-content { margin-left: 300px; padding: 2rem 3rem; }
        }

        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s ease; }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; }
            .comparison-box { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .page-header { padding: 2rem; }
            .page-header h1 { font-size: 2rem; }
            .content-section { padding: 2rem; }
            .cards-grid { grid-template-columns: 1fr; }
        }

        /* PRINT */
        @media print {
            .sidebar, .back-to-top { display: none; }
            .main-content { margin-left: 0; }
            .content-section { break-inside: avoid; box-shadow: none; border: 1px solid #ddd; }
        }
    </style>
</head>
<body>
    <!-- SIDEBAR NAVIGATION -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <img src="../static/images/logo.png" alt="Waka Voice" onerror="this.style.display='none'">
                <h1>WAKA VOICE</h1>
            </div>
            <span class="sidebar-version">v3.1-bargein</span>
            <span class="sidebar-date">D√©cembre 2025</span>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Partie I - Introduction</div>
            <a href="#introduction" class="nav-link active"><i class="bi bi-house"></i> Pr√©sentation, Vision & Strat√©gie</a>
            <a href="#rag" class="nav-link"><i class="bi bi-search"></i> Module RAG</a>
            <a href="#architecture" class="nav-link"><i class="bi bi-diagram-3"></i> Architecture</a>
            <a href="#database" class="nav-link"><i class="bi bi-database"></i> Base de donn√©es</a>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Partie II - Ressources</div>
            <a href="#personal-voice" class="nav-link"><i class="bi bi-mic"></i> Voix Personnelles</a>
            <a href="#tools" class="nav-link"><i class="bi bi-tools"></i> Syst√®me de Tools</a>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Partie III - Agents</div>
            <a href="#text-agents" class="nav-link"><i class="bi bi-chat-text"></i> Agents Texte</a>
            <a href="#voice-agents" class="nav-link"><i class="bi bi-telephone"></i> Agents Voix</a>
            <a href="#avatar-agents" class="nav-link"><i class="bi bi-person-video"></i> Agents Avatar</a>
            <a href="#integration" class="nav-link"><i class="bi bi-plug"></i> Int√©gration</a>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Partie IV - Technique</div>
            <a href="#capacity-scalability" class="nav-link"><i class="bi bi-diagram-3"></i> Capacit√© & Scalabilit√©</a>
            <a href="#code-framework" class="nav-link"><i class="bi bi-code-slash"></i> Code & Framework</a>
            <a href="#advanced-architecture" class="nav-link"><i class="bi bi-cpu"></i> Architecture Avanc√©e</a>
            <a href="#azure-resources" class="nav-link"><i class="bi bi-cloud-fill"></i> Ressources Azure</a>
            <a href="#models-comparison" class="nav-link"><i class="bi bi-bar-chart-line"></i> Mod√®les & Benchmarks</a>
            <a href="#watchdog" class="nav-link"><i class="bi bi-shield-check"></i> Watchdog</a>
            <a href="#tool-validator" class="nav-link"><i class="bi bi-check2-circle"></i> Tool Validator</a>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Partie V - Guides</div>
            <a href="#user-manual" class="nav-link"><i class="bi bi-book"></i> Manuel Utilisateur</a>
        </div>

        <div class="nav-section">
            <div class="nav-section-title">Partie VI - √âvolution</div>
            <a href="#changelog" class="nav-link"><i class="bi bi-clock-history"></i> Changelog & Perspectives</a>
        </div>

    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <!-- PAGE HEADER -->
        <header class="page-header">
            <h1>WAKA VOICE</h1>
            <p class="subtitle">Documentation Technique Exhaustive</p>
            <p class="description">
                Guide complet de la plateforme d'agents conversationnels IA multimodaux.
                Cette documentation couvre l'ensemble des fonctionnalit√©s, les choix architecturaux,
                les justifications techniques et les bonnes pratiques d'impl√©mentation.
            </p>
            <div class="header-stats">
                <div class="header-stat">
                    <div class="header-stat-value">600+</div>
                    <div class="header-stat-label">Voix Azure</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value">12</div>
                    <div class="header-stat-label">Mod√®les Voice</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value">3</div>
                    <div class="header-stat-label">Modalit√©s</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value">4</div>
                    <div class="header-stat-label">Types Tools</div>
                </div>
                <div class="header-stat">
                    <div class="header-stat-value">30+</div>
                    <div class="header-stat-label">Avatars</div>
                </div>
            </div>
        </header>

        <!-- ==========================================
             CHAPITRE 1: INTRODUCTION
             ========================================== -->
        <section id="introduction" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-info-circle"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 1: Pr√©sentation, Vision & Strat√©gie</h1>
                    <p class="section-subtitle">Introduction compl√®te √† la plateforme Waka Voice et ses fondations techniques</p>
                </div>
            </div>

            <div class="intro-text">
                <strong>Waka Voice</strong> est le <strong>centre d'appel IA</strong> d√©velopp√© par <strong>Waka Company</strong>,
                con√ßu pour r√©pondre aux besoins de sous-traitance d'op√©rations d'appels de ses clients entreprises.
                Cette plateforme permet de d√©ployer des agents vocaux IA personnalis√©s pour divers types d'op√©rations
                (recouvrement, t√©l√©vente, support client, enqu√™tes, prise de RDV) avec une promesse forte :
                <strong>moins de 30 minutes</strong> pour configurer et lancer un agent enti√®rement personnalis√©.
            </div>

            <!-- PROMESSE CL√â -->
            <div class="callout callout-success" style="margin: 2rem 0;">
                <i class="bi bi-stopwatch callout-icon" style="font-size: 2rem;"></i>
                <div class="callout-content">
                    <div class="callout-title" style="font-size: 1.3rem;">La Promesse Waka Voice : 30 Minutes</div>
                    <p style="font-size: 1.1rem; margin: 0;">
                        De la demande client au premier appel : <strong>personnalisation compl√®te de la voix</strong>,
                        adaptation au type d'op√©ration, int√©gration des donn√©es client, et d√©ploiement op√©rationnel
                        en <strong>moins de 30 minutes</strong>.
                    </p>
                </div>
            </div>

            <h2>1.1 Waka Company : L'Offre de Sous-Traitance IA</h2>

            <div class="intro-text">
                <strong>Waka Company</strong> se positionne comme un partenaire de sous-traitance pour les entreprises
                souhaitant externaliser leurs op√©rations d'appels. Waka Voice est l'outil technologique qui permet
                de r√©pondre √† cette demande avec une agilit√© et une personnalisation in√©gal√©es.
            </div>

            <h3>Mod√®le de Service</h3>

            <div class="mermaid">
flowchart LR
    subgraph Clients["üè¢ Clients Entreprises"]
        C1[Banque / Assurance]
        C2[E-commerce / Retail]
        C3[T√©l√©coms / √ânergie]
        C4[Sant√© / Services]
    end

    subgraph WakaCompany["üéØ Waka Company"]
        direction TB
        INTAKE[R√©ception Demande]
        CONFIG[Configuration<br/>< 30 min]
        DEPLOY[D√©ploiement]
        OPS[Op√©rations 24/7]
    end

    subgraph WakaVoice["üéôÔ∏è Waka Voice Platform"]
        direction TB
        AGENTS[Agents IA Personnalis√©s]
        VOICES[Voix Sur Mesure]
        TOOLS[Int√©grations Client]
        ANALYTICS[Reporting Temps R√©el]
    end

    C1 & C2 & C3 & C4 -->|Demande de sous-traitance| INTAKE
    INTAKE --> CONFIG
    CONFIG --> DEPLOY
    DEPLOY --> OPS

    OPS --> AGENTS
    AGENTS --> VOICES
    AGENTS --> TOOLS
    OPS --> ANALYTICS

    style WakaCompany fill:#4A148C,color:#fff
    style WakaVoice fill:#1565C0,color:#fff
            </div>

            <h3>Types d'Op√©rations Sous-Trait√©es</h3>

            <div class="cards-grid">
                <div class="feature-card">
                    <div class="feature-card-icon" style="background: linear-gradient(135deg, #C62828, #E53935);"><i class="bi bi-cash-coin"></i></div>
                    <h4>Recouvrement de Cr√©ances</h4>
                    <p>
                        Relances amiables, n√©gociation de plans de paiement, prise de promesses (PTP).
                        Personnalisation du ton selon le profil d√©biteur et l'anciennet√© de la cr√©ance.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon" style="background: linear-gradient(135deg, #2E7D32, #43A047);"><i class="bi bi-megaphone"></i></div>
                    <h4>T√©l√©vente & Prospection</h4>
                    <p>
                        Campagnes d'appels sortants, qualification de leads, prise de rendez-vous commerciaux.
                        Scripts adaptatifs selon les r√©ponses du prospect.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon" style="background: linear-gradient(135deg, #1565C0, #1976D2);"><i class="bi bi-headset"></i></div>
                    <h4>Support Client Niveau 1</h4>
                    <p>
                        Traitement des demandes simples, FAQ, suivi de commande, r√©initialisation.
                        Escalade intelligente vers agents humains pour cas complexes.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon" style="background: linear-gradient(135deg, #6A1B9A, #8E24AA);"><i class="bi bi-clipboard-check"></i></div>
                    <h4>Enqu√™tes & Satisfaction</h4>
                    <p>
                        Collecte de feedback post-interaction, NPS, √©tudes de march√©.
                        Analyse de sentiment en temps r√©el et verbatims enrichis.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon" style="background: linear-gradient(135deg, #E65100, #F57C00);"><i class="bi bi-calendar-check"></i></div>
                    <h4>Prise de Rendez-Vous</h4>
                    <p>
                        Qualification, v√©rification des disponibilit√©s, confirmation automatique.
                        Int√©gration calendriers (Outlook, Google Calendar, CRM).
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon" style="background: linear-gradient(135deg, #00695C, #00897B);"><i class="bi bi-person-badge"></i></div>
                    <h4>Accueil & Orientation</h4>
                    <p>
                        Agents avatar pour accueil premium en agence ou sur site web.
                        Qualification du besoin et routage vers le bon service.
                    </p>
                </div>
            </div>

            <h2>1.2 L'Ambition : D√©ploiement en 30 Minutes</h2>

            <div class="intro-text">
                L'ambition de Waka Voice est de permettre √† Waka Company de r√©pondre √† une nouvelle demande client
                en <strong>moins de 30 minutes</strong>, avec une personnalisation compl√®te. Ce d√©lai record est rendu possible
                par une architecture modulaire et des outils de configuration avanc√©s.
            </div>

            <h3>Parcours de D√©ploiement Express</h3>

            <div class="mermaid">
flowchart LR
    subgraph Phase1["‚è±Ô∏è 0-5 min"]
        A1[R√©ception Brief Client]
        A2[S√©lection Type Op√©ration]
    end

    subgraph Phase2["‚è±Ô∏è 5-15 min"]
        B1[Choix/Cr√©ation Voix]
        B2[Configuration Agent]
        B3[R√©daction Instructions]
    end

    subgraph Phase3["‚è±Ô∏è 15-25 min"]
        C1[Int√©gration Tools Client]
        C2[Import Base Contacts]
        C3[Tests Conversation]
    end

    subgraph Phase4["‚è±Ô∏è 25-30 min"]
        D1[Validation Qualit√©]
        D2[D√©ploiement Production]
        D3[Premier Appel]
    end

    A1 --> A2 --> B1 --> B2 --> B3 --> C1 --> C2 --> C3 --> D1 --> D2 --> D3

    style Phase1 fill:#E3F2FD,stroke:#1565C0
    style Phase2 fill:#E8F5E9,stroke:#2E7D32
    style Phase3 fill:#FFF3E0,stroke:#E65100
    style Phase4 fill:#F3E5F5,stroke:#6A1B9A
            </div>

            <h3>Les Cl√©s du D√©ploiement Rapide</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>√âl√©ment</th>
                            <th>Personnalisation Disponible</th>
                            <th>Temps Moyen</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Voix</strong></td>
                            <td>600+ voix Azure, 100+ voix HD, voix personnalis√©es clon√©es, voix OpenAI natives</td>
                            <td>2-5 min</td>
                        </tr>
                        <tr>
                            <td><strong>Langue & Accent</strong></td>
                            <td>140+ langues, accents r√©gionaux, adaptation dialectale</td>
                            <td>1 min</td>
                        </tr>
                        <tr>
                            <td><strong>Ton & Personnalit√©</strong></td>
                            <td>Templates m√©tier (recouvrement, commercial, support), personnalisation fine</td>
                            <td>3-5 min</td>
                        </tr>
                        <tr>
                            <td><strong>Instructions M√©tier</strong></td>
                            <td>Prompt Builder avec 4 m√©thodes (templates, phases, import, g√©n√©ration IA)</td>
                            <td>5-10 min</td>
                        </tr>
                        <tr>
                            <td><strong>Int√©grations</strong></td>
                            <td>API REST client, base de donn√©es, CRM, calendrier, paiement</td>
                            <td>5-10 min</td>
                        </tr>
                        <tr>
                            <td><strong>Base Contacts</strong></td>
                            <td>Import CSV/Excel, connexion CRM, API temps r√©el</td>
                            <td>2-5 min</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="callout callout-info">
                <i class="bi bi-lightbulb callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Approche No-Code / Low-Code</div>
                    <p>
                        Waka Voice a √©t√© con√ßu pour √™tre utilisable par les √©quipes op√©rationnelles de Waka Company,
                        sans intervention des d√©veloppeurs pour les d√©ploiements standards. L'interface visuelle
                        permet de cr√©er un agent fonctionnel en quelques clics, tandis que les APIs permettent
                        des int√©grations avanc√©es pour les cas complexes.
                    </p>
                </div>
            </div>

            <h2>1.3 Vision Technique : Les 3 Piliers</h2>

            <p>
                Pour atteindre cette promesse de d√©ploiement rapide tout en garantissant une qualit√© d'interaction
                indiscernable d'un agent humain, Waka Voice repose sur trois piliers techniques fondamentaux.
            </p>

            <h3>Pilier 1 : Naturalit√© des Conversations</h3>

            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-box-value">&lt;300ms</div>
                    <div class="stat-box-label">Latence bout en bout</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">Barge-in</div>
                    <div class="stat-box-label">Interruption naturelle</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">VAD</div>
                    <div class="stat-box-label">D√©tection s√©mantique</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">600+</div>
                    <div class="stat-box-label">Voix naturelles</div>
                </div>
            </div>

            <ul>
                <li><strong>Latence ultra-faible (&lt;300ms)</strong> : Architecture WebSocket bidirectionnelle garantissant des temps de r√©ponse imperceptibles</li>
                <li><strong>Barge-in (interruption)</strong> : L'utilisateur peut interrompre l'agent √† tout moment, comme dans une vraie conversation</li>
                <li><strong>VAD s√©mantique</strong> : D√©tection intelligente de fin de phrase, m√™me apr√®s une pause de r√©flexion</li>
                <li><strong>Voix expressives</strong> : Voix Azure Neural avec √©motions, intonations et styles adapt√©s au contexte</li>
            </ul>

            <h3>Pilier 2 : Puissance Agentique (Actions R√©elles)</h3>

            <ul>
                <li><strong>Syst√®me de Tools extensible</strong> : 4 types (API REST, MCP, Python, OpenAPI) pour int√©grer tout syst√®me client</li>
                <li><strong>Raisonnement contextuel</strong> : GPT-5.2, Claude Opus 4.5, Grok 3 pour d√©cisions intelligentes</li>
                <li><strong>Cha√Ænage d'actions</strong> : V√©rification √©ligibilit√© ‚Üí Calcul ‚Üí Prise engagement ‚Üí Confirmation, en une seule conversation</li>
            </ul>

            <h3>Pilier 3 : Multimodalit√© Int√©gr√©e</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Modalit√©</th>
                            <th>Cas d'usage pour Waka Company</th>
                            <th>Avantages</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Voix (Voice Live)</strong></td>
                            <td>Recouvrement, t√©l√©vente, support t√©l√©phonique, campagnes sortantes</td>
                            <td>Naturel, √©motionnel, accessible, haute conversion</td>
                        </tr>
                        <tr>
                            <td><strong>Avatar (Azure Avatar)</strong></td>
                            <td>Accueil premium en agence, kiosques, sites web haut de gamme</td>
                            <td>Humanisation, engagement visuel, d√©monstrations</td>
                        </tr>
                        <tr>
                            <td><strong>Texte (Chat)</strong></td>
                            <td>Support web 24/7, FAQ, demandes simples, suivi commandes</td>
                            <td>Discret, tra√ßable, multit√¢che, co√ªt r√©duit</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>1.4 Fonctionnalit√©s D√©taill√©es</h2>

            <p>
                Waka Voice int√®gre un ensemble complet de fonctionnalit√©s con√ßues pour couvrir l'ensemble du cycle de vie
                des agents conversationnels, de la cr√©ation au d√©ploiement en passant par l'analyse et l'optimisation.
            </p>

            <h3>Cr√©ation d'agents</h3>

            <div class="callout callout-info">
                <i class="bi bi-lightbulb callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Approche No-Code / Low-Code</div>
                    <p>
                        Waka Voice a √©t√© con√ßu pour √™tre accessible aux √©quipes m√©tier, pas uniquement aux d√©veloppeurs.
                        L'interface visuelle permet de cr√©er un agent fonctionnel en moins de 30 minutes, sans √©crire
                        une seule ligne de code. Les d√©veloppeurs peuvent n√©anmoins aller plus loin avec les APIs et
                        les tools personnalis√©s.
                    </p>
                </div>
            </div>

            <ul>
                <li>
                    <strong>Interface unifi√©e de cr√©ation</strong> : Un wizard en 5 √©tapes guide l'utilisateur √† travers
                    le choix du type d'agent (voix/avatar/texte), la s√©lection du mod√®le IA, la configuration de la voix,
                    l'assignation des tools et la r√©daction des instructions.
                </li>
                <li>
                    <strong>Prompt Builder intelligent</strong> : 4 m√©thodes de g√©n√©ration de prompts (templates m√©tier,
                    construction par phases, import existant, g√©n√©ration IA) garantissent des instructions optimales
                    quelle que soit l'expertise de l'utilisateur.
                </li>
                <li>
                    <strong>Biblioth√®que de templates</strong> : Des templates pr√©-configur√©s pour les cas d'usage courants
                    (recouvrement, support client, prise de RDV, enqu√™tes satisfaction) acc√©l√®rent le d√©ploiement.
                </li>
                <li>
                    <strong>Versioning et rollback</strong> : Chaque modification cr√©e une version, permettant de revenir
                    √† une configuration pr√©c√©dente en cas de probl√®me.
                </li>
            </ul>

            <h3>Gestion des voix</h3>

            <p>
                La voix est l'√©l√©ment le plus critique pour la perception de naturalit√©. Waka Voice offre trois niveaux
                de personnalisation :
            </p>

            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-box-value">600+</div>
                    <div class="stat-box-label">Voix Azure Standard</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">100+</div>
                    <div class="stat-box-label">Voix HD Neural</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">‚àû</div>
                    <div class="stat-box-label">Voix Personnalis√©es</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">8</div>
                    <div class="stat-box-label">Voix OpenAI Natives</div>
                </div>
            </div>

            <ul>
                <li>
                    <strong>Voix Azure Standard</strong> : Plus de 600 voix couvrant toutes les langues majeures.
                    Qualit√© professionnelle suffisante pour la plupart des cas d'usage, avec un excellent rapport qualit√©/co√ªt.
                </li>
                <li>
                    <strong>Voix HD Neural</strong> : Voix premium avec expressions √©motionnelles, styles de parole
                    (joyeux, triste, professionnel) et qualit√© audio sup√©rieure. Recommand√©es pour les interactions
                    √† forte valeur ajout√©e.
                </li>
                <li>
                    <strong>Voix Personnalis√©es</strong> : Cr√©ation de voix uniques √† partir d'enregistrements.
                    Permet de reproduire la voix d'un porte-parole, cr√©er une identit√© sonore de marque, ou
                    offrir une voix famili√®re aux utilisateurs.
                </li>
            </ul>

            <h3>Capacit√©s agentiques (Tools)</h3>

            <p>
                Le syst√®me de Tools est ce qui transforme un simple chatbot en agent v√©ritablement autonome.
                Chaque type de tool r√©pond √† des besoins sp√©cifiques :
            </p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Cas d'usage</th>
                            <th>Complexit√©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>API REST</strong></td>
                            <td>Appels HTTP vers des endpoints externes avec mapping des param√®tres</td>
                            <td>Int√©gration CRM, m√©t√©o, recherche, paiements</td>
                            <td>Moyenne - configuration JSON</td>
                        </tr>
                        <tr>
                            <td><strong>MCP Server</strong></td>
                            <td>Model Context Protocol - standard √©mergent pour l'int√©gration LLM</td>
                            <td>Acc√®s bases de donn√©es, syst√®mes legacy, processus complexes</td>
                            <td>√âlev√©e - d√©veloppement serveur</td>
                        </tr>
                        <tr>
                            <td><strong>Code Python</strong></td>
                            <td>Scripts Python ex√©cut√©s dans un sandbox s√©curis√©</td>
                            <td>Calculs financiers, logique m√©tier, transformations</td>
                            <td>Moyenne - code Python</td>
                        </tr>
                        <tr>
                            <td><strong>Import OpenAPI</strong></td>
                            <td>Import automatique depuis une sp√©cification Swagger/OpenAPI</td>
                            <td>Int√©gration rapide d'APIs document√©es</td>
                            <td>Faible - upload fichier</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>1.5 Public Cible et Cas d'Usage</h2>

            <h3>Profils utilisateurs</h3>

            <p>
                Waka Voice s'adresse √† trois profils principaux, chacun avec des besoins et des niveaux
                d'expertise diff√©rents :
            </p>

            <div class="cards-grid">
                <div class="feature-card">
                    <div class="feature-card-icon"><i class="bi bi-briefcase"></i></div>
                    <h4>Responsables M√©tier</h4>
                    <p>
                        Directeurs de centres d'appels, responsables exp√©rience client, directeurs marketing.
                        Ils utilisent l'interface no-code pour cr√©er et g√©rer des agents, suivre les KPIs
                        dans les dashboards, et optimiser les parcours conversationnels.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon"><i class="bi bi-code-slash"></i></div>
                    <h4>D√©veloppeurs & Int√©grateurs</h4>
                    <p>
                        √âquipes techniques int√©grant Waka Voice dans des applications existantes.
                        Ils utilisent les APIs REST et WebSocket, d√©veloppent des tools personnalis√©s,
                        et configurent les int√©grations avanc√©es.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon"><i class="bi bi-building"></i></div>
                    <h4>D√©cideurs IT & Architectes</h4>
                    <p>
                        DSI, architectes solutions, responsables s√©curit√©. Ils √©valuent la conformit√©,
                        la scalabilit√©, les co√ªts et l'int√©gration dans l'√©cosyst√®me existant.
                        Cette documentation r√©pond √† leurs questions techniques.
                    </p>
                </div>
            </div>

            <h3>Cas d'usage principaux</h3>

            <div class="timeline">
                <div class="timeline-item">
                    <div class="timeline-title">Recouvrement de cr√©ances</div>
                    <p>
                        Automatisation des appels de relance avec personnalisation du discours selon le profil
                        d√©biteur, proposition de plans de paiement, prise de promesses de paiement, et mise √† jour
                        automatique du CRM. Taux de contact multipli√© par 3, co√ªt par contact divis√© par 5.
                    </p>
                </div>
                <div class="timeline-item">
                    <div class="timeline-title">Support client niveau 1</div>
                    <p>
                        Traitement automatique des demandes simples (suivi commande, FAQ, r√©initialisation mot de passe)
                        avec escalade intelligente vers des agents humains pour les cas complexes.
                        R√©duction de 60% du volume trait√© par les √©quipes humaines.
                    </p>
                </div>
                <div class="timeline-item">
                    <div class="timeline-title">Prise de rendez-vous</div>
                    <p>
                        Qualification des prospects, v√©rification des disponibilit√©s, cr√©ation de rendez-vous
                        dans l'agenda, envoi de confirmations. Utilis√© par les cabinets m√©dicaux, concessions auto,
                        agences immobili√®res. Disponibilit√© 24/7 vs horaires de bureau limit√©s.
                    </p>
                </div>
                <div class="timeline-item">
                    <div class="timeline-title">Accueil et orientation</div>
                    <p>
                        Agents avatar en kiosque ou sur site web pour accueillir, qualifier le besoin et orienter
                        vers le bon service ou interlocuteur. Exp√©rience premium avec personnage anim√©,
                        r√©duction des temps d'attente en agence.
                    </p>
                </div>
                <div class="timeline-item">
                    <div class="timeline-title">Enqu√™tes satisfaction</div>
                    <p>
                        Collecte de feedback post-interaction par appel ou chat, avec questionnaires adaptatifs
                        et analyse de sentiment en temps r√©el. Taux de r√©ponse sup√©rieur aux emails
                        (40% vs 5-10%), insights plus riches gr√¢ce au verbatim.
                    </p>
                </div>
            </div>

            <h2>1.6 Strat√©gie Technique : Fondations</h2>

            <div class="intro-text">
                Cette section explique les d√©cisions architecturales et technologiques qui sous-tendent Waka Voice.
                Comprendre ces choix permet d'appr√©hender les forces de la plateforme, ses compromis,
                et comment en tirer le meilleur parti.
            </div>

            <h3>1.6.1 Pourquoi Azure comme Fondation ?</h3>

            <p>
                Le choix d'Azure comme plateforme cloud principale n'est pas anodin. Il r√©sulte d'une analyse
                approfondie des alternatives (AWS, GCP, solutions on-premise) et de crit√®res pr√©cis.
            </p>

            <h4>Crit√®res de s√©lection</h4>

            <div class="comparison-box">
                <div class="comparison-item positive">
                    <div class="comparison-title"><i class="bi bi-check-circle-fill" style="color: var(--success-color)"></i> Avantages Azure</div>
                    <ul>
                        <li><strong>Suite Speech la plus compl√®te</strong> : STT, TTS, Custom Voice, Speaker Recognition dans un √©cosyst√®me unifi√©</li>
                        <li><strong>Voice Live API</strong> : Seul provider offrant des conversations temps r√©el avec latence &lt;300ms</li>
                        <li><strong>Avatar Service</strong> : Technologie unique de personnages 3D anim√©s avec synchronisation labiale</li>
                        <li><strong>OpenAI int√©gr√©</strong> : Acc√®s natif √† GPT-4, GPT-5, Realtime sans passer par un tiers</li>
                        <li><strong>Conformit√© europ√©enne</strong> : Datacenters EU, conformit√© RGPD, certifications bancaires</li>
                        <li><strong>Cosmos DB</strong> : Base NoSQL globalement distribu√©e avec latence garantie &lt;10ms</li>
                    </ul>
                </div>
                <div class="comparison-item negative">
                    <div class="comparison-title"><i class="bi bi-x-circle-fill" style="color: var(--error-color)"></i> Limitations accept√©es</div>
                    <ul>
                        <li><strong>Vendor lock-in partiel</strong> : D√©pendance aux APIs propri√©taires Azure, mitigation via abstraction</li>
                        <li><strong>Courbe d'apprentissage</strong> : √âcosyst√®me complexe, documentation parfois fragment√©e</li>
                        <li><strong>Disponibilit√© r√©gionale</strong> : Certains services (Voice Live) limit√©s √† quelques r√©gions</li>
                    </ul>
                </div>
            </div>

            <h4>Comparaison avec les alternatives</h4>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Crit√®re</th>
                            <th>Azure</th>
                            <th>AWS</th>
                            <th>GCP</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Voix temps r√©el</td>
                            <td><strong>Voice Live API</strong> - natif</td>
                            <td>Amazon Connect - t√©l√©phonie</td>
                            <td>Dialogflow CX - chat first</td>
                        </tr>
                        <tr>
                            <td>Nombre de voix TTS</td>
                            <td><strong>600+</strong></td>
                            <td>~200</td>
                            <td>~380</td>
                        </tr>
                        <tr>
                            <td>Avatars 3D</td>
                            <td><strong>Natif (Azure Avatar)</strong></td>
                            <td>Non disponible</td>
                            <td>Non disponible</td>
                        </tr>
                        <tr>
                            <td>LLM int√©gr√©s</td>
                            <td><strong>OpenAI + Anthropic + xAI</strong></td>
                            <td>Bedrock (Claude, Titan)</td>
                            <td>Gemini uniquement</td>
                        </tr>
                        <tr>
                            <td>Latence voix</td>
                            <td><strong>&lt;300ms</strong></td>
                            <td>500-800ms</td>
                            <td>400-600ms</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="callout callout-success">
                <i class="bi bi-award callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">D√©cision finale</div>
                    <p>
                        Azure s'impose comme le choix optimal pour une plateforme d'agents conversationnels multimodaux
                        gr√¢ce √† son √©cosyst√®me Speech in√©gal√©, son int√©gration native avec OpenAI, et ses services
                        uniques comme Azure Avatar. Les limitations identifi√©es sont g√©rables via une architecture
                        d'abstraction et un monitoring proactif.
                    </p>
                </div>
            </div>

            <h3>1.6.2 Pourquoi Flask et Python ?</h3>

            <p>
                Le choix de Flask comme framework backend, associ√© √† Python 3.13+, r√©pond √† des crit√®res
                de productivit√©, de flexibilit√© et d'√©cosyst√®me.
            </p>

            <h4>Arguments en faveur de Flask</h4>

            <ul>
                <li>
                    <strong>L√©g√®ret√© et flexibilit√©</strong> : Contrairement √† Django qui impose une structure,
                    Flask permet une architecture sur mesure adapt√©e √† nos besoins sp√©cifiques (Blueprints modulaires,
                    WebSocket via flask-sock, pas d'ORM impos√©).
                </li>
                <li>
                    <strong>√âcosyst√®me Python IA</strong> : Python domine l'√©cosyst√®me IA/ML. Nos int√©grations avec
                    Azure Cognitive Services, OpenAI, et les biblioth√®ques de traitement audio b√©n√©ficient d'un
                    support de premi√®re classe.
                </li>
                <li>
                    <strong>Productivit√© de d√©veloppement</strong> : Syntaxe claire, typage optionnel (utilis√© via
                    type hints), debugging facilit√©, hot-reload en d√©veloppement. Temps de mise sur le march√© r√©duit.
                </li>
                <li>
                    <strong>Support WebSocket natif</strong> : flask-sock offre une int√©gration WebSocket √©l√©gante
                    sans n√©cessiter de serveur s√©par√© (vs Node.js + Socket.io).
                </li>
            </ul>

            <h4>Alternatives consid√©r√©es et rejet√©es</h4>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Alternative</th>
                            <th>Raison du rejet</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>FastAPI</strong></td>
                            <td>
                                Excellente option, mais √©cosyst√®me moins mature pour WebSocket temps r√©el.
                                La gestion async native est un avantage, mais flask-sock + gevent offre
                                des performances suffisantes avec une courbe d'apprentissage moindre.
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Django</strong></td>
                            <td>
                                Trop opinionated pour notre architecture. L'ORM int√©gr√© est inutile avec Cosmos DB,
                                et le syst√®me de templates est superflu pour une API-first approach.
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Node.js (Express)</strong></td>
                            <td>
                                Callback hell, typage faible (m√™me avec TypeScript), √©cosyst√®me IA moins riche.
                                Les SDKs Azure Python sont plus complets et mieux maintenus.
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Go (Gin/Echo)</strong></td>
                            <td>
                                Performances excellentes, mais productivit√© moindre, √©cosyst√®me IA quasi inexistant,
                                et recrutement de d√©veloppeurs Go plus difficile.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>1.6.3 Pourquoi Cosmos DB ?</h3>

            <p>
                Le choix de Cosmos DB comme base de donn√©es principale est motiv√© par les exigences sp√©cifiques
                des agents conversationnels : donn√©es semi-structur√©es, latence faible, scalabilit√© globale.
            </p>

            <h4>Caract√©ristiques d√©cisives</h4>

            <div class="cards-grid">
                <div class="feature-card">
                    <div class="feature-card-icon"><i class="bi bi-lightning-charge"></i></div>
                    <h5>Latence garantie &lt;10ms</h5>
                    <p>
                        SLA de latence au 99√®me percentile. Critique pour ne pas ajouter de d√©lai
                        dans les conversations temps r√©el o√π chaque milliseconde compte.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon"><i class="bi bi-globe2"></i></div>
                    <h5>Distribution globale</h5>
                    <p>
                        R√©plication automatique multi-r√©gion. Les donn√©es suivent les utilisateurs,
                        r√©duisant la latence pour les d√©ploiements internationaux.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon"><i class="bi bi-braces"></i></div>
                    <h5>Sch√©ma flexible (JSON)</h5>
                    <p>
                        Les configurations d'agents √©voluent fr√©quemment. Un sch√©ma rigide SQL
                        n√©cessiterait des migrations constantes. JSON permet l'√©volution sans friction.
                    </p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon"><i class="bi bi-arrows-expand"></i></div>
                    <h5>Scalabilit√© automatique</h5>
                    <p>
                        Provisioned ou Serverless, Cosmos DB scale automatiquement avec la charge.
                        Pas de DBA n√©cessaire pour g√©rer les pics de trafic.
                    </p>
                </div>
            </div>

            <h4>Mod√©lisation des donn√©es</h4>

            <p>
                Notre mod√©lisation suit le pattern "one-to-few" recommand√© pour Cosmos DB :
                les documents sont auto-suffisants et contiennent toutes les donn√©es n√©cessaires
                pour √©viter les jointures co√ªteuses.
            </p>

            <pre><code>// Exemple : Document Agent complet (pas de r√©f√©rences externes)
{
  "id": "agent-uuid-12345",
  "partitionKey": "agent-uuid-12345",  // Partition = ID pour distribution optimale
  "type": "VoiceAgent",
  "metadata": {
    "name": "Agent Recouvrement Premium",
    "reference": "Agent-000042",
    "status": "active",
    "createdAt": "2025-12-29T10:00:00Z",
    "updatedAt": "2025-12-29T15:30:00Z",
    "createdBy": "user-uuid-xxx"
  },
  "configuration": {
    "model": {
      "id": "gpt-realtime",
      "family": "F1",
      "temperature": 0.7,
      "maxTokens": 2000
    },
    "voice": {
      "type": "azure_tts",
      "id": "fr-FR-DeniseNeural",
      "locale": "fr-FR"
    },
    "vad": {
      "type": "azure_semantic_vad",
      "threshold": 0.3,
      "silenceDurationMs": 300
    }
  },
  "instructions": "Tu es un agent de recouvrement professionnel...",
  "tools": [
    // Tools embarqu√©s, pas de r√©f√©rence
    {
      "name": "check_client_status",
      "type": "api",
      "endpoint": "https://crm.example.com/api/clients/{id}/status"
    }
  ],
  "analytics": {
    "totalCalls": 1523,
    "avgDuration": 187,
    "successRate": 0.72
  }
}</code></pre>

            <div class="callout callout-warning">
                <i class="bi bi-exclamation-triangle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Compromis de la d√©normalisation</div>
                    <p>
                        Cette approche d√©normalis√©e implique une duplication potentielle des donn√©es
                        (ex: d√©finition d'un tool copi√©e dans chaque agent qui l'utilise).
                        C'est un compromis acceptable car : (1) les lectures sont bien plus fr√©quentes
                        que les √©critures, (2) la consistance √©ventuelle est acceptable pour les configs,
                        (3) la simplicit√© de requ√™tage compense la duplication.
                    </p>
                </div>
            </div>

            <h3>1.6.4 Architecture Temps R√©el : WebSocket Bidirectionnel</h3>

            <p>
                La conversation vocale en temps r√©el est le d√©fi technique central de Waka Voice.
                Notre architecture de proxy WebSocket bidirectionnel est le r√©sultat de nombreuses
                it√©rations pour atteindre les objectifs de latence et de fiabilit√©.
            </p>

            <h4>Pourquoi un proxy et pas une connexion directe ?</h4>

            <p>
                Une approche na√Øve connecterait directement le navigateur √† Azure Voice Live API.
                Nous avons opt√© pour un proxy interm√©diaire pour plusieurs raisons critiques :
            </p>

            <ul>
                <li>
                    <strong>S√©curit√© des credentials</strong> : Les cl√©s API Azure ne doivent jamais
                    √™tre expos√©es c√¥t√© client. Le proxy garde les secrets c√¥t√© serveur et authentifie
                    chaque connexion.
                </li>
                <li>
                    <strong>Ex√©cution des Tools</strong> : Quand l'agent IA d√©cide d'appeler un tool,
                    cette ex√©cution doit se faire c√¥t√© serveur (appels API, acc√®s BDD, code Python).
                    Le proxy intercepte les tool_calls et les ex√©cute avant de renvoyer le r√©sultat.
                </li>
                <li>
                    <strong>Logging et analytics</strong> : Toutes les transcriptions passent par le
                    proxy, permettant un logging centralis√©, l'analyse de sentiment en temps r√©el,
                    et l'alimentation des dashboards sans impact sur la latence client.
                </li>
                <li>
                    <strong>Gestion des sessions</strong> : Le proxy maintient l'√©tat de chaque session
                    (transcriptions, r√©sultats de tools, m√©triques) et persiste dans Cosmos DB en fin
                    de conversation avec une seule √©criture optimis√©e.
                </li>
                <li>
                    <strong>R√©silience</strong> : Le proxy peut g√©rer les reconnexions, timeouts,
                    et erreurs Azure de mani√®re transparente pour le client, am√©liorant l'exp√©rience
                    utilisateur.
                </li>
            </ul>

            <h4>Flux de donn√©es d√©taill√©</h4>

            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant B as Browser
    participant P as Proxy Flask
    participant A as Azure Voice Live
    participant T as Tools Executor
    participant C as Cosmos DB

    Note over U,C: Initialisation de session
    U->>B: Clic "D√©marrer conversation"
    B->>P: WS Connect /voice-proxy/ws/{agent_id}
    P->>C: Lire config agent
    C-->>P: Config JSON
    P->>A: WS Connect Azure Voice Live
    A-->>P: session.created
    P->>A: session.update (config agent)
    P-->>B: session.ready
    P->>C: Cr√©er document session

    Note over U,C: Boucle de conversation
    U->>B: Parle au microphone
    B->>P: input_audio_buffer.append (base64 PCM16)
    P->>A: input_audio_buffer.append

    A-->>P: input_audio_buffer.speech_started
    P-->>B: speech_started (UI feedback)

    A-->>P: input_audio_buffer.speech_stopped
    A-->>P: conversation.item.created (transcription user)
    P->>P: Log transcription + Sentiment analysis

    A-->>P: response.created

    loop Streaming audio
        A-->>P: response.audio.delta (chunks)
        P-->>B: response.audio.delta
        B->>U: Lecture audio
    end

    A-->>P: response.audio_transcript.done
    P->>P: Log transcription agent
    A-->>P: response.done

    Note over U,C: Tool call (optionnel)
    A-->>P: response.function_call_arguments.done
    P->>T: Ex√©cuter tool (API/Python/MCP)
    T-->>P: R√©sultat tool
    P->>A: conversation.item.create (tool_result)
    A->>A: Continuer r√©ponse avec r√©sultat

    Note over U,C: Fin de session
    U->>B: Clic "Terminer"
    B->>P: session.end
    P->>A: Fermer connexion Azure
    P->>C: Update session (historique complet, co√ªts, outcome)
    P-->>B: session.closed
            </div>

            <h4>Optimisations de latence</h4>

            <p>
                Chaque milliseconde compte dans une conversation vocale. Voici les optimisations
                impl√©ment√©es pour minimiser la latence :
            </p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Optimisation</th>
                            <th>Impact</th>
                            <th>Impl√©mentation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Cache config agent</strong></td>
                            <td>-50ms par message</td>
                            <td>La config agent est lue une seule fois au d√©marrage et cach√©e en m√©moire</td>
                        </tr>
                        <tr>
                            <td><strong>√âcriture Cosmos diff√©r√©e</strong></td>
                            <td>-20ms par message</td>
                            <td>Les transcriptions s'accumulent en m√©moire, un seul write en fin de session</td>
                        </tr>
                        <tr>
                            <td><strong>Thread d√©di√© Azure</strong></td>
                            <td>-30ms</td>
                            <td>Un thread s√©par√© √©coute Azure, √©vitant le blocage du thread principal</td>
                        </tr>
                        <tr>
                            <td><strong>Connection pooling</strong></td>
                            <td>-100ms (premier message)</td>
                            <td>Connexion Azure √©tablie d√®s le connect client, pas au premier message</td>
                        </tr>
                        <tr>
                            <td><strong>Binary frames</strong></td>
                            <td>-10% bande passante</td>
                            <td>L'audio est envoy√© en frames binaires, pas en base64 JSON quand possible</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </section>

        <!-- ==========================================
             MODULE RAG - RETRIEVAL AUGMENTED GENERATION (ENRICHI)
             Documentation compl√®te du syst√®me RAG
             ========================================== -->
        <section id="rag" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-search"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Module RAG</h1>
                    <p class="section-subtitle">Retrieval Augmented Generation - Base de Connaissances Intelligente</p>
                </div>
            </div>

            <div class="intro-text">
                Le module <strong>RAG (Retrieval Augmented Generation)</strong> de Waka Voice permet d'enrichir
                les r√©ponses des agents avec des connaissances issues de vos documents d'entreprise. Gr√¢ce √†
                la recherche vectorielle s√©mantique, les agents peuvent acc√©der √† vos proc√©dures, politiques,
                documentation technique et bases de connaissances en temps r√©el, garantissant des r√©ponses
                contextuellement pertinentes et toujours √† jour.
            </div>

            <!-- STATISTIQUES CL√âS RAG -->
            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-box-value">3</div>
                    <div class="stat-box-label">Sources d'ingestion</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">6</div>
                    <div class="stat-box-label">√âtapes de pipeline</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">1536</div>
                    <div class="stat-box-label">Dimensions embedding</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">500+</div>
                    <div class="stat-box-label">Pages/min (crawl)</div>
                </div>
            </div>

            <h2>Stack Technique RAG</h2>

            <div style="margin: 1.5rem 0;">
                <span class="tech-badge"><i class="bi bi-filetype-py"></i> Flask Blueprint</span>
                <span class="tech-badge"><i class="bi bi-microsoft"></i> Microsoft Graph API</span>
                <span class="tech-badge"><i class="bi bi-file-earmark-text"></i> Azure Document Intelligence</span>
                <span class="tech-badge"><i class="bi bi-search"></i> Azure AI Search</span>
                <span class="tech-badge"><i class="bi bi-database"></i> Cosmos DB</span>
                <span class="tech-badge"><i class="bi bi-cloud"></i> Azure Blob Storage</span>
                <span class="tech-badge"><i class="bi bi-vector-pen"></i> text-embedding-3-small</span>
                <span class="tech-badge"><i class="bi bi-robot"></i> GPT-5-mini</span>
            </div>

            <h2>Pourquoi le RAG est-il essentiel ?</h2>

            <div class="callout callout-info">
                <i class="bi bi-lightbulb callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Le d√©fi des LLMs g√©n√©riques</div>
                    <p>
                        Les mod√®les de langage (LLM) sont entra√Æn√©s sur des donn√©es publiques jusqu'√† une date
                        de coupure. Ils ne connaissent pas vos documents internes, vos proc√©dures sp√©cifiques,
                        ni vos derni√®res mises √† jour. Le RAG r√©sout ce probl√®me en injectant dynamiquement
                        le contexte pertinent issu de vos propres sources dans chaque r√©ponse.
                    </p>
                </div>
            </div>

            <div class="comparison-box">
                <div class="comparison-column">
                    <div class="comparison-header success">Avec RAG</div>
                    <ul class="comparison-list">
                        <li>R√©ponses bas√©es sur vos documents internes</li>
                        <li>Mise √† jour instantan√©e des connaissances</li>
                        <li>Sources citables et tra√ßables</li>
                        <li>R√©ponses contextuellement pertinentes</li>
                        <li>R√©duction des hallucinations du mod√®le</li>
                    </ul>
                </div>
                <div class="comparison-column">
                    <div class="comparison-header warning">Sans RAG</div>
                    <ul class="comparison-list">
                        <li>R√©ponses g√©n√©riques bas√©es sur donn√©es publiques</li>
                        <li>Connaissances limit√©es √† la date de training</li>
                        <li>Impossible de citer des sources internes</li>
                        <li>Risque de r√©ponses incorrectes ou obsol√®tes</li>
                        <li>Hallucinations sur les sujets sp√©cifiques</li>
                    </ul>
                </div>
            </div>

            <h2>Architecture Globale du Module RAG</h2>

            <p>
                Le module RAG de Waka Voice s'appuie sur une architecture robuste int√©grant plusieurs
                services Azure pour offrir une recherche s√©mantique performante et scalable :
            </p>

            <div class="mermaid">
flowchart TB
    subgraph Sources["Sources de Donn√©es"]
        SP["<b>SharePoint</b><br/>Microsoft Graph API"]
        WEB["<b>Web Crawler</b><br/>aiohttp + Playwright"]
        UPLOAD["<b>Upload Direct</b><br/>Interface Web"]
    end

    subgraph Ingestion["Pipeline d'Indexation (6 √©tapes)"]
        DI["<b>1. Extraction</b><br/>Azure Document Intelligence"]
        CHUNK["<b>2. Chunking</b><br/>800 chars + overlap 100"]
        SUMMARY["<b>3. R√©sum√©</b><br/>GPT-5-mini"]
        ENTITIES["<b>4. Entit√©s</b><br/>Azure Text Analytics"]
        EMBED["<b>5. Embeddings</b><br/>text-embedding-3-small"]
        INDEX["<b>6. Indexation</b><br/>Azure AI Search"]
    end

    subgraph Storage["Stockage Multi-Bases"]
        BLOB[("Azure Blob Storage<br/>Documents originaux")]
        COSMOS[("Cosmos DB RAG_base<br/>Chunks + m√©tadonn√©es")]
        SEARCH[("Azure AI Search<br/>Index vectoriel HNSW")]
    end

    subgraph Query["Recherche & Retrieval"]
        INTENT["G√©n√©ration Intent<br/>GPT-4"]
        VECTOR["Recherche Vectorielle<br/>Cosine similarity"]
        FILTER["Filtrage Projet<br/>OData filter"]
        RANK["Scoring & Ranking<br/>Top-K results"]
    end

    subgraph Agent["Int√©gration Agent"]
        TOOL["search_knowledge_base<br/>Tool"]
        CONTEXT["Injection Contexte<br/>dans prompt"]
        RESPONSE["R√©ponse Enrichie<br/>avec sources"]
    end

    SP --> DI
    WEB --> DI
    UPLOAD --> DI

    DI --> CHUNK
    CHUNK --> SUMMARY
    CHUNK --> ENTITIES
    SUMMARY --> EMBED
    ENTITIES --> EMBED
    EMBED --> INDEX

    DI --> BLOB
    INDEX --> COSMOS
    INDEX --> SEARCH

    TOOL --> INTENT
    INTENT --> VECTOR
    VECTOR --> SEARCH
    SEARCH --> FILTER
    FILTER --> RANK
    RANK --> CONTEXT
    CONTEXT --> RESPONSE

    style Sources fill:#E3F2FD,stroke:#1976D2
    style Ingestion fill:#FFF3E0,stroke:#FF9800
    style Storage fill:#E8F5E9,stroke:#4CAF50
    style Query fill:#FCE4EC,stroke:#E91E63
    style Agent fill:#F3E5F5,stroke:#9C27B0
            </div>

            <h2>Les 3 Sources d'Ingestion</h2>

            <p>
                Le module RAG supporte trois m√©thodes d'ingestion de donn√©es, chacune optimis√©e
                pour diff√©rents cas d'usage. S√©lectionnez la source adapt√©e √† vos besoins :
            </p>

            <!-- MOCKUP S√âLECTION SOURCE -->
            <div style="background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 100%); border-radius: 20px; padding: 30px; margin: 25px 0; color: white;">
                <div style="text-align: center; margin-bottom: 25px;">
                    <h4 style="margin: 0;">S√©lectionnez une source de donn√©es</h4>
                    <p style="opacity: 0.7; margin-top: 5px;">Choisissez le mode d'ingestion pour votre base de connaissances</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                    <!-- SharePoint -->
                    <div style="background: rgba(255,255,255,0.1); border: 2px solid #0078D4; border-radius: 16px; padding: 25px; text-align: center; cursor: pointer;">
                        <div style="width: 60px; height: 60px; background: #0078D4; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                            <i class="bi bi-microsoft" style="font-size: 1.8rem;"></i>
                        </div>
                        <h5 style="margin: 0 0 10px 0;">SharePoint</h5>
                        <p style="opacity: 0.7; font-size: 0.85rem; margin: 0;">Biblioth√®ques Microsoft 365</p>
                        <div style="margin-top: 15px;">
                            <span style="background: rgba(0,120,212,0.3); padding: 4px 10px; border-radius: 10px; font-size: 0.75rem;">MSAL Auth</span>
                        </div>
                    </div>

                    <!-- Web Crawler -->
                    <div style="background: rgba(255,255,255,0.1); border: 2px dashed rgba(255,255,255,0.3); border-radius: 16px; padding: 25px; text-align: center; cursor: pointer;">
                        <div style="width: 60px; height: 60px; background: #4CAF50; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                            <i class="bi bi-globe2" style="font-size: 1.8rem;"></i>
                        </div>
                        <h5 style="margin: 0 0 10px 0;">Web Crawler</h5>
                        <p style="opacity: 0.7; font-size: 0.85rem; margin: 0;">Sites web et documentation</p>
                        <div style="margin-top: 15px;">
                            <span style="background: rgba(76,175,80,0.3); padding: 4px 10px; border-radius: 10px; font-size: 0.75rem;">Sitemap + JS</span>
                        </div>
                    </div>

                    <!-- Upload Direct -->
                    <div style="background: rgba(255,255,255,0.1); border: 2px dashed rgba(255,255,255,0.3); border-radius: 16px; padding: 25px; text-align: center; cursor: pointer;">
                        <div style="width: 60px; height: 60px; background: #FF9800; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                            <i class="bi bi-cloud-upload" style="font-size: 1.8rem;"></i>
                        </div>
                        <h5 style="margin: 0 0 10px 0;">Upload Direct</h5>
                        <p style="opacity: 0.7; font-size: 0.85rem; margin: 0;">Fichiers locaux</p>
                        <div style="margin-top: 15px;">
                            <span style="background: rgba(255,152,0,0.3); padding: 4px 10px; border-radius: 10px; font-size: 0.75rem;">Drag & Drop</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SOURCE 1: SHAREPOINT -->
            <h3>Source 1 : Int√©gration SharePoint</h3>

            <p>
                Connexion directe √† vos biblioth√®ques SharePoint via <strong>Microsoft Graph API</strong>.
                L'indexation parcourt r√©cursivement tous les dossiers et sous-dossiers.
            </p>

            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant UI as Interface RAG
    participant API as Flask API
    participant MSAL as MSAL Client
    participant GRAPH as Microsoft Graph
    participant BLOB as Azure Blob
    participant DI as Document Intelligence
    participant COSMOS as Cosmos DB
    participant SEARCH as Azure AI Search

    U->>UI: S√©lectionner biblioth√®que SharePoint
    UI->>API: POST /api/fetch_sharepoint_libraries
    API->>MSAL: Obtenir access_token
    MSAL-->>API: Bearer token
    API->>GRAPH: GET /sites/{site_id}/drives
    GRAPH-->>API: Liste des biblioth√®ques
    API-->>UI: Afficher biblioth√®ques

    U->>UI: Lancer l'indexation
    UI->>API: POST /api/kickoff_indexation
    Note over API: Thread async d√©marr√©
    API-->>UI: operation_id pour suivi

    loop Pour chaque fichier (r√©cursif)
        API->>GRAPH: GET /drives/{id}/items (r√©cursif)
        GRAPH-->>API: Liste fichiers + dossiers
        API->>GRAPH: GET /@content (t√©l√©chargement)
        GRAPH-->>API: Contenu fichier
        API->>BLOB: Upload avec m√©tadonn√©es
        BLOB-->>API: blob_url
        API->>DI: Analyser document
        DI-->>API: Texte extrait
        API->>API: Chunking + Embedding
        API->>COSMOS: Sauvegarder chunks
        API->>SEARCH: Indexer vecteurs
    end

    API-->>UI: SSE progress updates
            </div>

            <div class="callout callout-info">
                <i class="bi bi-info-circle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Authentification MSAL</div>
                    <p>
                        L'authentification utilise <strong>MSAL (Microsoft Authentication Library)</strong>
                        avec un flux <code>client_credentials</code>. Les credentials Azure AD (tenant_id, client_id, client_secret)
                        sont stock√©s dans les variables d'environnement.
                    </p>
                </div>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Param√®tre</th><th>Type</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>libraryId</code></td><td>string</td><td>ID du drive SharePoint (obligatoire)</td></tr>
                        <tr><td><code>libraryName</code></td><td>string</td><td>Nom de la biblioth√®que</td></tr>
                        <tr><td><code>folderId</code></td><td>string</td><td>ID d'un sous-dossier sp√©cifique (optionnel)</td></tr>
                        <tr><td><code>folderName</code></td><td>string</td><td>Nom du dossier</td></tr>
                        <tr><td><code>project_name</code></td><td>string</td><td>Projet pour filtrage RAG</td></tr>
                    </tbody>
                </table>
            </div>

<pre><code># Exemple appel API SharePoint Indexation
POST /api/kickoff_indexation
Content-Type: application/json

{
    "libraryId": "b!abc123def456...",
    "libraryName": "Documentation RH",
    "folderId": null,
    "folderName": "",
    "project_name": "ressources_humaines"
}

# R√©ponse
{
    "status": "started",
    "operation_id": "op_xyz789",
    "status_endpoint": "/api/indexation_status/op_xyz789"
}</code></pre>

            <!-- SOURCE 2: WEB CRAWLER -->
            <h3>Source 2 : Web Crawler</h3>

            <p>
                Crawler web asynchrone haute performance pour indexer des sites entiers.
                Supporte deux modes : <strong>Fast</strong> (aiohttp) et <strong>JavaScript</strong> (Playwright).
            </p>

            <div class="mermaid">
flowchart TB
    subgraph Input["Configuration Crawl"]
        URL[URL de depart]
        CONFIG[max_pages, max_depth<br/>use_javascript, use_sitemap]
    end

    subgraph Discovery["Decouverte URLs"]
        SITEMAP[Parser sitemap.xml<br/>+ sitemap_index.xml]
        LINKS[Extraction liens HTML]
        QUEUE[Queue BFS<br/>avec visited set]
    end

    subgraph Fetch["Recuperation Pages"]
        FAST["Mode Fast<br/>aiohttp async<br/>10 concurrent<br/>500 pages/min"]
        JS["Mode JavaScript<br/>Playwright Chromium<br/>Rendu SPA/React<br/>30s timeout"]
    end

    subgraph Process["Traitement"]
        BS4[BeautifulSoup<br/>Extraction texte]
        FILTER[Filtrage domaine<br/>is_same_domain]
        DEDUP[Deduplication<br/>URLs visitees]
    end

    subgraph Output["Sortie"]
        RESULTS[Liste URLs crawlees]
        FAILED[URLs en echec]
        INDEXATION[Pipeline indexation]
    end

    URL --> CONFIG
    CONFIG --> SITEMAP
    SITEMAP --> QUEUE
    QUEUE --> FAST
    QUEUE --> JS

    FAST --> BS4
    JS --> BS4
    BS4 --> FILTER
    FILTER --> LINKS
    LINKS --> QUEUE

    FILTER --> DEDUP
    DEDUP --> RESULTS
    DEDUP --> FAILED
    RESULTS --> INDEXATION

    style FAST fill:#4CAF50,color:#fff
    style JS fill:#2196F3,color:#fff
            </div>

            <!-- MOCKUP INTERFACE CRAWL -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 30px; margin: 25px 0; box-shadow: 0 15px 35px rgba(0,0,0,0.2);">
                <div style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 25px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h4 style="color: #333; margin: 0;"><i class="bi bi-globe2"></i> Configuration Web Crawler</h4>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; color: #666; font-size: 0.85rem; margin-bottom: 5px;">URL de d√©part</label>
                        <input type="text" value="https://docs.example.com" style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1rem;">
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div>
                            <label style="display: block; color: #666; font-size: 0.85rem; margin-bottom: 5px;">Max Pages</label>
                            <input type="number" value="500" style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px;">
                        </div>
                        <div>
                            <label style="display: block; color: #666; font-size: 0.85rem; margin-bottom: 5px;">Max Depth</label>
                            <input type="number" value="5" style="width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px;">
                        </div>
                    </div>

                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" checked style="width: 18px; height: 18px;">
                            <span style="color: #333;">Utiliser Sitemap</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" style="width: 18px; height: 18px;">
                            <span style="color: #333;">Mode JavaScript (Playwright)</span>
                        </label>
                    </div>

                    <!-- Progress -->
                    <div style="background: #f5f5f5; border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: #333; font-weight: 600;">Crawl en cours...</span>
                            <span style="color: #667eea; font-weight: 600;">127/500 pages</span>
                        </div>
                        <div style="background: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="width: 25%; height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 4px;"></div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px;">
                        <button style="flex: 1; padding: 15px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;">
                            <i class="bi bi-play-fill"></i> D√©marrer Crawl
                        </button>
                        <button style="padding: 15px 25px; background: #f44336; color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;">
                            <i class="bi bi-stop-fill"></i> Stop
                        </button>
                    </div>
                </div>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Param√®tre</th><th>D√©faut</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>url</code></td><td>-</td><td>URL de d√©part du crawl (obligatoire)</td></tr>
                        <tr><td><code>max_pages</code></td><td>500</td><td>Nombre maximum de pages √† crawler</td></tr>
                        <tr><td><code>max_depth</code></td><td>5</td><td>Profondeur maximale de navigation</td></tr>
                        <tr><td><code>max_concurrent</code></td><td>10</td><td>Requ√™tes simultan√©es (mode Fast)</td></tr>
                        <tr><td><code>use_javascript</code></td><td>false</td><td>Activer Playwright pour rendu JS</td></tr>
                        <tr><td><code>use_sitemap</code></td><td>true</td><td>Parser sitemap.xml en priorit√©</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="callout callout-warning">
                <i class="bi bi-exclamation-triangle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Mode JavaScript vs Mode Fast</div>
                    <p>
                        <strong>Mode Fast (aiohttp)</strong> : Tr√®s rapide (~500 pages/min), mais ne charge pas le JavaScript.
                        Id√©al pour les sites statiques et la documentation.<br>
                        <strong>Mode JavaScript (Playwright)</strong> : Plus lent mais rend les pages avec Chromium.
                        N√©cessaire pour les SPA (React, Vue, Angular) et les sites avec contenu dynamique.
                    </p>
                </div>
            </div>

            <!-- SOURCE 3: UPLOAD DIRECT -->
            <h3>Source 3 : Upload Direct</h3>

            <p>
                Upload manuel de fichiers via l'interface web. Id√©al pour des documents
                sp√©cifiques ou des mises √† jour ponctuelles de la base de connaissances.
            </p>

            <div class="mermaid">
flowchart LR
    subgraph Upload["Interface Upload"]
        DROP[Drag & Drop Zone]
        SELECT[S√©lection fichiers]
        PREVIEW[Pr√©visualisation]
    end

    subgraph Process["Traitement Backend"]
        VALID[Validation format<br/>SUPPORTED_EXTENSIONS]
        SANITIZE[Sanitize blob_name]
        BLOB_UP[Upload Azure Blob]
    end

    subgraph Indexation["Pipeline Indexation"]
        DI[Document Intelligence]
        CHUNK[Chunking]
        EMBED[Embedding]
        INDEX[Indexation Search]
    end

    DROP --> VALID
    SELECT --> VALID
    VALID --> PREVIEW
    PREVIEW --> SANITIZE
    SANITIZE --> BLOB_UP
    BLOB_UP --> DI
    DI --> CHUNK
    CHUNK --> EMBED
    EMBED --> INDEX

    style Upload fill:#E3F2FD,stroke:#1976D2
    style Process fill:#FFF3E0,stroke:#FF9800
    style Indexation fill:#E8F5E9,stroke:#4CAF50
            </div>

            <!-- MOCKUP UPLOAD INTERFACE -->
            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 20px; padding: 30px; margin: 25px 0; box-shadow: 0 15px 35px rgba(0,0,0,0.2);">
                <div style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 25px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h4 style="color: #333; margin: 0;"><i class="bi bi-cloud-upload"></i> Upload de Fichiers</h4>
                    </div>

                    <!-- Drop Zone -->
                    <div style="border: 3px dashed #ddd; border-radius: 15px; padding: 40px; text-align: center; margin-bottom: 20px; background: #fafafa;">
                        <div style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"><i class="bi bi-cloud-arrow-up"></i></div>
                        <p style="color: #666; margin: 0;">Glissez vos fichiers ici ou <span style="color: #f5576c; cursor: pointer; font-weight: 600;">parcourez</span></p>
                        <p style="color: #999; font-size: 0.85rem; margin-top: 10px;">PDF, DOCX, PPTX, XLSX, TXT, MD, HTML (max 50MB)</p>
                    </div>

                    <!-- File List -->
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; background: #f5f5f5; border-radius: 10px; margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="bi bi-file-pdf" style="font-size: 1.5rem; color: #f44336;"></i>
                                <div>
                                    <div style="font-weight: 600; color: #333;">Guide_RH_2025.pdf</div>
                                    <div style="font-size: 0.8rem; color: #888;">2.4 MB</div>
                                </div>
                            </div>
                            <span style="background: #4CAF50; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.75rem;">‚úì Index√©</span>
                        </div>
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; background: #f5f5f5; border-radius: 10px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <i class="bi bi-file-word" style="font-size: 1.5rem; color: #2196F3;"></i>
                                <div>
                                    <div style="font-weight: 600; color: #333;">Procedures_IT.docx</div>
                                    <div style="font-size: 0.8rem; color: #888;">856 KB</div>
                                </div>
                            </div>
                            <span style="background: #FF9800; color: white; padding: 4px 12px; border-radius: 15px; font-size: 0.75rem;">Indexation...</span>
                        </div>
                    </div>

                    <button style="width: 100%; padding: 15px; background: linear-gradient(135deg, #f093fb, #f5576c); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;">
                        <i class="bi bi-upload"></i> Uploader et Indexer
                    </button>
                </div>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Format</th><th>Extension</th><th>M√©thode d'extraction</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Documents PDF</td><td>.pdf</td><td>Azure Document Intelligence (OCR inclus)</td></tr>
                        <tr><td>Microsoft Word</td><td>.docx, .doc</td><td>Azure Document Intelligence</td></tr>
                        <tr><td>PowerPoint</td><td>.pptx, .ppt</td><td>Azure Document Intelligence</td></tr>
                        <tr><td>Excel</td><td>.xlsx, .xls</td><td>Azure Document Intelligence (tableaux)</td></tr>
                        <tr><td>Texte brut</td><td>.txt, .md, .html</td><td>T√©l√©chargement direct + parsing</td></tr>
                        <tr><td>Rich Text</td><td>.rtf, .odt</td><td>Azure Document Intelligence</td></tr>
                        <tr><td>Code source</td><td>.py, .js, .json</td><td>T√©l√©chargement direct</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="cards-grid">
                <div class="info-card">
                    <div class="card-header">
                        <i class="bi bi-microsoft"></i>
                        <h3>SharePoint Integration</h3>
                    </div>
                    <p>
                        Connexion directe √† vos biblioth√®ques SharePoint via Microsoft Graph API.
                        Synchronisation automatique des documents avec d√©tection des modifications.
                    </p>
                    <ul>
                        <li><strong>Formats support√©s</strong> : PDF, DOCX, PPTX, XLSX, RTF, ODT</li>
                        <li><strong>Navigation r√©cursive</strong> des dossiers et sous-dossiers</li>
                        <li><strong>M√©tadonn√©es pr√©serv√©es</strong> : auteur, date, dossier source</li>
                        <li><strong>Authentification MSAL</strong> s√©curis√©e</li>
                    </ul>
                    <pre><code># Endpoint: POST /api/kickoff_indexation
{
    "libraryId": "b!abc123...",
    "libraryName": "Documentation RH",
    "project_id": "projet_rh",
    "project_name": "Ressources Humaines"
}</code></pre>
                </div>

                <div class="info-card">
                    <div class="card-header">
                        <i class="bi bi-globe2"></i>
                        <h3>Web Crawler</h3>
                    </div>
                    <p>
                        Crawler web asynchrone pour indexer des sites entiers. Supporte le mode
                        JavaScript (Playwright) pour les sites dynamiques.
                    </p>
                    <ul>
                        <li><strong>Extraction Sitemap</strong> automatique pour d√©couverte rapide</li>
                        <li><strong>Mode Fast</strong> : aiohttp asynchrone (500 pages/min)</li>
                        <li><strong>Mode JavaScript</strong> : Playwright pour SPA/React</li>
                        <li><strong>Respect robots.txt</strong> et rate limiting</li>
                        <li><strong>Profondeur configurable</strong> (max_depth, max_pages)</li>
                    </ul>
                    <pre><code># Endpoint: POST /crawl/start-crawl
{
    "url": "https://docs.example.com",
    "max_pages": 500,
    "max_depth": 5,
    "use_javascript": false,
    "use_sitemap": true
}</code></pre>
                </div>

                <div class="info-card">
                    <div class="card-header">
                        <i class="bi bi-cloud-upload"></i>
                        <h3>Upload Direct</h3>
                    </div>
                    <p>
                        Upload manuel de fichiers via l'interface web. Id√©al pour des documents
                        sp√©cifiques ou des mises √† jour ponctuelles.
                    </p>
                    <ul>
                        <li><strong>Drag & Drop</strong> dans l'interface moderne</li>
                        <li><strong>Multi-fichiers</strong> simultan√©s</li>
                        <li><strong>Preview</strong> avant indexation</li>
                        <li><strong>Statut temps r√©el</strong> de l'indexation</li>
                        <li><strong>Formats</strong> : PDF, DOCX, TXT, HTML, MD, code source</li>
                    </ul>
                    <pre><code># Endpoint: POST /api/upload-to-blob
# Content-Type: multipart/form-data
- files: [fichier1.pdf, fichier2.docx]
- library_id: "uploads"
- project_name: "Mon Projet"</code></pre>
                </div>
            </div>

            <h2>Pipeline d'Indexation</h2>

            <p>
                Chaque document passe par un pipeline d'indexation sophistiqu√© en 6 √©tapes :
            </p>

            <h3>√âtape 1 : Extraction de texte</h3>

            <div class="tech-badge"><i class="bi bi-file-earmark-text"></i> Azure Document Intelligence</div>

            <p>
                L'extraction intelligente d√©tecte automatiquement le type de fichier et utilise
                la m√©thode appropri√©e :
            </p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Type de fichier</th>
                            <th>M√©thode d'extraction</th>
                            <th>Capacit√©s</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>PDF, DOCX, PPTX, XLSX</td>
                            <td>Azure Document Intelligence (prebuilt-layout)</td>
                            <td>OCR, tableaux, mise en page pr√©serv√©e</td>
                        </tr>
                        <tr>
                            <td>TXT, MD, HTML, code source</td>
                            <td>T√©l√©chargement direct + parsing</td>
                            <td>D√©tection encoding, syntaxe pr√©serv√©e</td>
                        </tr>
                        <tr>
                            <td>Images dans documents</td>
                            <td>OCR int√©gr√© Document Intelligence</td>
                            <td>Extraction texte des images embarqu√©es</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>√âtape 2 : Chunking intelligent</h3>

            <p>
                Le texte extrait est d√©coup√© en chunks de taille optimale pour la recherche
                vectorielle. L'algorithme respecte les fronti√®res de phrases :
            </p>

            <pre><code># Param√®tres de chunking (utils/indexation.py)
def split_text(summary=None, text="", max_chars=800, overlap=100):
    """
    D√©coupe le texte en chunks respectant les fronti√®res de phrases.

    Args:
        max_chars: Taille cible par chunk (800 caract√®res)
        overlap: Chevauchement entre chunks (100 caract√®res)

    Algorithme:
    1. Split par regex sur terminateurs de phrase (. ! ?)
    2. Accumulation jusqu'√† max_chars
    3. Overlap des derni√®res phrases pour continuit√©
    4. Chaque chunk commence ET finit sur une phrase compl√®te
    """
    sentences = re.split(r'(?<=[.!?])\s+', text)
    # ... algorithme de chunking avec overlap
    return pages  # [{page_number, chunk, summary}]</code></pre>

            <div class="callout callout-warning">
                <i class="bi bi-exclamation-triangle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Pourquoi 800 caract√®res ?</div>
                    <p>
                        Cette taille est optimale pour les embeddings text-embedding-3-small :
                        assez grande pour capturer le contexte, assez petite pour une recherche
                        pr√©cise. Les chunks > 5000 caract√®res sont automatiquement tronqu√©s.
                    </p>
                </div>
            </div>

            <h3>√âtape 3 : R√©sum√© par GPT-5-mini</h3>

            <p>
                Chaque document re√ßoit un r√©sum√© g√©n√©r√© par Azure OpenAI GPT-5-mini,
                attach√© √† tous ses chunks pour enrichir la recherche :
            </p>

            <pre><code># G√©n√©ration de r√©sum√© (utils/indexation.py)
def summarize_text(text):
    """
    G√©n√®re un r√©sum√© concis via Azure OpenAI GPT-5-mini.

    Prompt:
    - Capturer les points cl√©s
    - 2-5 phrases maximum
    - Style professionnel
    """
    prompt = """Tu es un expert en synth√®se de documents.
G√©n√®re un r√©sum√© concis et informatif en fran√ßais.
- Points cl√©s essentiels
- 2 √† 5 phrases
- Style professionnel"""

    # Appel Azure OpenAI avec max_completion_tokens: 5000
    return summary.strip()</code></pre>

            <h3>√âtape 4 : Extraction d'entit√©s</h3>

            <div class="tech-badge"><i class="bi bi-diagram-2"></i> Azure Text Analytics</div>

            <p>
                Azure Text Analytics extrait automatiquement les entit√©s nomm√©es de chaque chunk :
            </p>

            <ul>
                <li><strong>Person</strong> : Noms de personnes mentionn√©es</li>
                <li><strong>Organization</strong> : Entreprises, institutions</li>
                <li><strong>Location</strong> : Lieux g√©ographiques</li>
                <li><strong>DateTime</strong> : Dates et heures</li>
                <li><strong>Email, PhoneNumber, URL</strong> : Coordonn√©es</li>
                <li><strong>Skill, Product, Event</strong> : Concepts m√©tier</li>
                <li><strong>Key Phrases</strong> : Termes importants du chunk</li>
            </ul>

            <h3>√âtape 5 : G√©n√©ration d'embeddings</h3>

            <div class="tech-badge"><i class="bi bi-vector-pen"></i> text-embedding-3-small</div>

            <p>
                Chaque chunk est converti en vecteur de 1536 dimensions via Azure OpenAI :
            </p>

            <pre><code># G√©n√©ration d'embeddings (utils/indexation.py)
def generate_embeddings_for_chunks(json_data, batch_size=50):
    """
    G√©n√®re les embeddings pour un batch de chunks.

    Mod√®le: text-embedding-3-small (1536 dimensions)
    Batch: 50 chunks par requ√™te (optimisation co√ªts)
    Rate limit: 2 secondes entre batches
    """
    for batch in batches:
        response = requests.post(
            f"{endpoint}/openai/deployments/{deployment}/embeddings",
            json={"input": [chunk['chunk'] for chunk in batch]}
        )
        for chunk, embedding in zip(batch, response['data']):
            chunk['embedding'] = embedding['embedding']  # 1536 floats</code></pre>

            <h3>√âtape 6 : Stockage multi-bases</h3>

            <p>
                Les donn√©es sont stock√©es de mani√®re optimale dans trois syst√®mes :
            </p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Syst√®me</th>
                            <th>Donn√©es stock√©es</th>
                            <th>Usage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Azure Blob Storage</strong></td>
                            <td>Documents originaux + m√©tadonn√©es (StatusIndexation, LibraryId...)</td>
                            <td>Archivage, r√©-indexation, audit</td>
                        </tr>
                        <tr>
                            <td><strong>Cosmos DB (RAG_base/database)</strong></td>
                            <td>Chunks + r√©sum√© + entit√©s + embeddings</td>
                            <td>Requ√™tes complexes, filtrage par projet</td>
                        </tr>
                        <tr>
                            <td><strong>Azure AI Search</strong></td>
                            <td>Index vectoriel optimis√© pour recherche</td>
                            <td>Recherche s√©mantique temps r√©el</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>Recherche Vectorielle</h2>

            <p>
                La recherche RAG utilise une approche en deux √©tapes pour garantir
                pertinence et pr√©cision :
            </p>

            <h3>√âtape 1 : G√©n√©ration de l'intent de recherche</h3>

            <pre><code># api_rag_search.py - generate_search_intent()
def generate_search_intent(last_message: str, history: List[Dict]) -> Dict:
    """
    Transforme le message utilisateur + historique en intent optimis√©.

    1. Formate l'historique de conversation
    2. Prompt GPT-4 pour extraire l'intent pr√©cis
    3. G√©n√®re l'embedding de l'intent

    Exemple:
    User: "Quels sont les d√©lais pour les cong√©s ?"
    History: [{"role": "user", "content": "Je travaille aux RH"}]

    ‚Üí Intent: "vacation leave request deadlines HR department policy"
    """
    prompt = f"""Based on this conversation context:
History: {history_text}
Last message: {last_message}

Formulate a precise search intent for Azure AI Search.
Return only the search intent string in English."""

    # G√©n√©ration intent via GPT-4
    search_intent = client.chat.completions.create(...).choices[0].message.content

    # G√©n√©ration embedding
    embedding = embedding_client.embeddings.create(
        model="text-embedding-3-small",
        input=search_intent
    ).data[0].embedding

    return {"search_intent": search_intent, "embedding": embedding}</code></pre>

            <h3>√âtape 2 : Recherche vectorielle avec filtres</h3>

            <pre><code># Recherche dans Azure AI Search
def vector_search_with_filter(embedding: List[float], project_name: str, top_k: int = 10):
    """
    Recherche vectorielle avec filtrage par projet.

    Utilise la similarit√© cosinus pour trouver les chunks
    les plus proches s√©mantiquement de la requ√™te.
    """
    search_results = search_client.search(
        search_text="",  # Pas de recherche textuelle
        vector_queries=[{
            "vector": embedding,
            "fields": "embedding",
            "k": top_k,
            "kind": "vector",
            "exhaustive": True  # Recherche exhaustive pour pr√©cision
        }],
        filter=f"project_name eq '{project_name}'",  # Filtrage par projet
        select=["chunk", "url_document_source", "key_phrases"]
    )
    return results</code></pre>

            <h2>Int√©gration avec les Agents</h2>

            <p>
                Le module RAG s'int√®gre nativement avec les agents Waka Voice via un Tool d√©di√© :
            </p>

            <pre><code># utils/tools/rag_vector_search.py
RAG_VECTOR_SEARCH_TOOL = {
    "type": "function",
    "function": {
        "name": "search_knowledge_base",
        "description": """Recherche dans la base de connaissances interne.

Utilise ce tool pour:
- Trouver des informations sur les proc√©dures internes
- Rechercher des documents de l'entreprise
- Obtenir des r√©ponses sur les politiques et r√®gles
- Consulter la documentation technique ou RH

Retourne les passages les plus pertinents avec leur source.""",
        "parameters": {
            "type": "object",
            "properties": {
                "query": {
                    "type": "string",
                    "description": "La requ√™te de recherche en langage naturel"
                },
                "max_results": {
                    "type": "integer",
                    "description": "Nombre max de r√©sultats (d√©faut: 5, max: 10)",
                    "default": 5
                },
                "min_score": {
                    "type": "number",
                    "description": "Score minimum de pertinence (0-1)",
                    "default": 0.5
                }
            },
            "required": ["query"]
        }
    }
}</code></pre>

            <div class="callout callout-info">
                <i class="bi bi-robot callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Fonctionnement automatique</div>
                    <p>
                        Lorsque le tool <code>search_knowledge_base</code> est attach√© √† un agent,
                        celui-ci d√©cide automatiquement quand l'utiliser. Si l'utilisateur pose une
                        question sur un sujet interne, l'agent invoque le tool, r√©cup√®re les chunks
                        pertinents, et formule sa r√©ponse en citant les sources.
                    </p>
                </div>
            </div>

            <h2>Interfaces RAG</h2>

            <p>
                Le module RAG dispose de plusieurs interfaces accessibles via le pr√©fixe <code>/rag</code> :
            </p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Route</th>
                            <th>Description</th>
                            <th>Fonctionnalit√©s</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>/rag/upload</code></td>
                            <td>Upload de fichiers</td>
                            <td>Drag & drop, multi-fichiers, preview</td>
                        </tr>
                        <tr>
                            <td><code>/rag/crawl</code></td>
                            <td>Configuration du crawler web</td>
                            <td>URL, profondeur, mode JS, sitemap</td>
                        </tr>
                        <tr>
                            <td><code>/rag/sharepoint</code></td>
                            <td>Int√©gration SharePoint</td>
                            <td>S√©lection biblioth√®ques, indexation</td>
                        </tr>
                        <tr>
                            <td><code>/rag/knowledge</code></td>
                            <td>Base de connaissances</td>
                            <td>Visualisation documents index√©s</td>
                        </tr>
                        <tr>
                            <td><code>/rag/conversations</code></td>
                            <td>Historique conversations RAG</td>
                            <td>Filtres, satisfaction, export</td>
                        </tr>
                        <tr>
                            <td><code>/rag/deletion</code></td>
                            <td>Suppression des donn√©es</td>
                            <td>Par URL, par projet, nettoyage</td>
                        </tr>
                        <tr>
                            <td><code>/rag/chat</code></td>
                            <td>Chat avec la base</td>
                            <td>Interface de test RAG standalone</td>
                        </tr>
                        <tr>
                            <td><code>/rag/chat-enhanced</code></td>
                            <td>Chat am√©lior√©</td>
                            <td>Sidebar fichiers, √©tapes analyse, tools</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>Gestion des Sessions RAG</h2>

            <p>
                Les conversations RAG sont persist√©es dans Cosmos DB avec un sch√©ma riche
                permettant l'analyse et le suivi de la satisfaction :
            </p>

            <pre><code># configuration/sessions/rag/manager.py
class RagSessionManager:
    """
    Gestionnaire des sessions RAG Chat.
    Container: ConversationHistory (ConversationsDB)

    Sch√©ma du document:
    {
        "id": "conv_abc123",
        "user_email": "user@domain.com",
        "display_name": "John Doe",
        "history": [
            {"role": "user", "content": "...", "timestamp": "..."},
            {"role": "assistant", "content": "...", "timestamp": "..."}
        ],
        "start_datetime": "2025-12-22T12:00:00Z",
        "end_datetime": "",
        "duration": "0:00:00",
        "summary": "",
        "satisfaction_measure": {
            "response_confidence": {"positive": 0.85, "negative": 0.15},
            "user_messages_average": {"positive": 0.78, "negative": 0.22}
        },
        "status": "active"
    }
    """

    def create(self, session_id, user_email, display_name, initial_message=None):
        """Cr√©e une nouvelle session RAG."""

    def add_message(self, session_id, role, content):
        """Ajoute un message √† l'historique."""

    def close(self, session_id, summary, satisfaction):
        """Cl√¥ture la session avec m√©triques."""</code></pre>

            <h2>M√©triques et Monitoring</h2>

            <p>
                Le module RAG expose plusieurs m√©triques pour le suivi et l'optimisation :
            </p>

            <div class="cards-grid">
                <div class="info-card">
                    <div class="card-header">
                        <i class="bi bi-graph-up"></i>
                        <h3>M√©triques d'indexation</h3>
                    </div>
                    <ul>
                        <li><strong>Documents trait√©s</strong> : Total / Succ√®s / √âchecs / Ignor√©s</li>
                        <li><strong>Chunks cr√©√©s</strong> : Par document et total</li>
                        <li><strong>Temps d'indexation</strong> : Par √©tape du pipeline</li>
                        <li><strong>Erreurs</strong> : Types et fr√©quences</li>
                    </ul>
                </div>

                <div class="info-card">
                    <div class="card-header">
                        <i class="bi bi-search"></i>
                        <h3>M√©triques de recherche</h3>
                    </div>
                    <ul>
                        <li><strong>Latence recherche</strong> : P50, P95, P99</li>
                        <li><strong>Score moyen</strong> : Pertinence des r√©sultats</li>
                        <li><strong>Taux de r√©sultats vides</strong> : Requ√™tes sans match</li>
                        <li><strong>Volume requ√™tes</strong> : Par heure/jour</li>
                    </ul>
                </div>

                <div class="info-card">
                    <div class="card-header">
                        <i class="bi bi-emoji-smile"></i>
                        <h3>M√©triques satisfaction</h3>
                    </div>
                    <ul>
                        <li><strong>Confiance r√©ponse</strong> : Score positif/n√©gatif</li>
                        <li><strong>Sentiment utilisateur</strong> : Analyse messages</li>
                        <li><strong>Dur√©e sessions</strong> : Moyenne et distribution</li>
                        <li><strong>Taux r√©solution</strong> : Sessions avec succ√®s</li>
                    </ul>
                </div>
            </div>

            <h2>Bonnes Pratiques RAG</h2>

            <div class="callout callout-success">
                <i class="bi bi-check-circle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Recommandations pour un RAG performant</div>
                    <ul>
                        <li><strong>Qualit√© des sources</strong> : Privil√©giez des documents bien structur√©s avec titres et sections</li>
                        <li><strong>Mise √† jour r√©guli√®re</strong> : R√©indexez p√©riodiquement pour refl√©ter les changements</li>
                        <li><strong>Segmentation par projet</strong> : Utilisez project_name pour isoler les domaines m√©tier</li>
                        <li><strong>Min score adapt√©</strong> : Ajustez le seuil selon la taille de votre base (0.5-0.7 recommand√©)</li>
                        <li><strong>Monitoring actif</strong> : Surveillez les requ√™tes sans r√©sultats pour identifier les lacunes</li>
                        <li><strong>Feedback loop</strong> : Utilisez les m√©triques de satisfaction pour am√©liorer le contenu</li>
                    </ul>
                </div>
            </div>

            <h2>API Reference RAG</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Endpoint</th>
                            <th>M√©thode</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>/api/rag_search/{project_name}</code></td>
                            <td>POST</td>
                            <td>Recherche vectorielle avec filtrage projet</td>
                        </tr>
                        <tr>
                            <td><code>/api/kickoff_indexation</code></td>
                            <td>POST</td>
                            <td>D√©marre indexation SharePoint</td>
                        </tr>
                        <tr>
                            <td><code>/api/indexation_status/{operation_id}</code></td>
                            <td>GET</td>
                            <td>Statut d'une op√©ration d'indexation</td>
                        </tr>
                        <tr>
                            <td><code>/crawl/start-crawl</code></td>
                            <td>POST</td>
                            <td>D√©marre un crawl web</td>
                        </tr>
                        <tr>
                            <td><code>/crawl/crawl-status</code></td>
                            <td>GET</td>
                            <td>Statut du crawl en cours</td>
                        </tr>
                        <tr>
                            <td><code>/crawl/stop-crawl</code></td>
                            <td>POST</td>
                            <td>Arr√™te le crawl en cours</td>
                        </tr>
                        <tr>
                            <td><code>/api/upload-to-blob</code></td>
                            <td>POST</td>
                            <td>Upload fichiers vers Blob Storage</td>
                        </tr>
                        <tr>
                            <td><code>/rag/api/conversations</code></td>
                            <td>GET</td>
                            <td>Liste conversations avec pagination</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </section>

        <!-- ==========================================
             CHAPITRE 3: ARCHITECTURE D√âTAILL√âE
             ========================================== -->
        <section id="architecture" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-diagram-3"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 3: Architecture Syst√®me</h1>
                    <p class="section-subtitle">Structure modulaire et flux de donn√©es</p>
                </div>
            </div>

            <div class="intro-text">
                L'architecture de Waka Voice suit le principe de <strong>s√©paration des pr√©occupations</strong>
                via un syst√®me de Blueprints Flask modulaires. Chaque composant a une responsabilit√© unique
                et peut √©voluer ind√©pendamment, facilitant la maintenance et l'extension du syst√®me.
            </div>

            <h2>3.1 Vue d'ensemble architecturale</h2>

            <p>
                L'architecture se d√©compose en quatre couches principales, chacune avec des responsabilit√©s
                bien d√©finies et des interfaces claires :
            </p>

            <div class="mermaid">
flowchart TB
    subgraph Presentation["Couche Pr√©sentation"]
        WEB[Templates Jinja2]
        API[REST API]
        WS[WebSocket Endpoints]
    end

    subgraph Business["Couche M√©tier (Blueprints)"]
        VOICE[voice_live_proxy]
        AVATAR[avatar_live_proxy]
        TEXT[text_agents]
        UNIFIED[unified_agent]
        TOOLS[tools]
        PERSONAL[personal_voice]
        PROMPT[prompt_builder]
    end

    subgraph Data["Couche Donn√©es"]
        MANAGERS[Cosmos Managers]
        SESSIONS[Session Managers]
        STORAGE[Blob Storage Client]
    end

    subgraph External["Services Externes"]
        AZURE_VOICE[Azure Voice Live]
        AZURE_SPEECH[Azure Speech]
        AZURE_OPENAI[Azure OpenAI]
        AZURE_AVATAR[Azure Avatar]
        COSMOS[(Cosmos DB)]
        BLOB[(Blob Storage)]
    end

    WEB --> Business
    API --> Business
    WS --> VOICE
    WS --> AVATAR

    VOICE --> MANAGERS
    VOICE --> AZURE_VOICE
    AVATAR --> MANAGERS
    AVATAR --> AZURE_AVATAR
    TEXT --> MANAGERS
    TEXT --> AZURE_OPENAI
    UNIFIED --> MANAGERS
    TOOLS --> MANAGERS
    PERSONAL --> AZURE_SPEECH
    PERSONAL --> STORAGE

    MANAGERS --> COSMOS
    SESSIONS --> COSMOS
    STORAGE --> BLOB
            </div>

            <h2>3.2 Structure des Blueprints</h2>

            <p>
                Les Blueprints Flask permettent d'organiser le code en modules ind√©pendants avec leurs
                propres routes, templates et logique m√©tier. Voici le d√©tail de chaque Blueprint :
            </p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Blueprint</th>
                            <th>Pr√©fixe</th>
                            <th>Responsabilit√©</th>
                            <th>Fichiers cl√©s</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>voice_proxy</code></td>
                            <td>/voice-proxy</td>
                            <td>Proxy WebSocket bidirectionnel pour conversations voix temps r√©el</td>
                            <td>voice_live_proxy.py (800+ lignes)</td>
                        </tr>
                        <tr>
                            <td><code>avatar_proxy</code></td>
                            <td>/avatar-proxy</td>
                            <td>Proxy WebSocket pour conversations avatar avec synchronisation vid√©o</td>
                            <td>avatar_live_proxy.py</td>
                        </tr>
                        <tr>
                            <td><code>text_agents</code></td>
                            <td>/text-agents</td>
                            <td>Gestion compl√®te des agents textuels : CRUD, chat, streaming SSE</td>
                            <td>text_agents_routes.py</td>
                        </tr>
                        <tr>
                            <td><code>unified_agent</code></td>
                            <td>/agents/unified</td>
                            <td>Interface de cr√©ation unifi√©e pour tous types d'agents</td>
                            <td>unified_agent_routes.py</td>
                        </tr>
                        <tr>
                            <td><code>tools</code></td>
                            <td>/tools</td>
                            <td>CRUD tools, test, import OpenAPI avec analyse IA</td>
                            <td>tools/__init__.py, add.py, list.py</td>
                        </tr>
                        <tr>
                            <td><code>personal_voice</code></td>
                            <td>/creer-une-voix</td>
                            <td>Cr√©ation voix personnalis√©es : consentement, entra√Ænement, galerie</td>
                            <td>personal_voice_routes.py</td>
                        </tr>
                        <tr>
                            <td><code>prompt_builder</code></td>
                            <td>/agents/prompt-builder</td>
                            <td>G√©n√©rateur visuel de prompts avec 4 m√©thodes</td>
                            <td>prompt_builder_routes.py</td>
                        </tr>
                        <tr>
                            <td><code>azure_voices</code></td>
                            <td>/api/azure-voices</td>
                            <td>API REST pour r√©cup√©ration dynamique des voix Azure</td>
                            <td>azure_voices_api.py</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Principe de responsabilit√© unique</h3>

            <p>
                Chaque Blueprint suit le principe SRP (Single Responsibility Principle). Par exemple,
                <code>voice_live_proxy</code> ne g√®re que la communication WebSocket temps r√©el,
                tandis que la persistance est d√©l√©gu√©e aux Cosmos Managers. Cette s√©paration permet :
            </p>

            <ul>
                <li><strong>Testabilit√©</strong> : Chaque composant peut √™tre test√© isol√©ment avec des mocks</li>
                <li><strong>√âvolutivit√©</strong> : Modifier le stockage n'impacte pas la logique WebSocket</li>
                <li><strong>Lisibilit√©</strong> : Un d√©veloppeur trouve rapidement le code pertinent</li>
                <li><strong>Parall√©lisation</strong> : Plusieurs d√©veloppeurs travaillent sans conflits</li>
            </ul>

            <h2>3.3 Configuration et Managers</h2>

            <p>
                La couche <code>configuration/</code> contient les gestionnaires de donn√©es (Managers)
                qui abstraient l'acc√®s √† Cosmos DB. Cette abstraction offre plusieurs avantages :
            </p>

            <pre><code># Exemple : cosmos_agent_manager.py

class CosmosAgentManager:
    """
    Gestionnaire CRUD pour les agents voix.

    Responsabilit√©s:
    - Abstraction des op√©rations Cosmos DB
    - Validation des donn√©es entrantes
    - G√©n√©ration des r√©f√©rences uniques
    - Gestion des timestamps
    """

    def __init__(self):
        self.container = get_agents_container()

    def create(self, config: dict) -> str:
        """
        Cr√©e un nouvel agent avec validation et enrichissement.

        Args:
            config: Configuration de l'agent (nom, mod√®le, voix, tools, instructions)

        Returns:
            agent_id: UUID du nouvel agent

        Raises:
            ValidationError: Si la configuration est invalide
        """
        # Validation
        self._validate_config(config)

        # Enrichissement
        agent_id = str(uuid.uuid4())
        now = datetime.now(timezone.utc).isoformat()

        document = {
            "id": agent_id,
            "agent_id": agent_id,
            "agent_reference": self._generate_reference(),
            "created_at": now,
            "updated_at": now,
            "status": "active",
            **config
        }

        # Persistance
        self.container.create_item(body=document)

        return agent_id

    def get(self, agent_id: str) -> Optional[dict]:
        """R√©cup√®re un agent par son ID."""
        try:
            return self.container.read_item(
                item=agent_id,
                partition_key=agent_id
            )
        except exceptions.CosmosResourceNotFoundError:
            return None

    def update(self, agent_id: str, updates: dict) -> bool:
        """Met √† jour partiellement un agent."""
        agent = self.get(agent_id)
        if not agent:
            return False

        agent.update(updates)
        agent["updated_at"] = datetime.now(timezone.utc).isoformat()

        self.container.replace_item(item=agent_id, body=agent)
        return True

    def delete(self, agent_id: str) -> bool:
        """Supprime un agent (soft delete recommand√© en production)."""
        try:
            self.container.delete_item(item=agent_id, partition_key=agent_id)
            return True
        except exceptions.CosmosResourceNotFoundError:
            return False

    def list_all(self, status: str = None) -> List[dict]:
        """Liste tous les agents avec filtre optionnel."""
        query = "SELECT * FROM c"
        if status:
            query += f" WHERE c.status = '{status}'"
        query += " ORDER BY c.created_at DESC"

        return list(self.container.query_items(
            query=query,
            enable_cross_partition_query=True
        ))</code></pre>

            <div class="callout callout-info">
                <i class="bi bi-info-circle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Pattern Singleton pour les Managers</div>
                    <p>
                        Les Managers sont instanci√©s une seule fois au d√©marrage de l'application via
                        la fonction <code>get_*_manager()</code>. Cela √©vite de recr√©er la connexion
                        Cosmos DB √† chaque requ√™te, am√©liorant les performances et r√©duisant les co√ªts.
                    </p>
                </div>
            </div>

            <h2>3.4 Stack Technique D√©taill√©e</h2>

            <p>
                Voici l'ensemble des technologies utilis√©es avec leur justification :
            </p>

            <h3>Backend</h3>

            <div class="tech-badge"><i class="bi bi-filetype-py"></i> Python 3.13+</div>
            <div class="tech-badge"><i class="bi bi-box"></i> Flask 3.0</div>
            <div class="tech-badge"><i class="bi bi-plug"></i> flask-sock</div>
            <div class="tech-badge"><i class="bi bi-arrow-repeat"></i> Gevent</div>
            <div class="tech-badge"><i class="bi bi-globe"></i> Requests</div>
            <div class="tech-badge"><i class="bi bi-file-code"></i> Jinja2</div>

            <h3>Azure Services</h3>

            <div class="tech-badge"><i class="bi bi-database"></i> Cosmos DB</div>
            <div class="tech-badge"><i class="bi bi-mic"></i> Speech Services</div>
            <div class="tech-badge"><i class="bi bi-chat-dots"></i> OpenAI Service</div>
            <div class="tech-badge"><i class="bi bi-person-video"></i> Avatar Service</div>
            <div class="tech-badge"><i class="bi bi-cloud"></i> Blob Storage</div>
            <div class="tech-badge"><i class="bi bi-search"></i> AI Search</div>

            <h3>Frontend</h3>

            <div class="tech-badge"><i class="bi bi-filetype-html"></i> HTML5</div>
            <div class="tech-badge"><i class="bi bi-filetype-css"></i> CSS3 / Bootstrap 5</div>
            <div class="tech-badge"><i class="bi bi-filetype-js"></i> Vanilla JavaScript</div>
            <div class="tech-badge"><i class="bi bi-bar-chart"></i> Chart.js</div>
            <div class="tech-badge"><i class="bi bi-plug"></i> WebSocket API</div>

        </section>

        <!-- ==========================================
             CHAPITRE 4: BASE DE DONN√âES COSMOS DB
             ========================================== -->
        <section id="database" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-database"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 4: Base de Donn√©es</h1>
                    <p class="section-subtitle">Architecture Hybride Cosmos DB + Azure Blob Storage</p>
                </div>
            </div>

            <div class="intro-text">
                Waka Voice adopte une <strong>architecture de stockage hybride</strong> combinant
                <strong>Azure Cosmos DB</strong> pour les donn√©es structur√©es et transactionnelles,
                et <strong>Azure Blob Storage</strong> pour les fichiers binaires volumineux.
                Cette approche permet d'optimiser les co√ªts, les performances et la scalabilit√©
                en utilisant chaque service pour ses forces respectives.
            </div>

            <!-- STATISTIQUES CL√âS -->
            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-box-value">2</div>
                    <div class="stat-box-label">Databases Cosmos DB</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">21</div>
                    <div class="stat-box-label">Containers Cosmos DB</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">6</div>
                    <div class="stat-box-label">Containers Blob Storage</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">&lt;10ms</div>
                    <div class="stat-box-label">Latence P99 garantie</div>
                </div>
            </div>

            <h2>4.1 Approche Hybride : Cosmos DB + Blob Storage</h2>

            <h3>4.1.1 Philosophie de l'Architecture</h3>

            <div class="intro-text">
                L'architecture hybride s√©pare intelligemment les responsabilit√©s de stockage :
                <strong>Cosmos DB</strong> g√®re les m√©tadonn√©es, configurations et donn√©es transactionnelles,
                tandis que <strong>Blob Storage</strong> stocke les fichiers binaires volumineux (audio, documents, images).
                Cette s√©paration permet d'optimiser chaque type de donn√©es selon ses caract√©ristiques.
            </div>

            <div class="mermaid">
flowchart TB
    subgraph Application["üñ•Ô∏è Application Waka Voice"]
        API[Flask API]
        WS[WebSocket Handler]
    end

    subgraph CosmosLayer["üíæ Azure Cosmos DB"]
        direction TB
        DB1[("ConversationsDB<br/>17 containers")]
        DB2[("RAG_base<br/>3 containers")]
    end

    subgraph BlobLayer["üì¶ Azure Blob Storage"]
        direction TB
        B1[documents]
        B2[consent-audio]
        B3[voice-samples]
        B4[synthesized-audio]
        B5[enregistrements]
        B6[background]
    end

    subgraph DataTypes["Types de Donn√©es"]
        META["üìã M√©tadonn√©es<br/>Configurations<br/>Historiques<br/>Sessions"]
        FILES["üìÅ Fichiers Binaires<br/>Audio WAV/MP3<br/>Documents PDF<br/>Images PNG/JPG"]
    end

    API --> CosmosLayer
    WS --> CosmosLayer
    API --> BlobLayer

    META -.->|Stock√© dans| CosmosLayer
    FILES -.->|Stock√© dans| BlobLayer

    CosmosLayer <-->|"R√©f√©rences URL"| BlobLayer

    style CosmosLayer fill:#4A148C,color:#fff
    style BlobLayer fill:#0D47A1,color:#fff
    style Application fill:#1B5E20,color:#fff
            </div>

            <h3>4.1.2 Comparaison et Avantages</h3>

            <div class="comparison-box">
                <div class="comparison-column">
                    <div class="comparison-header" style="background: linear-gradient(135deg, #4A148C, #7B1FA2); color: white;">üíæ Cosmos DB</div>
                    <ul class="comparison-list">
                        <li><strong>Latence &lt; 10ms</strong> garantie au P99</li>
                        <li><strong>Requ√™tes SQL</strong> sur documents JSON</li>
                        <li><strong>Transactions ACID</strong> par partition</li>
                        <li><strong>Indexation automatique</strong> de tous les champs</li>
                        <li><strong>Distribution g√©ographique</strong> multi-r√©gions</li>
                        <li><strong>Change Feed</strong> pour √©v√©nements temps r√©el</li>
                        <li><strong>SLA 99.999%</strong> disponibilit√©</li>
                    </ul>
                    <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(74, 20, 140, 0.1); border-radius: 8px;">
                        <strong>Id√©al pour :</strong> Configurations agents, sessions, historiques, m√©tadonn√©es, tools
                    </div>
                </div>
                <div class="comparison-column">
                    <div class="comparison-header" style="background: linear-gradient(135deg, #0D47A1, #1976D2); color: white;">Blob Storage</div>
                    <ul class="comparison-list">
                        <li><strong>Fichiers illimit√©s</strong> jusqu'√† 190.7 TB chacun</li>
                        <li><strong>Streaming natif</strong> pour audio/vid√©o</li>
                        <li><strong>CDN int√©gr√©</strong> pour distribution globale</li>
                        <li><strong>Tiers de stockage</strong> : Hot, Cool, Archive</li>
                        <li><strong>Acc√®s SAS</strong> s√©curis√© avec expiration</li>
                        <li><strong>Versioning</strong> et soft delete</li>
                    </ul>
                    <div style="margin-top: 1rem; padding: 0.75rem; background: rgba(13, 71, 161, 0.1); border-radius: 8px;">
                        <strong>Id√©al pour :</strong> Audio, documents PDF, images, fichiers volumineux
                    </div>
                </div>
            </div>

            <div class="callout callout-success">
                <i class="bi bi-lightning-charge callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Avantage de l'Approche Hybride</div>
                    <p>
                        En stockant les <strong>r√©f√©rences URL</strong> dans Cosmos DB plut√¥t que les fichiers binaires,
                        nous optimisons les performances de stockage. Les fichiers volumineux (audio, documents) sont
                        stock√©s dans Blob Storage avec acc√®s rapide via CDN.
                    </p>
                </div>
            </div>

            <!-- MOCKUP ARCHITECTURE VISUELLE -->
            <h3>4.1.3 Vue d'Ensemble des Bases</h3>

            <div style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 16px; padding: 2rem; margin: 2rem 0;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <!-- Cosmos DB Section -->
                    <div style="background: rgba(74, 20, 140, 0.3); border: 2px solid #7B1FA2; border-radius: 12px; padding: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                            <div style="width: 48px; height: 48px; background: #4A148C; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-database" style="color: white; font-size: 1.5rem;"></i>
                            </div>
                            <div>
                                <div style="color: white; font-weight: 600; font-size: 1.1rem;">Azure Cosmos DB</div>
                                <div style="color: #B39DDB; font-size: 0.85rem;">NoSQL Document Database</div>
                            </div>
                        </div>

                        <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                            <div style="color: #CE93D8; font-weight: 600; margin-bottom: 0.5rem;">üìÅ ConversationsDB</div>
                            <div style="color: #E1BEE7; font-size: 0.85rem;">17 containers ‚Ä¢ Donn√©es applicatives</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.75rem;">
                                <span style="background: #4A148C; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">AgentConfigurations</span>
                                <span style="background: #4A148C; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">VoiceSessions</span>
                                <span style="background: #4A148C; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">Tools</span>
                                <span style="background: #4A148C; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">+14 autres</span>
                            </div>
                        </div>

                        <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 1rem;">
                            <div style="color: #CE93D8; font-weight: 600; margin-bottom: 0.5rem;">üìÅ RAG_base</div>
                            <div style="color: #E1BEE7; font-size: 0.85rem;">3 containers ‚Ä¢ Donn√©es RAG</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.75rem;">
                                <span style="background: #4A148C; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">database (chunks)</span>
                                <span style="background: #4A148C; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">Libraries_Tracking</span>
                                <span style="background: #4A148C; color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">Logs_RAG</span>
                            </div>
                        </div>
                    </div>

                    <!-- Blob Storage Section -->
                    <div style="background: rgba(13, 71, 161, 0.3); border: 2px solid #1976D2; border-radius: 12px; padding: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem;">
                            <div style="width: 48px; height: 48px; background: #0D47A1; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <i class="bi bi-cloud-upload" style="color: white; font-size: 1.5rem;"></i>
                            </div>
                            <div>
                                <div style="color: white; font-weight: 600; font-size: 1.1rem;">Azure Blob Storage</div>
                                <div style="color: #90CAF9; font-size: 0.85rem;">Object Storage Service</div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                            <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 0.75rem;">
                                <div style="color: #64B5F6; font-weight: 600; font-size: 0.9rem;">üìÑ documents</div>
                                <div style="color: #BBDEFB; font-size: 0.75rem;">PDF, DOCX, XLSX</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 0.75rem;">
                                <div style="color: #64B5F6; font-weight: 600; font-size: 0.9rem;">üé§ consent-audio</div>
                                <div style="color: #BBDEFB; font-size: 0.75rem;">WAV consentements</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 0.75rem;">
                                <div style="color: #64B5F6; font-weight: 600; font-size: 0.9rem;">üîä voice-samples</div>
                                <div style="color: #BBDEFB; font-size: 0.75rem;">√âchantillons vocaux</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 0.75rem;">
                                <div style="color: #64B5F6; font-weight: 600; font-size: 0.9rem;">üéµ synthesized-audio</div>
                                <div style="color: #BBDEFB; font-size: 0.75rem;">Audio g√©n√©r√©</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 0.75rem;">
                                <div style="color: #64B5F6; font-weight: 600; font-size: 0.9rem;">üéôÔ∏è enregistrements</div>
                                <div style="color: #BBDEFB; font-size: 0.75rem;">Enregistrements</div>
                            </div>
                            <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 0.75rem;">
                                <div style="color: #64B5F6; font-weight: 600; font-size: 0.9rem;">üñºÔ∏è background</div>
                                <div style="color: #BBDEFB; font-size: 0.75rem;">Images avatars</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h2>4.2 Database 1 : ConversationsDB (Principal)</h2>

            <div class="intro-text">
                <strong>ConversationsDB</strong> est la base de donn√©es principale contenant 17 containers
                pour toutes les donn√©es applicatives : configurations agents, sessions, tools, campagnes, etc.
            </div>

            <h3>4.2.1 Container : AgentConfigurations</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2" style="background: linear-gradient(135deg, #4A148C, #7B1FA2); color: white;">
                                <i class="bi bi-mic"></i> AgentConfigurations
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Description</strong></td><td>Configurations des agents vocaux (Voice Live)</td></tr>
                        <tr><td><strong>Partition Key</strong></td><td><code>/agent_id</code></td></tr>
                        <tr><td><strong>Justification PK</strong></td><td>Acc√®s direct par ID agent, isolation par agent</td></tr>
                        <tr><td><strong>Liens vers</strong></td><td>VoiceSessions, Tools, campagnes-appels</td></tr>
                    </tbody>
                </table>
            </div>

            <pre><code class="language-json">{
  "id": "uuid",
  "agent_id": "uuid",
  "agent_reference": "Agent-XXXXXX",
  "agent_type": "voice_agent",
  "config_type": "azure_speech",
  "model_id": "gpt-4o-realtime",
  "model_name": "GPT-4o Realtime",
  "model_family": "F1_Realtime",
  "speech_endpoint": "https://eastus2.api.cognitive.microsoft.com/",
  "speech_region": "eastus2",
  "agent_name": "Assistant Commercial",
  "role": "commercial",
  "voice_config": {
    "voice": "fr-FR-DeniseNeural",
    "style": "friendly"
  },
  "azure_config": {
    "modalities": ["text", "audio"],
    "temperature": 0.8,
    "max_response_output_tokens": 4096,
    "turn_detection": {
      "type": "server_vad",
      "threshold": 0.5,
      "silence_duration_ms": 500
    },
    "input_audio_transcription": { "model": "whisper-1" },
    "tools": ["search_web", "send_email"],
    "instructions": "Tu es un assistant commercial..."
  },
  "tools": ["tool_id_1", "tool_id_2"],
  "current_step": 4,
  "status": "active",
  "created_at": "2024-01-15T10:30:00Z",
  "updated_at": "2024-01-20T14:45:00Z"
}</code></pre>

            <h3>4.2.2 Container : AvatarConfigurations</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2" style="background: linear-gradient(135deg, #00695C, #00897B); color: white;">
                                <i class="bi bi-person-video3"></i> AvatarConfigurations
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Description</strong></td><td>Configurations des agents avatar (Azure Avatar)</td></tr>
                        <tr><td><strong>Partition Key</strong></td><td><code>/agent_id</code></td></tr>
                        <tr><td><strong>Justification PK</strong></td><td>M√™me pattern que AgentConfigurations</td></tr>
                        <tr><td><strong>Liens vers</strong></td><td>VoiceSessions, Tools, AvatarGallery</td></tr>
                    </tbody>
                </table>
            </div>

            <pre><code class="language-json">{
  "id": "uuid",
  "agent_id": "uuid",
  "agent_reference": "Avatar-XXXXXX",
  "agent_type": "azure_avatar",
  "avatar_type": "photo",
  "azure_config": {
    "avatar": {
      "character": "lisa",
      "style": "casual-sitting",
      "photoAvatarBaseModel": "vasa-1",
      "video": {
        "bitrate": 2000000,
        "codec": "h264",
        "resolution": { "width": 1920, "height": 1080 }
      }
    },
    "modalities": ["text", "audio"],
    "temperature": 0.7
  },
  "background_url": "https://...blob.../background/office.jpg",
  "status": "active"
}</code></pre>

            <h3>4.2.3 Container : TextAgentConfigurations</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2" style="background: linear-gradient(135deg, #1565C0, #1976D2); color: white;">
                                <i class="bi bi-chat-text"></i> TextAgentConfigurations
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Description</strong></td><td>Configurations des agents texte (GPT-5.2, Claude Opus 4.5)</td></tr>
                        <tr><td><strong>Partition Key</strong></td><td><code>/agent_id</code></td></tr>
                        <tr><td><strong>Justification PK</strong></td><td>Acc√®s direct par ID agent</td></tr>
                        <tr><td><strong>Liens vers</strong></td><td>VoiceSessions, Tools</td></tr>
                    </tbody>
                </table>
            </div>

            <pre><code class="language-json">{
  "id": "uuid",
  "agent_id": "uuid",
  "agent_reference": "TextAgent-XXXXXX",
  "agent_type": "text_agent",
  "config_type": "azure_inference",
  "model_id": "gpt-5.2-chat",
  "model_name": "GPT-5.2",
  "model_provider": "OpenAI",
  "language": "fr-FR",
  "tools": ["end_text_conversation", "search_knowledge"],
  "tools_definitions": [
    {
      "type": "function",
      "function": {
        "name": "search_knowledge",
        "description": "Recherche dans la base de connaissances",
        "parameters": { ... }
      }
    }
  ],
  "instructions": "Tu es un assistant expert...",
  "temperature": 0.7,
  "max_response_tokens": 4096,
  "status": "active",
  "created_at": "2024-02-01T09:00:00Z"
}</code></pre>

            <h3>4.2.4 Container : VoiceSessions</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2" style="background: linear-gradient(135deg, #E65100, #F57C00); color: white;">
                                <i class="bi bi-telephone"></i> VoiceSessions
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Description</strong></td><td>Sessions de conversation (Voice, Avatar, Text)</td></tr>
                        <tr><td><strong>Partition Key</strong></td><td><code>/call_id</code></td></tr>
                        <tr><td><strong>Justification PK</strong></td><td>Isolation parfaite par session, requ√™tes rapides</td></tr>
                        <tr><td><strong>Liens vers</strong></td><td>AgentConfigurations, CallHistory</td></tr>
                    </tbody>
                </table>
            </div>

            <pre><code class="language-json">{
  "id": "session_uuid",
  "call_id": "call_uuid",
  "session_id": "session_uuid",
  "session_type": "voice_live",
  "agent_id": "agent_uuid",
  "agent_type": "Agent Voice",
  "model_id": "gpt-4o-realtime",
  "family": "F1_Realtime",
  "tarif_base": "pro",
  "azure_config": { ... },
  "history": [
    { "role": "user", "content": "Bonjour", "timestamp": "..." },
    { "role": "assistant", "content": "Bonjour ! Comment puis-je vous aider ?", "timestamp": "..." }
  ],
  "usage": {
    "input_token_details": { "text_tokens": 150, "audio_tokens": 2400 },
    "output_token_details": { "text_tokens": 200, "audio_tokens": 3200 }
  },
  "cost": {
    "total_cost": 0.045,
    "cost_per_minute": 0.015
  },
  "duration_minutes": 3.5,
  "status": "completed",
  "summary": "Discussion sur les tarifs et disponibilit√©s",
  "sentiment": "positive",
  "created_at": "2024-01-20T14:30:00Z",
  "end_datetime": "2024-01-20T14:33:30Z"
}</code></pre>

            <h3>4.2.5 Container : Tools</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2" style="background: linear-gradient(135deg, #6A1B9A, #8E24AA); color: white;">
                                <i class="bi bi-tools"></i> Tools
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Description</strong></td><td>D√©finitions des outils dynamiques pour les agents</td></tr>
                        <tr><td><strong>Partition Key</strong></td><td><code>/category</code></td></tr>
                        <tr><td><strong>Justification PK</strong></td><td>Requ√™tes fr√©quentes par cat√©gorie (galerie, filtrage)</td></tr>
                        <tr><td><strong>Liens vers</strong></td><td>AgentConfigurations (via tools[])</td></tr>
                    </tbody>
                </table>
            </div>

            <pre><code class="language-json">{
  "id": "uuid",
  "tool_id": "uuid",
  "name": "search_web",
  "display_name": "Recherche Web",
  "category": "general",
  "tool_type": "api_rest",
  "definition": {
    "type": "function",
    "function": {
      "name": "search_web",
      "description": "Effectue une recherche sur le web",
      "parameters": {
        "type": "object",
        "properties": {
          "query": { "type": "string", "description": "Requ√™te de recherche" }
        },
        "required": ["query"]
      }
    }
  },
  "execution": {
    "type": "http",
    "method": "GET",
    "endpoint": "https://api.bing.microsoft.com/v7.0/search",
    "headers": { "Ocp-Apim-Subscription-Key": "{{BING_API_KEY}}" }
  },
  "status": "active",
  "is_system": false,
  "version": 1,
  "created_at": "2024-01-10T08:00:00Z"
}</code></pre>

            <h3>4.2.6 Container : CallHistory</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2" style="background: linear-gradient(135deg, #C62828, #E53935); color: white;">
                                <i class="bi bi-journal-text"></i> CallHistory
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Description</strong></td><td>Historique d√©taill√© des appels (campagnes)</td></tr>
                        <tr><td><strong>Partition Key</strong></td><td><code>/call_id</code></td></tr>
                        <tr><td><strong>Justification PK</strong></td><td>Isolation par appel, corr√©lation avec VoiceSessions</td></tr>
                        <tr><td><strong>Liens vers</strong></td><td>campagnes-appels, CampaignClients</td></tr>
                    </tbody>
                </table>
            </div>

            <pre><code class="language-json">{
  "id": "call_uuid",
  "call_id": "call_uuid",
  "session_id": "call_uuid",
  "session_type": "voice_live",
  "agent_id": "agent_uuid",
  "campaign_id": "campaign_uuid",
  "customer_data": {
    "name": "Jean Dupont",
    "phone": "+33612345678",
    "company": "Acme Inc"
  },
  "current_step": "closing",
  "conversation_history": [ ... ],
  "brain_history": [ ... ],
  "tools_executed": [
    { "name": "check_availability", "result": "success", "timestamp": "..." }
  ],
  "tokens": {
    "input_text": 450,
    "input_audio": 5600,
    "output_text": 380,
    "output_audio": 7200
  },
  "status": "completed",
  "outcome": "ptp",
  "created_at": "2024-01-22T10:15:00Z"
}</code></pre>

            <h3>4.2.7 Container : campagnes-appels</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2" style="background: linear-gradient(135deg, #283593, #3949AB); color: white;">
                                <i class="bi bi-megaphone"></i> campagnes-appels
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Description</strong></td><td>Configurations des campagnes d'appels sortants</td></tr>
                        <tr><td><strong>Partition Key</strong></td><td><code>/id</code></td></tr>
                        <tr><td><strong>Justification PK</strong></td><td>Acc√®s direct par ID campagne</td></tr>
                        <tr><td><strong>Liens vers</strong></td><td>AgentConfigurations, CampaignClients, CallHistory</td></tr>
                    </tbody>
                </table>
            </div>

            <pre><code class="language-json">{
  "id": "campaign_uuid",
  "campaign_id": "campaign_uuid",
  "campaign_reference": "campagne_XXXXX",
  "campaign_name": "Recouvrement Q1 2024",
  "campaign_type": "recouvrement",
  "agent_id": "agent_uuid",
  "agent_reference": "Agent-XXXXXX",
  "start_date": "2024-01-15",
  "end_date": "2024-03-31",
  "selected_tools": ["check_payment_status", "schedule_callback"],
  "selected_statuses": ["impay√©", "relance"],
  "clients": ["client_id_1", "client_id_2"],
  "total_clients": 250,
  "stats": {
    "total_calls": 180,
    "successful_calls": 145,
    "ptp_count": 89,
    "callback_scheduled": 32
  },
  "status": "active",
  "created_at": "2024-01-10T09:00:00Z"
}</code></pre>

            <h3>4.2.8 Container : ConversationHistory</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2" style="background: linear-gradient(135deg, #00838F, #00ACC1); color: white;">
                                <i class="bi bi-chat-dots"></i> ConversationHistory
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Description</strong></td><td>Historique des conversations RAG Chat</td></tr>
                        <tr><td><strong>Partition Key</strong></td><td><code>/id</code></td></tr>
                        <tr><td><strong>Justification PK</strong></td><td>Acc√®s direct par ID conversation</td></tr>
                        <tr><td><strong>Liens vers</strong></td><td>RAGProjects</td></tr>
                    </tbody>
                </table>
            </div>

            <pre><code class="language-json">{
  "id": "conv_abc123",
  "user_email": "user@domain.com",
  "display_name": "Jean Dupont",
  "history": [
    { "role": "user", "content": "Quelle est la politique de remboursement ?" },
    { "role": "assistant", "content": "Selon notre documentation, les remboursements sont possibles..." }
  ],
  "start_datetime": "2024-01-25T14:00:00Z",
  "end_datetime": "2024-01-25T14:15:00Z",
  "duration": "0:15:00",
  "summary": "Questions sur la politique de remboursement",
  "satisfaction_measure": {
    "rating": 4,
    "feedback": "R√©ponse claire et rapide"
  },
  "status": "completed"
}</code></pre>

            <h3>4.2.9 Containers Personal Voice</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Container</th>
                            <th>Partition Key</th>
                            <th>Description</th>
                            <th>Lien Blob Storage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>PersonalVoiceProjects</code></td>
                            <td><code>/project_id</code></td>
                            <td>Projets de cr√©ation de voix personnalis√©es</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td><code>PersonalVoiceConsents</code></td>
                            <td><code>/consent_id</code></td>
                            <td>Enregistrements de consentement</td>
                            <td><code>consent-audio</code> (audio_url)</td>
                        </tr>
                        <tr>
                            <td><code>PersonalVoices</code></td>
                            <td><code>/voice_id</code></td>
                            <td>Voix cr√©√©es et entra√Æn√©es</td>
                            <td><code>voice-samples</code> (training_audio_url)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>4.2.10 Autres Containers ConversationsDB</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Container</th>
                            <th>Partition Key</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>CampaignClients</code></td>
                            <td><code>/campagne_id</code></td>
                            <td>Clients associ√©s aux campagnes d'appels</td>
                        </tr>
                        <tr>
                            <td><code>Callbacks</code></td>
                            <td><code>/client_id</code></td>
                            <td>Rappels planifi√©s pour les campagnes</td>
                        </tr>
                        <tr>
                            <td><code>AvatarGallery</code></td>
                            <td><code>/id</code></td>
                            <td>Galerie d'avatars pr√©d√©finis (Studio Avatar)</td>
                        </tr>
                        <tr>
                            <td><code>AvatarPreferences</code></td>
                            <td><code>/user_id</code></td>
                            <td>Pr√©f√©rences utilisateur (favoris, r√©cents)</td>
                        </tr>
                        <tr>
                            <td><code>RAGProjects</code></td>
                            <td><code>/id</code></td>
                            <td>Projets RAG (organisation des documents)</td>
                        </tr>
                        <tr>
                            <td><code>TokenConsumption</code></td>
                            <td><code>/user_id</code></td>
                            <td>Suivi de consommation de tokens par utilisateur</td>
                        </tr>
                        <tr>
                            <td><code>ModelInstructions</code></td>
                            <td><code>/id</code></td>
                            <td>Templates d'instructions pour les mod√®les</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>4.3 Database 2 : RAG_base (Fonctionnalit√© RAG)</h2>

            <div class="intro-text">
                <strong>RAG_base</strong> est une base de donn√©es d√©di√©e au syst√®me RAG (Retrieval-Augmented Generation),
                contenant 3 containers pour les chunks index√©s, le tracking et les logs.
            </div>

            <h3>4.3.1 Container : database (Chunks)</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2" style="background: linear-gradient(135deg, #2E7D32, #43A047); color: white;">
                                <i class="bi bi-file-earmark-text"></i> database (Chunks RAG)
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Description</strong></td><td>Chunks de documents index√©s avec embeddings</td></tr>
                        <tr><td><strong>Partition Key</strong></td><td><code>/project_name</code></td></tr>
                        <tr><td><strong>Justification PK</strong></td><td>Filtrage rapide par projet lors des recherches</td></tr>
                        <tr><td><strong>Liens vers</strong></td><td>Blob Storage (documents), RAGProjects</td></tr>
                    </tbody>
                </table>
            </div>

            <pre><code class="language-json">{
  "id": "chunk_uuid",
  "document_id": "doc_uuid",
  "project_id": "project_uuid",
  "project_name": "Base Connaissances RH",
  "content": "Le processus d'int√©gration des nouveaux employ√©s comprend...",
  "chunk_index": 5,
  "total_chunks": 24,
  "blob_url": "https://wakastorage.blob.../documents/politique_rh.pdf",
  "source_filename": "politique_rh.pdf",
  "source_type": "upload",
  "embedding": [0.0234, -0.0156, 0.0891, ...],
  "metadata": {
    "page_number": 3,
    "section": "Int√©gration",
    "language": "fr"
  },
  "summary": "R√©sum√© du processus d'int√©gration...",
  "entities": ["RH", "int√©gration", "onboarding"],
  "created_at": "2024-01-18T11:30:00Z"
}</code></pre>

            <h3>4.3.2 Container : Libraries_Tracking</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2" style="background: linear-gradient(135deg, #1565C0, #1E88E5); color: white;">
                                <i class="bi bi-folder2-open"></i> Libraries_Tracking
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Description</strong></td><td>Suivi des biblioth√®ques SharePoint synchronis√©es</td></tr>
                        <tr><td><strong>Partition Key</strong></td><td><code>/site_id</code></td></tr>
                        <tr><td><strong>Justification PK</strong></td><td>Groupement par site SharePoint</td></tr>
                    </tbody>
                </table>
            </div>

            <pre><code class="language-json">{
  "id": "tracking_uuid",
  "site_id": "sharepoint_site_id",
  "library_id": "library_id",
  "library_name": "Documents RH",
  "last_sync": "2024-01-25T02:00:00Z",
  "documents_indexed": 156,
  "chunks_created": 2340,
  "sync_status": "completed",
  "errors": []
}</code></pre>

            <h3>4.3.3 Container : Logs_RAG</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th colspan="2" style="background: linear-gradient(135deg, #455A64, #607D8B); color: white;">
                                <i class="bi bi-journal-code"></i> Logs_RAG
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Description</strong></td><td>Logs des op√©rations RAG (indexation, recherche)</td></tr>
                        <tr><td><strong>Partition Key</strong></td><td><code>/operation_type</code></td></tr>
                        <tr><td><strong>Justification PK</strong></td><td>Analyse par type d'op√©ration</td></tr>
                    </tbody>
                </table>
            </div>

            <h2>4.4 Azure Blob Storage : Containers</h2>

            <div class="intro-text">
                <strong>Azure Blob Storage</strong> stocke tous les fichiers binaires volumineux,
                avec des r√©f√©rences URL conserv√©es dans Cosmos DB pour maintenir la liaison.
            </div>

            <div class="mermaid">
flowchart LR
    subgraph BlobContainers["üì¶ Azure Blob Storage Containers"]
        direction TB
        DOC["üìÑ documents<br/>PDF, DOCX, XLSX<br/>RAG indexation"]
        CONS["üé§ consent-audio<br/>WAV consentements<br/>Personal Voice"]
        SAMP["üîä voice-samples<br/>√âchantillons vocaux<br/>Training CNV"]
        SYNTH["üéµ synthesized-audio<br/>Audio g√©n√©r√©<br/>TTS output"]
        ENR["üéôÔ∏è enregistrements<br/>Enregistrements divers<br/>Audio g√©n√©ral"]
        BG["üñºÔ∏è background<br/>Images fond<br/>Avatar Studio"]
    end

    subgraph CosmosRefs["üíæ R√©f√©rences Cosmos DB"]
        R1["RAG_base.database<br/>blob_url"]
        R2["PersonalVoiceConsents<br/>audio_url"]
        R3["PersonalVoices<br/>training_audio_url"]
        R4["VoiceSessions<br/>audio_url"]
        R5["AgentConfigurations<br/>sample_audio_url"]
        R6["AvatarConfigurations<br/>background_url"]
    end

    DOC --> R1
    CONS --> R2
    SAMP --> R3
    SYNTH --> R4
    ENR --> R5
    BG --> R6

    style BlobContainers fill:#0D47A1,color:#fff
    style CosmosRefs fill:#4A148C,color:#fff
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Container</th>
                            <th>Contenu</th>
                            <th>Formats</th>
                            <th>Tier</th>
                            <th>R√©f√©renc√© par</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>documents</code></td>
                            <td>Documents pour indexation RAG</td>
                            <td>PDF, DOCX, XLSX, TXT, PPTX</td>
                            <td>Hot</td>
                            <td>RAG_base.database</td>
                        </tr>
                        <tr>
                            <td><code>consent-audio</code></td>
                            <td>Enregistrements de consentement vocal</td>
                            <td>WAV (16kHz, mono)</td>
                            <td>Hot</td>
                            <td>PersonalVoiceConsents</td>
                        </tr>
                        <tr>
                            <td><code>voice-samples</code></td>
                            <td>√âchantillons pour entra√Ænement voix</td>
                            <td>WAV (24kHz, mono)</td>
                            <td>Hot</td>
                            <td>PersonalVoices</td>
                        </tr>
                        <tr>
                            <td><code>synthesized-audio</code></td>
                            <td>Audio g√©n√©r√© par TTS</td>
                            <td>WAV, MP3</td>
                            <td>Cool</td>
                            <td>VoiceSessions</td>
                        </tr>
                        <tr>
                            <td><code>enregistrements</code></td>
                            <td>Enregistrements audio g√©n√©raux</td>
                            <td>WAV, MP3</td>
                            <td>Hot</td>
                            <td>AgentConfigurations</td>
                        </tr>
                        <tr>
                            <td><code>background</code></td>
                            <td>Images de fond pour avatars</td>
                            <td>PNG, JPG, WEBP</td>
                            <td>Hot</td>
                            <td>AvatarConfigurations</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h2>4.5 Diagramme d'Interrelations</h2>

            <div class="intro-text">
                Ce diagramme montre les relations entre tous les containers Cosmos DB et Blob Storage,
                illustrant comment les donn√©es circulent dans l'application.
            </div>

            <div class="mermaid">
erDiagram
    AgentConfigurations ||--o{ VoiceSessions : "lance"
    AgentConfigurations ||--o{ campagnes-appels : "utilis√© par"
    AgentConfigurations }o--o{ Tools : "r√©f√©rence"

    AvatarConfigurations ||--o{ VoiceSessions : "lance"
    AvatarConfigurations }o--|| AvatarGallery : "s√©lectionne"
    AvatarConfigurations }o--|| background-blob : "image de"

    TextAgentConfigurations ||--o{ VoiceSessions : "lance"
    TextAgentConfigurations }o--o{ Tools : "r√©f√©rence"

    VoiceSessions ||--|| CallHistory : "d√©tails dans"
    VoiceSessions }o--|| synthesized-audio-blob : "audio dans"

    campagnes-appels ||--o{ CampaignClients : "contient"
    campagnes-appels ||--o{ CallHistory : "g√©n√®re"
    campagnes-appels ||--o{ Callbacks : "planifie"

    CampaignClients ||--o{ Callbacks : "rappels pour"

    PersonalVoiceProjects ||--o{ PersonalVoiceConsents : "contient"
    PersonalVoiceProjects ||--o{ PersonalVoices : "produit"
    PersonalVoiceConsents }o--|| consent-audio-blob : "audio dans"
    PersonalVoices }o--|| voice-samples-blob : "samples dans"

    RAGProjects ||--o{ database-chunks : "organise"
    database-chunks }o--|| documents-blob : "source dans"

    ConversationHistory }o--|| RAGProjects : "utilise"

    AgentConfigurations {
        string agent_id PK
        string agent_reference
        array tools FK
        string status
    }

    VoiceSessions {
        string call_id PK
        string agent_id FK
        array history
        object usage
    }

    Tools {
        string tool_id PK
        string category
        string name
        object definition
    }

    campagnes-appels {
        string campaign_id PK
        string agent_id FK
        array clients FK
    }

    PersonalVoiceProjects {
        string project_id PK
        array consents FK
        array voices FK
    }

    RAGProjects {
        string project_id PK
        string name
        int document_count
    }
            </div>

            <h2>4.6 Flux de Donn√©es Principaux</h2>

            <h3>4.6.1 Flux 1 : Session Voice/Avatar</h3>

            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant API as Flask API
    participant Cosmos as Cosmos DB
    participant Blob as Blob Storage
    participant Azure as Azure OpenAI

    U->>API: D√©marrer session
    API->>Cosmos: Read AgentConfigurations
    Cosmos-->>API: Config agent + tools
    API->>Cosmos: Create VoiceSessions

    loop Conversation
        U->>API: Message audio
        API->>Azure: Realtime API
        Azure-->>API: R√©ponse audio
        API->>API: Accumule en m√©moire
    end

    U->>API: Fin session
    API->>Blob: Upload audio (optionnel)
    Blob-->>API: URL audio
    API->>Cosmos: Update VoiceSessions (final)
    API->>Cosmos: Create/Update CallHistory
            </div>

            <h3>4.6.2 Flux 2 : Indexation RAG</h3>

            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant API as Flask API
    participant Blob as Blob Storage
    participant DocInt as Document Intelligence
    participant OpenAI as Azure OpenAI
    participant Cosmos as Cosmos DB RAG_base
    participant Search as AI Search

    U->>API: Upload document
    API->>Blob: Store fichier
    Blob-->>API: blob_url

    API->>DocInt: Extraction texte
    DocInt-->>API: Contenu structur√©

    API->>API: Chunking (500 tokens)

    loop Pour chaque chunk
        API->>OpenAI: Embedding
        OpenAI-->>API: Vector 1536d
        API->>Cosmos: Insert chunk + embedding
    end

    API->>Search: Index mise √† jour
    API->>Cosmos: Update RAGProjects stats
            </div>

            <h3>4.6.3 Flux 3 : Personal Voice</h3>

            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant API as Flask API
    participant Blob as Blob Storage
    participant Speech as Azure Speech
    participant Cosmos as Cosmos DB

    U->>API: Cr√©er projet
    API->>Cosmos: Create PersonalVoiceProjects

    U->>API: Enregistrer consentement
    API->>Blob: Upload consent-audio
    Blob-->>API: audio_url
    API->>Cosmos: Create PersonalVoiceConsents
    API->>Speech: Submit consent
    Speech-->>API: azure_consent_id
    API->>Cosmos: Update consent status

    U->>API: Upload √©chantillons
    API->>Blob: Upload voice-samples
    API->>Speech: Create Personal Voice
    Speech-->>API: voice_id
    API->>Cosmos: Create PersonalVoices
            </div>

            <h2>4.7 Pattern de Persistance Optimis√©</h2>

            <div class="callout callout-success">
                <i class="bi bi-lightning-charge callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Optimisation : 2 appels Cosmos par session</div>
                    <p>
                        Au lieu de persister chaque message (50+ writes par conversation),
                        ce pattern r√©duit √† exactement 2 op√©rations : 1 create au lancement,
                        1 update √† la cl√¥ture. <strong>√âconomie : ~95% des RU/s.</strong>
                    </p>
                </div>
            </div>

            <pre><code class="language-python"># Pattern de persistance (voice_live_proxy.py)
class VoiceLiveSession:
    def __init__(self, ...):
        # Phase 1: Lancement - 1 read config, 1 create session
        self.cached_azure_config = agent_config.get('azure_config')
        self._create_conversation_document()  # 1 write

    def _accumulate_transcript(self, role, content):
        # Phase 2: Pendant - 0 appels Cosmos
        self.transcripts.append({
            "role": role,
            "content": content,
            "timestamp": datetime.utcnow().isoformat()
        })  # M√©moire uniquement

    def close(self):
        # Phase 3: Fin - 1 update final
        manager.update(self.session_id, {
            "history": self.transcripts,
            "usage": self.accumulated_tokens,
            "outcome": self.end_outcome,
            "end_datetime": datetime.utcnow().isoformat()
        })  # 1 write</code></pre>

            <h2>4.8 Bonnes Pratiques de Partition Key</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Pattern</th>
                            <th>Partition Key</th>
                            <th>Cas d'usage</th>
                            <th>Avantages</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Acc√®s direct</strong></td>
                            <td><code>/id</code> ou <code>/entity_id</code></td>
                            <td>AgentConfigurations, VoiceSessions</td>
                            <td>Point reads ultra-rapides (1 RU)</td>
                        </tr>
                        <tr>
                            <td><strong>Groupement logique</strong></td>
                            <td><code>/category</code>, <code>/project_name</code></td>
                            <td>Tools, RAG chunks</td>
                            <td>Requ√™tes filtr√©es efficaces</td>
                        </tr>
                        <tr>
                            <td><strong>Isolation tenant</strong></td>
                            <td><code>/user_id</code>, <code>/campaign_id</code></td>
                            <td>TokenConsumption, CampaignClients</td>
                            <td>Donn√©es isol√©es par entit√©</td>
                        </tr>
                        <tr>
                            <td><strong>Time-series</strong></td>
                            <td><code>/operation_type</code></td>
                            <td>Logs_RAG</td>
                            <td>Analyse par type d'op√©ration</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="callout callout-warning">
                <i class="bi bi-exclamation-triangle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">‚ö†Ô∏è √âviter les hot partitions</div>
                    <p>
                        Ne jamais utiliser une partition key avec faible cardinalit√© (ex: <code>/status</code> avec 3 valeurs).
                        Cela cr√©e des "hot partitions" qui limitent le throughput. Pr√©f√©rer des cl√©s avec haute cardinalit√©
                        comme les IDs ou les cat√©gories multiples.
                    </p>
                </div>
            </div>

        </section>

        <!-- ==========================================
             CHAPITRE 5: VOIX PERSONNELLES (Personal Voice)
             Module complet de cr√©ation de voix personnalis√©es
             ========================================== -->
        <section id="personal-voice" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-mic"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 5: Voix Personnelles</h1>
                    <p class="section-subtitle">Personal Voice - Cr√©ation de voix sur mesure avec Azure Custom Neural Voice</p>
                </div>
            </div>

            <div class="intro-text">
                Le module <strong>Personal Voice</strong> permet de cr√©er des <strong>voix personnalis√©es</strong> uniques,
                reproduisant fid√®lement le timbre et le style d'une voix humaine r√©elle via <strong>Azure Custom Neural Voice</strong>.
                Ce processus guid√© en <strong>4 √©tapes</strong> garantit la conformit√© l√©gale (consentement explicite),
                la qualit√© audio optimale et l'int√©gration automatique dans votre galerie de voix.
            </div>

            <!-- STATISTIQUES CL√âS -->
            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-box-value">4</div>
                    <div class="stat-box-label">√âtapes de cr√©ation</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">80%</div>
                    <div class="stat-box-label">Score validation minimum</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">3</div>
                    <div class="stat-box-label">√âchantillons vocaux requis</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">~5min</div>
                    <div class="stat-box-label">Temps total de cr√©ation</div>
                </div>
            </div>

            <h2>5.1 Architecture du Module</h2>

            <h3>5.1.1 Stack Technique</h3>

            <div style="margin: 1.5rem 0;">
                <span class="tech-badge"><i class="bi bi-filetype-py"></i> Flask Blueprint</span>
                <span class="tech-badge"><i class="bi bi-cloud"></i> Azure Speech Services</span>
                <span class="tech-badge"><i class="bi bi-database"></i> Cosmos DB</span>
                <span class="tech-badge"><i class="bi bi-cloud-upload"></i> Azure Blob Storage</span>
                <span class="tech-badge"><i class="bi bi-mic"></i> Web Audio API</span>
                <span class="tech-badge"><i class="bi bi-filetype-js"></i> JavaScript ES6+</span>
            </div>

            <h3>5.1.2 Flux de Donn√©es Global</h3>

            <div class="mermaid">
flowchart TB
    subgraph Frontend["Frontend (personal_voice.js)"]
        UI[Interface Utilisateur]
        REC[Web Audio Recorder]
        VAL[Validateur Local]
    end

    subgraph Backend["Backend Flask (personal_voice_routes.py)"]
        API[API REST Routes]
        PROC[Audio Processor]
        LEV[Levenshtein Validator]
    end

    subgraph Azure["Services Azure"]
        SPEECH[Azure Speech Services]
        BLOB[Azure Blob Storage]
        CNV[Custom Neural Voice API]
    end

    subgraph Storage["Stockage"]
        COSMOS[(Cosmos DB)]
        FILES[(Fichiers Audio)]
    end

    UI -->|Enregistrement| REC
    REC -->|WAV Base64| API
    API -->|Transcription| SPEECH
    SPEECH -->|Texte| LEV
    LEV -->|Score| PROC
    PROC -->|Upload| BLOB
    PROC -->|M√©tadonn√©es| COSMOS
    API -->|Cr√©ation Voix| CNV
    CNV -->|Speaker Profile ID| COSMOS

    style Frontend fill:#E3F2FD,stroke:#1976D2
    style Backend fill:#FFF3E0,stroke:#FF9800
    style Azure fill:#E8F5E9,stroke:#4CAF50
    style Storage fill:#FCE4EC,stroke:#E91E63
            </div>

            <h2>5.2 Le Workflow en 4 √âtapes</h2>

            <div class="mermaid">
flowchart LR
    A["<b>√âtape 1</b><br/>S√©lection Projet"] --> B["<b>√âtape 2</b><br/>Consentement Vocal"]
    B --> C["<b>√âtape 3</b><br/>3 √âchantillons Audio"]
    C --> D["<b>√âtape 4</b><br/>Synth√®se & Galerie"]

    A -->|Projet existant<br/>ou nouveau| A1[Project ID]
    B -->|8-15 secondes<br/>Score ‚â• 80%| B1[Consent valid√©]
    C -->|5-90 sec chacun<br/>Score ‚â• 80%| C1[3 samples OK]
    D -->|Azure CNV API<br/>Speaker Profile| D1[Voix cr√©√©e]

    style A fill:#4A148C,color:#fff
    style B fill:#7B1FA2,color:#fff
    style C fill:#9C27B0,color:#fff
    style D fill:#BA68C8,color:#fff
            </div>

            <!-- √âTAPE 1 -->
            <h3>5.2.1 √âtape 1 : S√©lection du Projet</h3>

            <p>L'utilisateur choisit un projet Azure existant ou en cr√©e un nouveau. Chaque projet peut contenir plusieurs voix personnalis√©es.</p>

            <!-- Mockup HTML/CSS √âtape 1 -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 30px; margin: 25px 0; box-shadow: 0 15px 35px rgba(0,0,0,0.2);">
                <div style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 25px; backdrop-filter: blur(10px);">
                    <div style="text-align: center; margin-bottom: 25px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 24px; margin-bottom: 15px;">1</div>
                        <h4 style="color: #333; margin: 0; font-size: 1.4rem;">S√©lectionner un Projet</h4>
                        <p style="color: #666; margin-top: 5px; font-size: 0.9rem;">Choisissez le projet Azure pour votre nouvelle voix</p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div style="border: 2px solid #667eea; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s; background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));">
                            <i class="bi bi-folder" style="font-size: 2rem; color: #667eea;"></i>
                            <div style="font-weight: 600; color: #333; margin-top: 10px;">Projet Marketing</div>
                            <div style="font-size: 0.8rem; color: #888;">3 voix existantes</div>
                        </div>
                        <div style="border: 2px dashed #ccc; border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s;">
                            <i class="bi bi-plus-circle" style="font-size: 2rem; color: #888;"></i>
                            <div style="font-weight: 600; color: #666; margin-top: 10px;">Nouveau Projet</div>
                            <div style="font-size: 0.8rem; color: #888;">Cr√©er un projet</div>
                        </div>
                    </div>

                    <button style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer;">
                        <i class="bi bi-arrow-right"></i> Continuer vers l'√©tape 2
                    </button>
                </div>
            </div>

            <div class="callout callout-info">
                <i class="bi bi-info-circle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Gestion des Projets Azure</div>
                    <p>
                        Les projets sont r√©cup√©r√©s via l'API Azure Custom Neural Voice.
                        Si aucun projet n'existe, un nouveau sera cr√©√© automatiquement avec un nom par d√©faut.
                        Endpoint: <code>GET /personal-voice/api/projects</code>
                    </p>
                </div>
            </div>

            <!-- √âTAPE 2 -->
            <h3>5.2.2 √âtape 2 : Enregistrement du Consentement</h3>

            <p>Cette √©tape est <strong>obligatoire l√©galement</strong>. L'utilisateur doit lire √† haute voix un texte de consentement officiel qui autorise Azure √† cr√©er une voix synth√©tique.</p>

            <div class="callout callout-warning">
                <i class="bi bi-exclamation-triangle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Conformit√© L√©gale Obligatoire</div>
                    <p>
                        Azure exige un enregistrement de consentement explicite de la personne dont la voix sera clon√©e.
                        Le texte doit √™tre lu exactement tel qu'affich√©. Un score de validation <strong>‚â• 80%</strong> est requis.
                    </p>
                </div>
            </div>

            <!-- Mockup HTML/CSS √âtape 2 -->
            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 20px; padding: 30px; margin: 25px 0; box-shadow: 0 15px 35px rgba(0,0,0,0.2);">
                <div style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 25px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #f093fb, #f5576c); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 24px; margin-bottom: 15px;">2</div>
                        <h4 style="color: #333; margin: 0;">Enregistrement du Consentement</h4>
                    </div>

                    <!-- Texte de consentement -->
                    <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 20px; border-left: 4px solid #f5576c;">
                        <div style="font-size: 0.75rem; color: #888; text-transform: uppercase; margin-bottom: 10px;">Lisez ce texte √† haute voix :</div>
                        <p style="color: #333; font-size: 1rem; line-height: 1.8; margin: 0; font-style: italic;">
                            "I [state your name] am aware that recordings of my voice will be used by [state the company name]
                            to create and use a synthetic version of my voice."
                        </p>
                    </div>

                    <!-- Zone d'enregistrement -->
                    <div style="text-align: center; padding: 30px; border: 2px dashed #ddd; border-radius: 12px; margin-bottom: 20px;">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, #f093fb, #f5576c); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 15px; cursor: pointer; box-shadow: 0 5px 20px rgba(245,87,108,0.4);">
                            <i class="bi bi-mic-fill" style="font-size: 2rem; color: white;"></i>
                        </div>
                        <div style="color: #666; font-size: 0.9rem;">Cliquez pour commencer l'enregistrement</div>
                        <div style="color: #888; font-size: 0.8rem; margin-top: 5px;">Dur√©e requise : 8 √† 15 secondes</div>
                    </div>

                    <!-- Barre de validation -->
                    <div style="background: #e9ecef; border-radius: 10px; height: 30px; overflow: hidden; margin-bottom: 10px;">
                        <div style="width: 85%; height: 100%; background: linear-gradient(90deg, #4CAF50, #8BC34A); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.85rem;">
                            Score: 85% ‚úì
                        </div>
                    </div>
                    <div style="text-align: center; color: #4CAF50; font-size: 0.85rem;"><i class="bi bi-check-circle"></i> Consentement valid√© (seuil minimum : 80%)</div>
                </div>
            </div>

            <h4>Algorithme de Validation</h4>

            <p>La validation utilise l'algorithme de <strong>distance de Levenshtein</strong> pour comparer le texte transcrit avec le texte attendu :</p>

            <div class="mermaid">
flowchart TD
    A[Audio Enregistr√©] --> B[Azure Speech-to-Text]
    B --> C[Transcription obtenue]
    C --> D[Normalisation texte]
    D --> E[Calcul Distance Levenshtein]
    E --> F{Score ‚â• 80% ?}
    F -->|Oui| G[‚úì Validation OK]
    F -->|Non| H[‚úó R√©essayer]

    G --> I[Upload vers Azure Blob]
    I --> J[Enregistrement Cosmos DB]

    style A fill:#E3F2FD,stroke:#1976D2
    style G fill:#C8E6C9,stroke:#4CAF50
    style H fill:#FFCDD2,stroke:#F44336
            </div>

<pre><code># Extrait de personal_voice_routes.py - Validation Levenshtein
def calculate_similarity_score(text1: str, text2: str) -> float:
    """Calcule le score de similarit√© entre deux textes (0-100%)"""
    # Normalisation
    t1 = text1.lower().strip()
    t2 = text2.lower().strip()

    # Distance de Levenshtein
    distance = levenshtein_distance(t1, t2)
    max_len = max(len(t1), len(t2))

    if max_len == 0:
        return 100.0

    # Score = 100 - (distance/max_len * 100)
    return max(0, 100 - (distance / max_len * 100))</code></pre>

            <!-- √âTAPE 3 -->
            <h3>5.2.3 √âtape 3 : Enregistrement des 3 √âchantillons Vocaux</h3>

            <p>L'utilisateur enregistre <strong>3 √©chantillons audio</strong> en lisant des phrases pr√©d√©finies. Chaque √©chantillon doit durer entre <strong>5 et 90 secondes</strong> et atteindre un score de validation <strong>‚â• 80%</strong>.</p>

            <!-- Mockup HTML/CSS √âtape 3 -->
            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); border-radius: 20px; padding: 30px; margin: 25px 0; box-shadow: 0 15px 35px rgba(0,0,0,0.2);">
                <div style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 25px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #4facfe, #00f2fe); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: white; font-size: 24px; margin-bottom: 15px;">3</div>
                        <h4 style="color: #333; margin: 0;">√âchantillons Vocaux (3 requis)</h4>
                        <p style="color: #666; margin-top: 5px; font-size: 0.9rem;">Lisez chaque phrase clairement et distinctement</p>
                    </div>

                    <!-- Sample 1 - Valid√© -->
                    <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 15px; border-left: 4px solid #4CAF50;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="background: #4CAF50; color: white; padding: 3px 10px; border-radius: 15px; font-size: 0.75rem;">√âchantillon 1 ‚úì</span>
                            <span style="color: #4CAF50; font-weight: 600;">87%</span>
                        </div>
                        <p style="color: #333; font-size: 0.95rem; margin: 0; line-height: 1.6;">"The quick brown fox jumps over the lazy dog. This sentence contains every letter of the alphabet."</p>
                        <div style="margin-top: 10px; background: #e8f5e9; height: 6px; border-radius: 3px;">
                            <div style="width: 87%; height: 100%; background: #4CAF50; border-radius: 3px;"></div>
                        </div>
                    </div>

                    <!-- Sample 2 - Valid√© -->
                    <div style="background: #f8f9fa; border-radius: 12px; padding: 20px; margin-bottom: 15px; border-left: 4px solid #4CAF50;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="background: #4CAF50; color: white; padding: 3px 10px; border-radius: 15px; font-size: 0.75rem;">√âchantillon 2 ‚úì</span>
                            <span style="color: #4CAF50; font-weight: 600;">92%</span>
                        </div>
                        <p style="color: #333; font-size: 0.95rem; margin: 0; line-height: 1.6;">"Technology continues to evolve at an unprecedented pace, transforming how we work and communicate."</p>
                        <div style="margin-top: 10px; background: #e8f5e9; height: 6px; border-radius: 3px;">
                            <div style="width: 92%; height: 100%; background: #4CAF50; border-radius: 3px;"></div>
                        </div>
                    </div>

                    <!-- Sample 3 - En cours -->
                    <div style="background: #fff3e0; border-radius: 12px; padding: 20px; margin-bottom: 15px; border-left: 4px solid #FF9800;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="background: #FF9800; color: white; padding: 3px 10px; border-radius: 15px; font-size: 0.75rem;">√âchantillon 3 - En cours</span>
                            <span style="color: #FF9800;"><i class="bi bi-mic-fill"></i> Recording...</span>
                        </div>
                        <p style="color: #333; font-size: 0.95rem; margin: 0; line-height: 1.6;">"Please speak naturally and at a comfortable pace. Clear pronunciation helps create a better voice model."</p>
                        <div style="margin-top: 10px; background: #ffe0b2; height: 6px; border-radius: 3px; overflow: hidden;">
                            <div style="width: 60%; height: 100%; background: linear-gradient(90deg, #FF9800, #FFB74D); border-radius: 3px; animation: pulse 1s infinite;"></div>
                        </div>
                    </div>

                    <!-- Progress global -->
                    <div style="text-align: center; margin-top: 20px;">
                        <div style="display: inline-flex; gap: 10px;">
                            <div style="width: 40px; height: 40px; background: #4CAF50; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;"><i class="bi bi-check"></i></div>
                            <div style="width: 40px; height: 40px; background: #4CAF50; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;"><i class="bi bi-check"></i></div>
                            <div style="width: 40px; height: 40px; background: #FF9800; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">3</div>
                        </div>
                        <div style="color: #666; margin-top: 10px; font-size: 0.85rem;">2/3 √©chantillons valid√©s</div>
                    </div>
                </div>
            </div>

            <h4>Configuration des √âchantillons</h4>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Param√®tre</th>
                            <th>Valeur</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>MIN_DURATION</code></td>
                            <td>5 secondes</td>
                            <td>Dur√©e minimale par √©chantillon</td>
                        </tr>
                        <tr>
                            <td><code>MAX_DURATION</code></td>
                            <td>90 secondes</td>
                            <td>Dur√©e maximale par √©chantillon</td>
                        </tr>
                        <tr>
                            <td><code>MIN_VALIDATION_SCORE</code></td>
                            <td>80%</td>
                            <td>Score Levenshtein minimum requis</td>
                        </tr>
                        <tr>
                            <td><code>REQUIRED_SAMPLES</code></td>
                            <td>3</td>
                            <td>Nombre d'√©chantillons requis</td>
                        </tr>
                        <tr>
                            <td><code>AUDIO_FORMAT</code></td>
                            <td>WAV 16-bit</td>
                            <td>Format d'enregistrement</td>
                        </tr>
                        <tr>
                            <td><code>SAMPLE_RATE</code></td>
                            <td>24000 Hz</td>
                            <td>Fr√©quence d'√©chantillonnage</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- √âTAPE 4 -->
            <h3>5.2.4 √âtape 4 : Synth√®se et Galerie</h3>

            <p>Une fois les 3 √©chantillons valid√©s, le syst√®me appelle l'<strong>Azure Custom Neural Voice API</strong> pour cr√©er la voix personnalis√©e. Un <strong>Speaker Profile ID</strong> unique est g√©n√©r√©.</p>

            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant F as Frontend
    participant B as Backend Flask
    participant A as Azure CNV API
    participant C as Cosmos DB

    U->>F: Clique "Cr√©er la voix"
    F->>B: POST /personal-voice/api/create-voice
    B->>A: POST /customvoice/personalvoices
    Note over A: Traitement Azure<br/>(~30 secondes)
    A-->>B: speaker_profile_id
    B->>C: Sauvegarde voice_metadata
    B-->>F: {success: true, voice_id: "xxx"}
    F->>U: Redirection vers Galerie
            </div>

            <!-- Mockup HTML/CSS √âtape 4 - Galerie -->
            <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); border-radius: 20px; padding: 30px; margin: 25px 0; box-shadow: 0 15px 35px rgba(0,0,0,0.2);">
                <div style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 25px;">
                    <div style="text-align: center; margin-bottom: 25px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #a8edea, #fed6e3); border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: #333; font-size: 24px; margin-bottom: 15px;">
                            <i class="bi bi-collection-play"></i>
                        </div>
                        <h4 style="color: #333; margin: 0;">Galerie de Voix Personnelles</h4>
                        <p style="color: #666; margin-top: 5px; font-size: 0.9rem;">Vos voix cr√©√©es sont pr√™tes √† l'emploi</p>
                    </div>

                    <!-- Voice Cards Grid -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                        <!-- Voice Card 1 -->
                        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border: 1px solid #eee;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                                    <i class="bi bi-person-circle"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 700; color: #333;">Marie - Marketing</div>
                                    <div style="font-size: 0.8rem; color: #888;">Cr√©√©e le 15/12/2025</div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                                <span style="background: #e8f5e9; color: #4CAF50; padding: 4px 10px; border-radius: 15px; font-size: 0.75rem;">Active</span>
                                <span style="background: #e3f2fd; color: #1976D2; padding: 4px 10px; border-radius: 15px; font-size: 0.75rem;">fr-FR</span>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button style="flex: 1; padding: 10px; background: #f5f5f5; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px;">
                                    <i class="bi bi-play-fill"></i> Test
                                </button>
                                <button style="flex: 1; padding: 10px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                    <i class="bi bi-robot"></i> Assigner
                                </button>
                            </div>
                        </div>

                        <!-- Voice Card 2 -->
                        <div style="background: white; border-radius: 15px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border: 1px solid #eee;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #f093fb, #f5576c); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem;">
                                    <i class="bi bi-person-circle"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 700; color: #333;">Thomas - Support</div>
                                    <div style="font-size: 0.8rem; color: #888;">Cr√©√©e le 20/12/2025</div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                                <span style="background: #e8f5e9; color: #4CAF50; padding: 4px 10px; border-radius: 15px; font-size: 0.75rem;">Active</span>
                                <span style="background: #e3f2fd; color: #1976D2; padding: 4px 10px; border-radius: 15px; font-size: 0.75rem;">fr-FR</span>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button style="flex: 1; padding: 10px; background: #f5f5f5; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px;">
                                    <i class="bi bi-play-fill"></i> Test
                                </button>
                                <button style="flex: 1; padding: 10px; background: linear-gradient(135deg, #f093fb, #f5576c); color: white; border: none; border-radius: 8px; cursor: pointer;">
                                    <i class="bi bi-robot"></i> Assigner
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <h2>5.3 API REST - Endpoints</h2>

            <p>Le module Personal Voice expose les endpoints suivants via le Blueprint Flask <code>personal_voice_bp</code> :</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>M√©thode</th>
                            <th>Endpoint</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>GET</code></td>
                            <td><code>/personal-voice/</code></td>
                            <td>Page d'accueil - √âtape 1 (s√©lection projet)</td>
                        </tr>
                        <tr>
                            <td><code>GET</code></td>
                            <td><code>/personal-voice/step2/&lt;project_id&gt;</code></td>
                            <td>√âtape 2 - Enregistrement consentement</td>
                        </tr>
                        <tr>
                            <td><code>GET</code></td>
                            <td><code>/personal-voice/step3/&lt;project_id&gt;/&lt;consent_id&gt;</code></td>
                            <td>√âtape 3 - Enregistrement √©chantillons</td>
                        </tr>
                        <tr>
                            <td><code>GET</code></td>
                            <td><code>/personal-voice/gallery</code></td>
                            <td>Galerie des voix cr√©√©es</td>
                        </tr>
                        <tr>
                            <td><code>GET</code></td>
                            <td><code>/personal-voice/api/projects</code></td>
                            <td>Liste des projets Azure CNV</td>
                        </tr>
                        <tr>
                            <td><code>POST</code></td>
                            <td><code>/personal-voice/api/validate-audio</code></td>
                            <td>Validation audio via Levenshtein</td>
                        </tr>
                        <tr>
                            <td><code>POST</code></td>
                            <td><code>/personal-voice/api/upload-consent</code></td>
                            <td>Upload et validation du consentement</td>
                        </tr>
                        <tr>
                            <td><code>POST</code></td>
                            <td><code>/personal-voice/api/upload-sample</code></td>
                            <td>Upload d'un √©chantillon vocal</td>
                        </tr>
                        <tr>
                            <td><code>POST</code></td>
                            <td><code>/personal-voice/api/create-voice</code></td>
                            <td>Cr√©ation finale de la voix (appel Azure)</td>
                        </tr>
                        <tr>
                            <td><code>GET</code></td>
                            <td><code>/personal-voice/api/voices</code></td>
                            <td>Liste des voix personnelles cr√©√©es</td>
                        </tr>
                        <tr>
                            <td><code>DELETE</code></td>
                            <td><code>/personal-voice/api/voice/&lt;voice_id&gt;</code></td>
                            <td>Suppression d'une voix</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>5.3.1 Exemple d'Appel API - Validation Audio</h3>

<pre><code>// Requ√™te POST /personal-voice/api/validate-audio
{
    "audio_data": "data:audio/wav;base64,UklGRiQAAABXQV...",
    "expected_text": "I John Doe am aware that recordings...",
    "audio_type": "consent"  // ou "sample"
}

// R√©ponse
{
    "success": true,
    "transcription": "I John Doe am aware that recordings...",
    "validation_score": 87.5,
    "is_valid": true,
    "message": "Audio valid√© avec un score de 87.5%"
}</code></pre>

            <h2>5.4 Structure de Donn√©es Cosmos DB</h2>

            <h3>5.4.1 Collection : personal_voices</h3>

<pre><code>{
    "id": "pv_abc123def456",
    "type": "personal_voice",
    "project_id": "proj_xyz789",
    "user_id": "user_12345",
    "voice_name": "Marie - Marketing",
    "speaker_profile_id": "spk_azure_profile_id",
    "locale": "fr-FR",
    "status": "active",  // draft, processing, active, failed
    "consent": {
        "blob_url": "https://blob.azure/.../consent_abc123.wav",
        "validation_score": 85.2,
        "recorded_at": "2025-12-15T10:30:00Z"
    },
    "samples": [
        {
            "sample_id": "smp_001",
            "blob_url": "https://blob.azure/.../sample1_abc123.wav",
            "validation_score": 87.5,
            "duration_seconds": 12.4,
            "recorded_at": "2025-12-15T10:32:00Z"
        },
        {
            "sample_id": "smp_002",
            "blob_url": "https://blob.azure/.../sample2_abc123.wav",
            "validation_score": 92.1,
            "duration_seconds": 15.2,
            "recorded_at": "2025-12-15T10:34:00Z"
        },
        {
            "sample_id": "smp_003",
            "blob_url": "https://blob.azure/.../sample3_abc123.wav",
            "validation_score": 88.9,
            "duration_seconds": 14.1,
            "recorded_at": "2025-12-15T10:36:00Z"
        }
    ],
    "azure_metadata": {
        "custom_voice_endpoint": "https://westeurope.api.cognitive.microsoft.com/...",
        "deployment_id": "dep_xxx",
        "model_version": "2024-01"
    },
    "created_at": "2025-12-15T10:30:00Z",
    "updated_at": "2025-12-15T10:40:00Z"
}</code></pre>

            <h2>5.5 Int√©gration avec les Agents</h2>

            <p>Une fois cr√©√©e, la voix personnelle peut √™tre assign√©e √† n'importe quel <strong>agent Voice</strong> ou <strong>agent Avatar</strong> dans Waka Voice.</p>

            <div class="mermaid">
flowchart LR
    subgraph Personal["Module Personal Voice"]
        PV[Voix Cr√©√©e]
        SPK[speaker_profile_id]
    end

    subgraph Agents["Agents Waka Voice"]
        VA[Agent Voice]
        AV[Agent Avatar]
    end

    subgraph Azure["Azure TTS"]
        TTS[Text-to-Speech]
        SSML[SSML avec speaker]
    end

    PV --> SPK
    SPK -->|Configuration| VA
    SPK -->|Configuration| AV
    VA -->|G√©n√©ration| SSML
    AV -->|G√©n√©ration| SSML
    SSML --> TTS

    style Personal fill:#E8F5E9,stroke:#4CAF50
    style Agents fill:#E3F2FD,stroke:#1976D2
    style Azure fill:#FFF3E0,stroke:#FF9800
            </div>

            <h3>5.5.1 Configuration Agent avec Personal Voice</h3>

<pre><code>// Configuration de l'agent dans Cosmos DB
{
    "agent_id": "agent_voice_001",
    "type": "voice",
    "azure_config": {
        "voice_type": "personal",  // au lieu de "standard"
        "speaker_profile_id": "spk_azure_profile_id",
        "locale": "fr-FR",
        "style": "neutral",
        "rate": "1.0",
        "pitch": "0%"
    }
}

// SSML g√©n√©r√© automatiquement
&lt;speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis"&gt;
    &lt;voice name="PersonalVoiceModel"&gt;
        &lt;mstts:ttsembedding speakerProfileId="spk_azure_profile_id"/&gt;
        Bonjour, comment puis-je vous aider aujourd'hui ?
    &lt;/voice&gt;
&lt;/speak&gt;</code></pre>

            <h2>5.6 Bonnes Pratiques</h2>

            <div class="cards-grid">
                <div class="feature-card">
                    <div class="feature-card-icon"><i class="bi bi-mic"></i></div>
                    <h4>Qualit√© d'Enregistrement</h4>
                    <p>Utilisez un micro de qualit√© dans un environnement silencieux. √âvitez les √©chos et bruits de fond pour une voix synth√©tique optimale.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon"><i class="bi bi-volume-up"></i></div>
                    <h4>Articulation Claire</h4>
                    <p>Parlez distinctement √† un rythme naturel. √âvitez de parler trop vite ou trop lentement pour de meilleurs r√©sultats.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon"><i class="bi bi-shield-check"></i></div>
                    <h4>Consentement Explicite</h4>
                    <p>Assurez-vous que le consentement est donn√© par la personne elle-m√™me. C'est une exigence l√©gale d'Azure.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-card-icon"><i class="bi bi-arrow-repeat"></i></div>
                    <h4>R√©essayer si N√©cessaire</h4>
                    <p>Si le score de validation est inf√©rieur √† 80%, r√©enregistrez l'√©chantillon. La qualit√© finale d√©pend de la qualit√© des inputs.</p>
                </div>
            </div>

            <div class="callout callout-success">
                <i class="bi bi-lightbulb callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Conseil Pro</div>
                    <p>
                        Pour des r√©sultats optimaux, enregistrez plus que les 3 √©chantillons minimum si possible.
                        Azure utilise l'ensemble des donn√©es pour cr√©er un mod√®le vocal plus pr√©cis et naturel.
                        La dur√©e totale recommand√©e est de <strong>10-15 minutes</strong> de parole.
                    </p>
                </div>
            </div>

        </section>

        <!-- ==========================================
             CHAPITRE 6: SYST√àME DE TOOLS (ENRICHI)
             Module complet de gestion des outils dynamiques
             ========================================== -->
        <section id="tools" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-tools"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 6: Syst√®me de Tools</h1>
                    <p class="section-subtitle">Capacit√©s agentiques et ex√©cution de fonctions dynamiques</p>
                </div>
            </div>

            <div class="intro-text">
                Le syst√®me de <strong>Tools</strong> transforme les agents en v√©ritables
                <strong>agents autonomes</strong> capables d'ex√©cuter des actions en temps r√©el :
                appeler des API REST, ex√©cuter du code Python sandbox√©, se connecter √† des serveurs MCP,
                ou importer automatiquement des sp√©cifications OpenAPI. Tous les tools sont stock√©s
                dans <strong>Cosmos DB</strong> et peuvent √™tre cr√©√©s/modifi√©s sans red√©ploiement.
            </div>

            <!-- STATISTIQUES CL√âS -->
            <div class="stats-row">
                <div class="stat-box">
                    <div class="stat-box-value">4</div>
                    <div class="stat-box-label">Types de Tools</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">30+</div>
                    <div class="stat-box-label">Tools pr√©d√©finis</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">23</div>
                    <div class="stat-box-label">Cat√©gories</div>
                </div>
                <div class="stat-box">
                    <div class="stat-box-value">100%</div>
                    <div class="stat-box-label">Dynamique (No redeploy)</div>
                </div>
            </div>

            <h2>6.1 Architecture du Syst√®me de Tools</h2>

            <h3>6.1.1 Stack Technique</h3>

            <div style="margin: 1.5rem 0;">
                <span class="tech-badge"><i class="bi bi-filetype-py"></i> Flask Blueprint</span>
                <span class="tech-badge"><i class="bi bi-database"></i> Cosmos DB</span>
                <span class="tech-badge"><i class="bi bi-braces"></i> OpenAI Function Calling</span>
                <span class="tech-badge"><i class="bi bi-file-code"></i> OpenAPI Parser</span>
                <span class="tech-badge"><i class="bi bi-cpu"></i> GPT-5.2 pour g√©n√©ration</span>
                <span class="tech-badge"><i class="bi bi-plug"></i> MCP Protocol</span>
            </div>

            <h3>6.1.2 Flux de Donn√©es Global</h3>

            <div class="mermaid">
flowchart TB
    subgraph Creation["Cr√©ation de Tools"]
        UI[Interface Web]
        OPENAPI[Import OpenAPI]
        AI_GEN[G√©n√©ration IA]
    end

    subgraph Storage["Stockage Cosmos DB"]
        TOOLS_DB[(Container Tools)]
        JOBS_DB[(Container ImportJobs)]
    end

    subgraph Execution["Ex√©cution"]
        AGENT[Agent Voice/Text/Avatar]
        EXECUTOR[Tool Executor]
        HTTP_CALL[HTTP Client]
        PYTHON_EXEC[Python Sandbox]
        MCP_CLIENT[MCP Client]
    end

    subgraph External["Services Externes"]
        EXT_API[APIs REST]
        MCP_SERVER[Serveurs MCP]
    end

    UI -->|POST /tools/api/create| TOOLS_DB
    OPENAPI -->|Parsing + GPT-5.2| AI_GEN
    AI_GEN -->|Batch upsert| TOOLS_DB

    AGENT -->|tool_call| EXECUTOR
    EXECUTOR -->|Fetch config| TOOLS_DB
    EXECUTOR -->|HTTP| HTTP_CALL --> EXT_API
    EXECUTOR -->|Python| PYTHON_EXEC
    EXECUTOR -->|MCP| MCP_CLIENT --> MCP_SERVER

    style Creation fill:#E3F2FD,stroke:#1976D2
    style Storage fill:#FFF3E0,stroke:#FF9800
    style Execution fill:#E8F5E9,stroke:#4CAF50
    style External fill:#FCE4EC,stroke:#E91E63
            </div>

            <h2>6.2 Les 4 Types de Tools</h2>

            <div class="mermaid">
flowchart LR
    subgraph Types["Types de Tools"]
        API["<b>API REST</b><br/>HTTP calls"]
        CODE["<b>Code Python</b><br/>Sandbox exec"]
        MCP["<b>MCP Server</b><br/>Protocol connect"]
        OPENAPI["<b>Import OpenAPI</b><br/>Auto-generate"]
    end

    API -->|GET/POST/PUT/DELETE| EXT[Services Externes]
    CODE -->|RestrictedPython| RESULT[R√©sultat]
    MCP -->|STDIO/SSE/HTTP| TOOLS[Outils MCP]
    OPENAPI -->|Parser + GPT-5.2| BATCH[Tools en batch]

    style API fill:#4A148C,color:#fff
    style CODE fill:#7B1FA2,color:#fff
    style MCP fill:#9C27B0,color:#fff
    style OPENAPI fill:#BA68C8,color:#fff
            </div>

            <!-- Mockup Type Selection -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 30px; margin: 25px 0; box-shadow: 0 15px 35px rgba(0,0,0,0.2);">
                <div style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 25px;">
                    <div style="text-align: center; margin-bottom: 25px;">
                        <h4 style="color: #333; margin: 0; font-size: 1.4rem;">S√©lection du Type de Tool</h4>
                        <p style="color: #666; margin-top: 5px; font-size: 0.9rem;">Choisissez le type d'outil √† cr√©er</p>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                        <!-- API REST -->
                        <div style="border: 2px solid #667eea; border-radius: 16px; padding: 25px; text-align: center; cursor: pointer; background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));">
                            <div style="font-size: 2.5rem; margin-bottom: 15px;"><i class="bi bi-cloud"></i></div>
                            <h5 style="margin: 0 0 10px 0; color: #4A148C;">API REST</h5>
                            <p style="color: #666; font-size: 0.8rem; margin: 0;">GET, POST, PUT, DELETE avec authentification</p>
                        </div>

                        <!-- MCP Server -->
                        <div style="border: 2px dashed #ccc; border-radius: 16px; padding: 25px; text-align: center; cursor: pointer;">
                            <div style="font-size: 2.5rem; margin-bottom: 15px;"><i class="bi bi-plug"></i></div>
                            <h5 style="margin: 0 0 10px 0; color: #333;">MCP SERVER</h5>
                            <p style="color: #666; font-size: 0.8rem; margin: 0;">STDIO, SSE, HTTP Streamable</p>
                        </div>

                        <!-- Code Python -->
                        <div style="border: 2px dashed #ccc; border-radius: 16px; padding: 25px; text-align: center; cursor: pointer;">
                            <div style="font-size: 2.5rem; margin-bottom: 15px;"><i class="bi bi-filetype-py"></i></div>
                            <h5 style="margin: 0 0 10px 0; color: #333;">CODE PYTHON</h5>
                            <p style="color: #666; font-size: 0.8rem; margin: 0;">Ex√©cution sandbox√©e, timeout 30s</p>
                        </div>

                        <!-- Import OpenAPI -->
                        <div style="border: 2px dashed #ccc; border-radius: 16px; padding: 25px; text-align: center; cursor: pointer;">
                            <div style="font-size: 2.5rem; margin-bottom: 15px;"><i class="bi bi-file-code"></i></div>
                            <h5 style="margin: 0 0 10px 0; color: #333;">IMPORT OPENAPI</h5>
                            <p style="color: #666; font-size: 0.8rem; margin: 0;">YAML/JSON, g√©n√©ration IA batch</p>
                        </div>
                    </div>
                </div>
            </div>

            <h3>6.2.1 Type API REST</h3>

            <p>Appels HTTP vers des services externes avec configuration compl√®te de l'authentification et du mapping des param√®tres.</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Champ</th><th>Type</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>endpoint</code></td><td>string</td><td>URL compl√®te de l'API (ex: <code>https://api.example.com/users</code>)</td></tr>
                        <tr><td><code>method</code></td><td>enum</td><td>GET, POST, PUT, PATCH, DELETE</td></tr>
                        <tr><td><code>headers</code></td><td>object</td><td>Headers HTTP personnalis√©s</td></tr>
                        <tr><td><code>auth_type</code></td><td>enum</td><td><code>none</code>, <code>api_key</code>, <code>bearer</code>, <code>basic</code></td></tr>
                        <tr><td><code>auth_config</code></td><td>object</td><td>Configuration auth (header_name, value, in: header/query)</td></tr>
                        <tr><td><code>params_mapping</code></td><td>object</td><td>Mapping param ‚Üí path/query/body/header</td></tr>
                        <tr><td><code>body_template</code></td><td>string</td><td>Template JSON pour le body (avec placeholders <code>{{param}}</code>)</td></tr>
                    </tbody>
                </table>
            </div>

<pre><code>// Exemple de configuration API REST
{
    "name": "create_client",
    "type": "api",
    "execution": {
        "type": "http",
        "endpoint": "https://api.waka.com/v1/clients",
        "method": "POST",
        "headers": {
            "Content-Type": "application/json",
            "Accept": "application/json"
        },
        "auth_type": "bearer",
        "auth_config": {
            "value": "${env.WAKA_API_TOKEN}"
        },
        "params_mapping": {
            "first_name": {"in": "body", "name": "firstName"},
            "last_name": {"in": "body", "name": "lastName"},
            "phone": {"in": "body", "name": "phoneNumber"}
        }
    }
}</code></pre>

            <h3>6.2.2 Type MCP Server</h3>

            <p>Connexion au <strong>Model Context Protocol</strong> pour int√©grer des serveurs d'outils externes. Trois transports support√©s :</p>

            <div class="mermaid">
flowchart LR
    subgraph Transports["Transports MCP"]
        STDIO["<b>STDIO</b><br/>Local subprocess"]
        SSE["<b>SSE</b><br/>Server-Sent Events"]
        HTTP["<b>HTTP</b><br/>Azure AI Foundry"]
    end

    STDIO -->|npx, node, python| LOCAL[Processus Local]
    SSE -->|Streaming| REMOTE[Serveur Distant]
    HTTP -->|REST + Auth| FOUNDRY[Azure AI Foundry]

    style STDIO fill:#4CAF50,color:#fff
    style SSE fill:#2196F3,color:#fff
    style HTTP fill:#FF9800,color:#fff
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Transport</th><th>Use Case</th><th>Configuration Cl√©</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>stdio</code></td>
                            <td>Serveurs MCP locaux (npx, node, python)</td>
                            <td><code>command</code>, <code>args[]</code>, <code>env{}</code></td>
                        </tr>
                        <tr>
                            <td><code>sse</code></td>
                            <td>Serveurs MCP distants avec streaming</td>
                            <td><code>url</code>, <code>auth_type</code>, <code>timeout</code>, <code>verify_ssl</code></td>
                        </tr>
                        <tr>
                            <td><code>http</code></td>
                            <td>Azure AI Foundry MCP Gateways</td>
                            <td><code>server_url</code>, <code>server_label</code>, <code>allowed_tools[]</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>

<pre><code>// Exemple MCP STDIO (serveur local)
{
    "name": "filesystem_tools",
    "type": "mcp_server",
    "execution": {
        "type": "mcp",
        "transport": "stdio",
        "command": "npx",
        "args": ["-y", "@anthropic/mcp-server-filesystem", "/home/user/documents"],
        "env": {
            "NODE_OPTIONS": "--max-old-space-size=4096"
        }
    }
}

// Exemple MCP HTTP (Azure AI Foundry)
{
    "name": "azure_ai_tools",
    "type": "mcp_server",
    "execution": {
        "type": "mcp",
        "transport": "http",
        "server_url": "https://my-foundry.azure.com/mcp",
        "server_label": "Azure AI Foundry",
        "allowed_tools": ["search_documents", "analyze_image"],
        "auth_type": "bearer",
        "auth_config": {"value": "${env.AZURE_AI_KEY}"},
        "require_approval": "never"
    }
}</code></pre>

            <h3>6.2.3 Type Code Python</h3>

            <p>Ex√©cution de code Python dans un environnement <strong>sandbox√©</strong> avec <code>RestrictedPython</code>. Timeout de 30 secondes.</p>

            <div class="callout callout-warning">
                <i class="bi bi-exclamation-triangle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">S√©curit√© du Sandbox</div>
                    <p>
                        Le code Python est ex√©cut√© dans un environnement restreint. Seules les fonctions built-in s√ªres sont autoris√©es :
                        <code>print</code>, <code>len</code>, <code>str</code>, <code>int</code>, <code>float</code>,
                        <code>list</code>, <code>dict</code>, <code>bool</code>, <code>range</code>,
                        <code>abs</code>, <code>min</code>, <code>max</code>, <code>sum</code>, <code>round</code>.
                    </p>
                </div>
            </div>

<pre><code>// Exemple Tool Python
{
    "name": "calculate_interest",
    "type": "code",
    "execution_python": {
        "type": "python",
        "code": "def execute(params):\n    principal = params.get('principal', 0)\n    rate = params.get('rate', 0.05)\n    years = params.get('years', 1)\n    interest = principal * rate * years\n    return {\n        'principal': principal,\n        'rate': rate,\n        'years': years,\n        'interest': round(interest, 2),\n        'total': round(principal + interest, 2)\n    }",
        "inputs": [
            {"name": "principal", "type": "number", "required": true, "description": "Montant principal"},
            {"name": "rate", "type": "number", "required": false, "description": "Taux d'int√©r√™t (d√©faut: 5%)"},
            {"name": "years", "type": "integer", "required": false, "description": "Nombre d'ann√©es"}
        ],
        "outputs": ["principal", "rate", "years", "interest", "total"]
    }
}</code></pre>

            <h3>6.2.4 Import OpenAPI / YAML</h3>

            <p>Import automatique de sp√©cifications <strong>OpenAPI 3.x / Swagger 2.x</strong> avec <strong>Pipeline V2 en 3 √©tapes</strong> et validation intelligente via <strong>Claude Opus 4.5</strong>.</p>

            <h4>Pipeline V2 - Vue d'ensemble</h4>

            <div class="mermaid">
flowchart TD
    subgraph UPLOAD["üì§ UPLOAD"]
        A[Fichier YAML/JSON] --> B[Lecture c√¥t√© client]
        B --> C[Validation extension]
    end

    subgraph PARSE["üîç PARSING INITIAL"]
        C --> D[POST /tools/api/openapi/parse]
        D --> E[OpenAPIParser natif Python]
        E --> F[Extraction endpoints, tags, security]
        F --> G[Affichage Preview]
    end

    subgraph PIPELINE["‚öôÔ∏è PIPELINE V2 - 3 √âTAPES"]
        G -->|Clic G√©n√©rer| H[POST /tools/api/openapi/import-v2]
        
        H --> I["üîç √âTAPE 1: Validation YAML"]
        I --> I1[Claude analyse structure OpenAPI]
        I1 --> I2[V√©rifie coh√©rence $ref, schemas]
        I2 --> I3[Corrige automatiquement]
        I3 --> I4[Tronque descriptions longues]
        
        I4 --> J["‚öôÔ∏è √âTAPE 2: Conversion & Upload"]
        J --> J1[Conversion endpoints ‚Üí Tools]
        J1 --> J2[G√©n√©ration JSON Schema params]
        J2 --> J3[Configuration HTTP execution]
        J3 --> J4[Upload Cosmos DB]
        
        J4 --> K["‚úÖ √âTAPE 3: Validation Tools"]
        K --> K1[Validation locale format]
        K1 --> K2[Validation IA enrichissement]
        K2 --> K3[Correction auto si n√©cessaire]
        K3 --> K4[Mise √† jour Cosmos DB]
    end

    subgraph RESULT["üìä R√âSULTAT"]
        K4 --> L[SSE Feedback temps r√©el]
        L --> M[R√©sum√©: cr√©√©s/mis √† jour/erreurs]
    end

    style UPLOAD fill:#E3F2FD,stroke:#1976D2
    style PARSE fill:#E8F5E9,stroke:#388E3C
    style PIPELINE fill:#FFF3E0,stroke:#F57C00
    style RESULT fill:#F3E5F5,stroke:#7B1FA2
            </div>

            <h4>D√©tail du flux SSE (Server-Sent Events)</h4>

            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant UI as Interface Web
    participant API as Flask API
    participant CLAUDE as Claude Opus 4.5
    participant IMPORTER as OpenAPIImporter
    participant COSMOS as Cosmos DB

    U->>UI: Upload fichier YAML/JSON
    UI->>API: POST /tools/api/openapi/parse
    API->>API: Parser natif Python
    API-->>UI: Preview (titre, endpoints, base_url)
    
    U->>UI: Clic "G√©n√©rer les Tools"
    UI->>API: POST /tools/api/openapi/import-v2 (SSE)
    
    rect rgb(227, 242, 253)
        Note over API,CLAUDE: √âTAPE 1 - Validation YAML
        API->>CLAUDE: Analyse structure + coh√©rence
        CLAUDE-->>API: YAML corrig√© + rapport
        API-->>UI: SSE step=1 status=valid/corrected
    end
    
    rect rgb(232, 245, 233)
        Note over API,COSMOS: √âTAPE 2 - Conversion & Upload
        API->>IMPORTER: convert_to_tools(yaml)
        IMPORTER-->>API: Liste tools g√©n√©r√©s
        API->>COSMOS: Batch upsert tools
        COSMOS-->>API: R√©sultat (created/updated/skipped)
        API-->>UI: SSE step=2 data={created, updated}
    end
    
    rect rgb(255, 243, 224)
        Note over API,CLAUDE: √âTAPE 3 - Validation Tools
        loop Pour chaque tool
            API->>API: Validation locale JSON Schema
            API->>CLAUDE: Validation + enrichissement
            CLAUDE-->>API: Tool valid√©/corrig√©
            API->>COSMOS: Update si corrig√©
            API-->>UI: SSE tool_progress
        end
        API-->>UI: SSE step=3 status=complete
    end
    
    API-->>UI: SSE type=complete summary={...}
    UI-->>U: R√©sum√© final avec statistiques
            </div>

            <h4>Les 3 √âtapes en d√©tail</h4>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>√âtape</th><th>Action</th><th>Technologie</th><th>Corrections automatiques</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>1. Validation YAML</strong></td>
                            <td>Analyse globale de la structure OpenAPI</td>
                            <td>Claude Opus 4.5</td>
                            <td>
                                <ul>
                                    <li>$ref cass√©es ‚Üí corrig√©es</li>
                                    <li>Descriptions > 900 chars ‚Üí reformul√©es par IA (limite Azure = 1024)</li>
                                    <li>Champs JSON Schema interdits (minLength, pattern, format) ‚Üí supprim√©s</li>
                                    <li>Schemas orphelins ‚Üí signal√©s</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>2. Conversion & Upload</strong></td>
                            <td>Transformation endpoints ‚Üí Tools + sauvegarde</td>
                            <td>OpenAPIImporter Python</td>
                            <td>
                                <ul>
                                    <li>operationId ‚Üí tool_name (snake_case)</li>
                                    <li>summary ‚Üí display_name</li>
                                    <li>requestBody + parameters ‚Üí JSON Schema</li>
                                    <li>Gestion auth (API Key, Bearer)</li>
                                </ul>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>3. Validation Tools</strong></td>
                            <td>V√©rification individuelle de chaque tool</td>
                            <td>Claude Opus 4.5 + Validation locale</td>
                            <td>
                                <ul>
                                    <li>Format JSON Schema strict</li>
                                    <li>Descriptions enrichies par IA</li>
                                    <li>Param√®tres manquants ‚Üí ajout√©s</li>
                                    <li>Types incoh√©rents ‚Üí corrig√©s</li>
                                </ul>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="callout callout-info">
                <i class="bi bi-info-circle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Pipeline V2 - Avantages</div>
                    <p>
                        Le <strong>Pipeline V2</strong> combine un <strong>parser natif Python</strong> (100% fiable, instantan√©) 
                        avec <strong>Claude Opus 4.5</strong> pour la validation et l'enrichissement intelligent. 
                        Chaque √©tape envoie des √©v√©nements SSE pour un <strong>feedback temps r√©el</strong> dans l'interface.
                    </p>
                </div>
            </div>

            <h4>Fichiers cl√©s du Pipeline</h4>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Fichier</th><th>R√¥le</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>static/js/tools/add.js</code></td><td>Gestion upload, appel API, affichage progress bar SSE</td></tr>
                        <tr><td><code>Blueprints/tools/add.py</code></td><td>Endpoints <code>/api/openapi/parse</code> et <code>/api/openapi/import-v2</code></td></tr>
                        <tr><td><code>Blueprints/tools/openapi_parser.py</code></td><td>Parser natif Python pour extraction endpoints</td></tr>
                        <tr><td><code>utils/tools/openapi_importer.py</code></td><td>Classe <code>OpenAPIImporter</code> - pipeline 3 √©tapes</td></tr>
                        <tr><td><code>utils/tools/tool_validator.py</code></td><td>Validation JSON Schema + enrichissement IA</td></tr>
                    </tbody>
                </table>
            </div>

            <h2>6.3 Cat√©gories de Tools</h2>

            <p>Les tools sont organis√©s en <strong>23 cat√©gories</strong> dont 13 cat√©gories WAKA sp√©cifiques √† la microfinance :</p>

            <div class="mermaid">
mindmap
    root((Cat√©gories))
        Standard
            general
            communication
            travel
            local_services
            finance
            campaign
            system
            rag_search
            custom
        WAKA Microfinance
            waka_clients
            waka_credits
            waka_payments
            waka_guarantors
            waka_committee
            waka_campaigns
            waka_reports
            waka_audit
            waka_promises
            waka_jobs
            waka_bots
            waka_system
            waka_tests
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Cat√©gorie</th><th>Description</th><th>Exemples de Tools</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>general</code></td><td>Outils g√©n√©riques</td><td>search_web, get_weather, calculate</td></tr>
                        <tr><td><code>communication</code></td><td>Email, SMS, notifications</td><td>send_email, send_sms, push_notification</td></tr>
                        <tr><td><code>travel</code></td><td>Voyage et transport</td><td>search_flights, book_hotel, estimate_taxi</td></tr>
                        <tr><td><code>finance</code></td><td>Finance et paiements</td><td>convert_currency, calculate_tax, process_payment</td></tr>
                        <tr><td><code>waka_clients</code></td><td>Gestion clients WAKA</td><td>get_client, update_client, search_clients</td></tr>
                        <tr><td><code>waka_credits</code></td><td>Gestion des cr√©dits</td><td>get_credit_status, calculate_remaining, list_credits</td></tr>
                        <tr><td><code>waka_payments</code></td><td>Enregistrement paiements</td><td>record_payment, verify_payment, list_payments</td></tr>
                        <tr><td><code>system</code></td><td>Outils syst√®me</td><td>end_conversation, conversation_brain</td></tr>
                    </tbody>
                </table>
            </div>

            <h2>6.4 API REST - Endpoints</h2>

            <p>Le module Tools expose les endpoints suivants via le Blueprint Flask <code>tools_bp</code> :</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>M√©thode</th><th>Endpoint</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>GET</code></td><td><code>/tools/</code></td><td>Page galerie des tools</td></tr>
                        <tr><td><code>GET</code></td><td><code>/tools/add</code></td><td>Page cr√©ation de tool</td></tr>
                        <tr><td><code>GET</code></td><td><code>/tools/api/list</code></td><td>Liste pagin√©e des tools</td></tr>
                        <tr><td><code>GET</code></td><td><code>/tools/api/categories</code></td><td>Liste des cat√©gories</td></tr>
                        <tr><td><code>GET</code></td><td><code>/tools/api/get/&lt;tool_id&gt;</code></td><td>D√©tails d'un tool</td></tr>
                        <tr><td><code>POST</code></td><td><code>/tools/api/create</code></td><td>Cr√©er un nouveau tool</td></tr>
                        <tr><td><code>PUT</code></td><td><code>/tools/api/update/&lt;tool_id&gt;</code></td><td>Mettre √† jour un tool</td></tr>
                        <tr><td><code>POST</code></td><td><code>/tools/api/toggle-status/&lt;tool_id&gt;</code></td><td>Activer/d√©sactiver un tool</td></tr>
                        <tr><td><code>DELETE</code></td><td><code>/tools/api/delete/&lt;tool_id&gt;</code></td><td>Supprimer un tool</td></tr>
                        <tr><td><code>POST</code></td><td><code>/tools/api/test</code></td><td>Tester un tool</td></tr>
                        <tr><td><code>POST</code></td><td><code>/tools/api/check-name</code></td><td>V√©rifier si un nom existe</td></tr>
                        <tr><td><code>POST</code></td><td><code>/tools/api/generate</code></td><td>G√©n√©rer description/body avec IA</td></tr>
                        <tr><td><code>POST</code></td><td><code>/tools/api/generate-code</code></td><td>G√©n√©rer code Python avec IA</td></tr>
                        <tr><td><code>POST</code></td><td><code>/tools/api/openapi/parse</code></td><td>Parser une spec OpenAPI/YAML (natif Python)</td></tr>
                        <tr><td><code>POST</code></td><td><code>/tools/api/openapi/import-v2</code></td><td>Import OpenAPI Pipeline V2 (SSE 3 √©tapes)</td></tr>
                        <tr><td><code>POST</code></td><td><code>/tools/api/validate-tool</code></td><td>Valider et enrichir un tool via Claude</td></tr>
                        <tr><td><code>POST</code></td><td><code>/tools/api/validate-tools-batch</code></td><td>Valider plusieurs tools en batch</td></tr>
                        <tr><td><code>GET</code></td><td><code>/tools/api/import-job/&lt;job_id&gt;</code></td><td>Status d'un job d'import</td></tr>
                    </tbody>
                </table>
            </div>

            <h2>6.5 Structure de Donn√©es Cosmos DB</h2>

            <h3>6.5.1 Container : Tools</h3>

<pre><code>{
    "id": "tool_abc123def456",
    "tool_id": "tool_abc123def456",
    "name": "create_client",
    "display_name": "Cr√©er un Client",
    "category": "waka_clients",  // Partition Key
    "tags": ["waka", "clients", "api"],
    "status": "active",  // active | inactive
    "is_system": false,
    "version": 2,
    "definition": {
        "type": "function",
        "function": {
            "name": "create_client",
            "description": "Cr√©e un nouveau client dans le syst√®me WAKA",
            "parameters": {
                "type": "object",
                "properties": {
                    "first_name": {"type": "string", "description": "Pr√©nom du client"},
                    "last_name": {"type": "string", "description": "Nom de famille"},
                    "phone": {"type": "string", "description": "Num√©ro de t√©l√©phone"}
                },
                "required": ["first_name", "last_name", "phone"]
            }
        }
    },
    "execution": {
        "type": "http",
        "endpoint": "https://api.waka.com/v1/clients",
        "method": "POST",
        "headers": {"Content-Type": "application/json"},
        "auth_type": "bearer",
        "auth_config": {"value": "${env.WAKA_API_TOKEN}"},
        "params_mapping": {
            "first_name": {"in": "body", "name": "firstName"},
            "last_name": {"in": "body", "name": "lastName"},
            "phone": {"in": "body", "name": "phoneNumber"}
        }
    },
    "openapi_source": {
        "path": "/clients",
        "method": "POST",
        "operation_id": "createClient"
    },
    "created_at": "2025-12-15T10:30:00Z",
    "updated_at": "2025-12-20T14:45:00Z",
    "created_by": "admin"
}</code></pre>

            <h3>6.5.2 Container : ImportJobs</h3>

<pre><code>{
    "id": "job_xyz789",
    "status": "processing",  // pending | processing | completed | failed
    "total": 42,
    "processed": 25,
    "success": 23,
    "errors": 2,
    "created_at": "2025-12-20T14:00:00Z",
    "updated_at": "2025-12-20T14:02:30Z",
    "config": {
        "category": "custom",
        "prefix": "myapi_",
        "base_url": "https://api.example.com"
    },
    "results": [
        {"name": "get_users", "status": "created"},
        {"name": "create_user", "status": "created"}
    ],
    "error_details": [
        {"endpoint": "/admin/dangerous", "error": "Endpoint filtered"}
    ]
}</code></pre>

            <h2>6.6 Ex√©cution des Tools</h2>

            <p>L'ex√©cution des tools est orchestr√©e par le module <code>tools/__init__.py</code> qui fournit les fonctions centrales :</p>

            <div class="mermaid">
flowchart TD
    A[Agent re√ßoit tool_call] --> B{Type de Tool?}
    B -->|http| C[HTTP Client]
    B -->|python| D[Python Sandbox]
    B -->|mcp| E[MCP Client]

    C --> F[Construire requ√™te]
    F --> G[Appliquer auth]
    G --> H[Mapper param√®tres]
    H --> I[Ex√©cuter request]
    I --> J[Parser r√©ponse]

    D --> K[Valider code]
    K --> L[Sandbox RestrictedPython]
    L --> M[Execute avec timeout]
    M --> N[Retourner r√©sultat]

    E --> O{Transport?}
    O -->|stdio| P[Subprocess]
    O -->|sse| Q[SSE Stream]
    O -->|http| R[HTTP Call]

    J --> S[Retour √† l'Agent]
    N --> S
    P --> S
    Q --> S
    R --> S

    style B fill:#4A148C,color:#fff
    style S fill:#4CAF50,color:#fff
            </div>

<pre><code># Fonction principale d'ex√©cution (tools/__init__.py)
def execute_tool(tool_name, arguments):
    """
    Ex√©cute un outil sp√©cifique avec les arguments fournis.

    Args:
        tool_name: Nom de l'outil √† ex√©cuter
        arguments: Dictionnaire des arguments pour l'outil

    Returns:
        dict: R√©sultat de l'ex√©cution de l'outil
    """
    # Mapping des noms vers les modules
    tool_map = {
        "search_web": tool_search_web,
        "send_email": tool_email,
        "get_weather_forecast": tool_weather,
        "end_conversation": tool_end_conversation,
        "conversation_brain": tool_conversation_brain,
        # ... 30+ tools pr√©d√©finis
    }

    if tool_name in tool_map:
        return tool_map[tool_name].execute(arguments)

    # Fallback: chercher dans Cosmos DB (tools dynamiques)
    return execute_dynamic_tool(tool_name, arguments)</code></pre>

            <h2>6.7 Galerie des Tools</h2>

            <!-- Mockup Galerie -->
            <div style="background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 100%); border-radius: 20px; padding: 30px; margin: 25px 0; color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h3 style="margin: 0;"><i class="bi bi-tools"></i> Galerie des Tools</h3>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" placeholder="Rechercher..." style="padding: 10px 15px; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white; width: 200px;">
                        <select style="padding: 10px 15px; border-radius: 10px; border: none; background: rgba(255,255,255,0.1); color: white;">
                            <option>Toutes cat√©gories</option>
                            <option>waka_clients</option>
                            <option>communication</option>
                        </select>
                        <button style="padding: 10px 20px; border-radius: 10px; border: none; background: linear-gradient(135deg, #667eea, #764ba2); color: white; cursor: pointer; font-weight: 600;">+ Cr√©er</button>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                    <!-- Tool Card 1 -->
                    <div style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <span style="background: #4CAF50; padding: 3px 10px; border-radius: 10px; font-size: 0.7rem;">ACTIF</span>
                            <span style="background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 10px; font-size: 0.7rem;">API REST</span>
                        </div>
                        <h5 style="margin: 0 0 5px 0;">search_weather</h5>
                        <p style="margin: 0; font-size: 0.85rem; opacity: 0.7;">Recherche m√©t√©o d'une ville</p>
                        <div style="margin-top: 15px; display: flex; gap: 8px;">
                            <span style="background: rgba(255,255,255,0.1); padding: 3px 8px; border-radius: 8px; font-size: 0.7rem;">general</span>
                            <span style="background: rgba(255,255,255,0.1); padding: 3px 8px; border-radius: 8px; font-size: 0.7rem;">weather</span>
                        </div>
                    </div>

                    <!-- Tool Card 2 -->
                    <div style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <span style="background: #4CAF50; padding: 3px 10px; border-radius: 10px; font-size: 0.7rem;">ACTIF</span>
                            <span style="background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 10px; font-size: 0.7rem;">PYTHON</span>
                        </div>
                        <h5 style="margin: 0 0 5px 0;">calculate_interest</h5>
                        <p style="margin: 0; font-size: 0.85rem; opacity: 0.7;">Calcul d'int√©r√™ts compos√©s</p>
                        <div style="margin-top: 15px; display: flex; gap: 8px;">
                            <span style="background: rgba(255,255,255,0.1); padding: 3px 8px; border-radius: 8px; font-size: 0.7rem;">finance</span>
                        </div>
                    </div>

                    <!-- Tool Card 3 -->
                    <div style="background: rgba(255,255,255,0.1); border-radius: 15px; padding: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <span style="background: #4CAF50; padding: 3px 10px; border-radius: 10px; font-size: 0.7rem;">ACTIF</span>
                            <span style="background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 10px; font-size: 0.7rem;">MCP</span>
                        </div>
                        <h5 style="margin: 0 0 5px 0;">filesystem_tools</h5>
                        <p style="margin: 0; font-size: 0.85rem; opacity: 0.7;">Acc√®s au syst√®me de fichiers</p>
                        <div style="margin-top: 15px; display: flex; gap: 8px;">
                            <span style="background: rgba(255,255,255,0.1); padding: 3px 8px; border-radius: 8px; font-size: 0.7rem;">system</span>
                            <span style="background: rgba(255,255,255,0.1); padding: 3px 8px; border-radius: 8px; font-size: 0.7rem;">mcp</span>
                        </div>
                    </div>
                </div>
            </div>

            <h2>6.8 Tools Pr√©d√©finis (30+)</h2>

            <p>Waka Voice inclut plus de 30 tools pr√©d√©finis pr√™ts √† l'emploi :</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Tool</th><th>Cat√©gorie</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>search_web</code></td><td>general</td><td>Recherche web via Bing/DuckDuckGo</td></tr>
                        <tr><td><code>get_weather_forecast</code></td><td>general</td><td>Pr√©visions m√©t√©o</td></tr>
                        <tr><td><code>send_email</code></td><td>communication</td><td>Envoi d'email via Azure Communication Services</td></tr>
                        <tr><td><code>translate_text</code></td><td>general</td><td>Traduction multi-langues</td></tr>
                        <tr><td><code>convert_currency</code></td><td>finance</td><td>Conversion de devises</td></tr>
                        <tr><td><code>search_flights</code></td><td>travel</td><td>Recherche de vols</td></tr>
                        <tr><td><code>book_hotel</code></td><td>travel</td><td>R√©servation d'h√¥tel</td></tr>
                        <tr><td><code>estimate_taxi_fare</code></td><td>travel</td><td>Estimation tarif taxi</td></tr>
                        <tr><td><code>find_pharmacy</code></td><td>local_services</td><td>Localiser une pharmacie</td></tr>
                        <tr><td><code>get_prayer_times</code></td><td>local_services</td><td>Horaires de pri√®re</td></tr>
                        <tr><td><code>end_conversation</code></td><td>system</td><td>Terminer la conversation</td></tr>
                        <tr><td><code>conversation_brain</code></td><td>system</td><td>Gestion dynamique du prompt</td></tr>
                        <tr><td><code>schedule_callback</code></td><td>campaign</td><td>Planifier un rappel</td></tr>
                        <tr><td><code>send_sms_payment_promise</code></td><td>campaign</td><td>SMS promesse de paiement</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="callout callout-success">
                <i class="bi bi-lightbulb callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Conseil Pro</div>
                    <p>
                        Pour les projets de microfinance, activez les cat√©gories <code>waka_*</code> qui incluent
                        des tools sp√©cialis√©s pour la gestion des clients, cr√©dits, paiements et promesses.
                        Ces tools sont optimis√©s pour l'int√©gration avec les syst√®mes WAKA.
                    </p>
                </div>
            </div>

            <!-- ==========================================
                 SECTION 6.9: CR√âATION D'OUTIL RAG
                 ========================================== -->
            <h2>6.9 Cr√©ation d'Outil RAG</h2>

            <p>
                Lorsqu'un projet RAG est cr√©√©, un <strong>outil de recherche RAG</strong> est automatiquement g√©n√©r√©.
                Cet outil permet √† l'assistant IA d'interroger la base de connaissances du projet via le m√©canisme
                de <em>function calling</em> d'Azure OpenAI.
            </p>

            <h3>6.9.1 Vue d'ensemble du processus</h3>

            <div class="mermaid">
flowchart TB
    subgraph USER["Utilisateur"]
        CREATE["Cr√©e un projet RAG<br/>'Mon Projet'"]
    end

    subgraph API["API Flask"]
        ENDPOINT["POST /rag/api/projects"]
        HANDLER["api_create_project()"]
    end

    subgraph COSMOS["Cosmos DB"]
        PROJECTS["Container: RAGProjects"]
        TOOLS["Container: Tools"]
    end

    subgraph CREATED["√âl√©ments cr√©√©s"]
        PROJECT["Projet<br/>name: 'Mon Projet'<br/>id: uuid"]
        TOOL["Tool RAG Search<br/>name: rag_search_mon_projet<br/>endpoint: /api/rag-tool/..."]
    end

    CREATE -->|"{ name, description, color }"| ENDPOINT
    ENDPOINT --> HANDLER
    HANDLER -->|"1. create_project()"| PROJECTS
    PROJECTS --> PROJECT
    HANDLER -->|"2. create_rag_search_tool_for_project()"| TOOLS
    TOOLS --> TOOL

    style USER fill:#E3F2FD,stroke:#1976D2
    style API fill:#E8F5E9,stroke:#4CAF50
    style COSMOS fill:#F3E5F5,stroke:#9C27B0
    style CREATED fill:#FFF3E0,stroke:#FF9800
            </div>

            <h3>6.9.2 √âtapes d√©taill√©es</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>√âtape</th><th>Action</th><th>Fichier</th><th>R√©sultat</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>1</strong></td>
                            <td>Requ√™te POST avec nom du projet</td>
                            <td>-</td>
                            <td><code>{ "name": "Mon Projet", "description": "...", "color": "#4A148C" }</code></td>
                        </tr>
                        <tr>
                            <td><strong>2</strong></td>
                            <td>Validation et cr√©ation du projet</td>
                            <td><code>cosmos_project_manager.py</code></td>
                            <td>Document projet dans Cosmos DB</td>
                        </tr>
                        <tr>
                            <td><strong>3</strong></td>
                            <td>G√©n√©ration du nom technique du tool</td>
                            <td><code>project_routes.py</code></td>
                            <td><code>rag_search_mon_projet</code> (sanitized)</td>
                        </tr>
                        <tr>
                            <td><strong>4</strong></td>
                            <td>Construction de l'URL endpoint</td>
                            <td><code>project_routes.py</code></td>
                            <td><code>/api/rag-tool/Mon%20Projet/fast-search</code></td>
                        </tr>
                        <tr>
                            <td><strong>5</strong></td>
                            <td>Cr√©ation de la d√©finition OpenAI</td>
                            <td><code>project_routes.py</code></td>
                            <td>Structure function calling conforme</td>
                        </tr>
                        <tr>
                            <td><strong>6</strong></td>
                            <td>Enregistrement du tool</td>
                            <td><code>cosmos_tools_manager.py</code></td>
                            <td>Document tool dans Cosmos DB</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>6.9.3 Structure du Tool cr√©√©</h3>

            <p>Le tool g√©n√©r√© suit le format <strong>Azure OpenAI Function Calling</strong> :</p>

            <pre><code>{
    "name": "rag_search_mon_projet",
    "display_name": "Recherche RAG - Mon Projet",
    "category": "rag_search",
    "status": "active",
    "tags": ["rag", "search", "vector", "mon projet"],
    "is_system": false,

    "definition": {
        "type": "function",
        "function": {
            "name": "rag_search_mon_projet",
            "description": "Recherche dans la base de connaissances 'Mon Projet'...",
            "parameters": {
                "type": "object",
                "properties": {
                    "search_query": {
                        "type": "string",
                        "description": "Intention de recherche g√©n√©r√©e par l'assistant"
                    }
                },
                "required": ["search_query"]
            }
        }
    },

    "execution": {
        "type": "http",
        "method": "POST",
        "endpoint": "https://domain.com/api/rag-tool/Mon%20Projet/fast-search",
        "headers": { "Content-Type": "application/json" },
        "body_template": {
            "search_query": "{{search_query}}",
            "max_results": 5
        }
    },

    "metadata": {
        "project_id": "uuid-du-projet",
        "project_name": "Mon Projet",
        "auto_generated": true
    }
}</code></pre>

            <h3>6.9.4 Diagramme de flux complet</h3>

            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant UI as Interface Web
    participant API as Flask API
    participant PM as Project Manager
    participant TM as Tools Manager
    participant DB as Cosmos DB

    U->>UI: Cr√©e projet "Mon Projet"
    UI->>API: POST /rag/api/projects
    Note right of API: { name: "Mon Projet", description: "...", color: "#4A148C" }

    API->>PM: create_project(name, description, color)
    PM->>DB: Insert into RAGProjects
    DB-->>PM: project { id, name, ... }
    PM-->>API: { success: true, project: {...} }

    API->>API: create_rag_search_tool_for_project(project_id, name)
    Note right of API: G√©n√®re tool_name: rag_search_mon_projet
    Note right of API: Encode URL: Mon%20Projet

    API->>TM: create_tool(tool_data)
    TM->>DB: Insert into Tools
    DB-->>TM: tool { id, name, ... }
    TM-->>API: { success: true, tool: {...} }

    API-->>UI: 201 Created
    Note left of UI: { success: true, project: {...}, tool_created: true, tool: {...} }
    UI-->>U: Projet cr√©√© avec son outil RAG
            </div>

            <h3>6.9.5 Utilisation du Tool par l'Assistant</h3>

            <p>Une fois le projet cr√©√© et des documents index√©s, l'assistant peut utiliser le tool :</p>

            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant A as Assistant IA
    participant T as Tool RAG
    participant E as Embedding API
    participant S as Azure AI Search

    U->>A: "Quels sont les tarifs ?"
    A->>A: G√©n√®re intention de recherche
    Note right of A: search_query: "tarifs abonnement prix"

    A->>T: POST /api/rag-tool/Mon%20Projet/fast-search
    Note right of T: { search_query: "tarifs abonnement prix" }

    T->>E: G√©n√®re embedding
    E-->>T: [0.123, -0.456, ...]

    T->>S: Recherche vectorielle
    Note right of S: filter: project_name eq 'Mon Projet'
    S-->>T: Documents pertinents

    T-->>A: { documents: [...], total_found: 3 }
    A-->>U: "Voici les tarifs trouv√©s..."
            </div>

            <h3>6.9.6 Points cl√©s</h3>

            <div class="callout callout-warning">
                <i class="bi bi-exclamation-triangle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Important : Coh√©rence du project_name</div>
                    <p>
                        Le <code>project_name</code> doit √™tre <strong>identique</strong> partout :
                    </p>
                    <ul>
                        <li>Dans le projet Cosmos DB</li>
                        <li>Dans les chunks index√©s (documents)</li>
                        <li>Dans le filtre de recherche Azure AI Search</li>
                    </ul>
                    <p>
                        Le nom est utilis√© <strong>tel que saisi</strong> par l'utilisateur (pas de normalisation).
                        L'URL utilise l'encodage URL pour les espaces et caract√®res sp√©ciaux.
                    </p>
                </div>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>√âl√©ment</th><th>Format</th><th>Exemple</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Nom du projet</td>
                            <td>Original (tel que saisi)</td>
                            <td><code>Mon Projet</code></td>
                        </tr>
                        <tr>
                            <td>Nom du tool</td>
                            <td>Sanitized (snake_case)</td>
                            <td><code>rag_search_mon_projet</code></td>
                        </tr>
                        <tr>
                            <td>URL endpoint</td>
                            <td>Encod√© URL</td>
                            <td><code>/api/rag-tool/Mon%20Projet/fast-search</code></td>
                        </tr>
                        <tr>
                            <td>Filtre recherche</td>
                            <td>Original</td>
                            <td><code>project_name eq 'Mon Projet'</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>6.9.7 Fichiers sources</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Fichier</th><th>R√¥le</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>Blueprints/project_routes.py</code></td>
                            <td>API cr√©ation projet + g√©n√©ration tool</td>
                        </tr>
                        <tr>
                            <td><code>configuration/cosmos_project_manager.py</code></td>
                            <td>CRUD projets dans Cosmos DB</td>
                        </tr>
                        <tr>
                            <td><code>configuration/cosmos_tools_manager.py</code></td>
                            <td>CRUD tools dans Cosmos DB</td>
                        </tr>
                        <tr>
                            <td><code>Blueprints/api_rag_search_tool.py</code></td>
                            <td>Endpoint Fast Search (ex√©cution du tool)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </section>

        <!-- ==========================================
             CHAPITRE 7: MODULE AGENTS TEXTE (COMPLET)
             ========================================== -->
        <section id="text-agents" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-chat-text"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 7: Module Agents Texte</h1>
                    <p class="section-subtitle">Documentation Technique Compl√®te</p>
                </div>
            </div>

            <div class="intro-text">
                Le module <strong>Agents Texte</strong> permet de cr√©er des agents conversationnels bas√©s sur des mod√®les
                de langage avanc√©s (LLM). Contrairement aux agents voix qui utilisent l'API Realtime d'Azure,
                les agents texte fonctionnent via des requ√™tes HTTP classiques avec streaming SSE (Server-Sent Events).
            </div>

            <h2>7.1 Architecture Globale</h2>

            <div class="mermaid">
flowchart TB
    subgraph CLIENT["Client Navigateur"]
        UI["Interface Chat"]
        SSE["EventSource SSE"]
    end

    subgraph FLASK["Flask Backend"]
        BP["text_agents_bp /text-agents"]
        CHAT["chat_stream_api()"]
        TOOLS["execute_dynamic_tool()"]
    end

    subgraph AZURE["Azure AI Foundry"]
        GPT52["GPT-5.2-chat"]
        CLAUDE["Claude Opus 4.5"]
        GROK["Grok 3"]
    end

    subgraph COSMOS["Cosmos DB"]
        AGENTS["Container: text_agents"]
        SESSIONS["Container: text_sessions"]
    end

    subgraph EXTERNAL["Services Externes"]
        HTTP["API REST"]
        MCP["MCP Servers"]
        PYTHON["Code Python"]
    end

    UI -->|"POST /api/id/chat/stream"| CHAT
    CHAT -->|"SSE Response"| SSE
    CHAT --> TOOLS
    TOOLS --> HTTP
    TOOLS --> MCP
    TOOLS --> PYTHON
    CHAT --> GPT52
    CHAT --> CLAUDE
    CHAT --> GROK
    BP --> COSMOS

    style CLIENT fill:#E3F2FD,stroke:#1976D2
    style FLASK fill:#E8F5E9,stroke:#4CAF50
    style AZURE fill:#FFF3E0,stroke:#FF9800
    style COSMOS fill:#F3E5F5,stroke:#9C27B0
    style EXTERNAL fill:#FFEBEE,stroke:#E53935
            </div>

            <h3>Caract√©ristiques Principales</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Caract√©ristique</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Mod√®les support√©s</strong></td><td>GPT-5.2-chat, Claude Opus 4.5, Grok 3 (via Azure AI Foundry)</td></tr>
                        <tr><td><strong>Streaming</strong></td><td>SSE (Server-Sent Events) temps r√©el</td></tr>
                        <tr><td><strong>Tools</strong></td><td>HTTP REST, Python Module, Python Inline, MCP (STDIO/SSE/HTTP)</td></tr>
                        <tr><td><strong>Sessions</strong></td><td>Persistance optionnelle dans Cosmos DB</td></tr>
                        <tr><td><strong>Int√©gration</strong></td><td>iframe, widget JavaScript, popup</td></tr>
                        <tr><td><strong>Pi√®ces jointes</strong></td><td>Images (vision), PDF, documents</td></tr>
                    </tbody>
                </table>
            </div>

            <h2>7.2 Configuration des Mod√®les</h2>

            <pre><code># configuration/cosmos_text_agent_manager.py

TEXT_MODELS = {
    "gpt-5.2-chat": {
        "display_name": "GPT-5.2 Chat",
        "provider": "azure",
        "endpoint_env": "AZURE_OPENAI_ENDPOINT",
        "api_key_env": "AZURE_OPENAI_API_KEY",
        "api_version": "2025-10-01",
        "supports_vision": True,
        "supports_tools": True,
        "max_tokens": 128000
    },
    "claude-opus-4-5": {
        "display_name": "Claude Opus 4.5",
        "provider": "azure-ai-foundry",
        "endpoint_env": "AZURE_AI_FOUNDRY_ENDPOINT",
        "api_key_env": "AZURE_AI_FOUNDRY_API_KEY",
        "supports_vision": True,
        "supports_tools": True,
        "max_tokens": 200000
    }
}</code></pre>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Mod√®le</th><th>Provider</th><th>Vision</th><th>Tools</th><th>Max Tokens</th><th>Latence</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>GPT-5.2-chat</td><td>Azure OpenAI</td><td>Oui</td><td>Oui</td><td>128K</td><td>~500ms</td></tr>
                        <tr><td>Claude Opus 4.5</td><td>Azure AI Foundry</td><td>Oui</td><td>Oui</td><td>200K</td><td>~800ms</td></tr>
                    </tbody>
                </table>
            </div>

            <h2>7.3 Architecture du Blueprint</h2>

            <pre><code># Blueprints/text_agents_routes.py
text_agents_bp = Blueprint('text_agents', __name__, url_prefix='/text-agents')</code></pre>

            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Route</th><th>M√©thode</th><th>Description</th></tr></thead>
                    <tbody>
                        <tr><td><code>/text-agents/</code></td><td>GET</td><td>Galerie des agents texte</td></tr>
                        <tr><td><code>/text-agents/create</code></td><td>GET/POST</td><td>Cr√©ation d'un agent</td></tr>
                        <tr><td><code>/text-agents/&lt;id&gt;/edit</code></td><td>GET/POST</td><td>Modification d'un agent</td></tr>
                        <tr><td><code>/text-agents/&lt;id&gt;/chat</code></td><td>GET</td><td>Interface de chat</td></tr>
                        <tr><td><code>/text-agents/&lt;id&gt;/embed</code></td><td>GET</td><td>Version embeddable</td></tr>
                        <tr><td><code>/text-agents/api/&lt;id&gt;/chat/stream</code></td><td>POST</td><td>API de chat streaming</td></tr>
                        <tr><td><code>/text-agents/api/&lt;id&gt;/session</code></td><td>GET/POST/DELETE</td><td>Gestion des sessions</td></tr>
                    </tbody>
                </table>
            </div>

            <h2>7.4 API de Chat Streaming</h2>

            <pre><code>POST /text-agents/api/&lt;agent_id&gt;/chat/stream
Content-Type: application/json

{
    "message": "Bonjour, comment puis-je vous aider ?",
    "session_id": "sess-uuid-optional",
    "attachments": [
        {"type": "image", "data": "base64_encoded_data", "mime_type": "image/png"}
    ],
    "metadata": {"user_id": "user-123", "source": "website"}
}</code></pre>

            <h3>R√©ponse SSE</h3>
            <pre><code>event: message
data: {"type": "content", "content": "Bonjour"}

event: message
data: {"type": "tool_call", "tool": "search_database", "arguments": {...}}

event: message
data: {"type": "tool_result", "tool": "search_database", "result": {...}}

event: message
data: {"type": "done", "usage": {"prompt_tokens": 150, "completion_tokens": 45}}</code></pre>

            <h3>Impl√©mentation Serveur</h3>
            <pre><code>@text_agents_bp.route('/api/&lt;agent_id&gt;/chat/stream', methods=['POST'])
def chat_stream_api(agent_id):
    data = request.get_json()
    message = data.get('message', '')
    session_id = data.get('session_id')

    agent = cosmos_text_agent_manager.get_agent(agent_id)
    if not agent:
        return jsonify({"error": "Agent not found"}), 404

    session = get_or_create_session(agent_id, session_id)

    def generate():
        messages = build_messages(agent, session, message, data.get('attachments', []))
        for chunk in stream_completion(agent, messages):
            if chunk.get('type') == 'tool_call':
                result = execute_dynamic_tool(chunk['tool'], chunk['arguments'])
                yield f"data: {json.dumps({'type': 'tool_result', 'result': result})}\n\n"
            else:
                yield f"data: {json.dumps(chunk)}\n\n"
        yield f"data: {json.dumps({'type': 'done'})}\n\n"

    return Response(stream_with_context(generate()), mimetype='text/event-stream',
        headers={'Cache-Control': 'no-cache', 'Connection': 'keep-alive'})</code></pre>

            <h2>7.5 Syst√®me de Tools</h2>

            <div class="mermaid">
flowchart TB
    TOOL["Tool Execution"]

    subgraph HTTP["HTTP REST"]
        GET["GET Request"]
        POST["POST Request"]
    end

    subgraph PYTHON["Python"]
        MODULE["Python Module"]
        INLINE["Python Inline"]
    end

    subgraph MCP["Model Context Protocol"]
        STDIO["STDIO Transport"]
        SSE["SSE Transport"]
        MCPHTTP["HTTP Transport"]
    end

    TOOL --> HTTP
    TOOL --> PYTHON
    TOOL --> MCP

    style HTTP fill:#E3F2FD,stroke:#1976D2
    style PYTHON fill:#E8F5E9,stroke:#4CAF50
    style MCP fill:#FFF3E0,stroke:#FF9800
            </div>

            <h3>Configuration Tool HTTP</h3>
            <pre><code>{
    "id": "tool-uuid-1",
    "name": "search_products",
    "description": "Recherche des produits dans le catalogue",
    "type": "http",
    "http_config": {
        "method": "GET",
        "url": "https://api.example.com/products",
        "headers": {"Authorization": "Bearer ${API_KEY}"},
        "query_params": {"q": "${query}", "limit": "${limit:10}"}
    },
    "parameters": {
        "type": "object",
        "properties": {
            "query": {"type": "string", "description": "Terme de recherche"},
            "limit": {"type": "integer", "default": 10}
        },
        "required": ["query"]
    }
}</code></pre>

            <h3>Configuration Tool MCP</h3>
            <pre><code>{
    "id": "tool-uuid-3",
    "name": "mcp_filesystem",
    "description": "Acc√®s au syst√®me de fichiers via MCP",
    "type": "mcp",
    "mcp_config": {
        "transport": "stdio",
        "command": "npx",
        "args": ["-y", "@anthropic/mcp-server-filesystem", "/path/to/allowed"],
        "timeout": 30000
    }
}</code></pre>

            <h3>Ex√©cution Dynamique</h3>
            <pre><code>def execute_dynamic_tool(tool_config: dict, arguments: dict) -> dict:
    tool_type = tool_config.get('type', 'http')

    if tool_type == 'http':
        return execute_http_tool(tool_config, arguments)
    elif tool_type == 'python_module':
        return execute_python_module_tool(tool_config, arguments)
    elif tool_type == 'mcp':
        return execute_mcp_tool(tool_config, arguments)
    else:
        return {"error": f"Unknown tool type: {tool_type}"}</code></pre>

            <h2>7.6 Gestion des Sessions</h2>

            <pre><code>{
    "id": "sess-uuid-123",
    "agent_id": "agent-uuid-456",
    "created_at": "2025-12-30T10:00:00Z",
    "messages": [
        {"role": "system", "content": "Tu es un assistant..."},
        {"role": "user", "content": "Bonjour", "timestamp": "2025-12-30T10:00:00Z"},
        {"role": "assistant", "content": "Bonjour ! Comment puis-je vous aider ?"}
    ],
    "metadata": {"user_id": "user-123", "source": "website"},
    "token_usage": {"prompt_tokens": 1500, "completion_tokens": 450}
}</code></pre>

            <h3>API de Session</h3>
            <pre><code># R√©cup√©rer une session
GET /text-agents/api/&lt;agent_id&gt;/session?session_id=&lt;id&gt;

# Cr√©er une nouvelle session
POST /text-agents/api/&lt;agent_id&gt;/session
{"metadata": {"user_id": "user-123"}}

# Supprimer une session
DELETE /text-agents/api/&lt;agent_id&gt;/session/&lt;session_id&gt;</code></pre>

            <h2>7.7 Sch√©ma de Donn√©es Agent</h2>

            <pre><code>{
    "id": "agent-uuid-789",
    "name": "Assistant Commercial",
    "description": "Agent sp√©cialis√© dans les ventes",
    "model": "gpt-5.2-chat",
    "system_prompt": "Tu es un assistant commercial expert...",
    "temperature": 0.7,
    "max_tokens": 4096,
    "tools": [...],
    "default_tools_enabled": true,
    "welcome_message": "Bonjour ! Je suis votre assistant commercial.",
    "suggested_prompts": ["Quels sont vos produits phares ?", "Comment commander ?"],
    "appearance": {
        "primary_color": "#007bff",
        "avatar_url": "/static/avatars/commercial.png"
    },
    "settings": {
        "session_timeout_minutes": 30,
        "max_messages_per_session": 100,
        "save_sessions": true
    }
}</code></pre>

            <h2>7.8 Int√©gration et Embedding</h2>

            <h3>Int√©gration iframe</h3>
            <pre><code>&lt;iframe
    src="https://wakavoice.example.com/text-agents/agent-uuid/embed"
    width="400" height="600" frameborder="0"
    style="border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);"&gt;
&lt;/iframe&gt;</code></pre>

            <h3>Widget JavaScript</h3>
            <pre><code>&lt;script src="https://wakavoice.example.com/static/js/text-agent-widget.js"&gt;&lt;/script&gt;
&lt;script&gt;
    WakaTextAgent.init({
        agentId: 'agent-uuid-789',
        position: 'bottom-right',
        primaryColor: '#007bff',
        welcomeMessage: 'Bonjour ! Comment puis-je vous aider ?',
        onMessage: function(message) { console.log('Message:', message); }
    });
&lt;/script&gt;</code></pre>

            <h3>API du Widget</h3>
            <pre><code>WakaTextAgent.open();        // Ouvrir
WakaTextAgent.close();       // Fermer
WakaTextAgent.sendMessage("Je cherche un produit");
WakaTextAgent.resetSession();
WakaTextAgent.on('message', (data) =&gt; console.log(data));
WakaTextAgent.on('toolCall', (data) =&gt; console.log(data.tool));</code></pre>

            <h2>7.9 Interface Utilisateur</h2>

            <!-- Mockup Chat -->
            <div style="background: white; border-radius: 16px; overflow: hidden; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                <div style="background: linear-gradient(135deg, #007bff, #00bcd4); padding: 16px 20px; display: flex; align-items: center; gap: 12px;">
                    <div style="width: 40px; height: 40px; background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px;">ü§ñ</div>
                    <div style="color: white;">
                        <h4 style="margin: 0; font-size: 16px;">Assistant Commercial</h4>
                        <span style="font-size: 12px; opacity: 0.9;">‚óè En ligne</span>
                    </div>
                </div>
                <div style="padding: 20px; min-height: 150px; background: #f8f9fa;">
                    <div style="display: flex; gap: 12px; margin-bottom: 16px;">
                        <div style="width: 32px; height: 32px; background: #007bff; border-radius: 50%;"></div>
                        <div style="background: white; padding: 12px 16px; border-radius: 12px; max-width: 70%;">
                            <p style="margin: 0; color: #333;">Bonjour ! Comment puis-je vous aider ?</p>
                        </div>
                    </div>
                    <div style="display: flex; justify-content: flex-end;">
                        <div style="background: #007bff; color: white; padding: 12px 16px; border-radius: 12px; max-width: 70%;">
                            <p style="margin: 0;">Je cherche un produit</p>
                        </div>
                    </div>
                </div>
                <div style="padding: 16px 20px; border-top: 1px solid #e0e0e0; display: flex; gap: 12px;">
                    <input type="text" placeholder="Tapez votre message..." style="flex: 1; padding: 12px 16px; border: 1px solid #e0e0e0; border-radius: 8px;">
                    <button style="padding: 12px 20px; background: #007bff; color: white; border: none; border-radius: 8px;">Envoyer</button>
                </div>
            </div>

            <h2>7.10 Flux de Conversation</h2>

            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant C as Client JS
    participant F as Flask
    participant DB as Cosmos DB
    participant LLM as LLM

    U->>C: Tape un message
    C->>F: POST /api/id/chat/stream
    F->>DB: R√©cup√©rer agent + session
    F->>LLM: Envoyer messages + tools

    loop Streaming
        LLM-->>F: Token partiel
        F-->>C: SSE content
        C-->>U: Affiche le texte
    end

    F->>DB: Sauvegarder session
    F-->>C: SSE done
            </div>

            <h2>7.11 M√©triques et Monitoring</h2>

            <div class="table-wrapper">
                <table>
                    <thead><tr><th>M√©trique</th><th>Description</th><th>Type</th></tr></thead>
                    <tbody>
                        <tr><td><code>text_agent.messages.total</code></td><td>Nombre total de messages</td><td>Counter</td></tr>
                        <tr><td><code>text_agent.tokens.prompt</code></td><td>Tokens de prompt utilis√©s</td><td>Counter</td></tr>
                        <tr><td><code>text_agent.tokens.completion</code></td><td>Tokens de compl√©tion utilis√©s</td><td>Counter</td></tr>
                        <tr><td><code>text_agent.latency.first_token</code></td><td>Latence jusqu'au premier token</td><td>Histogram</td></tr>
                        <tr><td><code>text_agent.tools.calls</code></td><td>Nombre d'appels de tools</td><td>Counter</td></tr>
                        <tr><td><code>text_agent.sessions.active</code></td><td>Sessions actives</td><td>Gauge</td></tr>
                    </tbody>
                </table>
            </div>

            <pre><code># Sant√© du service
GET /text-agents/health
Response: {"status": "healthy", "model_status": {...}}

# M√©triques Prometheus
GET /text-agents/metrics</code></pre>

            <div class="callout callout-success">
                <i class="bi bi-check-circle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Documentation Compl√®te</div>
                    <p>Ce chapitre couvre l'ensemble du module Agents Texte : architecture, API, syst√®me de tools (HTTP, Python, MCP), gestion des sessions, int√©gration (iframe, widget, popup), et monitoring.</p>
                </div>
            </div>

        </section>

        <!-- ==========================================
             CHAPITRE 8: AGENTS VOIX (Documentation Technique Compl√®te)
             ========================================== -->
        <section id="voice-agents" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-telephone"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 8: Module Agents Voix</h1>
                    <p class="section-subtitle">Documentation Technique Compl√®te - Conversations vocales temps r√©el</p>
                </div>
            </div>

            <div class="intro-text">
                Le module <strong>Agents Voix</strong> permet de cr√©er des agents conversationnels vocaux bas√©s sur l'API
                <strong>Azure OpenAI Voice Live (Realtime API)</strong>. Il utilise une architecture WebSocket bidirectionnelle
                full-duplex pour permettre des conversations naturelles en temps r√©el entre un utilisateur et un agent IA.
            </div>

            <!-- 8.1 Vue d'Ensemble -->
            <h2>8.1 Vue d'Ensemble et Architecture</h2>

            <div class="mermaid">
flowchart TB
    subgraph CLIENT["Client (Navigateur)"]
        MIC["Microphone"]
        SPK["Speaker"]
        UI["Interface Voice"]
        WS_CLIENT["WebSocket Client"]
    end

    subgraph FLASK["Flask Backend"]
        WS_PROXY["voice_live_proxy.py"]
        SESSION["VoiceLiveSession"]
        TOOLS["Tool Execution"]
    end

    subgraph AZURE["Azure OpenAI Realtime"]
        RT_API["Realtime API"]
        STT["Speech-to-Text"]
        LLM["GPT Realtime"]
        TTS["Text-to-Speech"]
    end

    subgraph COSMOS["Cosmos DB"]
        AGENTS_DB["Container: agents"]
        SESSIONS_DB["Container: VoiceSessions"]
    end

    MIC -->|Audio PCM16| WS_CLIENT
    WS_CLIENT -->|WebSocket| WS_PROXY
    WS_PROXY -->|Bidirectional WS| RT_API
    RT_API --> STT
    STT --> LLM
    LLM --> TTS
    TTS -->|Audio Response| WS_PROXY
    WS_PROXY -->|WebSocket| WS_CLIENT
    WS_CLIENT -->|Audio| SPK

    SESSION --> TOOLS
    SESSION --> COSMOS
            </div>

            <h3>Caract√©ristiques Principales</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Caract√©ristique</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Protocole</strong></td><td>WebSocket bidirectionnel full-duplex</td></tr>
                        <tr><td><strong>Mod√®les support√©s</strong></td><td>gpt-realtime, gpt-realtime-mini, phi4-mm-realtime, gpt-5-realtime</td></tr>
                        <tr><td><strong>Format Audio</strong></td><td>PCM16, 24kHz, mono</td></tr>
                        <tr><td><strong>Voix</strong></td><td>Azure Neural (600+), Personal Voice, OpenAI Native</td></tr>
                        <tr><td><strong>Turn Detection</strong></td><td>VAD s√©mantique multilingue (azure_semantic_vad)</td></tr>
                        <tr><td><strong>Barge-in</strong></td><td>Interruption native de l'agent</td></tr>
                        <tr><td><strong>Tools</strong></td><td>Max 8 outils par agent, ex√©cution temps r√©el</td></tr>
                        <tr><td><strong>Session Max</strong></td><td>15 minutes (limite Azure)</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 8.2 Mod√®les Realtime -->
            <h2>8.2 Les Mod√®les Voice Live</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Mod√®le</th>
                            <th>Formule</th>
                            <th>Latence</th>
                            <th>Qualit√©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>gpt-realtime</strong></td>
                            <td>Pro</td>
                            <td>~400ms</td>
                            <td>Excellente</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-realtime-mini</strong></td>
                            <td>Basic</td>
                            <td>~300ms</td>
                            <td>Bonne</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-4o-realtime-preview</strong></td>
                            <td>Pro</td>
                            <td>~450ms</td>
                            <td>Excellente</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-5-realtime</strong></td>
                            <td>Pro</td>
                            <td>~350ms</td>
                            <td>Exceptionnelle</td>
                        </tr>
                        <tr>
                            <td><strong>phi4-mm-realtime</strong></td>
                            <td>Lite</td>
                            <td>~250ms</td>
                            <td>Correcte</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-5-nano</strong></td>
                            <td>Lite</td>
                            <td>~200ms</td>
                            <td>Basique</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 8.3 Turn Detection -->
            <h2>8.3 Turn Detection (VAD S√©mantique)</h2>

            <div class="comparison-box">
                <div class="comparison-column">
                    <div class="comparison-header success">Semantic VAD (recommand√©)</div>
                    <ul class="comparison-list">
                        <li>Analyse le contenu s√©mantique</li>
                        <li>D√©tecte les fins de phrases logiques</li>
                        <li>Tol√®re les pauses de r√©flexion</li>
                        <li>Multilingue (semantic_detection_v1_multilingual)</li>
                    </ul>
                </div>
                <div class="comparison-column">
                    <div class="comparison-header warning">Server VAD (legacy)</div>
                    <ul class="comparison-list">
                        <li>D√©tection par silence uniquement</li>
                        <li>Plus rapide mais moins pr√©cis</li>
                        <li>Peut couper l'utilisateur</li>
                        <li>D√©pr√©ci√© depuis v3.1</li>
                    </ul>
                </div>
            </div>

            <pre><code class="language-json">{
    "turn_detection": {
        "type": "azure_semantic_vad",
        "threshold": 0.3,
        "silence_duration_ms": 300,
        "create_response": true,
        "end_of_utterance_detection": {
            "model": "semantic_detection_v1_multilingual"
        }
    }
}</code></pre>

            <!-- 8.4 Barge-in -->
            <h2>8.4 Barge-in (Interruption)</h2>

            <p>Le barge-in permet √† l'utilisateur d'interrompre l'agent pendant qu'il parle. L'audio de l'agent est imm√©diatement coup√© et la transcription de l'utilisateur est trait√©e.</p>

            <pre><code class="language-json">{
    "turn_detection": {
        "type": "azure_semantic_vad",
        "interrupt_response": true,
        "threshold": 0.5
    }
}</code></pre>

            <!-- 8.5 Architecture Blueprint -->
            <h2>8.5 Architecture du Blueprint</h2>

            <h3>Fichiers Principaux</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Fichier</th><th>Taille</th><th>R√¥le</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>voice_live_proxy.py</code></td><td>~26KB</td><td>WebSocket proxy + VoiceLiveSession</td></tr>
                        <tr><td><code>agents_config_routes.py</code></td><td>~50KB</td><td>Routes de gestion agents (4 √©tapes)</td></tr>
                        <tr><td><code>cosmos_agent_manager.py</code></td><td>~20KB</td><td>Manager d'agents (CRUD Cosmos)</td></tr>
                        <tr><td><code>voice_live_config.py</code></td><td>~10KB</td><td>Config Azure + client Voice Live</td></tr>
                        <tr><td><code>voice_live_session_builder.py</code></td><td>~15KB</td><td>Builder strict de sessions</td></tr>
                        <tr><td><code>sessions/voice/manager.py</code></td><td>~25KB</td><td>Manager de sessions Cosmos</td></tr>
                        <tr><td><code>static/js/agent_voice_session.js</code></td><td>~29KB</td><td>Client JS avec objet AudioSession (gestion audio, overlap protection)</td></tr>
                    </tbody>
                </table>
            </div>

            <h3>Endpoints Principaux</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Route</th><th>M√©thode</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>/agents/</code></td><td>GET</td><td>Galerie des agents voix</td></tr>
                        <tr><td><code>/agents/config/step1</code></td><td>GET</td><td>√âtape 1: S√©lection du mod√®le</td></tr>
                        <tr><td><code>/agents/config/step2/&lt;id&gt;</code></td><td>GET/POST</td><td>√âtape 2: Configuration voix</td></tr>
                        <tr><td><code>/agents/config/step3/&lt;id&gt;</code></td><td>GET/POST</td><td>√âtape 3: S√©lection des outils</td></tr>
                        <tr><td><code>/agents/config/step4/&lt;id&gt;</code></td><td>GET/POST</td><td>√âtape 4: Prompt syst√®me</td></tr>
                        <tr><td><code>/agents/session/&lt;id&gt;</code></td><td>GET</td><td>Page de session voix</td></tr>
                        <tr><td><code>/voice-proxy/ws/&lt;id&gt;</code></td><td>WebSocket</td><td>Connexion WebSocket principale</td></tr>
                        <tr><td><code>/agents/voice-history</code></td><td>GET</td><td>Historique des sessions</td></tr>
                        <tr><td><code>/agents/api/conversation/init</code></td><td>POST</td><td>Initialiser conversation</td></tr>
                        <tr><td><code>/agents/api/conversation/end</code></td><td>POST</td><td>Terminer conversation</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 8.6 Connexion WebSocket -->
            <h2>8.6 Connexion WebSocket</h2>

            <h3>Flux de Messages</h3>
            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant C as Client JS
    participant P as Flask Proxy
    participant A as Azure Realtime

    U->>C: Clic D√©marrer
    C->>P: WS Connect /voice-proxy/ws/agent_id
    P->>A: WS Connect Azure Realtime
    A-->>P: session.created
    P-->>C: session.created

    loop Conversation
        U->>C: Parle au micro
        C->>P: input_audio_buffer.append (PCM16)
        P->>A: input_audio_buffer.append

        A-->>P: speech_started (VAD)
        A-->>P: speech_stopped (VAD)
        A-->>P: conversation.item.created (transcript)
        P-->>C: transcript

        A-->>P: response.audio.delta (chunks)
        P-->>C: audio.delta
        C-->>U: Joue audio

        A-->>P: response.done
    end

    alt Tool Call
        A-->>P: function_call_arguments.done
        P->>P: execute_dynamic_tool()
        P->>A: conversation.item.create (tool_result)
    end

    U->>C: Clic Terminer
    C->>P: WS Close
    P->>A: WS Close
    P->>P: Sauvegarde Cosmos
            </div>

            <h3>Types de Messages Azure Realtime</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Message</th><th>Direction</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>session.created</code></td><td>Azure ‚Üí Client</td><td>Session initialis√©e</td></tr>
                        <tr><td><code>input_audio_buffer.append</code></td><td>Client ‚Üí Azure</td><td>Envoi audio PCM16</td></tr>
                        <tr><td><code>input_audio_buffer.speech_started</code></td><td>Azure ‚Üí Client</td><td>Parole d√©tect√©e (VAD)</td></tr>
                        <tr><td><code>input_audio_buffer.speech_stopped</code></td><td>Azure ‚Üí Client</td><td>Fin de parole (VAD)</td></tr>
                        <tr><td><code>conversation.item.created</code></td><td>Azure ‚Üí Client</td><td>Transcription compl√®te</td></tr>
                        <tr><td><code>response.audio.delta</code></td><td>Azure ‚Üí Client</td><td>Chunk audio r√©ponse</td></tr>
                        <tr><td><code>response.function_call_arguments.done</code></td><td>Azure ‚Üí Client</td><td>Tool call request</td></tr>
                        <tr><td><code>response.done</code></td><td>Azure ‚Üí Client</td><td>R√©ponse compl√®te</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 8.7 Syst√®me de Tools -->
            <h2>8.7 Syst√®me de Tools</h2>

            <h3>Outils Disponibles (31 total)</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Cat√©gorie</th><th>Tools</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Basiques</strong></td><td>calculator, currency, translator, weather, news</td><td>Outils utilitaires</td></tr>
                        <tr><td><strong>Recherche</strong></td><td>search_web, places, dogs, exercises</td><td>Recherche d'informations</td></tr>
                        <tr><td><strong>Communication</strong></td><td>email, sms, payment_promise, extension_confirm</td><td>Envoi de messages</td></tr>
                        <tr><td><strong>Voyage</strong></td><td>flight_search, flight_booking, hotel_search, hotel_booking</td><td>R√©servations</td></tr>
                        <tr><td><strong>Services</strong></td><td>prayer_times, pharmacy_locator, school_info, taxi_estimate</td><td>Services locaux</td></tr>
                        <tr><td><strong>Professionnel</strong></td><td>knowledge_base, cv_builder, tax_calculator</td><td>Outils m√©tier</td></tr>
                        <tr><td><strong>Syst√®me</strong></td><td>end_conversation, schedule_callback</td><td>Contr√¥le de session</td></tr>
                    </tbody>
                </table>
            </div>

            <div class="alert-box warning">
                <i class="bi bi-exclamation-triangle"></i>
                <strong>Important:</strong> L'API Azure Voice Live limite le nombre de tools √† 8 par session. Au-del√†, les performances se d√©gradent significativement.
            </div>

            <h3>Format de D√©finition d'un Tool</h3>
            <pre><code class="language-python"># tools/weather.py

def get_tool_definition() -> dict:
    return {
        'type': 'function',
        'function': {
            'name': 'get_weather_forecast',
            'description': 'R√©cup√®re les pr√©visions m√©t√©o',
            'parameters': {
                'type': 'object',
                'properties': {
                    'city': {'type': 'string', 'description': 'Nom de la ville'},
                    'days': {'type': 'integer', 'description': 'Jours (1-7)', 'default': 3}
                },
                'required': ['city']
            }
        }
    }

async def execute(args: dict) -> dict:
    city = args.get('city')
    response = await weather_api.get_forecast(city, args.get('days', 3))
    return {'city': city, 'forecast': response.data}</code></pre>

            <!-- 8.8 Gestion des Sessions -->
            <h2>8.8 Gestion des Sessions</h2>

            <h3>Sch√©ma de Session Cosmos DB</h3>
            <pre><code class="language-json">{
    "id": "sess-uuid-123",
    "call_id": "call-uuid-456",
    "agent_id": "agent-uuid-789",
    "status": "completed",
    "started_at": "2025-12-30T10:00:00Z",
    "ended_at": "2025-12-30T10:05:30Z",
    "duration_minutes": 5.5,
    "model": "gpt-realtime",
    "voice": "fr-FR-DeniseNeural",
    "tokens": {
        "input_token_details": {"text_tokens": 450, "audio_tokens": 12500},
        "output_token_details": {"text_tokens": 380, "audio_tokens": 8700}
    },
    "cost": {
        "input_text": 0.0025,
        "input_audio": 0.2125,
        "output_text": 0.0084,
        "output_audio": 0.4785,
        "total": 0.7019
    },
    "conversation": [...],
    "message_count": 12,
    "tools_executed": 2,
    "summary": "L'utilisateur a recherch√© un vol Paris-Lyon...",
    "sentiment": "positive",
    "sentiment_score": 0.85
}</code></pre>

            <!-- 8.9 Configuration Voice -->
            <h2>8.9 Types de Voix Support√©s</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Type</th><th>Description</th><th>Exemple</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>azure-standard</code></td><td>Voix Azure Neural standard (600+)</td><td>fr-FR-DeniseNeural</td></tr>
                        <tr><td><code>azure-personal</code></td><td>Personal Voice (clone de voix)</td><td>voice-XXXX-XXXX</td></tr>
                        <tr><td><code>azure-custom</code></td><td>Custom Neural Voice</td><td>custom-voice-id</td></tr>
                        <tr><td><code>openai</code></td><td>Voix natives OpenAI</td><td>alloy, echo, fable, onyx, nova, shimmer</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 8.10 Flux de Cr√©ation -->
            <h2>8.10 Flux de Cr√©ation d'un Agent</h2>

            <div class="mermaid">
flowchart LR
    S1["√âTAPE 1<br/>Mod√®le"] --> S2["√âTAPE 2<br/>Voix"]
    S2 --> S3["√âTAPE 3<br/>Outils"]
    S3 --> S4["√âTAPE 4<br/>Prompt"]
    S4 --> PUB["Agent Publi√©"]

    style S1 fill:#4A148C,color:#fff
    style S2 fill:#7B1FA2,color:#fff
    style S3 fill:#9C27B0,color:#fff
    style S4 fill:#AB47BC,color:#fff
    style PUB fill:#51cf66,color:#fff
            </div>

            <div class="cards-grid">
                <div class="info-card">
                    <div class="card-header"><i class="bi bi-1-circle"></i><h3>√âtape 1: Mod√®le</h3></div>
                    <ul>
                        <li>Choisir mod√®le realtime</li>
                        <li>Cr√©er document Cosmos (draft)</li>
                        <li>G√©n√©rer agent_reference</li>
                    </ul>
                </div>
                <div class="info-card">
                    <div class="card-header"><i class="bi bi-2-circle"></i><h3>√âtape 2: Voix</h3></div>
                    <ul>
                        <li>S√©lectionner langue/locale</li>
                        <li>Choisir la voix</li>
                        <li>Configurer vitesse (rate)</li>
                    </ul>
                </div>
                <div class="info-card">
                    <div class="card-header"><i class="bi bi-3-circle"></i><h3>√âtape 3: Outils</h3></div>
                    <ul>
                        <li>Multi-s√©lection (31 outils)</li>
                        <li>Maximum 8 par agent</li>
                        <li>Preview de chaque outil</li>
                    </ul>
                </div>
                <div class="info-card">
                    <div class="card-header"><i class="bi bi-4-circle"></i><h3>√âtape 4: Prompt</h3></div>
                    <ul>
                        <li>√âcrire instructions (max 2000 car.)</li>
                        <li>Option: G√©n√©rer avec IA</li>
                        <li>Publier (status=published)</li>
                    </ul>
                </div>
            </div>

            <!-- 8.11 Timeouts et M√©triques -->
            <h2>8.11 Timeouts et M√©triques</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Timeout</th><th>Valeur</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Azure connection</td><td>20s</td><td>Connexion initiale (retryable 3x)</td></tr>
                        <tr><td>Inactivity check</td><td>10s</td><td>Fr√©quence de v√©rification</td></tr>
                        <tr><td>Inactivity timeout</td><td>180s</td><td>Fermeture automatique si silence</td></tr>
                        <tr><td>Max session duration</td><td>900s (15 min)</td><td>Limite Azure Realtime</td></tr>
                        <tr><td>Client ping</td><td>15s</td><td>Keep-alive navigateur</td></tr>
                        <tr><td>Azure ping</td><td>10s</td><td>Keep-alive Azure (~60s timeout)</td></tr>
                    </tbody>
                </table>
            </div>

            <h3>M√©triques Collect√©es par Session</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>M√©trique</th><th>Description</th><th>Type</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>audio_sent</code></td><td>Bytes audio envoy√©s</td><td>Counter</td></tr>
                        <tr><td><code>audio_received</code></td><td>Bytes audio re√ßus</td><td>Counter</td></tr>
                        <tr><td><code>interruptions</code></td><td>Nombre de barge-in</td><td>Counter</td></tr>
                        <tr><td><code>tools_executed</code></td><td>Nombre de tools appel√©s</td><td>Counter</td></tr>
                        <tr><td><code>messages_count</code></td><td>Total messages (user + assistant)</td><td>Counter</td></tr>
                        <tr><td><code>duration_minutes</code></td><td>Dur√©e totale</td><td>Gauge</td></tr>
                        <tr><td><code>tokens.input_text</code></td><td>Tokens texte en entr√©e</td><td>Counter</td></tr>
                        <tr><td><code>tokens.input_audio</code></td><td>Tokens audio en entr√©e</td><td>Counter</td></tr>
                        <tr><td><code>tokens.output_text</code></td><td>Tokens texte en sortie</td><td>Counter</td></tr>
                        <tr><td><code>tokens.output_audio</code></td><td>Tokens audio en sortie</td><td>Counter</td></tr>
                    </tbody>
                </table>
            </div>

            <h3>Variables d'Environnement Requises</h3>
            <pre><code class="language-bash"># Azure Voice Live
VOICE_LIVE_KEY=&lt;api-key&gt;
VOICE_LIVE_NAME=&lt;resource-name&gt;
VOICE_LIVE_ENDPOINT=&lt;endpoint&gt;
VOICE_LIVE_ENDPOINT_TYPE=cognitiveservices

# Fallback (ancien format)
AZURE_SPEECH_KEY=&lt;key&gt;
AZURE_SPEECH_NAME=&lt;name&gt;
AZURE_SPEECH_ENDPOINT=&lt;endpoint&gt;

# Cosmos DB
COSMOS_URI=&lt;uri&gt;
COSMOS_KEY=&lt;key&gt;
COSMOS_DATABASE_NAME=ConversationsDB</code></pre>

        </section>

        <!-- ==========================================
             CHAPITRE 9: AGENTS AVATAR
             ========================================== -->
        <section id="avatar-agents" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-person-video"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 9: Agents Avatar</h1>
                    <p class="section-subtitle">Avatars vid√©o synchronis√©s lip-sync avec Azure Voice Live</p>
                </div>
            </div>

            <div class="intro-text">
                Le module <strong>Agents Avatar</strong> int√®gre l'API <strong>Azure Voice Live</strong> avec le rendu 3D d'avatars via <strong>WebRTC</strong>.
                Deux technologies : <strong>Avatar Vid√©o Azure</strong> (6 personnages 3D) et <strong>Photo Avatar VASA-1</strong> (30 personnages photo-r√©alistes).
            </div>

            <!-- 9.1 Vue d'Ensemble et Architecture -->
            <h2>9.1 Vue d'Ensemble et Architecture</h2>

            <div class="mermaid">
flowchart TB
    subgraph CLIENT["Client (Navigateur)"]
        MIC["Microphone"]
        SPK["Speaker"]
        VIDEO["Video Player WebRTC"]
        WS_CLIENT["WebSocket Client"]
    end

    subgraph FLASK["Flask Backend"]
        WS_PROXY["avatar_live_proxy.py"]
        SESSION["AvatarLiveSession"]
        TOOLS["Tool Execution"]
    end

    subgraph AZURE["Azure Services"]
        RT_API["Voice Live API"]
        AVATAR_SVC["Avatar Service"]
        STT["Speech-to-Text"]
        LLM["GPT Realtime"]
        TTS["Text-to-Speech"]
    end

    subgraph COSMOS["Cosmos DB"]
        AGENTS_DB["Container: AvatarConfigurations"]
        SESSIONS_DB["Container: VoiceSessions"]
    end

    MIC -->|Audio PCM16| WS_CLIENT
    WS_CLIENT -->|WebSocket| WS_PROXY
    WS_PROXY -->|Bidirectional WS| RT_API
    RT_API --> STT
    STT --> LLM
    LLM --> TTS
    TTS --> AVATAR_SVC
    AVATAR_SVC -->|WebRTC Video| VIDEO
    WS_PROXY -->|Audio Response| WS_CLIENT
    WS_CLIENT -->|Audio| SPK

    SESSION --> TOOLS
    SESSION --> COSMOS
            </div>

            <h3>Caract√©ristiques Principales</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Caract√©ristique</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Protocole</strong></td>
                            <td>WebSocket + WebRTC (SDP/ICE)</td>
                        </tr>
                        <tr>
                            <td><strong>Avatars Vid√©o</strong></td>
                            <td>6 personnages : Harry, Jeff, Lisa, Lori, Max, Meg</td>
                        </tr>
                        <tr>
                            <td><strong>Avatars Photo</strong></td>
                            <td>30 personnages VASA-1 (photo-r√©alistes)</td>
                        </tr>
                        <tr>
                            <td><strong>R√©solution Vid√©o</strong></td>
                            <td>1920x1080 (vid√©o) / 512x512 (photo)</td>
                        </tr>
                        <tr>
                            <td><strong>Format Audio</strong></td>
                            <td>PCM16, 24kHz, mono</td>
                        </tr>
                        <tr>
                            <td><strong>Lip-Sync</strong></td>
                            <td>Synchronisation temps r√©el via vis√®mes</td>
                        </tr>
                        <tr>
                            <td><strong>Barge-in</strong></td>
                            <td>Interruption native avec throttling 500ms</td>
                        </tr>
                        <tr>
                            <td><strong>Tools</strong></td>
                            <td>Max 8 outils par agent, HTTP + Python</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 9.2 Types d'Avatars -->
            <h2>9.2 Types d'Avatars</h2>

            <h3>Avatar Vid√©o Azure (6 personnages)</h3>
            <p>Personnages 3D pr√©-rendus avec styles vari√©s, rendu via WebRTC en haute r√©solution.</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Personnage</th>
                            <th>Styles Disponibles</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Harry</strong></td>
                            <td>business, casual, youthful</td>
                        </tr>
                        <tr>
                            <td><strong>Jeff</strong></td>
                            <td>business, formal</td>
                        </tr>
                        <tr>
                            <td><strong>Lisa</strong></td>
                            <td>casual-sitting, graceful-standing, technical-sitting, technical-standing</td>
                        </tr>
                        <tr>
                            <td><strong>Lori</strong></td>
                            <td>casual, formal, graceful</td>
                        </tr>
                        <tr>
                            <td><strong>Max</strong></td>
                            <td>business, casual, formal</td>
                        </tr>
                        <tr>
                            <td><strong>Meg</strong></td>
                            <td>business, casual, formal</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Configuration Vid√©o Avatar</h3>
            <pre><code class="language-json">{
    "avatar": {
        "character": "lisa",
        "style": "casual-sitting",
        "customized": false,
        "video": {
            "resolution": {"width": 1920, "height": 1080},
            "bitrate": 2000000,
            "crop": {
                "top_left": [560, 0],
                "bottom_right": [1360, 1080]
            },
            "background": {"color": "#FFFFFF"}
        },
        "ice_servers": [
            {"urls": ["stun:stun.l.google.com:19302"]}
        ]
    }
}</code></pre>

            <h3>Avatar Photo VASA-1 (30 personnages)</h3>
            <p>Anime une photo portrait pour cr√©er un avatar parlant r√©aliste avec micro-expressions.</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Personnages Photo Disponibles</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>adrian, amara, amira, anika, bianca, camila, carlos, clara, darius, diego</td>
                        </tr>
                        <tr>
                            <td>elise, farhan, faris, gabrielle, hyejin, imran, isabella, layla, liwei, ling</td>
                        </tr>
                        <tr>
                            <td>marcus, matteo, rahul, rana, ren, riya, sakura, simone, zayd, zoe</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Configuration Photo Avatar</h3>
            <pre><code class="language-json">{
    "avatar": {
        "type": "photo-avatar",
        "model": "vasa-1",
        "character": "isabella",
        "photoAvatarBaseModel": "isabella",
        "video": {
            "resolution": {"width": 512, "height": 512},
            "bitrate": 2000000
        }
    }
}</code></pre>

            <!-- 9.3 Architecture du Blueprint -->
            <h2>9.3 Architecture du Blueprint</h2>

            <h3>Fichiers Principaux</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Fichier</th>
                            <th>Lignes</th>
                            <th>R√¥le</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>avatar_routes.py</code></td>
                            <td>~1650</td>
                            <td>Routes Azure Avatar (5 √©tapes + chat)</td>
                        </tr>
                        <tr>
                            <td><code>avatar_live_proxy.py</code></td>
                            <td>~1580</td>
                            <td>WebSocket proxy + AvatarLiveSession</td>
                        </tr>
                        <tr>
                            <td><code>cosmos_azure_avatar_manager_v2.py</code></td>
                            <td>~730</td>
                            <td>Manager CRUD Cosmos DB</td>
                        </tr>
                        <tr>
                            <td><code>cosmos_avatar_preferences_manager.py</code></td>
                            <td>~510</td>
                            <td>Pr√©f√©rences utilisateur</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Endpoints Principaux</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Route</th>
                            <th>M√©thode</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>/azure-avatar/gallery</code></td>
                            <td>GET</td>
                            <td>Galerie des agents avatar</td>
                        </tr>
                        <tr>
                            <td><code>/azure-avatar/step1</code></td>
                            <td>GET/POST</td>
                            <td>√âtape 1: S√©lection du mod√®le</td>
                        </tr>
                        <tr>
                            <td><code>/azure-avatar/step2/&lt;id&gt;</code></td>
                            <td>GET/POST</td>
                            <td>√âtape 2: Configuration voix</td>
                        </tr>
                        <tr>
                            <td><code>/azure-avatar/step3/&lt;id&gt;</code></td>
                            <td>GET/POST</td>
                            <td>√âtape 3: S√©lection avatar (Photo/Vid√©o)</td>
                        </tr>
                        <tr>
                            <td><code>/azure-avatar/step4/&lt;id&gt;</code></td>
                            <td>GET/POST</td>
                            <td>√âtape 4: Configuration outils</td>
                        </tr>
                        <tr>
                            <td><code>/azure-avatar/step5/&lt;id&gt;</code></td>
                            <td>GET/POST</td>
                            <td>√âtape 5: Prompt syst√®me</td>
                        </tr>
                        <tr>
                            <td><code>/azure-avatar/session/&lt;id&gt;</code></td>
                            <td>GET</td>
                            <td>Interface de session int√©gr√©e</td>
                        </tr>
                        <tr>
                            <td><code>/azure-avatar/embed/&lt;id&gt;</code></td>
                            <td>GET</td>
                            <td>Widget int√©grable</td>
                        </tr>
                        <tr>
                            <td><code>/ws/avatar/&lt;id&gt;</code></td>
                            <td>WebSocket</td>
                            <td>Connexion temps r√©el</td>
                        </tr>
                        <tr>
                            <td><code>/azure-avatar/api/get-ice-token</code></td>
                            <td>POST</td>
                            <td>Token ICE pour WebRTC</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 9.4 Flux de Cr√©ation (5 √âtapes) -->
            <h2>9.4 Flux de Cr√©ation d'un Agent Avatar</h2>

            <div class="mermaid">
flowchart LR
    S1["√âTAPE 1\nMod√®le"] --> S2["√âTAPE 2\nVoix"]
    S2 --> S3["√âTAPE 3\nAvatar"]
    S3 --> S4["√âTAPE 4\nOutils"]
    S4 --> S5["√âTAPE 5\nPrompt"]
    S5 --> PUB["Agent Publi√©"]

    style S1 fill:#4A148C,color:#fff
    style S2 fill:#6A1B9A,color:#fff
    style S3 fill:#7B1FA2,color:#fff
    style S4 fill:#9C27B0,color:#fff
    style S5 fill:#AB47BC,color:#fff
    style PUB fill:#51cf66,color:#fff
            </div>

            <h3>√âtape 1: S√©lection du Mod√®le</h3>
            <ul>
                <li>Choisir parmi: gpt-realtime, gpt-realtime-mini</li>
                <li>Cr√©er document Cosmos avec <code>status="draft"</code></li>
                <li>Configurer les endpoints Speech Azure</li>
            </ul>

            <h3>√âtape 2: Configuration Voix</h3>
            <ul>
                <li>S√©lectionner langue et locale (fr-FR, en-US, etc.)</li>
                <li>Choisir la voix Azure Neural</li>
                <li>Configurer temp√©rature et vitesse</li>
            </ul>

            <h3>√âtape 3: S√©lection Avatar</h3>
            <ul>
                <li><strong>Vid√©o</strong>: Choisir personnage + style (1920x1080)</li>
                <li><strong>Photo</strong>: Choisir portrait VASA-1 (512x512)</li>
                <li>Configurer fond et crop (vid√©o uniquement)</li>
            </ul>

            <h3>√âtape 4: Configuration Outils</h3>
            <ul>
                <li>Multi-s√©lection parmi les outils disponibles</li>
                <li>Maximum 8 outils par agent</li>
                <li>Support HTTP endpoints + Python handlers</li>
            </ul>

            <h3>√âtape 5: Prompt Syst√®me</h3>
            <ul>
                <li>√âcrire instructions personnalis√©es</li>
                <li>Option: G√©n√©rer avec IA (GPT)</li>
                <li>Valider et publier (<code>status="active"</code>)</li>
            </ul>

            <!-- 9.5 Connexion WebSocket et WebRTC -->
            <h2>9.5 Connexion WebSocket et WebRTC</h2>

            <h3>Flux de Messages</h3>
            <div class="mermaid">
sequenceDiagram
    participant U as Utilisateur
    participant C as Client JS
    participant P as Flask Proxy
    participant A as Azure Voice Live

    U->>C: Clic D√©marrer
    C->>P: WS Connect /ws/avatar/agent_id
    P->>A: WS Connect Azure
    A-->>P: session.created
    P-->>C: session.ready

    C->>P: session.avatar.connect (SDP Offer)
    P->>A: Forward SDP
    A-->>P: SDP Answer + ICE Candidates
    P-->>C: WebRTC √©tabli (vid√©o)

    loop Conversation
        U->>C: Parle au micro
        C->>P: input_audio_buffer.append (PCM16)
        P->>A: Forward audio

        A-->>P: speech_started (VAD)
        P-->>C: user.speaking: true

        A-->>P: transcription.completed
        P-->>C: user.transcript

        A-->>P: response.audio.delta
        P-->>C: agent.transcript + audio
        Note over C: Avatar lip-sync via WebRTC
    end

    alt Barge-in (Interruption)
        U->>C: Parle pendant r√©ponse
        C->>P: interrupt
        P->>A: response.cancel
        Note over P: Throttle 500ms
    end

    U->>C: Clic Terminer
    C->>P: stop
    P->>A: WS Close
    P->>P: Sauvegarde Cosmos
            </div>

            <h3>Types de Messages WebSocket</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Message</th>
                            <th>Direction</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>session.ready</code></td>
                            <td>Server ‚Üí Client</td>
                            <td>Connexion WebSocket √©tablie</td>
                        </tr>
                        <tr>
                            <td><code>session.configured</code></td>
                            <td>Server ‚Üí Client</td>
                            <td>Configuration Azure valid√©e</td>
                        </tr>
                        <tr>
                            <td><code>session.avatar.connect</code></td>
                            <td>Client ‚Üí Server</td>
                            <td>SDP Offer WebRTC</td>
                        </tr>
                        <tr>
                            <td><code>session.avatar.connected</code></td>
                            <td>Server ‚Üí Client</td>
                            <td>WebRTC vid√©o √©tabli</td>
                        </tr>
                        <tr>
                            <td><code>input_audio_buffer.append</code></td>
                            <td>Client ‚Üí Server</td>
                            <td>Chunk audio PCM16</td>
                        </tr>
                        <tr>
                            <td><code>user.speaking</code></td>
                            <td>Server ‚Üí Client</td>
                            <td>√âtat parole utilisateur</td>
                        </tr>
                        <tr>
                            <td><code>user.transcript</code></td>
                            <td>Server ‚Üí Client</td>
                            <td>Transcription utilisateur</td>
                        </tr>
                        <tr>
                            <td><code>agent.speaking</code></td>
                            <td>Server ‚Üí Client</td>
                            <td>√âtat parole agent</td>
                        </tr>
                        <tr>
                            <td><code>agent.transcript</code></td>
                            <td>Server ‚Üí Client</td>
                            <td>Transcription agent (delta)</td>
                        </tr>
                        <tr>
                            <td><code>interrupt</code></td>
                            <td>Client ‚Üí Server</td>
                            <td>Demande d'interruption</td>
                        </tr>
                        <tr>
                            <td><code>ping/pong</code></td>
                            <td>Bidirectionnel</td>
                            <td>Keep-alive (15s client, 10s Azure)</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 9.6 Classe AvatarLiveSession -->
            <h2>9.6 Classe AvatarLiveSession</h2>

            <pre><code class="language-python"># Blueprints/avatar_live_proxy.py

class AvatarLiveSession:
    """G√®re une session avatar bidirectionnelle."""

    def __init__(self, agent_config: dict, client_ws, session_id: str):
        self.agent_config = agent_config
        self.client_ws = client_ws
        self.session_id = session_id
        self.azure_ws = None

        # √âtat de la session
        self.is_speaking = False           # Avatar en train de parler
        self.is_response_active = False    # R√©ponse en cours
        self.interruptions = 0             # Compteur barge-in
        self.tools_executed = 0            # Compteur tools

        # Transcriptions
        self.transcripts = []
        self.total_tokens = {"input": 0, "output": 0}

    async def connect_to_azure(self) -> bool:
        """Connexion √† Azure Voice Live API."""
        url = self._build_websocket_url()
        headers = {"api-key": self.speech_key}
        self.azure_ws = await websockets.connect(url, extra_headers=headers)
        return True

    async def send_session_update(self):
        """Envoie la configuration √† Azure."""
        # Normalise la config selon le type d'avatar
        if self._is_photo_avatar():
            self._normalize_photo_avatar_config()
        else:
            self._normalize_video_avatar_config()

        await self.azure_ws.send(json.dumps({
            'type': 'session.update',
            'session': self.cached_azure_config
        }))

    async def handle_azure_message(self, message: dict):
        """Traite les messages Azure."""
        msg_type = message.get('type')

        if msg_type == 'response.function_call_arguments.done':
            # Ex√©cuter le tool
            result = await self._execute_tool(
                message.get('call_id'),
                message.get('name'),
                message.get('arguments')
            )
            # Renvoyer le r√©sultat
            await self._submit_tool_result(message.get('call_id'), result)

        elif msg_type == 'response.done':
            # Capturer les tokens
            usage = message.get('response', {}).get('usage', {})
            self.total_tokens['input'] += usage.get('input_tokens', 0)
            self.total_tokens['output'] += usage.get('output_tokens', 0)

    async def handle_barge_in(self):
        """G√®re l'interruption utilisateur."""
        if self.is_speaking and self.is_response_active:
            self.interruptions += 1
            await self.azure_ws.send(json.dumps({'type': 'response.cancel'}))
            self.is_speaking = False
            self.is_response_active = False</code></pre>

            <!-- 9.7 Configuration Azure Compl√®te -->
            <h2>9.7 Configuration Azure Compl√®te</h2>

            <pre><code class="language-json">{
    "modalities": ["text", "audio"],
    "input_audio_format": "pcm16",
    "output_audio_format": "pcm16",
    "input_audio_sampling_rate": 24000,
    "output_audio_timestamp_types": ["word"],

    "input_audio_echo_cancellation": {
        "type": "server_echo_cancellation"
    },
    "input_audio_noise_reduction": {
        "type": "azure_deep_noise_suppression"
    },

    "voice": {
        "name": "fr-FR-DeniseNeural",
        "type": "azure-standard",
        "temperature": 0.8,
        "rate": "1.0"
    },

    "avatar": {
        "character": "lisa",
        "style": "casual-sitting",
        "video": {
            "resolution": {"width": 1920, "height": 1080},
            "bitrate": 2000000,
            "crop": {"top_left": [560, 0], "bottom_right": [1360, 1080]},
            "background": {"color": "#FFFFFF"}
        },
        "ice_servers": [
            {"urls": ["stun:stun.l.google.com:19302"]}
        ]
    },

    "turn_detection": {
        "type": "azure_semantic_vad_multilingual",
        "threshold": 0.5,
        "silence_duration_ms": 500,
        "speech_duration_ms": 150,
        "create_response": true,
        "interrupt_response": true,
        "end_of_utterance_detection": {
            "model": "semantic_detection_v1_multilingual",
            "threshold_level": "low"
        }
    },

    "input_audio_transcription": {
        "model": "whisper-1",
        "language": "fr-FR"
    },

    "tools": [...],
    "instructions": "Tu es Sophie, assistante virtuelle..."
}</code></pre>

            <!-- 9.8 Gestion des Sessions -->
            <h2>9.8 Gestion des Sessions</h2>

            <h3>Sch√©ma de Session Cosmos DB</h3>
            <pre><code class="language-json">{
    "id": "session_uuid",
    "call_id": "call_uuid",
    "agent_id": "agent_uuid",
    "agent_type": "Agent Avatar",
    "model_id": "gpt-realtime-preview",
    "status": "completed",

    "created_at": "2025-12-30T10:00:00Z",
    "updated_at": "2025-12-30T10:05:30Z",

    "history": [
        {"role": "user", "content": "Bonjour", "timestamp": "..."},
        {"role": "assistant", "content": "Bonjour !", "timestamp": "..."}
    ],

    "usage": {
        "input_tokens": 250,
        "output_tokens": 450,
        "total_tokens": 700
    },

    "metrics": {
        "duration_seconds": 330,
        "interruptions": 2,
        "tools_executed": 1,
        "final_transcript_count": 6
    }
}</code></pre>

            <!-- 9.9 Timeouts et Keep-Alive -->
            <h2>9.9 Timeouts et Keep-Alive</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Param√®tre</th>
                            <th>Valeur</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>AZURE_CONNECT_TIMEOUT</td>
                            <td>12s</td>
                            <td>Timeout connexion initiale Azure</td>
                        </tr>
                        <tr>
                            <td>PING_INTERVAL</td>
                            <td>15s</td>
                            <td>Keep-alive client ‚Üí server</td>
                        </tr>
                        <tr>
                            <td>AZURE_PING_INTERVAL</td>
                            <td>10s</td>
                            <td>Keep-alive server ‚Üí Azure</td>
                        </tr>
                        <tr>
                            <td>INACTIVITY_TIMEOUT</td>
                            <td>180s</td>
                            <td>Fermeture auto si silence</td>
                        </tr>
                        <tr>
                            <td>INACTIVITY_CHECK_INTERVAL</td>
                            <td>30s</td>
                            <td>Fr√©quence v√©rification inactivit√©</td>
                        </tr>
                        <tr>
                            <td>SAMPLE_RATE</td>
                            <td>24000 Hz</td>
                            <td>Fr√©quence audio PCM16</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 9.10 Variables d'Environnement -->
            <h2>9.10 Variables d'Environnement</h2>

            <pre><code class="language-bash"># Azure Voice Live (Avatar)
VOICE_LIVE_ENDPOINT=https://westus2.api.cognitive.microsoft.com/
VOICE_LIVE_KEY=&lt;api-key&gt;
VOICE_LIVE_REGION=westus2

# Azure OpenAI
AZURE_OPENAI_ENDPOINT=https://...
AZURE_OPENAI_KEY=&lt;key&gt;

# Cosmos DB
COSMOS_URI=https://...
COSMOS_KEY=&lt;key&gt;
COSMOS_DATABASE_NAME=ConversationsDB</code></pre>

        </section>

        <!-- ==========================================
             CHAPITRE 10: INT√âGRATION
             ========================================== -->
        <section id="integration" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-code-slash"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 10: Int√©gration</h1>
                    <p class="section-subtitle">Embedding sur vos sites</p>
                </div>
            </div>

            <h2>10.1 iframe</h2>
            <pre><code>&lt;iframe src="https://wakavoice.com/embed/agent/{id}" allow="microphone"&gt;&lt;/iframe&gt;</code></pre>

            <h2>10.2 Widget JavaScript</h2>
            <pre><code>&lt;script src="https://wakavoice.com/widget.js"&gt;&lt;/script&gt;
&lt;script&gt;WakaVoice.init({agentId: 'xxx', position: 'bottom-right'});&lt;/script&gt;</code></pre>

        </section>

        <!-- ==========================================
             CHAPITRE 11: CAPACIT√â & SCALABILIT√â
             ========================================== -->
        <section id="capacity-scalability" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-diagram-3"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 11: Capacit√© & Scalabilit√©</h1>
                    <p class="section-subtitle">Sessions simultan√©es, projections de volume et configuration Azure</p>
                </div>
            </div>

            <div class="intro-text">
                Ce chapitre d√©taille la <strong>capacit√© de traitement</strong> de la plateforme Waka Voice,
                avec des projections concr√®tes du nombre de transactions traitables selon diff√©rents sc√©narios
                d'utilisation (8h/jour ou 24h/jour) et par canal de communication.
            </div>

            <!-- ================================================
                 11.1 CONFIGURATION AZURE WEB APP
                 ================================================ -->
            <h2>11.1 Configuration Azure Web App</h2>

            <div class="callout callout-info">
                <i class="bi bi-cloud callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Auto-configuration des sessions</div>
                    <p>
                        L'application Azure Web App est configur√©e avec un param√®tre <strong>MAX_SESSION = 30%</strong>
                        de la capacit√© totale, auto-configurable. Par d√©faut, cette valeur est fix√©e √† <strong>1 session</strong>
                        pour les environnements de d√©veloppement.
                    </p>
                </div>
            </div>

            <div style="background: white; border: 1px solid #ddd; border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #4A148C; margin-bottom: 15px;"><i class="bi bi-gear"></i> Param√®tres de configuration</h4>

                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr><th>Param√®tre</th><th>Valeur par d√©faut</th><th>Description</th><th>Impact</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><code>MAX_SESSION_PERCENTAGE</code></td>
                                <td><strong>30%</strong></td>
                                <td>Pourcentage de la capacit√© CPU/RAM utilisable pour les sessions</td>
                                <td>√âvite la surcharge du serveur</td>
                            </tr>
                            <tr>
                                <td><code>DEFAULT_MAX_SESSIONS</code></td>
                                <td><strong>1</strong></td>
                                <td>Nombre de sessions simultan√©es par d√©faut (dev/test)</td>
                                <td>Limite les co√ªts en environnement de test</td>
                            </tr>
                            <tr>
                                <td><code>AUTO_SCALE_ENABLED</code></td>
                                <td><strong>true</strong></td>
                                <td>Active l'auto-scaling bas√© sur la charge</td>
                                <td>Ajuste automatiquement la capacit√©</td>
                            </tr>
                            <tr>
                                <td><code>SESSION_TIMEOUT</code></td>
                                <td><strong>90 sec</strong></td>
                                <td>Timeout d'inactivit√© avant fermeture automatique</td>
                                <td>Lib√®re les ressources inutilis√©es</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="callout callout-warning">
                <i class="bi bi-exclamation-triangle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Impact sur les ressources</div>
                    <p>
                        Chaque session active consomme des ressources Azure (CPU, RAM, bande passante, tokens OpenAI).
                        Le param√®tre <strong>30%</strong> permet de maintenir une marge de s√©curit√© pour √©viter les d√©passements
                        de quota et garantir la stabilit√© du service.
                    </p>
                </div>
            </div>

            <!-- ================================================
                 11.2 SESSIONS SIMULTAN√âES PAR CANAL
                 ================================================ -->
            <h2>11.2 Sessions Simultan√©es par Canal</h2>

            <p>Chaque type de canal a des caract√©ristiques de consommation diff√©rentes :</p>

            <div class="mermaid">
flowchart LR
    subgraph VOICE["üéôÔ∏è Agents Voix"]
        V1[Sessions max: 500]
        V2[RAM/session: 50 MB]
        V3[Dur√©e moy: 3 min]
    end

    subgraph TEXT["üí¨ Agents Texte"]
        T1[Sessions max: 1000]
        T2[RAM/session: 10 MB]
        T3[Dur√©e moy: 5 min]
    end

    subgraph AVATAR["üé≠ Agents Avatar"]
        A1[Sessions max: 200]
        A2[RAM/session: 150 MB]
        A3[Dur√©e moy: 2 min]
    end

    style VOICE fill:#E3F2FD,stroke:#1565C0
    style TEXT fill:#E8F5E9,stroke:#2E7D32
    style AVATAR fill:#F3E5F5,stroke:#7B1FA2
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Canal</th>
                            <th>Sessions Simultan√©es Max</th>
                            <th>RAM par Session</th>
                            <th>CPU par Session</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong><i class="bi bi-mic-fill"></i> Voix</strong></td>
                            <td>500</td>
                            <td>50 MB</td>
                            <td>0.1 vCPU</td>
                        </tr>
                        <tr>
                            <td><strong><i class="bi bi-chat-dots-fill"></i> Texte (Chat)</strong></td>
                            <td>1 000</td>
                            <td>10 MB</td>
                            <td>0.02 vCPU</td>
                        </tr>
                        <tr>
                            <td><strong><i class="bi bi-person-video"></i> Avatar Vid√©o</strong></td>
                            <td>200</td>
                            <td>150 MB</td>
                            <td>0.3 vCPU</td>
                        </tr>
                        <tr>
                            <td><strong><i class="bi bi-telephone-fill"></i> Phone (SIP)</strong></td>
                            <td>300</td>
                            <td>40 MB</td>
                            <td>0.08 vCPU</td>
                        </tr>
                        <tr>
                            <td><strong><i class="bi bi-whatsapp"></i> WhatsApp</strong></td>
                            <td>800</td>
                            <td>15 MB</td>
                            <td>0.03 vCPU</td>
                        </tr>
                        <tr>
                            <td><strong><i class="bi bi-chat-square-text"></i> SMS</strong></td>
                            <td>1 500</td>
                            <td>5 MB</td>
                            <td>0.01 vCPU</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 11.3 PROJECTION 8H/JOUR (HORAIRES BUREAU)
                 ================================================ -->
            <h2>11.3 Projection 8h/jour (Horaires Bureau)</h2>

            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #1565C0; margin-bottom: 15px;"><i class="bi bi-clock"></i> Sc√©nario : Utilisation en heures ouvr√©es (9h-17h)</h4>
                <p style="color: #333;">
                    Ce sc√©nario correspond √† une utilisation typique en entreprise, avec des agents disponibles
                    pendant les heures de bureau uniquement.
                </p>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Canal</th>
                            <th>Sessions/heure</th>
                            <th>Dur√©e moy.</th>
                            <th>Transactions/jour (8h)</th>
                            <th>Transactions/mois (22j)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E3F2FD;">
                            <td><strong><i class="bi bi-mic-fill"></i> Voix</strong></td>
                            <td>100</td>
                            <td>3 min</td>
                            <td><strong>800</strong></td>
                            <td><strong>17 600</strong></td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong><i class="bi bi-chat-dots-fill"></i> Texte</strong></td>
                            <td>200</td>
                            <td>5 min</td>
                            <td><strong>1 600</strong></td>
                            <td><strong>35 200</strong></td>
                        </tr>
                        <tr style="background: #F3E5F5;">
                            <td><strong><i class="bi bi-person-video"></i> Avatar</strong></td>
                            <td>60</td>
                            <td>2 min</td>
                            <td><strong>480</strong></td>
                            <td><strong>10 560</strong></td>
                        </tr>
                        <tr style="background: #FFF3E0;">
                            <td><strong><i class="bi bi-telephone-fill"></i> Phone</strong></td>
                            <td>80</td>
                            <td>4 min</td>
                            <td><strong>640</strong></td>
                            <td><strong>14 080</strong></td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong><i class="bi bi-whatsapp"></i> WhatsApp</strong></td>
                            <td>150</td>
                            <td>3 min</td>
                            <td><strong>1 200</strong></td>
                            <td><strong>26 400</strong></td>
                        </tr>
                        <tr style="background: #FCE4EC;">
                            <td><strong><i class="bi bi-chat-square-text"></i> SMS</strong></td>
                            <td>300</td>
                            <td>1 min</td>
                            <td><strong>2 400</strong></td>
                            <td><strong>52 800</strong></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr style="background: #4A148C; color: white; font-weight: bold;">
                            <td>TOTAL</td>
                            <td>890/h</td>
                            <td>-</td>
                            <td>7 120/jour</td>
                            <td>156 640/mois</td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="mermaid">
pie showData
    title "R√©partition Transactions/Jour (8h)"
    "SMS" : 2400
    "Texte" : 1600
    "WhatsApp" : 1200
    "Voix" : 800
    "Phone" : 640
    "Avatar" : 480
            </div>

            <!-- ================================================
                 11.4 PROJECTION 24H/JOUR (SIMULATION)
                 ================================================ -->
            <h2>11.4 Projection 24h/jour (Simulation Maximale)</h2>

            <div style="background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #E65100; margin-bottom: 15px;"><i class="bi bi-clock-history"></i> Sc√©nario : Utilisation 24/7</h4>
                <p style="color: #333;">
                    Ce sc√©nario simule une utilisation continue, typique pour les services clients internationaux
                    ou les chatbots disponibles en permanence. Les pics de charge sont liss√©s sur 24 heures.
                </p>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Canal</th>
                            <th>Sessions/heure (moy.)</th>
                            <th>Dur√©e moy.</th>
                            <th>Transactions/jour (24h)</th>
                            <th>Transactions/mois (30j)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E3F2FD;">
                            <td><strong><i class="bi bi-mic-fill"></i> Voix</strong></td>
                            <td>80</td>
                            <td>3 min</td>
                            <td><strong>1 920</strong></td>
                            <td><strong>57 600</strong></td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong><i class="bi bi-chat-dots-fill"></i> Texte</strong></td>
                            <td>180</td>
                            <td>5 min</td>
                            <td><strong>4 320</strong></td>
                            <td><strong>129 600</strong></td>
                        </tr>
                        <tr style="background: #F3E5F5;">
                            <td><strong><i class="bi bi-person-video"></i> Avatar</strong></td>
                            <td>40</td>
                            <td>2 min</td>
                            <td><strong>960</strong></td>
                            <td><strong>28 800</strong></td>
                        </tr>
                        <tr style="background: #FFF3E0;">
                            <td><strong><i class="bi bi-telephone-fill"></i> Phone</strong></td>
                            <td>60</td>
                            <td>4 min</td>
                            <td><strong>1 440</strong></td>
                            <td><strong>43 200</strong></td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong><i class="bi bi-whatsapp"></i> WhatsApp</strong></td>
                            <td>120</td>
                            <td>3 min</td>
                            <td><strong>2 880</strong></td>
                            <td><strong>86 400</strong></td>
                        </tr>
                        <tr style="background: #FCE4EC;">
                            <td><strong><i class="bi bi-chat-square-text"></i> SMS</strong></td>
                            <td>250</td>
                            <td>1 min</td>
                            <td><strong>6 000</strong></td>
                            <td><strong>180 000</strong></td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr style="background: #E65100; color: white; font-weight: bold;">
                            <td>TOTAL</td>
                            <td>730/h</td>
                            <td>-</td>
                            <td>17 520/jour</td>
                            <td>525 600/mois</td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="mermaid">
xychart-beta
    title "Transactions Mensuelles par Canal (24h/7j)"
    x-axis ["SMS", "Texte", "WhatsApp", "Voix", "Phone", "Avatar"]
    y-axis "Transactions (milliers)" 0 --> 200
    bar [180, 129.6, 86.4, 57.6, 43.2, 28.8]
            </div>

            <!-- ================================================
                 11.5 IMPACT DU PARAM√àTRE MAX_SESSION
                 ================================================ -->
            <h2>11.5 Impact du Param√®tre MAX_SESSION</h2>

            <p>Le param√®tre <code>MAX_SESSION_PERCENTAGE</code> impacte directement la capacit√© :</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>MAX_SESSION %</th>
                            <th>Sessions Voix Max</th>
                            <th>Sessions Texte Max</th>
                            <th>Recommandation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>10%</strong></td>
                            <td>50</td>
                            <td>100</td>
                            <td>Dev / Tests</td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong>30%</strong> (d√©faut)</td>
                            <td>150</td>
                            <td>300</td>
                            <td>Production standard</td>
                        </tr>
                        <tr>
                            <td><strong>50%</strong></td>
                            <td>250</td>
                            <td>500</td>
                            <td>Charge moyenne</td>
                        </tr>
                        <tr>
                            <td><strong>70%</strong></td>
                            <td>350</td>
                            <td>700</td>
                            <td>Charge √©lev√©e</td>
                        </tr>
                        <tr style="background: #FFEBEE;">
                            <td><strong>90%</strong></td>
                            <td>450</td>
                            <td>900</td>
                            <td>Risque de surcharge</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="callout callout-success">
                <i class="bi bi-shield-check callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Recommandation</div>
                    <p>
                        Conservez le param√®tre √† <strong>30%</strong> pour garantir une marge de s√©curit√©.
                        Cette configuration permet de g√©rer les pics de charge impr√©vus sans d√©grader l'exp√©rience utilisateur.
                        Augmentez progressivement si les m√©triques de monitoring montrent une utilisation stable.
                    </p>
                </div>
            </div>

        </section>

        <!-- ==========================================
             CHAPITRE 12: MANUEL UTILISATEUR
             ========================================== -->
        <section id="user-manual" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-book"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 12: Manuel Utilisateur</h1>
                    <p class="section-subtitle">Guide pratique pas-√†-pas pour utiliser Waka Voice</p>
                </div>
            </div>

            <div class="intro-text">
                Bienvenue dans le manuel utilisateur de Waka Voice ! Ce guide vous accompagne √©cran par √©cran
                pour ma√Ætriser toutes les fonctionnalit√©s de la plateforme. Pour chaque √©cran, vous trouverez :
                une <strong>description visuelle</strong> de l'interface, la <strong>localisation de chaque √©l√©ment</strong>,
                et des <strong>instructions pas-√†-pas</strong> pour chaque action possible.
            </div>

            <!-- ================================================================
                 COMMENT NAVIGUER DANS L'APPLICATION
                 ================================================================ -->
            <h2>12.1 Comment naviguer dans l'application</h2>

            <div style="background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #2E7D32; margin-bottom: 15px;"><i class="bi bi-compass"></i> La barre de navigation</h4>
                <p style="color: #333;">
                    En haut de chaque page, vous voyez une <strong>barre violette</strong> qui reste toujours visible.
                    C'est votre menu principal pour acc√©der √† toutes les fonctionnalit√©s.
                </p>

                <div style="background: white; border-radius: 10px; padding: 20px; margin-top: 15px;">
                    <p style="margin: 0 0 10px 0; color: #333;"><strong>De gauche √† droite, vous trouverez :</strong></p>
                    <ul style="color: #333; margin: 0; padding-left: 20px;">
                        <li><strong>Logo Waka Voice</strong> (tout √† gauche) : Cliquez dessus pour revenir √† l'accueil √† tout moment</li>
                        <li><strong>Accueil</strong> : Votre tableau de bord avec les statistiques</li>
                        <li><strong>Waka AXIOM</strong> : Pour g√©rer vos documents et votre base de connaissances</li>
                        <li><strong>Cr√©ation</strong> : Pour cr√©er de nouveaux agents, voix ou outils</li>
                        <li><strong>Galeries</strong> : Pour voir et g√©rer tout ce que vous avez cr√©√©</li>
                        <li><strong>Dashboards</strong> : Pour consulter les rapports et statistiques d√©taill√©es</li>
                        <li><strong>FR/EN/ES</strong> (√† droite) : Pour changer la langue de l'interface</li>
                    </ul>
                </div>
            </div>

            <div class="callout callout-info">
                <i class="bi bi-lightbulb callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Astuce de navigation</div>
                    <p>
                        Passez votre souris sur un menu pour voir les sous-menus disponibles.
                        Un petit triangle √† c√¥t√© du nom indique qu'il y a des options √† l'int√©rieur.
                    </p>
                </div>
            </div>

            <!-- ================================================================
                 √âCRAN 1 : ACCUEIL - DASHBOARD PRINCIPAL
                 ================================================================ -->
            <h2>12.2 √âcran "Accueil" - Le tableau de bord</h2>

            <div style="background: #f8f9fa; border-left: 4px solid #4A148C; padding: 20px; margin: 20px 0; border-radius: 0 10px 10px 0;">
                <p style="margin: 0; color: #333;"><strong>Pour y acc√©der :</strong> Cliquez sur "Accueil" dans le menu, ou cliquez sur le logo Waka Voice</p>
            </div>

            <h3><i class="bi bi-eye"></i> Description de l'√©cran</h3>

            <p>L'√©cran d'accueil est votre <strong>tableau de bord central</strong>. Il vous montre en un coup d'≈ìil tout ce qui se passe sur votre plateforme : combien de conversations sont en cours, combien d'argent vous avez g√©n√©r√©, et comment se portent vos agents.</p>

            <h4>Ce que vous voyez sur cet √©cran :</h4>

            <div style="background: white; border: 1px solid #ddd; border-radius: 15px; padding: 25px; margin: 20px 0;">
                <p><strong>En haut de la page :</strong></p>
                <ul style="color: #333;">
                    <li><strong>Titre "Dashboard"</strong> avec la date du jour</li>
                    <li><strong>Bouton "Rafra√Æchir"</strong> (ic√¥ne de fl√®che circulaire, en haut √† droite) : pour actualiser les chiffres</li>
                    <li><strong>Bouton "Configurer taux"</strong> : pour d√©finir votre tarif de facturation par minute</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Au centre - Les cartes de statistiques :</strong></p>
                <p style="color: #666;">Vous voyez plusieurs <strong>cartes rectangulaires</strong> dispos√©es en grille. Chaque carte affiche une cat√©gorie de donn√©es :</p>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div style="background: #E3F2FD; padding: 15px; border-radius: 10px;">
                        <strong style="color: #1565C0;">Carte "Conversations"</strong>
                        <p style="font-size: 0.9rem; margin: 10px 0 0 0; color: #333;">Affiche le nombre total de conversations et celles en cours actuellement</p>
                    </div>
                    <div style="background: #E8F5E9; padding: 15px; border-radius: 10px;">
                        <strong style="color: #2E7D32;">Carte "Business"</strong>
                        <p style="font-size: 0.9rem; margin: 10px 0 0 0; color: #333;">Montre les revenus g√©n√©r√©s, les co√ªts et votre marge b√©n√©ficiaire</p>
                    </div>
                    <div style="background: #FFF3E0; padding: 15px; border-radius: 10px;">
                        <strong style="color: #E65100;">Carte "Tokens"</strong>
                        <p style="font-size: 0.9rem; margin: 10px 0 0 0; color: #333;">Indique la consommation de ressources IA (entr√©e/sortie, texte/audio)</p>
                    </div>
                    <div style="background: #FCE4EC; padding: 15px; border-radius: 10px;">
                        <strong style="color: #C2185B;">Carte "Sentiment"</strong>
                        <p style="font-size: 0.9rem; margin: 10px 0 0 0; color: #333;">Analyse l'humeur des conversations : positif, neutre ou n√©gatif</p>
                    </div>
                    <div style="background: #F3E5F5; padding: 15px; border-radius: 10px;">
                        <strong style="color: #7B1FA2;">Carte "Dur√©e"</strong>
                        <p style="font-size: 0.9rem; margin: 10px 0 0 0; color: #333;">Statistiques sur la dur√©e des appels (moyenne, minimum, maximum)</p>
                    </div>
                </div>

                <p style="margin-top: 20px;"><strong>Les petits graphiques (Sparklines) :</strong></p>
                <p style="color: #666;">Dans certaines cartes, vous voyez de petites courbes qui montrent l'√©volution sur les 15 derni√®res minutes.</p>
            </div>

            <h3><i class="bi bi-list-check"></i> Fonctionnalit√©s pas-√†-pas</h3>

            <!-- Fonctionnalit√© 1 : Consulter les statistiques -->
            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #1565C0; margin-bottom: 15px;"><i class="bi bi-bar-chart"></i> Consulter vos statistiques</h4>

                <p style="color: #333;"><strong>Objectif :</strong> Voir rapidement comment se porte votre activit√©</p>

                <ol style="color: #333; line-height: 2;">
                    <li>Ouvrez la page d'accueil (cliquez sur "Accueil" ou le logo)</li>
                    <li>Regardez les cartes affich√©es au centre de l'√©cran</li>
                    <li>Chaque carte montre une cat√©gorie diff√©rente :
                        <ul>
                            <li>Les <strong>gros chiffres</strong> sont les valeurs actuelles</li>
                            <li>Les <strong>petites courbes</strong> montrent la tendance r√©cente</li>
                            <li>Les <strong>fl√®ches vertes/rouges</strong> indiquent si √ßa monte ou descend</li>
                        </ul>
                    </li>
                    <li>Pour avoir les donn√©es les plus r√©centes, cliquez sur le bouton <strong>"Rafra√Æchir"</strong> en haut √† droite</li>
                </ol>
            </div>

            <!-- Fonctionnalit√© 2 : Configurer le taux -->
            <div style="background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #E65100; margin-bottom: 15px;"><i class="bi bi-currency-euro"></i> Configurer votre taux de facturation</h4>

                <p style="color: #333;"><strong>Objectif :</strong> D√©finir combien vous facturez par minute de conversation</p>

                <ol style="color: #333; line-height: 2;">
                    <li>Sur la page d'accueil, rep√©rez le bouton <strong>"Configurer taux"</strong> en haut de la page</li>
                    <li>Cliquez dessus : une petite fen√™tre (popup) s'ouvre</li>
                    <li>Dans le champ de saisie, entrez votre tarif en euros par minute (exemple : 0.50 pour 50 centimes)</li>
                    <li>Cliquez sur <strong>"Enregistrer"</strong> pour valider</li>
                    <li>Les calculs de revenus se mettront √† jour automatiquement avec votre nouveau tarif</li>
                </ol>

                <div class="callout callout-warning" style="margin-top: 15px;">
                    <i class="bi bi-exclamation-triangle callout-icon"></i>
                    <div class="callout-content">
                        <div class="callout-title">Attention</div>
                        <p>Si vous ne configurez pas de taux, les revenus afficheront 0‚Ç¨ m√™me si vous avez des conversations.</p>
                    </div>
                </div>
            </div>

            <h3><i class="bi bi-exclamation-circle"></i> En cas de probl√®me</h3>

            <div style="background: #fff; border-radius: 15px; padding: 25px; margin: 20px 0; border: 1px solid #ddd;">
                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Les chiffres affichent tous 0</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Aucune conversation n'a encore eu lieu, ou aucun agent n'est actif.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Cr√©ez un agent (voir section Cr√©ation) et testez-le pour g√©n√©rer des donn√©es.</p>
                </div>

                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Les donn√©es ne se mettent pas √† jour</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Le navigateur utilise peut-√™tre d'anciennes donn√©es en cache.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Cliquez sur le bouton "Rafra√Æchir", ou appuyez sur F5 sur votre clavier.</p>
                </div>

                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Message d'erreur "Impossible de charger les donn√©es"</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> La connexion avec la base de donn√©es a √©chou√©.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Attendez quelques secondes et rafra√Æchissez la page. Si le probl√®me persiste, contactez le support technique.</p>
                </div>

                <div>
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Les petits graphiques sont vides</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Il n'y a pas encore 15 minutes de donn√©es collect√©es.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> C'est normal au d√©but. Les graphiques se rempliront au fil du temps.</p>
                </div>
            </div>

            <div class="callout callout-success">
                <i class="bi bi-shield-check callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Bonnes pratiques</div>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li>Consultez le dashboard chaque matin pour avoir une vue d'ensemble de votre activit√©</li>
                        <li>Configurez votre taux de facturation d√®s le premier jour pour avoir des revenus corrects</li>
                        <li>Si vous voyez des sentiments n√©gatifs augmenter, v√©rifiez les instructions de vos agents</li>
                    </ul>
                </div>
            </div>

            <!-- ================================================================
                 √âCRAN 2 : WAKA AXIOM - UPLOAD DE DOCUMENTS
                 ================================================================ -->
            <h2>12.3 √âcran "Upload de Documents" (Waka AXIOM)</h2>

            <div style="background: #f8f9fa; border-left: 4px solid #4A148C; padding: 20px; margin: 20px 0; border-radius: 0 10px 10px 0;">
                <p style="margin: 0; color: #333;"><strong>Pour y acc√©der :</strong> Menu "Waka AXIOM" ‚Üí "Ajouter Documents"</p>
            </div>

            <h3><i class="bi bi-eye"></i> Description de l'√©cran</h3>

            <p>Cet √©cran vous permet d'<strong>ajouter des documents</strong> √† votre base de connaissances. Ces documents seront ensuite utilis√©s par vos agents pour r√©pondre aux questions des utilisateurs en s'appuyant sur leur contenu.</p>

            <h4>Ce que vous voyez sur cet √©cran :</h4>

            <div style="background: white; border: 1px solid #ddd; border-radius: 15px; padding: 25px; margin: 20px 0;">
                <p><strong>En haut de la page :</strong></p>
                <ul style="color: #333;">
                    <li><strong>Titre "Ajouter des documents"</strong> avec une ic√¥ne de t√©l√©chargement</li>
                    <li><strong>S√©lecteur de projet</strong> (menu d√©roulant) : permet de choisir dans quel projet stocker les documents</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Au centre - La zone de t√©l√©chargement :</strong></p>
                <p style="color: #666;">Vous voyez une grande <strong>zone rectangulaire avec une bordure en pointill√©s</strong>. C'est la zone o√π vous pouvez d√©poser vos fichiers.</p>
                <ul style="color: #333;">
                    <li>Une <strong>ic√¥ne de nuage</strong> au centre</li>
                    <li>Le texte <strong>"Glissez-d√©posez vos fichiers ici"</strong></li>
                    <li>Un bouton <strong>"Parcourir"</strong> pour s√©lectionner des fichiers manuellement</li>
                    <li>La liste des <strong>formats accept√©s</strong> : PDF, DOCX, TXT, XLSX, PPTX, HTML, MD</li>
                </ul>

                <p style="margin-top: 20px;"><strong>En dessous - La liste des fichiers :</strong></p>
                <p style="color: #666;">Une fois des fichiers ajout√©s, ils apparaissent dans une liste avec :</p>
                <ul style="color: #333;">
                    <li>Le <strong>nom du fichier</strong></li>
                    <li>Sa <strong>taille</strong> (en Ko ou Mo)</li>
                    <li>Une <strong>barre de progression</strong> pendant le t√©l√©chargement</li>
                    <li>Un <strong>bouton "X"</strong> pour retirer un fichier de la liste</li>
                </ul>

                <p style="margin-top: 20px;"><strong>En bas de la page :</strong></p>
                <ul style="color: #333;">
                    <li>Bouton <strong>"T√©l√©charger et indexer"</strong> : lance le traitement des fichiers</li>
                </ul>
            </div>

            <h3><i class="bi bi-list-check"></i> Fonctionnalit√©s pas-√†-pas</h3>

            <!-- Fonctionnalit√© 1 : Ajouter des documents par glisser-d√©poser -->
            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #1565C0; margin-bottom: 15px;"><i class="bi bi-upload"></i> Ajouter des documents (m√©thode glisser-d√©poser)</h4>

                <p style="color: #333;"><strong>Objectif :</strong> T√©l√©charger rapidement plusieurs fichiers en les faisant glisser</p>

                <ol style="color: #333; line-height: 2;">
                    <li>Ouvrez l'√©cran "Ajouter Documents" depuis le menu Waka AXIOM</li>
                    <li><strong>Choisissez le projet</strong> dans le menu d√©roulant en haut (si vous n'avez qu'un projet, il sera d√©j√† s√©lectionn√©)</li>
                    <li>Sur votre ordinateur, ouvrez le dossier contenant vos fichiers</li>
                    <li><strong>S√©lectionnez les fichiers</strong> que vous voulez ajouter (vous pouvez en s√©lectionner plusieurs en maintenant Ctrl enfonc√©)</li>
                    <li><strong>Faites-les glisser</strong> avec votre souris vers la zone en pointill√©s sur la page</li>
                    <li>La zone devient <strong>bleue/violette</strong> quand vous √™tes au-dessus : rel√¢chez les fichiers</li>
                    <li>Vos fichiers apparaissent dans la liste en dessous</li>
                    <li>V√©rifiez que tous les fichiers souhait√©s sont dans la liste</li>
                    <li>Cliquez sur le bouton <strong>"T√©l√©charger et indexer"</strong></li>
                    <li>Attendez que les barres de progression atteignent 100% pour chaque fichier</li>
                    <li>Un message <strong>"Indexation termin√©e"</strong> confirme que tout est pr√™t</li>
                </ol>
            </div>

            <!-- Fonctionnalit√© 2 : Ajouter via le bouton Parcourir -->
            <div style="background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #2E7D32; margin-bottom: 15px;"><i class="bi bi-folder2-open"></i> Ajouter des documents (m√©thode bouton Parcourir)</h4>

                <p style="color: #333;"><strong>Objectif :</strong> S√©lectionner des fichiers via l'explorateur de fichiers classique</p>

                <ol style="color: #333; line-height: 2;">
                    <li>Ouvrez l'√©cran "Ajouter Documents" depuis le menu Waka AXIOM</li>
                    <li><strong>Choisissez le projet</strong> dans le menu d√©roulant en haut</li>
                    <li>Cliquez sur le bouton <strong>"Parcourir"</strong> au centre de la zone en pointill√©s</li>
                    <li>Une fen√™tre de l'explorateur de fichiers s'ouvre</li>
                    <li>Naviguez jusqu'au dossier contenant vos fichiers</li>
                    <li><strong>S√©lectionnez les fichiers</strong> (Ctrl+clic pour en s√©lectionner plusieurs)</li>
                    <li>Cliquez sur <strong>"Ouvrir"</strong></li>
                    <li>Vos fichiers apparaissent dans la liste</li>
                    <li>Cliquez sur <strong>"T√©l√©charger et indexer"</strong></li>
                    <li>Patientez pendant le traitement</li>
                </ol>
            </div>

            <!-- Fonctionnalit√© 3 : Retirer un fichier de la liste -->
            <div style="background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #E65100; margin-bottom: 15px;"><i class="bi bi-x-circle"></i> Retirer un fichier avant l'envoi</h4>

                <p style="color: #333;"><strong>Objectif :</strong> Enlever un fichier que vous avez ajout√© par erreur</p>

                <ol style="color: #333; line-height: 2;">
                    <li>Rep√©rez le fichier √† retirer dans la liste</li>
                    <li>√Ä droite du nom du fichier, cliquez sur le <strong>bouton "X"</strong> (ou l'ic√¥ne poubelle)</li>
                    <li>Le fichier dispara√Æt de la liste</li>
                    <li>Vous pouvez maintenant continuer avec les autres fichiers</li>
                </ol>

                <p style="color: #666; margin-top: 15px; font-style: italic;">Note : Cette action est possible uniquement AVANT d'avoir cliqu√© sur "T√©l√©charger et indexer".</p>
            </div>

            <h3><i class="bi bi-exclamation-circle"></i> En cas de probl√®me</h3>

            <div style="background: #fff; border-radius: 15px; padding: 25px; margin: 20px 0; border: 1px solid #ddd;">
                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Le fichier est refus√© / "Format non support√©"</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Le type de fichier n'est pas accept√© (exemple : images, vid√©os, fichiers .zip).</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Convertissez votre document en PDF ou DOCX avant de le t√©l√©charger. Pour les tableaux, utilisez le format XLSX.</p>
                </div>

                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> "Fichier trop volumineux"</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Le fichier d√©passe la limite de 100 Mo.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> D√©coupez votre document en plusieurs parties plus petites, ou compressez les images √† l'int√©rieur du document.</p>
                </div>

                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> La barre de progression reste bloqu√©e</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Probl√®me de connexion internet ou surcharge temporaire du serveur.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Attendez quelques minutes. Si rien ne bouge, rafra√Æchissez la page (F5) et recommencez.</p>
                </div>

                <div>
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> "Aucun texte trouv√© dans le document"</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Votre PDF est probablement une image scann√©e, pas un document avec du vrai texte.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Utilisez un outil OCR (comme Adobe Acrobat) pour convertir l'image en texte, ou retapez le contenu dans un fichier Word.</p>
                </div>
            </div>

            <div class="callout callout-warning">
                <i class="bi bi-exclamation-triangle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">√Ä √©viter absolument</div>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li><strong>Ne fermez pas la page</strong> pendant que les fichiers se t√©l√©chargent - le processus serait interrompu</li>
                        <li><strong>Ne t√©l√©chargez pas des documents confidentiels</strong> contenant des donn√©es sensibles (num√©ros de carte bancaire, mots de passe, etc.)</li>
                        <li><strong>√âvitez les fichiers avec beaucoup d'images</strong> et peu de texte - l'agent ne pourra pas les exploiter efficacement</li>
                    </ul>
                </div>
            </div>

            <!-- ================================================================
                 √âCRAN 3 : WAKA AXIOM - CRAWLER WEB
                 ================================================================ -->
            <h2>12.4 √âcran "Crawler Web" (Waka AXIOM)</h2>

            <div style="background: #f8f9fa; border-left: 4px solid #4A148C; padding: 20px; margin: 20px 0; border-radius: 0 10px 10px 0;">
                <p style="margin: 0; color: #333;"><strong>Pour y acc√©der :</strong> Menu "Waka AXIOM" ‚Üí "Ajouter Sites Web"</p>
            </div>

            <h3><i class="bi bi-eye"></i> Description de l'√©cran</h3>

            <p>Cet √©cran vous permet d'<strong>indexer le contenu d'un site web</strong>. Le syst√®me va parcourir les pages du site et en extraire le texte pour que vos agents puissent r√©pondre √† des questions sur ce contenu.</p>

            <h4>Ce que vous voyez sur cet √©cran :</h4>

            <div style="background: white; border: 1px solid #ddd; border-radius: 15px; padding: 25px; margin: 20px 0;">
                <p><strong>En haut de la page :</strong></p>
                <ul style="color: #333;">
                    <li><strong>Titre "Ajouter un site web"</strong></li>
                    <li><strong>S√©lecteur de projet</strong> (menu d√©roulant) : choisir o√π stocker le contenu</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Le formulaire principal :</strong></p>
                <ul style="color: #333;">
                    <li><strong>Champ "URL de d√©part"</strong> : c'est ici que vous tapez l'adresse du site (exemple : https://www.monsite.fr)</li>
                    <li><strong>Curseur "Profondeur"</strong> : de 1 √† 5, d√©finit combien de niveaux de liens le syst√®me va suivre
                        <ul>
                            <li>Profondeur 1 : seulement la page indiqu√©e</li>
                            <li>Profondeur 2 : la page + les pages li√©es depuis cette page</li>
                            <li>Profondeur 3 et plus : on continue √† suivre les liens</li>
                        </ul>
                    </li>
                    <li><strong>Champ "Limite de pages"</strong> : nombre maximum de pages √† r√©cup√©rer (√©vite de t√©l√©charger un site entier de 10 000 pages)</li>
                    <li><strong>Champs "Inclure" et "Exclure"</strong> (optionnels) : pour filtrer certaines parties du site</li>
                </ul>

                <p style="margin-top: 20px;"><strong>En bas :</strong></p>
                <ul style="color: #333;">
                    <li>Bouton <strong>"Lancer le crawl"</strong> : d√©marre le processus</li>
                    <li>Une <strong>zone de progression</strong> appara√Æt pendant le crawl, montrant les pages trouv√©es</li>
                </ul>
            </div>

            <h3><i class="bi bi-list-check"></i> Fonctionnalit√©s pas-√†-pas</h3>

            <!-- Fonctionnalit√© 1 : Crawler un site simple -->
            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #1565C0; margin-bottom: 15px;"><i class="bi bi-globe"></i> Indexer un site web</h4>

                <p style="color: #333;"><strong>Objectif :</strong> R√©cup√©rer le contenu d'un site pour que votre agent puisse r√©pondre √† des questions dessus</p>

                <ol style="color: #333; line-height: 2;">
                    <li>Ouvrez l'√©cran "Ajouter Sites Web" depuis le menu Waka AXIOM</li>
                    <li><strong>S√©lectionnez votre projet</strong> dans le menu d√©roulant</li>
                    <li>Dans le champ "URL de d√©part", <strong>tapez l'adresse compl√®te du site</strong>
                        <ul>
                            <li>Exemple correct : <code>https://www.monentreprise.fr/faq</code></li>
                            <li>Exemple incorrect : <code>monentreprise.fr</code> (il manque le https://)</li>
                        </ul>
                    </li>
                    <li>Choisissez la <strong>profondeur de crawl</strong> :
                        <ul>
                            <li>Pour une seule page ou section : choisissez <strong>1 ou 2</strong></li>
                            <li>Pour un petit site (blog, FAQ) : choisissez <strong>3</strong></li>
                            <li>Pour un site complet : choisissez <strong>4 ou 5</strong></li>
                        </ul>
                    </li>
                    <li>D√©finissez une <strong>limite de pages</strong> raisonnable (commencez par 50-100)</li>
                    <li>Cliquez sur <strong>"Lancer le crawl"</strong></li>
                    <li>Observez la progression : le syst√®me affiche les pages qu'il trouve</li>
                    <li>Attendez le message <strong>"Crawl termin√©"</strong></li>
                    <li>Vos agents peuvent maintenant utiliser ce contenu !</li>
                </ol>
            </div>

            <h3><i class="bi bi-exclamation-circle"></i> En cas de probl√®me</h3>

            <div style="background: #fff; border-radius: 15px; padding: 25px; margin: 20px 0; border: 1px solid #ddd;">
                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Le crawl ne d√©marre pas ou s'arr√™te imm√©diatement</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Le site bloque peut-√™tre les robots (fichier robots.txt).</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Essayez avec une page sp√©cifique du site. Si √ßa ne fonctionne toujours pas, t√©l√©chargez manuellement le contenu en PDF.</p>
                </div>

                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Tr√®s peu de contenu r√©cup√©r√©</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Le site utilise peut-√™tre du JavaScript pour afficher son contenu (sites modernes type React, Vue).</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Le crawler ne peut pas ex√©cuter le JavaScript. Utilisez plut√¥t la m√©thode "Copier-coller" : copiez le texte du site et collez-le dans un document Word, puis t√©l√©chargez ce document.</p>
                </div>

                <div>
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Timeout / "Le site ne r√©pond pas"</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Le site est lent ou temporairement inaccessible.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> V√©rifiez que le site fonctionne dans votre navigateur. R√©essayez plus tard.</p>
                </div>
            </div>

            <!-- ================================================================
                 √âCRAN 4 : WAKA AXIOM - BASE DE CONNAISSANCES
                 ================================================================ -->
            <h2>12.5 √âcran "Base de Connaissances" (Waka AXIOM)</h2>

            <div style="background: #f8f9fa; border-left: 4px solid #4A148C; padding: 20px; margin: 20px 0; border-radius: 0 10px 10px 0;">
                <p style="margin: 0; color: #333;"><strong>Pour y acc√©der :</strong> Menu "Waka AXIOM" ‚Üí "Base de Connaissances"</p>
            </div>

            <h3><i class="bi bi-eye"></i> Description de l'√©cran</h3>

            <p>Cet √©cran vous montre <strong>tout le contenu que vous avez ajout√©</strong> (documents et sites web). Vous pouvez voir, rechercher et supprimer vos sources d'information.</p>

            <h4>Ce que vous voyez sur cet √©cran :</h4>

            <div style="background: white; border: 1px solid #ddd; border-radius: 15px; padding: 25px; margin: 20px 0;">
                <p><strong>En haut de la page :</strong></p>
                <ul style="color: #333;">
                    <li><strong>Titre "Base de Connaissances"</strong></li>
                    <li><strong>S√©lecteur de projet</strong> : pour voir les documents d'un projet sp√©cifique</li>
                    <li><strong>Barre de recherche</strong> : pour trouver un document par son nom</li>
                    <li><strong>Statistiques</strong> : nombre total de documents, de chunks (morceaux de texte), et taille totale</li>
                </ul>

                <p style="margin-top: 20px;"><strong>La liste des sources :</strong></p>
                <p style="color: #666;">Un tableau affiche toutes vos sources avec :</p>
                <ul style="color: #333;">
                    <li><strong>Ic√¥ne</strong> : indique le type (document, site web, SharePoint)</li>
                    <li><strong>Nom</strong> : le nom du fichier ou l'URL du site</li>
                    <li><strong>Date d'ajout</strong> : quand vous l'avez t√©l√©charg√©</li>
                    <li><strong>Taille</strong> : le nombre de "chunks" (morceaux de texte index√©s)</li>
                    <li><strong>Boutons d'action</strong> (√† droite de chaque ligne) :
                        <ul>
                            <li>Ic√¥ne <strong>≈ìil</strong> : voir les d√©tails</li>
                            <li>Ic√¥ne <strong>poubelle</strong> : supprimer</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <h3><i class="bi bi-list-check"></i> Fonctionnalit√©s pas-√†-pas</h3>

            <!-- Fonctionnalit√© 1 : Rechercher un document -->
            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #1565C0; margin-bottom: 15px;"><i class="bi bi-search"></i> Rechercher un document</h4>

                <ol style="color: #333; line-height: 2;">
                    <li>Rep√©rez la <strong>barre de recherche</strong> en haut de la liste</li>
                    <li>Tapez une partie du nom du document (exemple : "FAQ" ou "tarifs")</li>
                    <li>La liste se filtre automatiquement pour ne montrer que les documents correspondants</li>
                    <li>Pour effacer la recherche, supprimez le texte ou cliquez sur le X dans le champ</li>
                </ol>
            </div>

            <!-- Fonctionnalit√© 2 : Supprimer un document -->
            <div style="background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #C62828; margin-bottom: 15px;"><i class="bi bi-trash"></i> Supprimer un document</h4>

                <p style="color: #333;"><strong>Attention : Cette action est d√©finitive !</strong></p>

                <ol style="color: #333; line-height: 2;">
                    <li>Trouvez le document √† supprimer dans la liste</li>
                    <li>Cliquez sur l'ic√¥ne <strong>poubelle</strong> √† droite de la ligne</li>
                    <li>Une fen√™tre de confirmation appara√Æt : <strong>"√ätes-vous s√ªr ?"</strong></li>
                    <li>Lisez bien le message pour v√©rifier que c'est le bon document</li>
                    <li>Cliquez sur <strong>"Supprimer"</strong> pour confirmer, ou <strong>"Annuler"</strong> pour revenir</li>
                    <li>Le document dispara√Æt de la liste et de votre base de connaissances</li>
                </ol>

                <div class="callout callout-warning" style="margin-top: 15px;">
                    <i class="bi bi-exclamation-triangle callout-icon"></i>
                    <div class="callout-content">
                        <div class="callout-title">Important</div>
                        <p>Une fois supprim√©, le document ne peut pas √™tre r√©cup√©r√©. Vos agents ne pourront plus r√©pondre aux questions bas√©es sur ce contenu.</p>
                    </div>
                </div>
            </div>

            <!-- ================================================================
                 √âCRAN 5 : WAKA AXIOM - CHAT RAG
                 ================================================================ -->
            <h2>12.6 √âcran "Chat" (Waka AXIOM)</h2>

            <div style="background: #f8f9fa; border-left: 4px solid #4A148C; padding: 20px; margin: 20px 0; border-radius: 0 10px 10px 0;">
                <p style="margin: 0; color: #333;"><strong>Pour y acc√©der :</strong> Menu "Waka AXIOM" ‚Üí "Chat"</p>
            </div>

            <h3><i class="bi bi-eye"></i> Description de l'√©cran</h3>

            <p>C'est une <strong>interface de conversation textuelle</strong> qui r√©pond √† vos questions en utilisant votre base de connaissances. Pratique pour tester si vos documents sont bien index√©s ou pour trouver rapidement une information.</p>

            <h4>Ce que vous voyez sur cet √©cran :</h4>

            <div style="background: white; border: 1px solid #ddd; border-radius: 15px; padding: 25px; margin: 20px 0;">
                <p><strong>En haut :</strong></p>
                <ul style="color: #333;">
                    <li><strong>S√©lecteur de projet</strong> : choisir quelle base de connaissances interroger</li>
                    <li><strong>Bouton "Nouvelle conversation"</strong> : pour recommencer √† z√©ro</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Au centre - La zone de conversation :</strong></p>
                <ul style="color: #333;">
                    <li>Vos <strong>questions</strong> apparaissent √† droite (bulles color√©es)</li>
                    <li>Les <strong>r√©ponses</strong> de l'assistant apparaissent √† gauche (bulles blanches)</li>
                    <li>Sous chaque r√©ponse, vous pouvez voir les <strong>sources cit√©es</strong> (les documents utilis√©s pour r√©pondre)</li>
                </ul>

                <p style="margin-top: 20px;"><strong>En bas :</strong></p>
                <ul style="color: #333;">
                    <li>Un <strong>champ de saisie</strong> : c'est ici que vous tapez votre question</li>
                    <li>Un bouton <strong>"Envoyer"</strong> (ou appuyez sur Entr√©e)</li>
                    <li>Un bouton <strong>trombone</strong> : pour joindre un fichier √† analyser ponctuellement</li>
                </ul>
            </div>

            <h3><i class="bi bi-list-check"></i> Fonctionnalit√©s pas-√†-pas</h3>

            <!-- Fonctionnalit√© 1 : Poser une question -->
            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #1565C0; margin-bottom: 15px;"><i class="bi bi-chat-dots"></i> Poser une question sur vos documents</h4>

                <ol style="color: #333; line-height: 2;">
                    <li>Assurez-vous d'avoir <strong>s√©lectionn√© le bon projet</strong> en haut</li>
                    <li>Cliquez dans le <strong>champ de saisie</strong> en bas de l'√©cran</li>
                    <li>Tapez votre question en langage naturel
                        <ul>
                            <li>Exemple : "Quels sont les horaires d'ouverture ?"</li>
                            <li>Exemple : "Comment fonctionne la politique de retour ?"</li>
                        </ul>
                    </li>
                    <li>Appuyez sur <strong>Entr√©e</strong> ou cliquez sur le bouton <strong>Envoyer</strong></li>
                    <li>Patientez quelques secondes : la r√©ponse s'affiche mot par mot</li>
                    <li>Lisez la r√©ponse et v√©rifiez les <strong>sources cit√©es</strong> en dessous</li>
                    <li>Vous pouvez poser des questions de suivi dans la m√™me conversation</li>
                </ol>
            </div>

            <h3><i class="bi bi-exclamation-circle"></i> En cas de probl√®me</h3>

            <div style="background: #fff; border-radius: 15px; padding: 25px; margin: 20px 0; border: 1px solid #ddd;">
                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> L'assistant r√©pond "Je ne sais pas" ou donne une r√©ponse hors sujet</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> L'information n'est peut-√™tre pas dans vos documents, ou la question est formul√©e diff√©remment du contenu.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Reformulez votre question avec d'autres mots. V√©rifiez aussi que le document contenant l'information est bien index√© dans la Base de Connaissances.</p>
                </div>

                <div>
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Aucune source n'est cit√©e</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> La r√©ponse est peut-√™tre bas√©e sur les connaissances g√©n√©rales de l'IA, pas sur vos documents.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Posez une question plus sp√©cifique li√©e directement au contenu de vos documents.</p>
                </div>
            </div>

            <!-- ================================================================
                 √âCRAN 6 : CR√âATION D'UN AGENT
                 ================================================================ -->
            <h2>12.7 √âcran "Cr√©er un Agent"</h2>

            <div style="background: #f8f9fa; border-left: 4px solid #4A148C; padding: 20px; margin: 20px 0; border-radius: 0 10px 10px 0;">
                <p style="margin: 0; color: #333;"><strong>Pour y acc√©der :</strong> Menu "Cr√©ation" ‚Üí "Cr√©er un Agent"</p>
            </div>

            <h3><i class="bi bi-eye"></i> Description de l'√©cran</h3>

            <p>C'est l'√©cran le plus important ! Il vous guide en <strong>5 √©tapes</strong> pour cr√©er votre agent conversationnel. Un agent est un assistant virtuel qui pourra discuter avec vos utilisateurs par la voix, le texte ou via un avatar vid√©o.</p>

            <h4>Ce que vous voyez sur cet √©cran :</h4>

            <div style="background: white; border: 1px solid #ddd; border-radius: 15px; padding: 25px; margin: 20px 0;">
                <p><strong>En haut :</strong></p>
                <ul style="color: #333;">
                    <li>Une <strong>barre de progression</strong> avec 5 cercles num√©rot√©s : elle montre o√π vous en √™tes</li>
                    <li>Les √©tapes sont : 1. Mod√®le ‚Üí 2. Voix ‚Üí 3. Tools ‚Üí 4. Instructions ‚Üí 5. Publier</li>
                    <li>L'√©tape en cours est <strong>color√©e en violet</strong>, les √©tapes termin√©es ont une <strong>coche verte</strong></li>
                </ul>

                <p style="margin-top: 20px;"><strong>Au centre :</strong></p>
                <p style="color: #666;">Le contenu change selon l'√©tape. Vous avez toujours des formulaires ou des s√©lections √† faire.</p>

                <p style="margin-top: 20px;"><strong>En bas :</strong></p>
                <ul style="color: #333;">
                    <li>Bouton <strong>"Pr√©c√©dent"</strong> : pour revenir √† l'√©tape d'avant</li>
                    <li>Bouton <strong>"Suivant"</strong> : pour passer √† l'√©tape suivante</li>
                    <li>√Ä la derni√®re √©tape : bouton <strong>"Publier l'agent"</strong></li>
                </ul>
            </div>

            <h3><i class="bi bi-list-check"></i> Cr√©ation pas-√†-pas (les 5 √©tapes)</h3>

            <!-- √âTAPE 1 -->
            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #1565C0;">
                <h4 style="color: #1565C0; margin-bottom: 15px;">√âtape 1 : Choisir le mod√®le d'IA</h4>

                <p style="color: #333;"><strong>Ce que vous devez faire :</strong> S√©lectionner quel "cerveau" utilisera votre agent</p>

                <p style="color: #333;"><strong>Ce que vous voyez :</strong></p>
                <ul style="color: #333;">
                    <li>Plusieurs <strong>cartes</strong> repr√©sentant diff√©rents mod√®les d'IA</li>
                    <li>Chaque carte indique le <strong>nom du mod√®le</strong> et ses caract√©ristiques</li>
                </ul>

                <p style="color: #333; margin-top: 15px;"><strong>Comment choisir :</strong></p>
                <div style="background: white; padding: 15px; border-radius: 10px; margin-top: 10px;">
                    <ul style="color: #333; margin: 0;">
                        <li><strong>gpt-4o-realtime</strong> : Le plus performant pour les conversations vocales naturelles</li>
                        <li><strong>gpt-4o</strong> : Excellent √©quilibre qualit√©/co√ªt</li>
                        <li><strong>gpt-4o-mini</strong> : Plus √©conomique, id√©al pour les tests</li>
                        <li><strong>gpt-5</strong> : La derni√®re g√©n√©ration (plus puissant mais plus co√ªteux)</li>
                    </ul>
                </div>

                <ol style="color: #333; line-height: 2; margin-top: 15px;">
                    <li><strong>Cliquez sur la carte</strong> du mod√®le que vous souhaitez utiliser</li>
                    <li>La carte s√©lectionn√©e s'entoure d'une <strong>bordure violette</strong></li>
                    <li>Cliquez sur <strong>"Suivant"</strong> en bas √† droite</li>
                </ol>
            </div>

            <!-- √âTAPE 2 -->
            <div style="background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #2E7D32;">
                <h4 style="color: #2E7D32; margin-bottom: 15px;">√âtape 2 : Configurer la voix</h4>

                <p style="color: #333;"><strong>Ce que vous devez faire :</strong> Choisir comment votre agent va parler (sa voix)</p>

                <p style="color: #333;"><strong>Ce que vous voyez :</strong></p>
                <ul style="color: #333;">
                    <li>Une s√©rie de <strong>menus d√©roulants en cascade</strong></li>
                    <li>Chaque choix d√©termine les options du menu suivant</li>
                </ul>

                <ol style="color: #333; line-height: 2;">
                    <li><strong>Langue</strong> : S√©lectionnez la langue principale (Fran√ßais, English, Espa√±ol, etc.)</li>
                    <li><strong>R√©gion</strong> : Choisissez l'accent (France, Belgique, Canada pour le fran√ßais)</li>
                    <li><strong>Genre</strong> : Masculin ou F√©minin</li>
                    <li><strong>Type de voix</strong> : Standard ou Neural (Neural = plus naturel)</li>
                    <li><strong>Voix</strong> : Choisissez parmi les voix disponibles
                        <ul>
                            <li>Un bouton <strong>"√âcouter"</strong> vous permet de tester chaque voix</li>
                        </ul>
                    </li>
                    <li>Cliquez sur <strong>"Suivant"</strong> quand vous √™tes satisfait</li>
                </ol>

                <div class="callout callout-info" style="margin-top: 15px;">
                    <i class="bi bi-lightbulb callout-icon"></i>
                    <div class="callout-content">
                        <div class="callout-title">Conseil</div>
                        <p>Testez plusieurs voix en cliquant sur "√âcouter" avant de faire votre choix. La voix repr√©sente l'identit√© de votre marque !</p>
                    </div>
                </div>
            </div>

            <!-- √âTAPE 3 -->
            <div style="background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #E65100;">
                <h4 style="color: #E65100; margin-bottom: 15px;">√âtape 3 : S√©lectionner les outils (Tools)</h4>

                <p style="color: #333;"><strong>Ce que vous devez faire :</strong> Choisir les "pouvoirs" de votre agent (ce qu'il peut faire pendant une conversation)</p>

                <p style="color: #333;"><strong>Ce que vous voyez :</strong></p>
                <ul style="color: #333;">
                    <li>Une <strong>grille de cartes</strong> repr√©sentant tous les outils disponibles</li>
                    <li>Chaque carte a une <strong>case √† cocher</strong></li>
                    <li>Les outils sont class√©s par cat√©gorie (Basiques, Communication, Recherche, etc.)</li>
                </ul>

                <p style="color: #333; margin-top: 15px;"><strong>Exemples d'outils :</strong></p>
                <div style="background: white; padding: 15px; border-radius: 10px; margin-top: 10px;">
                    <ul style="color: #333; margin: 0;">
                        <li><strong>M√©t√©o</strong> : L'agent peut donner la m√©t√©o d'une ville</li>
                        <li><strong>Calculatrice</strong> : L'agent peut faire des calculs</li>
                        <li><strong>Envoi d'email</strong> : L'agent peut envoyer un email r√©capitulatif</li>
                        <li><strong>Recherche web</strong> : L'agent peut chercher des informations sur internet</li>
                        <li><strong>Base de connaissances</strong> : L'agent peut consulter vos documents (RAG)</li>
                    </ul>
                </div>

                <ol style="color: #333; line-height: 2; margin-top: 15px;">
                    <li><strong>Parcourez les outils</strong> disponibles</li>
                    <li><strong>Cochez</strong> ceux que vous voulez activer (maximum 8 recommand√©)</li>
                    <li>Les outils coch√©s apparaissent avec une <strong>bordure color√©e</strong></li>
                    <li>Cliquez sur <strong>"Suivant"</strong></li>
                </ol>

                <div class="callout callout-warning" style="margin-top: 15px;">
                    <i class="bi bi-exclamation-triangle callout-icon"></i>
                    <div class="callout-content">
                        <div class="callout-title">Attention</div>
                        <p>N'ajoutez pas trop d'outils. Plus il y en a, plus l'agent peut se tromper dans son choix. S√©lectionnez uniquement ceux vraiment utiles pour votre cas d'usage.</p>
                    </div>
                </div>
            </div>

            <!-- √âTAPE 4 -->
            <div style="background: linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #7B1FA2;">
                <h4 style="color: #7B1FA2; margin-bottom: 15px;">√âtape 4 : √âcrire les instructions</h4>

                <p style="color: #333;"><strong>Ce que vous devez faire :</strong> Expliquer √† l'agent son r√¥le, sa personnalit√© et comment il doit se comporter</p>

                <p style="color: #333;"><strong>Ce que vous voyez :</strong></p>
                <ul style="color: #333;">
                    <li>Une grande <strong>zone de texte</strong> pour √©crire vos instructions</li>
                    <li>Un bouton <strong>"G√©n√©rer avec l'IA"</strong> pour obtenir une aide √† la r√©daction</li>
                    <li>Des <strong>mod√®les pr√©d√©finis</strong> que vous pouvez utiliser comme base</li>
                </ul>

                <p style="color: #333; margin-top: 15px;"><strong>Que mettre dans les instructions :</strong></p>
                <div style="background: white; padding: 15px; border-radius: 10px; margin-top: 10px;">
                    <ol style="color: #333; margin: 0;">
                        <li><strong>Identit√©</strong> : "Tu es Sophie, assistante commerciale de l'entreprise ABC"</li>
                        <li><strong>Mission</strong> : "Tu aides les clients √† trouver des produits et √† passer commande"</li>
                        <li><strong>Ton</strong> : "Sois amical, professionnel et patient"</li>
                        <li><strong>Limites</strong> : "Ne donne jamais de prix sans v√©rifier dans la base de donn√©es"</li>
                        <li><strong>Actions</strong> : "√Ä la fin de chaque appel, propose d'envoyer un r√©capitulatif par email"</li>
                    </ol>
                </div>

                <ol style="color: #333; line-height: 2; margin-top: 15px;">
                    <li><strong>Option A</strong> - √âcrire vous-m√™me :
                        <ul>
                            <li>Cliquez dans la zone de texte</li>
                            <li>R√©digez vos instructions en langage naturel</li>
                        </ul>
                    </li>
                    <li><strong>Option B</strong> - Utiliser l'aide de l'IA :
                        <ul>
                            <li>Cliquez sur <strong>"G√©n√©rer avec l'IA"</strong></li>
                            <li>D√©crivez bri√®vement votre besoin</li>
                            <li>L'IA g√©n√®re un brouillon que vous pouvez modifier</li>
                        </ul>
                    </li>
                    <li>Relisez et ajustez vos instructions</li>
                    <li>Cliquez sur <strong>"Suivant"</strong></li>
                </ol>
            </div>

            <!-- √âTAPE 5 -->
            <div style="background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #4CAF50;">
                <h4 style="color: #4CAF50; margin-bottom: 15px;">√âtape 5 : Nommer et publier</h4>

                <p style="color: #333;"><strong>Ce que vous devez faire :</strong> Donner un nom √† votre agent et le mettre en ligne</p>

                <p style="color: #333;"><strong>Ce que vous voyez :</strong></p>
                <ul style="color: #333;">
                    <li>Un <strong>champ pour le nom</strong> de l'agent</li>
                    <li>Un <strong>r√©capitulatif</strong> de tous vos choix (mod√®le, voix, outils)</li>
                    <li>Un bouton <strong>"Publier l'agent"</strong></li>
                </ul>

                <ol style="color: #333; line-height: 2;">
                    <li><strong>Entrez un nom</strong> pour votre agent (exemple : "Assistant Support Client")</li>
                    <li>V√©rifiez le r√©capitulatif : tout est correct ?</li>
                    <li>Si besoin, utilisez le bouton <strong>"Pr√©c√©dent"</strong> pour modifier une √©tape</li>
                    <li>Cliquez sur <strong>"Publier l'agent"</strong></li>
                    <li>Attendez le message de confirmation <strong>"Agent cr√©√© avec succ√®s !"</strong></li>
                    <li>Vous √™tes redirig√© vers la galerie des agents</li>
                </ol>

                <div class="callout callout-success" style="margin-top: 15px;">
                    <i class="bi bi-check-circle callout-icon"></i>
                    <div class="callout-content">
                        <div class="callout-title">F√©licitations !</div>
                        <p>Votre agent est maintenant cr√©√© et pr√™t √† √™tre test√©. Rendez-vous dans la Galerie des Agents pour le tester.</p>
                    </div>
                </div>
            </div>

            <h3><i class="bi bi-exclamation-circle"></i> En cas de probl√®me</h3>

            <div style="background: #fff; border-radius: 15px; padding: 25px; margin: 20px 0; border: 1px solid #ddd;">
                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Le bouton "Suivant" reste gris√©</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Vous n'avez pas fait tous les choix obligatoires de l'√©tape en cours.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> V√©rifiez que vous avez bien s√©lectionn√© un mod√®le, une voix, etc. Les champs obligatoires sont souvent marqu√©s d'une √©toile rouge *.</p>
                </div>

                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> "Ce nom d'agent existe d√©j√†"</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Vous avez d√©j√† un agent avec ce nom.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Choisissez un nom diff√©rent (ajoutez un num√©ro ou une description, exemple : "Support Client v2").</p>
                </div>

                <div>
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Aucune voix disponible dans la liste</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> La combinaison langue/r√©gion/genre n'a pas de voix disponible.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Essayez une autre r√©gion ou un autre genre. Par exemple, certaines langues n'ont que des voix f√©minines.</p>
                </div>
            </div>

            <!-- ================================================================
                 √âCRAN 7 : GALERIE DES AGENTS
                 ================================================================ -->
            <h2>12.8 √âcran "Galerie des Agents"</h2>

            <div style="background: #f8f9fa; border-left: 4px solid #4A148C; padding: 20px; margin: 20px 0; border-radius: 0 10px 10px 0;">
                <p style="margin: 0; color: #333;"><strong>Pour y acc√©der :</strong> Menu "Galeries" ‚Üí "Agents" ‚Üí "Voix" (ou "Texte" ou "Avatar")</p>
            </div>

            <h3><i class="bi bi-eye"></i> Description de l'√©cran</h3>

            <p>Cet √©cran affiche <strong>tous vos agents</strong> sous forme de cartes. C'est votre "tableau de bord des agents" o√π vous pouvez les voir, les tester, les modifier ou les supprimer.</p>

            <h4>Ce que vous voyez sur cet √©cran :</h4>

            <div style="background: white; border: 1px solid #ddd; border-radius: 15px; padding: 25px; margin: 20px 0;">
                <p><strong>En haut :</strong></p>
                <ul style="color: #333;">
                    <li><strong>Compteurs</strong> : "X agents au total", "Y actifs", "Z brouillons"</li>
                    <li><strong>Barre de recherche</strong> : pour trouver un agent par son nom</li>
                    <li><strong>Filtres</strong> : par mod√®le, statut, date de cr√©ation</li>
                    <li><strong>Bouton "Cr√©er un agent"</strong> : raccourci vers l'√©cran de cr√©ation</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Au centre - La grille de cartes :</strong></p>
                <p style="color: #666;">Chaque agent est repr√©sent√© par une <strong>carte rectangulaire</strong> contenant :</p>
                <ul style="color: #333;">
                    <li>Un <strong>badge color√©</strong> en haut √† gauche : "Actif" (vert) ou "Brouillon" (gris)</li>
                    <li>La <strong>r√©f√©rence</strong> de l'agent (code unique)</li>
                    <li>Le <strong>nom</strong> de l'agent (en gros)</li>
                    <li>Le <strong>mod√®le</strong> utilis√© (gpt-4o, etc.)</li>
                    <li>La <strong>voix</strong> s√©lectionn√©e</li>
                    <li>Le nombre de <strong>tools</strong> activ√©s</li>
                    <li><strong>4 boutons d'action</strong> en bas de la carte :
                        <ul>
                            <li><i class="bi bi-play-fill"></i> <strong>Tester</strong> : lancer une conversation avec l'agent</li>
                            <li><i class="bi bi-pencil"></i> <strong>Modifier</strong> : changer les param√®tres</li>
                            <li><i class="bi bi-files"></i> <strong>Dupliquer</strong> : cr√©er une copie</li>
                            <li><i class="bi bi-trash"></i> <strong>Supprimer</strong> : effacer l'agent</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <h3><i class="bi bi-list-check"></i> Fonctionnalit√©s pas-√†-pas</h3>

            <!-- Fonctionnalit√© 1 : Tester un agent -->
            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #1565C0; margin-bottom: 15px;"><i class="bi bi-play-fill"></i> Tester un agent</h4>

                <p style="color: #333;"><strong>Objectif :</strong> Avoir une conversation avec votre agent pour v√©rifier qu'il fonctionne bien</p>

                <ol style="color: #333; line-height: 2;">
                    <li>Trouvez l'agent que vous voulez tester dans la grille</li>
                    <li>V√©rifiez que son badge indique <strong>"Actif"</strong> (les brouillons ne peuvent pas √™tre test√©s)</li>
                    <li>Cliquez sur le bouton <strong>Tester</strong> (ic√¥ne lecture ‚ñ∂)</li>
                    <li>Vous √™tes redirig√© vers l'<strong>√©cran de session</strong> (voir section suivante)</li>
                    <li>Autorisez l'acc√®s √† votre microphone si demand√©</li>
                    <li>Commencez √† parler pour tester l'agent !</li>
                </ol>
            </div>

            <!-- Fonctionnalit√© 2 : Modifier un agent -->
            <div style="background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #E65100; margin-bottom: 15px;"><i class="bi bi-pencil"></i> Modifier un agent</h4>

                <p style="color: #333;"><strong>Objectif :</strong> Changer les param√®tres d'un agent existant</p>

                <ol style="color: #333; line-height: 2;">
                    <li>Trouvez l'agent √† modifier</li>
                    <li>Cliquez sur le bouton <strong>Modifier</strong> (ic√¥ne crayon ‚úé)</li>
                    <li>Vous retournez dans l'<strong>assistant de cr√©ation</strong>, mais avec les valeurs actuelles pr√©-remplies</li>
                    <li>Naviguez entre les √©tapes avec "Pr√©c√©dent" et "Suivant"</li>
                    <li>Modifiez ce que vous souhaitez (voix, outils, instructions...)</li>
                    <li>√Ä la derni√®re √©tape, cliquez sur <strong>"Enregistrer les modifications"</strong></li>
                </ol>
            </div>

            <!-- Fonctionnalit√© 3 : Supprimer un agent -->
            <div style="background: linear-gradient(135deg, #FFEBEE 0%, #FFCDD2 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #C62828; margin-bottom: 15px;"><i class="bi bi-trash"></i> Supprimer un agent</h4>

                <p style="color: #333;"><strong>Attention : Cette action est d√©finitive !</strong></p>

                <ol style="color: #333; line-height: 2;">
                    <li>Trouvez l'agent √† supprimer</li>
                    <li>Cliquez sur le bouton <strong>Supprimer</strong> (ic√¥ne poubelle üóë)</li>
                    <li>Une fen√™tre de confirmation appara√Æt</li>
                    <li>Lisez le message pour v√©rifier que c'est le bon agent</li>
                    <li>Cliquez sur <strong>"Confirmer la suppression"</strong></li>
                    <li>L'agent dispara√Æt de la galerie</li>
                </ol>

                <div class="callout callout-warning" style="margin-top: 15px;">
                    <i class="bi bi-exclamation-triangle callout-icon"></i>
                    <div class="callout-content">
                        <div class="callout-title">Important</div>
                        <p>Un agent supprim√© ne peut pas √™tre r√©cup√©r√©. Si vous n'√™tes pas s√ªr, utilisez plut√¥t la fonction "Dupliquer" pour garder une copie avant de modifier l'original.</p>
                    </div>
                </div>
            </div>

            <!-- ================================================================
                 √âCRAN 8 : SESSION VOIX
                 ================================================================ -->
            <h2>12.9 √âcran "Session Voix" (Tester un agent)</h2>

            <div style="background: #f8f9fa; border-left: 4px solid #4A148C; padding: 20px; margin: 20px 0; border-radius: 0 10px 10px 0;">
                <p style="margin: 0; color: #333;"><strong>Pour y acc√©der :</strong> Galerie des Agents ‚Üí Bouton "Tester" sur un agent</p>
            </div>

            <h3><i class="bi bi-eye"></i> Description de l'√©cran</h3>

            <p>C'est l'√©cran o√π vous <strong>discutez vocalement</strong> avec votre agent. Vous parlez dans votre micro, l'agent r√©pond √† l'oral, et vous voyez la transcription de la conversation en temps r√©el.</p>

            <h4>Ce que vous voyez sur cet √©cran :</h4>

            <div style="background: white; border: 1px solid #ddd; border-radius: 15px; padding: 25px; margin: 20px 0;">
                <p><strong>En haut :</strong></p>
                <ul style="color: #333;">
                    <li>Le <strong>nom de l'agent</strong> avec lequel vous parlez</li>
                    <li>Un <strong>indicateur de connexion</strong> : point vert = connect√©, orange = en connexion, rouge = d√©connect√©</li>
                    <li>Un bouton <strong>"Retour"</strong> pour revenir √† la galerie</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Au centre - La zone de conversation :</strong></p>
                <ul style="color: #333;">
                    <li>Les messages s'affichent comme dans une messagerie</li>
                    <li><strong>Vos paroles</strong> : √† droite, avec une ic√¥ne de microphone</li>
                    <li><strong>R√©ponses de l'agent</strong> : √† gauche, avec une ic√¥ne de robot</li>
                    <li>Quand un <strong>outil s'ex√©cute</strong> : un message jaune appara√Æt (exemple : "Recherche m√©t√©o en cours...")</li>
                </ul>

                <p style="margin-top: 20px;"><strong>En bas :</strong></p>
                <ul style="color: #333;">
                    <li><strong>Bouton Micro</strong> (grand bouton rond) :
                        <ul>
                            <li>Vert avec micro = vous pouvez parler</li>
                            <li>Rouge avec micro barr√© = micro coup√©</li>
                        </ul>
                    </li>
                    <li><strong>Visualisation audio</strong> : des barres qui bougent quand vous parlez</li>
                    <li>Bouton <strong>"Terminer"</strong> : pour mettre fin √† la session</li>
                </ul>
            </div>

            <h3><i class="bi bi-list-check"></i> Fonctionnalit√©s pas-√†-pas</h3>

            <!-- Fonctionnalit√© 1 : Avoir une conversation -->
            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #1565C0; margin-bottom: 15px;"><i class="bi bi-mic-fill"></i> Avoir une conversation avec l'agent</h4>

                <ol style="color: #333; line-height: 2;">
                    <li>Attendez que l'indicateur passe au <strong>vert</strong> (connexion √©tablie)</li>
                    <li>V√©rifiez que le bouton micro est <strong>vert</strong> (micro actif)</li>
                    <li><strong>Parlez normalement</strong> dans votre micro, comme si vous parliez √† quelqu'un</li>
                    <li>Attendez que la transcription de vos paroles apparaisse √† l'√©cran</li>
                    <li>L'agent r√©fl√©chit puis <strong>r√©pond vocalement</strong> - vous l'entendez dans vos haut-parleurs</li>
                    <li>Sa r√©ponse s'affiche aussi en texte dans la zone de conversation</li>
                    <li>Continuez la discussion aussi longtemps que n√©cessaire</li>
                    <li>Pour terminer, cliquez sur <strong>"Terminer la session"</strong></li>
                </ol>
            </div>

            <!-- Fonctionnalit√© 2 : Couper/Activer le micro -->
            <div style="background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #E65100; margin-bottom: 15px;"><i class="bi bi-mic-mute"></i> Couper ou r√©activer votre micro</h4>

                <ol style="color: #333; line-height: 2;">
                    <li>Regardez le <strong>gros bouton rond</strong> en bas de l'√©cran</li>
                    <li>S'il est <strong>vert</strong> : votre micro est actif, l'agent vous entend</li>
                    <li>Cliquez dessus une fois pour <strong>couper le micro</strong> : il devient rouge</li>
                    <li>Cliquez √† nouveau pour <strong>r√©activer</strong> : il redevient vert</li>
                </ol>

                <p style="color: #666; margin-top: 15px;"><strong>Utilit√© :</strong> Coupez votre micro si vous devez parler √† quelqu'un d'autre ou s'il y a du bruit autour de vous.</p>
            </div>

            <h3><i class="bi bi-exclamation-circle"></i> En cas de probl√®me</h3>

            <div style="background: #fff; border-radius: 15px; padding: 25px; margin: 20px 0; border: 1px solid #ddd;">
                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> L'indicateur reste orange ou rouge</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> La connexion au serveur n'a pas pu s'√©tablir.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> V√©rifiez votre connexion internet. Rafra√Æchissez la page. Si le probl√®me persiste, le serveur peut √™tre temporairement surcharg√© - r√©essayez dans quelques minutes.</p>
                </div>

                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Le navigateur demande l'acc√®s au microphone</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> C'est normal ! L'agent a besoin de votre micro pour vous entendre.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Cliquez sur <strong>"Autoriser"</strong>. Si vous avez cliqu√© sur "Bloquer" par erreur, allez dans les param√®tres de votre navigateur pour r√©autoriser l'acc√®s au microphone.</p>
                </div>

                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> L'agent ne r√©pond pas quand je parle</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> L'agent ne d√©tecte peut-√™tre pas votre voix (micro trop loin, volume trop bas).</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Parlez plus fort et plus pr√®s du micro. V√©rifiez que le bon microphone est s√©lectionn√© dans les param√®tres de votre ordinateur.</p>
                </div>

                <div style="border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px;">
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> Le son de l'agent est hach√© ou gr√©sille</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Votre connexion internet est probablement trop lente ou instable.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> Rapprochez-vous de votre box internet, ou passez en connexion filaire (c√¢ble Ethernet) si possible. Fermez les autres applications qui utilisent internet.</p>
                </div>

                <div>
                    <p style="color: #d32f2f; font-weight: 600; margin-bottom: 10px;"><i class="bi bi-x-circle"></i> La session se termine toute seule</p>
                    <p style="color: #333; margin-bottom: 10px;"><strong>Pourquoi ?</strong> Apr√®s 5 minutes sans parole, la session se ferme automatiquement pour √©conomiser les ressources.</p>
                    <p style="color: #333; margin: 0;"><strong>Que faire ?</strong> C'est normal. Relancez simplement une nouvelle session si vous souhaitez continuer.</p>
                </div>
            </div>

            <div class="callout callout-success">
                <i class="bi bi-shield-check callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Conseils pour une bonne conversation</div>
                    <ul style="margin: 0; padding-left: 20px;">
                        <li><strong>Parlez clairement</strong> et √† un rythme normal - pas trop vite</li>
                        <li><strong>√âvitez les bruits de fond</strong> : fermez la fen√™tre, √©loignez-vous des coll√®gues qui parlent</li>
                        <li><strong>Attendez que l'agent finisse</strong> de parler avant de reprendre la parole</li>
                        <li><strong>Utilisez des phrases compl√®tes</strong> plut√¥t que des mots isol√©s</li>
                        <li>Si l'agent ne comprend pas, <strong>reformulez</strong> votre demande diff√©remment</li>
                    </ul>
                </div>
            </div>

            <!-- ================================================================
                 √âCRAN 9 : GALERIE DES TOOLS
                 ================================================================ -->
            <h2>12.10 √âcran "Galerie des Tools"</h2>

            <div style="background: #f8f9fa; border-left: 4px solid #4A148C; padding: 20px; margin: 20px 0; border-radius: 0 10px 10px 0;">
                <p style="margin: 0; color: #333;"><strong>Pour y acc√©der :</strong> Menu "Galeries" ‚Üí "Tools"</p>
            </div>

            <h3><i class="bi bi-eye"></i> Description de l'√©cran</h3>

            <p>Cet √©cran liste <strong>tous les outils disponibles</strong> pour vos agents. Vous y trouvez les outils syst√®me (pr√©-int√©gr√©s) et vos outils personnalis√©s.</p>

            <h4>Ce que vous voyez sur cet √©cran :</h4>

            <div style="background: white; border: 1px solid #ddd; border-radius: 15px; padding: 25px; margin: 20px 0;">
                <p><strong>En haut :</strong></p>
                <ul style="color: #333;">
                    <li><strong>Barre de recherche</strong> : pour trouver un outil par son nom</li>
                    <li><strong>Filtres par cat√©gorie</strong> : Basiques, Communication, Recherche, Voyage, etc.</li>
                    <li><strong>Bouton "Cr√©er un Tool"</strong> : pour ajouter un nouvel outil personnalis√©</li>
                </ul>

                <p style="margin-top: 20px;"><strong>La liste des outils :</strong></p>
                <p style="color: #666;">Chaque outil est affich√© dans une carte avec :</p>
                <ul style="color: #333;">
                    <li>Une <strong>ic√¥ne</strong> repr√©sentant sa fonction</li>
                    <li>Le <strong>nom</strong> de l'outil</li>
                    <li>Une courte <strong>description</strong></li>
                    <li>Un badge <strong>"Syst√®me"</strong> (bleu) ou <strong>"Custom"</strong> (violet)</li>
                    <li>Boutons <strong>Voir / Modifier / Supprimer</strong> (pour les tools custom uniquement)</li>
                </ul>
            </div>

            <h3><i class="bi bi-list-check"></i> Fonctionnalit√©s pas-√†-pas</h3>

            <!-- Fonctionnalit√© 1 : Cr√©er un outil personnalis√© -->
            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #1565C0; margin-bottom: 15px;"><i class="bi bi-plus-circle"></i> Cr√©er un outil personnalis√©</h4>

                <p style="color: #333;"><strong>Objectif :</strong> Ajouter une nouvelle capacit√© √† vos agents (par exemple, consulter votre CRM)</p>

                <ol style="color: #333; line-height: 2;">
                    <li>Cliquez sur le bouton <strong>"Cr√©er un Tool"</strong> en haut de la page</li>
                    <li>Choisissez le <strong>type de tool</strong> :
                        <ul>
                            <li><strong>OpenAPI</strong> : si vous avez une documentation API (fichier swagger.json)</li>
                            <li><strong>REST Endpoint</strong> : pour un appel HTTP simple</li>
                            <li><strong>Code Python</strong> : pour une logique m√©tier complexe</li>
                        </ul>
                    </li>
                    <li>Remplissez les champs demand√©s :
                        <ul>
                            <li><strong>Nom</strong> : comment s'appelle cet outil (ex: "check_stock")</li>
                            <li><strong>Description</strong> : expliquez ce que fait l'outil - c'est ce que l'IA lit pour d√©cider quand l'utiliser</li>
                            <li><strong>Configuration technique</strong> : URL, param√®tres, etc.</li>
                        </ul>
                    </li>
                    <li>Cliquez sur <strong>"Enregistrer"</strong></li>
                    <li>Votre outil appara√Æt maintenant dans la galerie avec un badge "Custom"</li>
                    <li>Vous pouvez d√©sormais le s√©lectionner lors de la cr√©ation d'un agent</li>
                </ol>
            </div>

            <!-- ================================================================
                 √âCRAN 10 : DASHBOARDS
                 ================================================================ -->
            <h2>12.11 √âcrans "Dashboards" (Qualit√© & Production)</h2>

            <div style="background: #f8f9fa; border-left: 4px solid #4A148C; padding: 20px; margin: 20px 0; border-radius: 0 10px 10px 0;">
                <p style="margin: 0; color: #333;"><strong>Pour y acc√©der :</strong> Menu "Dashboards" ‚Üí "Qualit√©" ou "Production"</p>
            </div>

            <h3><i class="bi bi-eye"></i> Description des √©crans</h3>

            <p>Ces tableaux de bord vous donnent des <strong>statistiques d√©taill√©es</strong> sur l'activit√© de votre plateforme.</p>

            <div style="background: white; border: 1px solid #ddd; border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #1565C0;">Dashboard Qualit√©</h4>
                <p style="color: #333;">Analyse la <strong>qualit√© des conversations</strong> :</p>
                <ul style="color: #333;">
                    <li>R√©partition des sentiments (positif/neutre/n√©gatif) sous forme de graphiques</li>
                    <li>√âvolution dans le temps (courbes jour par jour)</li>
                    <li>Performance par agent (qui g√©n√®re le plus de satisfaction ?)</li>
                    <li>Dur√©e moyenne des conversations</li>
                </ul>

                <h4 style="color: #2E7D32; margin-top: 20px;">Dashboard Production</h4>
                <p style="color: #333;">Analyse les <strong>aspects business</strong> :</p>
                <ul style="color: #333;">
                    <li>Volume d'appels par jour/semaine/mois</li>
                    <li>Revenus g√©n√©r√©s (bas√© sur votre taux de facturation)</li>
                    <li>Co√ªts de consommation Azure</li>
                    <li>Marge b√©n√©ficiaire (revenus - co√ªts)</li>
                </ul>
            </div>

            <h3><i class="bi bi-list-check"></i> Fonctionnalit√©s pas-√†-pas</h3>

            <!-- Fonctionnalit√© 1 : Changer la p√©riode -->
            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #1565C0; margin-bottom: 15px;"><i class="bi bi-calendar"></i> Changer la p√©riode d'analyse</h4>

                <ol style="color: #333; line-height: 2;">
                    <li>En haut du dashboard, rep√©rez le <strong>s√©lecteur de dates</strong></li>
                    <li>Cliquez dessus pour ouvrir le calendrier</li>
                    <li>S√©lectionnez la <strong>date de d√©but</strong> et la <strong>date de fin</strong></li>
                    <li>Ou utilisez les <strong>raccourcis</strong> : "Aujourd'hui", "Cette semaine", "Ce mois", "30 derniers jours"</li>
                    <li>Les graphiques se mettent √† jour automatiquement</li>
                </ol>
            </div>

            <!-- Fonctionnalit√© 2 : Exporter les donn√©es -->
            <div style="background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #2E7D32; margin-bottom: 15px;"><i class="bi bi-download"></i> Exporter les donn√©es</h4>

                <ol style="color: #333; line-height: 2;">
                    <li>Configurez d'abord la p√©riode que vous souhaitez exporter</li>
                    <li>Cliquez sur le bouton <strong>"Exporter"</strong> (ic√¥ne de t√©l√©chargement)</li>
                    <li>Choisissez le format : <strong>CSV</strong> (pour Excel) ou <strong>PDF</strong> (pour rapport)</li>
                    <li>Le fichier se t√©l√©charge automatiquement</li>
                </ol>
            </div>

            <!-- ================================================================
                 R√âCAPITULATIF FINAL
                 ================================================================ -->
            <h2>12.12 R√©capitulatif : O√π trouver quoi ?</h2>

            <div style="background: linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 100%); border-radius: 15px; padding: 25px; margin: 20px 0;">
                <h4 style="color: #7B1FA2; margin-bottom: 15px;"><i class="bi bi-signpost-2"></i> Tableau de navigation rapide</h4>

                <div class="table-wrapper">
                    <table style="font-size: 0.95rem;">
                        <thead>
                            <tr><th>Je veux...</th><th>Je vais dans...</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>Voir les statistiques globales</td><td><strong>Accueil</strong></td></tr>
                            <tr><td>Ajouter des documents pour mes agents</td><td><strong>Waka AXIOM ‚Üí Ajouter Documents</strong></td></tr>
                            <tr><td>Indexer un site web</td><td><strong>Waka AXIOM ‚Üí Ajouter Sites Web</strong></td></tr>
                            <tr><td>Voir mes documents index√©s</td><td><strong>Waka AXIOM ‚Üí Base de Connaissances</strong></td></tr>
                            <tr><td>Poser des questions sur mes documents</td><td><strong>Waka AXIOM ‚Üí Chat</strong></td></tr>
                            <tr><td>Cr√©er un nouvel agent</td><td><strong>Cr√©ation ‚Üí Cr√©er un Agent</strong></td></tr>
                            <tr><td>Cloner ma voix</td><td><strong>Cr√©ation ‚Üí Voix Personnelle</strong></td></tr>
                            <tr><td>Lancer une campagne d'appels</td><td><strong>Cr√©ation ‚Üí Nouvelle Campagne</strong></td></tr>
                            <tr><td>Ajouter un nouvel outil</td><td><strong>Cr√©ation ‚Üí Nouveau Tool</strong></td></tr>
                            <tr><td>Voir tous mes agents</td><td><strong>Galeries ‚Üí Agents</strong></td></tr>
                            <tr><td>Consulter l'historique des conversations</td><td><strong>Galeries ‚Üí Historique</strong></td></tr>
                            <tr><td>Voir les outils disponibles</td><td><strong>Galeries ‚Üí Tools</strong></td></tr>
                            <tr><td>Analyser la qualit√© des conversations</td><td><strong>Dashboards ‚Üí Qualit√©</strong></td></tr>
                            <tr><td>Voir les revenus et co√ªts</td><td><strong>Dashboards ‚Üí Production</strong></td></tr>
                            <tr><td>Changer la langue de l'interface</td><td><strong>Menu FR/EN/ES</strong> (en haut √† droite)</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="callout callout-info">
                <i class="bi bi-question-circle callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Besoin d'aide suppl√©mentaire ?</div>
                    <p>
                        Si vous rencontrez un probl√®me non couvert par ce manuel, n'h√©sitez pas √† contacter le support technique.
                        Pensez √† noter le message d'erreur exact et les √©tapes que vous avez suivies avant le probl√®me.
                    </p>
                </div>
            </div>


            <!-- ================================================
                 12.2 ACCUEIL - DASHBOARD PRINCIPAL
                 ================================================ -->
            <h2>12.2 Accueil - Dashboard Principal</h2>
            <p><strong>Route :</strong> <code>/</code> | <strong>Acc√®s :</strong> Cliquer sur "Accueil" ou le logo Waka</p>

            <h3><i class="bi bi-info-circle"></i> Description</h3>
            <p>Le dashboard principal est la page d'accueil de Waka Voice. Il affiche les m√©triques temps r√©el de toutes les conversations et agents, permettant de visualiser l'activit√© de la plateforme en un coup d'≈ìil.</p>

            <h3><i class="bi bi-gear"></i> Fonctionnalit√©s</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Section</th><th>M√©triques</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Conversations</strong></td><td>Total, En cours</td><td>Nombre de conversations totales et actives</td></tr>
                        <tr><td><strong>Business</strong></td><td>Revenus, Co√ªts, Marge</td><td>Revenus g√©n√©r√©s vs co√ªts ressources Azure</td></tr>
                        <tr><td><strong>Tokens</strong></td><td>Input/Output, Text/Audio</td><td>Consommation de tokens par type</td></tr>
                        <tr><td><strong>Sentiment</strong></td><td>Positif, Neutre, N√©gatif</td><td>Analyse sentiment utilisateur et agent</td></tr>
                        <tr><td><strong>Dur√©e</strong></td><td>Moyenne, Min, Max</td><td>Statistiques de dur√©e des sessions</td></tr>
                        <tr><td><strong>Sparklines</strong></td><td>Graphiques 15 min</td><td>Tendances en temps r√©el</td></tr>
                    </tbody>
                </table>
            </div>
            <ul>
                <li><strong>Rafra√Æchir</strong> - Bouton pour actualiser les m√©triques manuellement</li>
                <li><strong>Configurer taux</strong> - Modifier le taux de facturation (‚Ç¨/min)</li>
                <li><strong>Auto-refresh</strong> - Actualisation automatique toutes les 15 minutes</li>
            </ul>

            <h3><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Probl√®me</th><th>Cause probable</th><th>Solution</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>M√©triques √† z√©ro</td><td>Aucune session active</td><td>V√©rifier que des agents sont publi√©s et des sessions en cours</td></tr>
                        <tr><td>Donn√©es non actualis√©es</td><td>Cache navigateur</td><td>Cliquer sur le bouton "Rafra√Æchir" ou F5</td></tr>
                        <tr><td>Erreur de chargement</td><td>Connexion Cosmos DB</td><td>V√©rifier les variables d'environnement COSMOS_*</td></tr>
                        <tr><td>Sparklines vides</td><td>Moins de 15 min de donn√©es</td><td>Attendre l'accumulation de donn√©es historiques</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 12.3 MENU WAKA AXIOM (RAG)
                 ================================================ -->
            <h2>12.3 Menu Waka AXIOM (RAG)</h2>
            <p>Module de gestion de la base de connaissances pour le RAG (Retrieval-Augmented Generation).</p>

            <!-- 12.3.1 Upload Documents -->
            <h3>12.3.1 Upload de Documents</h3>
            <p><strong>Route :</strong> <code>/rag/upload</code> | <strong>Acc√®s :</strong> Waka AXIOM ‚Üí Ajouter Documents</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Interface pour t√©l√©verser des fichiers depuis votre ordinateur vers la base de connaissances. Les documents sont automatiquement d√©coup√©s en chunks et index√©s dans Azure AI Search.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Zone Drag & Drop</strong> - Glisser-d√©poser des fichiers</li>
                <li><strong>Bouton Parcourir</strong> - S√©lectionner des fichiers manuellement</li>
                <li><strong>Formats Support√©s</strong> - PDF, DOCX, TXT, XLSX, PPTX, HTML, MD</li>
                <li><strong>Barre de Progression</strong> - Suivi de l'indexation en temps r√©el</li>
                <li><strong>S√©lection Projet</strong> - Choisir le projet RAG cible</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Upload √©choue</td><td>Fichier trop volumineux (&gt;100MB)</td><td>D√©couper le fichier en plusieurs parties</td></tr>
                        <tr><td>Format non support√©</td><td>Extension non reconnue</td><td>Convertir en PDF ou DOCX</td></tr>
                        <tr><td>Indexation bloqu√©e</td><td>Quota Azure Search atteint</td><td>Supprimer d'anciens documents ou augmenter le quota</td></tr>
                        <tr><td>Chunks vides</td><td>Document scann√© (image)</td><td>Utiliser un PDF avec texte extractible (OCR)</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.3.2 Crawler Web -->
            <h3>12.3.2 Crawler Web</h3>
            <p><strong>Route :</strong> <code>/rag/crawl</code> | <strong>Acc√®s :</strong> Waka AXIOM ‚Üí Ajouter Sites Web</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Outil de crawling pour indexer le contenu de sites web. Le crawler parcourt les pages √† partir d'une URL de d√©part et extrait le texte pour l'indexation.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>URL de d√©part</strong> - URL du site √† indexer</li>
                <li><strong>Profondeur</strong> - Nombre de niveaux de liens √† suivre (1-5)</li>
                <li><strong>Limite pages</strong> - Nombre maximum de pages √† crawler</li>
                <li><strong>Filtres</strong> - Patterns d'URL √† inclure/exclure</li>
                <li><strong>Progression</strong> - Suivi en temps r√©el du crawl</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Crawl bloqu√©</td><td>robots.txt restrictif</td><td>V√©rifier les r√®gles robots.txt du site</td></tr>
                        <tr><td>Pages manquantes</td><td>Contenu dynamique (SPA)</td><td>Augmenter le d√©lai entre requ√™tes</td></tr>
                        <tr><td>Timeout</td><td>Site lent ou inaccessible</td><td>V√©rifier la connectivit√© au site</td></tr>
                        <tr><td>Contenu vide</td><td>JavaScript requis</td><td>Le crawler ne supporte pas le JS c√¥t√© client</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.3.3 SharePoint -->
            <h3>12.3.3 Int√©gration SharePoint</h3>
            <p><strong>Route :</strong> <code>/rag/sharepoint</code> | <strong>Acc√®s :</strong> Waka AXIOM ‚Üí Connecter SharePoint</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Connexion directe √† Microsoft SharePoint pour synchroniser les biblioth√®ques de documents avec la base de connaissances.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ol>
                <li><strong>Authentification</strong> - Se connecter avec compte Microsoft 365</li>
                <li><strong>Navigation</strong> - Parcourir les biblioth√®ques SharePoint</li>
                <li><strong>S√©lection</strong> - Cocher les dossiers √† indexer</li>
                <li><strong>Synchronisation</strong> - Lancer l'import automatique</li>
                <li><strong>Planification</strong> - Configurer la synchro p√©riodique</li>
            </ol>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>√âchec connexion</td><td>Token expir√©</td><td>Se d√©connecter et reconnecter</td></tr>
                        <tr><td>Biblioth√®ques invisibles</td><td>Permissions insuffisantes</td><td>Demander l'acc√®s √† l'admin SharePoint</td></tr>
                        <tr><td>Synchro partielle</td><td>Fichiers verrouill√©s</td><td>Fermer les fichiers ouverts dans SharePoint</td></tr>
                        <tr><td>Erreur 403</td><td>MFA requis</td><td>Utiliser l'authentification interactive</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.3.4 Base de Connaissances -->
            <h3>12.3.4 Base de Connaissances</h3>
            <p><strong>Route :</strong> <code>/rag/knowledge</code> | <strong>Acc√®s :</strong> Waka AXIOM ‚Üí Base de Connaissances</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Vue d'ensemble de tous les documents et sources index√©s dans le projet RAG actif. Permet de g√©rer, rechercher et supprimer des contenus.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Liste des sources</strong> - Tous les documents/sites index√©s avec m√©tadonn√©es</li>
                <li><strong>Recherche</strong> - Rechercher par nom ou contenu</li>
                <li><strong>Statistiques</strong> - Nombre de chunks, tokens, taille totale</li>
                <li><strong>Actions</strong> - Supprimer, R√©-indexer, Voir d√©tails</li>
                <li><strong>Filtres</strong> - Par type (document, web, SharePoint)</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Liste vide</td><td>Mauvais projet s√©lectionn√©</td><td>Changer de projet dans le s√©lecteur</td></tr>
                        <tr><td>Recherche lente</td><td>Index volumineux</td><td>Utiliser des filtres pour r√©duire le scope</td></tr>
                        <tr><td>Suppression √©choue</td><td>Document en cours d'utilisation</td><td>Attendre la fin des requ√™tes RAG</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.3.5 Chat RAG -->
            <h3>12.3.5 Chat RAG</h3>
            <p><strong>Route :</strong> <code>/rag/chat-enhanced</code> | <strong>Acc√®s :</strong> Waka AXIOM ‚Üí Chat</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Interface de chat conversationnel pour interroger la base de connaissances. Les r√©ponses sont augment√©es par les documents index√©s avec citations des sources.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Recherche s√©mantique</strong> - Trouve les passages pertinents</li>
                <li><strong>Citations</strong> - Sources des r√©ponses avec liens</li>
                <li><strong>Historique</strong> - Conversations sauvegard√©es</li>
                <li><strong>Upload fichiers</strong> - Analyse ponctuelle d'un document</li>
                <li><strong>Export</strong> - T√©l√©charger la conversation</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>R√©ponse "Je ne sais pas"</td><td>Information absente de la base</td><td>V√©rifier que le document est index√©</td></tr>
                        <tr><td>Pas de citations</td><td>Seuil de similarit√© trop haut</td><td>Reformuler la question</td></tr>
                        <tr><td>R√©ponse lente</td><td>Base volumineuse</td><td>Normal pour &gt;10k chunks</td></tr>
                        <tr><td>Erreur 500</td><td>Connexion Azure Search</td><td>V√©rifier AZURE_SEARCH_ENDPOINT</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.3.6 Suppression -->
            <h3>12.3.6 Suppression de Donn√©es</h3>
            <p><strong>Route :</strong> <code>/rag/deletion</code> | <strong>Acc√®s :</strong> Waka AXIOM ‚Üí Supprimer Sources</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Interface s√©curis√©e pour supprimer des sources de la base de connaissances. La suppression est d√©finitive et retire les chunks de l'index Azure Search.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>S√©lection multiple</strong> - Cocher plusieurs sources</li>
                <li><strong>Confirmation</strong> - Double validation avant suppression</li>
                <li><strong>Historique</strong> - Journal des suppressions</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Suppression partielle</td><td>Chunks orphelins</td><td>Relancer la suppression</td></tr>
                        <tr><td>Source toujours visible</td><td>Cache non invalid√©</td><td>Rafra√Æchir la page</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.3.7 Historique Conversations -->
            <h3>12.3.7 Historique des Conversations RAG</h3>
            <p><strong>Route :</strong> <code>/rag/conversations</code> | <strong>Acc√®s :</strong> Waka AXIOM ‚Üí Historique</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Historique de toutes les conversations effectu√©es dans le Chat RAG, avec possibilit√© de reprendre une conversation ou d'exporter les √©changes.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Liste chronologique</strong> - Conversations par date</li>
                <li><strong>Recherche</strong> - Trouver par mots-cl√©s</li>
                <li><strong>Reprendre</strong> - Continuer une conversation</li>
                <li><strong>Exporter</strong> - T√©l√©charger en JSON/TXT</li>
                <li><strong>Supprimer</strong> - Effacer une conversation</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Historique vide</td><td>Aucune conversation sauvegard√©e</td><td>Les conversations sont auto-sauvegard√©es</td></tr>
                        <tr><td>Conversation incompl√®te</td><td>Session interrompue</td><td>Les messages non envoy√©s sont perdus</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 12.4 MENU CR√âATION
                 ================================================ -->
            <h2>12.4 Menu Cr√©ation</h2>

            <!-- 12.4.1 Cr√©er un Agent -->
            <h3>12.4.1 Cr√©er un Agent (Unifi√©)</h3>
            <p><strong>Route :</strong> <code>/agents/unified/create</code> | <strong>Acc√®s :</strong> Cr√©ation ‚Üí Cr√©er un Agent</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Interface unifi√©e en 5 √©tapes pour cr√©er tous types d'agents conversationnels : Voix, Texte ou Avatar. L'assistant guide l'utilisateur √† travers la s√©lection du mod√®le, de la voix, des outils et des instructions.</p>

            <div class="mermaid">
flowchart LR
    S1["1. Mod√®le"] --> S2["2. Voix"]
    S2 --> S3["3. Tools"]
    S3 --> S4["4. Instructions"]
    S4 --> S5["5. Publier"]

    style S1 fill:#4A148C,color:#fff
    style S2 fill:#6A1B9A,color:#fff
    style S3 fill:#7B1FA2,color:#fff
    style S4 fill:#9C27B0,color:#fff
    style S5 fill:#51cf66,color:#fff
            </div>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <p><strong>√âtape 1 - S√©lection du Mod√®le :</strong></p>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Famille</th><th>Mod√®les</th><th>Usage</th></tr></thead>
                    <tbody>
                        <tr><td><strong>F1 Realtime</strong></td><td>gpt-realtime, gpt-realtime-mini</td><td>Voix temps r√©el natif</td></tr>
                        <tr><td><strong>F2 GPT-4o/4.1</strong></td><td>gpt-4o, gpt-4.1, gpt-4o-mini</td><td>STT + LLM + TTS pipeline</td></tr>
                        <tr><td><strong>F3 GPT-5</strong></td><td>gpt-5, gpt-5-mini, gpt-5-nano</td><td>Nouvelle g√©n√©ration</td></tr>
                    </tbody>
                </table>
            </div>
            <p><strong>√âtape 2 - Configuration Voix :</strong> S√©lection en cascade Langue ‚Üí Locale ‚Üí Genre ‚Üí Type ‚Üí Voix</p>
            <p><strong>√âtape 3 - S√©lection des Tools :</strong> Multi-s√©lection parmi 30+ outils (max 8 par agent)</p>
            <p><strong>√âtape 4 - Instructions :</strong> Prompt syst√®me avec g√©n√©ration IA disponible</p>
            <p><strong>√âtape 5 - Publication :</strong> Nom de l'agent et activation</p>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Bouton "Suivant" gris√©</td><td>Champ requis non rempli</td><td>V√©rifier les s√©lections de l'√©tape courante</td></tr>
                        <tr><td>Voix non list√©e</td><td>Locale non support√©e</td><td>Changer de locale ou de langue</td></tr>
                        <tr><td>Erreur publication</td><td>Nom d'agent d√©j√† existant</td><td>Choisir un nom unique</td></tr>
                        <tr><td>Tools non visibles</td><td>Aucun tool cr√©√©</td><td>Cr√©er d'abord des tools dans Cr√©ation ‚Üí Tool</td></tr>
                        <tr><td>G√©n√©ration IA √©choue</td><td>Quota OpenAI atteint</td><td>Attendre ou √©crire manuellement</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.4.2 Cr√©er une Voix Personnelle -->
            <h3>12.4.2 Cr√©er une Voix Personnelle</h3>
            <p><strong>Route :</strong> <code>/creer-une-voix</code> | <strong>Acc√®s :</strong> Cr√©ation ‚Üí Voix Personnelle</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Interface pour cloner une voix √† partir d'√©chantillons audio. La voix personnelle peut ensuite √™tre utilis√©e par les agents pour parler avec votre voix ou celle d'un collaborateur.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Enregistrer</strong> - Utiliser le microphone pour capturer des √©chantillons</li>
                <li><strong>Uploader</strong> - Importer des fichiers audio existants (WAV, MP3)</li>
                <li><strong>Dur√©e requise</strong> - Minimum 30 secondes d'audio clair</li>
                <li><strong>Nom et langue</strong> - Identifier la voix</li>
                <li><strong>G√©n√©ration</strong> - Traitement Azure (~5-10 minutes)</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Qualit√© voix m√©diocre</td><td>Audio bruit√© ou court</td><td>Enregistrer dans un lieu calme, &gt;60s</td></tr>
                        <tr><td>Micro non d√©tect√©</td><td>Permissions navigateur</td><td>Autoriser l'acc√®s au microphone</td></tr>
                        <tr><td>G√©n√©ration √©choue</td><td>Format audio non support√©</td><td>Convertir en WAV 16kHz mono</td></tr>
                        <tr><td>Voix non utilisable</td><td>Consentement manquant</td><td>Cocher la case de consentement</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.4.3 Cr√©er une Campagne -->
            <h3>12.4.3 Cr√©er une Campagne</h3>
            <p><strong>Route :</strong> <code>/campaigns/create/step1</code> | <strong>Acc√®s :</strong> Cr√©ation ‚Üí Nouvelle Campagne</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Assistant en 3 √©tapes pour configurer et lancer des campagnes d'appels sortants automatis√©s avec un agent voix.</p>

            <div class="mermaid">
flowchart LR
    C1["1. Choisir Agent"] --> C2["2. Importer Contacts"]
    C2 --> C3["3. Configurer & Lancer"]

    style C1 fill:#4A148C,color:#fff
    style C2 fill:#7B1FA2,color:#fff
    style C3 fill:#51cf66,color:#fff
            </div>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>√âtape 1</strong> - S√©lection de l'agent parmi les agents publi√©s</li>
                <li><strong>√âtape 2</strong> - Import CSV/Excel (Nom, T√©l√©phone, Email...) avec validation</li>
                <li><strong>√âtape 3</strong> - Configuration : nom, plage horaire, appels simultan√©s</li>
                <li><strong>Lancement</strong> - D√©marrage imm√©diat ou planifi√©</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Import CSV √©choue</td><td>Encodage incorrect</td><td>Sauvegarder en UTF-8</td></tr>
                        <tr><td>Num√©ros rejet√©s</td><td>Format invalide</td><td>Utiliser format E.164 (+33...)</td></tr>
                        <tr><td>Campagne ne d√©marre pas</td><td>Hors plage horaire</td><td>V√©rifier les heures configur√©es</td></tr>
                        <tr><td>Aucun agent disponible</td><td>Tous en brouillon</td><td>Publier au moins un agent</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.4.4 Cr√©er un Tool -->
            <h3>12.4.4 Cr√©er un Tool</h3>
            <p><strong>Route :</strong> <code>/tools/add</code> | <strong>Acc√®s :</strong> Cr√©ation ‚Üí Nouveau Tool</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Interface pour cr√©er des outils personnalis√©s que les agents peuvent utiliser pendant les conversations. Trois m√©thodes de cr√©ation disponibles.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Type de Tool</th><th>Description</th><th>Cas d'usage</th></tr></thead>
                    <tbody>
                        <tr><td><strong>OpenAPI</strong></td><td>Importer une spec OpenAPI/Swagger</td><td>APIs tierces document√©es</td></tr>
                        <tr><td><strong>REST Endpoint</strong></td><td>Configurer un endpoint HTTP manuel</td><td>APIs simples sans spec</td></tr>
                        <tr><td><strong>Code Python</strong></td><td>√âcrire du code Python ex√©cutable</td><td>Logique m√©tier complexe</td></tr>
                        <tr><td><strong>RAG</strong></td><td>Recherche dans base de connaissances</td><td>Questions sur documents</td></tr>
                    </tbody>
                </table>
            </div>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Import OpenAPI √©choue</td><td>Spec invalide</td><td>Valider sur editor.swagger.io</td></tr>
                        <tr><td>Tool non ex√©cut√©</td><td>Description trop vague</td><td>Am√©liorer la description du tool</td></tr>
                        <tr><td>Erreur Python</td><td>Import non autoris√©</td><td>Utiliser uniquement les modules whitelist√©s</td></tr>
                        <tr><td>Timeout 60s</td><td>API externe lente</td><td>Optimiser l'appel ou augmenter le timeout</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 12.5 MENU GALERIES
                 ================================================ -->
            <h2>12.5 Menu Galeries</h2>

            <!-- 12.5.1 Galerie Agents Voix -->
            <h3>12.5.1 Galerie Agents Voix</h3>
            <p><strong>Route :</strong> <code>/agents/gallery</code> | <strong>Acc√®s :</strong> Galeries ‚Üí Agents ‚Üí Voix</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Vue d'ensemble de tous les agents voix cr√©√©s, avec filtres, recherche et actions rapides. Affiche les agents en grille de cartes avec leurs informations cl√©s.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Statistiques</strong> - Total, Actifs, Brouillons en haut de page</li>
                <li><strong>Grille de cartes</strong> - Une carte par agent avec : Badge statut, R√©f√©rence, Nom, Mod√®le, Voix, Tools</li>
                <li><strong>Filtres</strong> - Par mod√®le, statut, date de cr√©ation</li>
                <li><strong>Recherche</strong> - Par nom d'agent</li>
                <li><strong>Actions</strong> - Tester, Modifier, Dupliquer, Supprimer</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Galerie vide</td><td>Aucun agent cr√©√©</td><td>Cr√©er un agent via Cr√©ation ‚Üí Agent</td></tr>
                        <tr><td>Agent non visible</td><td>Filtres actifs</td><td>R√©initialiser les filtres</td></tr>
                        <tr><td>Bouton Test gris√©</td><td>Agent en brouillon</td><td>Publier l'agent d'abord</td></tr>
                        <tr><td>Chargement lent</td><td>Beaucoup d'agents</td><td>Utiliser les filtres pour r√©duire</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.5.2 Galerie Agents Texte -->
            <h3>12.5.2 Galerie Agents Texte</h3>
            <p><strong>Route :</strong> <code>/text-agents/gallery</code> | <strong>Acc√®s :</strong> Galeries ‚Üí Agents ‚Üí Texte</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Galerie des agents conversationnels 100% texte (chatbots). M√™me structure que la galerie Voix avec des fonctionnalit√©s adapt√©es au texte.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Cartes agents</strong> - Nom, mod√®le LLM, nombre de tools</li>
                <li><strong>Test chat</strong> - Interface de chat int√©gr√©e</li>
                <li><strong>Embed</strong> - Code iframe pour int√©gration web</li>
                <li><strong>Statistiques</strong> - Messages, utilisateurs, satisfaction</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Chat ne r√©pond pas</td><td>Quota API atteint</td><td>V√©rifier les quotas Azure OpenAI</td></tr>
                        <tr><td>Embed ne charge pas</td><td>Domaine non autoris√©</td><td>Ajouter le domaine dans CORS</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.5.3 Galerie Agents Avatar -->
            <h3>12.5.3 Galerie Agents Avatar</h3>
            <p><strong>Route :</strong> <code>/azure-avatar/gallery</code> | <strong>Acc√®s :</strong> Galeries ‚Üí Agents ‚Üí Avatar</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Galerie des agents avec avatar vid√©o anim√©. Utilise Azure Avatar Service pour le rendu vid√©o temps r√©el avec lip-sync.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Avatars vid√©o</strong> - 6 personnages Azure (Lisa, Harry, etc.)</li>
                <li><strong>Avatars photo</strong> - VASA-1/VASA-2 (30 personnages)</li>
                <li><strong>Preview</strong> - Aper√ßu vid√©o avant test</li>
                <li><strong>Session vid√©o</strong> - Test avec WebRTC</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Vid√©o noire</td><td>WebRTC bloqu√©</td><td>Autoriser les connexions WebRTC</td></tr>
                        <tr><td>Avatar fig√©</td><td>Session expir√©e</td><td>Relancer la session</td></tr>
                        <tr><td>Pas de lip-sync</td><td>Audio non re√ßu</td><td>V√©rifier la connexion audio</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.5.4 Historique Sessions Voix -->
            <h3>12.5.4 Historique des Sessions Voix</h3>
            <p><strong>Route :</strong> <code>/agents/voice-history</code> | <strong>Acc√®s :</strong> Galeries ‚Üí Historique</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Journal de toutes les sessions voix effectu√©es avec les agents. Permet de consulter les transcriptions, analyser les sentiments et exporter les donn√©es.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Filtres</strong> - Date, Agent, Statut, Dur√©e, Sentiment</li>
                <li><strong>D√©tails session</strong> - Date/Heure, Dur√©e, Agent, Transcription</li>
                <li><strong>Analyse</strong> - Sentiment, Tokens consomm√©s, Co√ªt</li>
                <li><strong>Export</strong> - CSV, JSON</li>
                <li><strong>Rejouer</strong> - √âcouter l'audio (si enregistr√©)</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Historique vide</td><td>Aucune session effectu√©e</td><td>Tester un agent pour cr√©er une session</td></tr>
                        <tr><td>Transcription manquante</td><td>Session interrompue</td><td>Les sessions &lt;10s ne sont pas sauv√©es</td></tr>
                        <tr><td>Export √©choue</td><td>Trop de donn√©es</td><td>R√©duire la plage de dates</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.5.5 Galerie Campagnes -->
            <h3>12.5.5 Galerie des Campagnes</h3>
            <p><strong>Route :</strong> <code>/agents/campaigns/gallery</code> | <strong>Acc√®s :</strong> Galeries ‚Üí Campagnes</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Vue d'ensemble de toutes les campagnes d'appels sortants cr√©√©es, avec leur statut et progression.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Carte campagne</strong> - Nom, Agent, Statut (En cours/Termin√©e/Paus√©e)</li>
                <li><strong>Progression</strong> - Barre X/Y appels effectu√©s</li>
                <li><strong>Taux de succ√®s</strong> - Pourcentage de r√©ussite</li>
                <li><strong>Actions</strong> - Voir d√©tails, Pause/Reprendre, Exporter</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Campagne bloqu√©e</td><td>Tous contacts appel√©s</td><td>Ajouter de nouveaux contacts</td></tr>
                        <tr><td>Taux succ√®s bas</td><td>Num√©ros invalides</td><td>Nettoyer la liste de contacts</td></tr>
                        <tr><td>Pas de progression</td><td>Hors plage horaire</td><td>Attendre l'heure configur√©e</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.5.6 Galerie Voix Personnelles -->
            <h3>12.5.6 Galerie des Voix Personnelles</h3>
            <p><strong>Route :</strong> <code>/creer-une-voix/gallery</code> | <strong>Acc√®s :</strong> Galeries ‚Üí Voix</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Liste de toutes les voix personnelles cr√©√©es via le clonage vocal. Permet d'√©couter, g√©rer et assigner les voix aux agents.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Carte voix</strong> - Nom, Langue, Date cr√©ation</li>
                <li><strong>√âcouter</strong> - Aper√ßu audio de la voix</li>
                <li><strong>Utiliser</strong> - Assigner √† un agent</li>
                <li><strong>Supprimer</strong> - Retirer la voix (irr√©versible)</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Voix non list√©e</td><td>G√©n√©ration en cours</td><td>Attendre 5-10 minutes</td></tr>
                        <tr><td>Aper√ßu silencieux</td><td>Navigateur bloque audio</td><td>Cliquer sur la page d'abord</td></tr>
                        <tr><td>Voix disparue</td><td>Expiration Azure</td><td>Les voix expirent apr√®s 90 jours d'inactivit√©</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.5.7 Galerie Tools -->
            <h3>12.5.7 Galerie des Tools</h3>
            <p><strong>Route :</strong> <code>/tools/</code> | <strong>Acc√®s :</strong> Galeries ‚Üí Tools</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Catalogue de tous les outils disponibles pour les agents : outils syst√®me pr√©-int√©gr√©s et outils personnalis√©s cr√©√©s par l'utilisateur.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Cat√©gorie</th><th>Exemples</th></tr></thead>
                    <tbody>
                        <tr><td><strong>Basiques</strong></td><td>calculator, weather, translator</td></tr>
                        <tr><td><strong>Communication</strong></td><td>email, sms, end_conversation</td></tr>
                        <tr><td><strong>Recherche</strong></td><td>search_web, places, knowledge_base</td></tr>
                        <tr><td><strong>Voyage</strong></td><td>flight_search, hotel_booking</td></tr>
                        <tr><td><strong>Services</strong></td><td>prayer_times, pharmacy_locator</td></tr>
                        <tr><td><strong>Custom</strong></td><td>Vos tools personnalis√©s</td></tr>
                    </tbody>
                </table>
            </div>
            <ul>
                <li><strong>Filtres</strong> - Par cat√©gorie, type (syst√®me/custom)</li>
                <li><strong>Recherche</strong> - Par nom ou description</li>
                <li><strong>D√©tails</strong> - Voir la configuration compl√®te</li>
                <li><strong>Actions</strong> - Modifier, Dupliquer, Supprimer (custom uniquement)</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Tool syst√®me non modifiable</td><td>Prot√©g√©</td><td>Dupliquer pour cr√©er une version custom</td></tr>
                        <tr><td>Tool custom disparu</td><td>Supprim√© ou erreur</td><td>Recr√©er le tool</td></tr>
                        <tr><td>Test tool √©choue</td><td>Configuration invalide</td><td>V√©rifier les param√®tres et l'endpoint</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 12.6 MENU DASHBOARDS & REPORTING
                 ================================================ -->
            <h2>12.6 Menu Dashboards & Reporting</h2>

            <!-- 12.6.1 Dashboard Qualit√© -->
            <h3>12.6.1 Dashboard Qualit√©</h3>
            <p><strong>Route :</strong> <code>/quality</code> | <strong>Acc√®s :</strong> Dashboards ‚Üí Qualit√©</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Tableau de bord d√©di√© √† l'analyse qualitative des conversations. Affiche les m√©triques de sentiment, performance et satisfaction client.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Analyse Sentiment</strong> - Distribution positif/neutre/n√©gatif avec graphiques</li>
                <li><strong>Tendances</strong> - √âvolution dans le temps (jour/semaine/mois)</li>
                <li><strong>Performance par Agent</strong> - Comparaison entre agents</li>
                <li><strong>Dur√©e moyenne</strong> - Statistiques des interactions</li>
                <li><strong>Taux d'interruption</strong> - Fr√©quence des barge-in</li>
                <li><strong>Export</strong> - T√©l√©charger les rapports</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Graphiques vides</td><td>Pas de donn√©es sur la p√©riode</td><td>√âlargir la plage de dates</td></tr>
                        <tr><td>Sentiment non analys√©</td><td>Transcription trop courte</td><td>Normal pour sessions &lt;30s</td></tr>
                        <tr><td>Chargement lent</td><td>Beaucoup de donn√©es</td><td>R√©duire la p√©riode d'analyse</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.6.2 Dashboard Production -->
            <h3>12.6.2 Dashboard Production</h3>
            <p><strong>Route :</strong> <code>/production/</code> | <strong>Acc√®s :</strong> Dashboards ‚Üí Production</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Tableau de bord business affichant les m√©triques de volume, revenus, co√ªts et rentabilit√© de la plateforme.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Volume d'appels</strong> - Par jour/semaine/mois avec graphiques</li>
                <li><strong>Revenus g√©n√©r√©s</strong> - Facturation client calcul√©e</li>
                <li><strong>Co√ªts Azure</strong> - Consommation ressources (OpenAI, Speech, Search)</li>
                <li><strong>Marge brute</strong> - Revenus - Co√ªts en temps r√©el</li>
                <li><strong>Co√ªt par minute</strong> - √âvolution et tendances</li>
                <li><strong>Comparaison</strong> - P√©riode actuelle vs pr√©c√©dente</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Revenus √† z√©ro</td><td>Taux non configur√©</td><td>Configurer le taux ‚Ç¨/min dans Accueil</td></tr>
                        <tr><td>Co√ªts non affich√©s</td><td>Donn√©es Azure manquantes</td><td>V√©rifier la connexion aux APIs Azure</td></tr>
                        <tr><td>Marge n√©gative</td><td>Co√ªts > Revenus</td><td>Augmenter le taux de facturation</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 12.7 INTERFACES DE SESSION
                 ================================================ -->
            <h2>12.7 Interfaces de Session</h2>

            <!-- 12.7.1 Session Voix -->
            <h3>12.7.1 Session Voix</h3>
            <p><strong>Route :</strong> <code>/agents/&lt;agent_id&gt;/session</code> | <strong>Acc√®s :</strong> Galerie Agents ‚Üí Bouton "Tester"</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Interface de test en temps r√©el pour converser vocalement avec un agent. Utilise WebSocket pour la communication bidirectionnelle audio.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Header</strong> - Nom agent, statut connexion, bouton retour</li>
                <li><strong>Zone conversation</strong> - Transcription utilisateur et agent</li>
                <li><strong>Indicateurs</strong> - Qui parle, tools ex√©cut√©s</li>
                <li><strong>Contr√¥les</strong> - Boutons Start/Stop/Mute</li>
                <li><strong>Waveform</strong> - Visualisation audio en temps r√©el</li>
            </ul>

            <p><strong>Indicateurs de Statut :</strong></p>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Indicateur</th><th>Signification</th></tr></thead>
                    <tbody>
                        <tr><td><span style="color: #51cf66;">‚óè</span> Connect√©</td><td>Session WebSocket active</td></tr>
                        <tr><td><span style="color: #ffd43b;">‚óè</span> Connexion...</td><td>En cours de connexion √† Azure</td></tr>
                        <tr><td><span style="color: #ff6b6b;">‚óè</span> D√©connect√©</td><td>Session termin√©e ou erreur</td></tr>
                        <tr><td><i class="bi bi-mic-fill" style="color: #51cf66;"></i></td><td>Utilisateur parle</td></tr>
                        <tr><td><i class="bi bi-robot" style="color: #7B1FA2;"></i></td><td>Agent parle</td></tr>
                        <tr><td><i class="bi bi-tools" style="color: #ffd43b;"></i></td><td>Tool en cours d'ex√©cution</td></tr>
                    </tbody>
                </table>
            </div>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Connexion √©choue</td><td>WebSocket bloqu√©</td><td>V√©rifier le pare-feu, utiliser HTTPS</td></tr>
                        <tr><td>Micro non d√©tect√©</td><td>Permissions refus√©es</td><td>Autoriser l'acc√®s au microphone</td></tr>
                        <tr><td>Agent ne r√©pond pas</td><td>Pas de VAD d√©tect√©</td><td>Parler plus fort, v√©rifier le micro</td></tr>
                        <tr><td>Audio crackling</td><td>Bande passante insuffisante</td><td>Am√©liorer la connexion internet</td></tr>
                        <tr><td>Tool timeout</td><td>API externe lente</td><td>Le tool a 60s max, v√©rifier l'endpoint</td></tr>
                        <tr><td>Session interrompue</td><td>Inactivit√© 5min</td><td>Relancer la session</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.7.2 Session Avatar -->
            <h3>12.7.2 Session Avatar</h3>
            <p><strong>Route :</strong> <code>/azure-avatar/session/&lt;agent_id&gt;</code> | <strong>Acc√®s :</strong> Galerie Avatar ‚Üí Bouton "Tester"</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Interface de session avec avatar vid√©o anim√©. Combine la voix avec un rendu vid√©o temps r√©el synchronis√© sur les l√®vres.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Zone vid√©o</strong> - Affichage de l'avatar anim√© (720p/1080p)</li>
                <li><strong>Lip-sync</strong> - Synchronisation des l√®vres avec l'audio</li>
                <li><strong>WebRTC</strong> - Streaming vid√©o temps r√©el</li>
                <li><strong>Contr√¥les</strong> - Start/Stop, Plein √©cran</li>
                <li><strong>Transcription</strong> - Sous-titres en temps r√©el</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>Vid√©o noire</td><td>WebRTC bloqu√©</td><td>Autoriser les connexions WebRTC/TURN</td></tr>
                        <tr><td>Avatar fig√©</td><td>Session Azure expir√©e</td><td>Relancer la session (max 10min)</td></tr>
                        <tr><td>D√©synchronisation</td><td>Latence r√©seau</td><td>Am√©liorer la connexion</td></tr>
                        <tr><td>Vid√©o pixelis√©e</td><td>Bande passante faible</td><td>Minimum 5 Mbps recommand√©</td></tr>
                        <tr><td>Erreur ICE</td><td>Firewall bloque STUN/TURN</td><td>Ouvrir les ports UDP 3478, 5349</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 12.7.3 Session Chat Texte -->
            <h3>12.7.3 Session Chat Texte</h3>
            <p><strong>Route :</strong> <code>/text-agents/chat/&lt;agent_id&gt;</code> | <strong>Acc√®s :</strong> Galerie Texte ‚Üí Bouton "Tester"</p>

            <h4><i class="bi bi-info-circle"></i> Description</h4>
            <p>Interface de chat textuel avec un agent. Utilise SSE (Server-Sent Events) pour le streaming des r√©ponses.</p>

            <h4><i class="bi bi-gear"></i> Fonctionnalit√©s</h4>
            <ul>
                <li><strong>Zone de chat</strong> - Messages avec markdown support√©</li>
                <li><strong>Streaming</strong> - R√©ponse affich√©e mot par mot</li>
                <li><strong>Attachments</strong> - Upload de fichiers pour analyse</li>
                <li><strong>Historique</strong> - Conversation sauvegard√©e</li>
                <li><strong>Export</strong> - T√©l√©charger la conversation</li>
            </ul>

            <h4><i class="bi bi-exclamation-triangle"></i> Troubleshooting</h4>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Probl√®me</th><th>Cause</th><th>Solution</th></tr></thead>
                    <tbody>
                        <tr><td>R√©ponse bloqu√©e</td><td>SSE interrompu</td><td>Rafra√Æchir la page</td></tr>
                        <tr><td>Upload √©choue</td><td>Fichier trop volumineux</td><td>Max 10MB par fichier</td></tr>
                        <tr><td>R√©ponse tronqu√©e</td><td>Limite tokens atteinte</td><td>D√©marrer une nouvelle conversation</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 12.8 RACCOURCIS ET NAVIGATION
                 ================================================ -->
            <h2>12.8 Raccourcis et Navigation Rapide</h2>

            <div class="mermaid">
flowchart TB
    HOME["Accueil /"] --> AGENTS["Agents"]
    HOME --> RAG["Waka AXIOM"]
    HOME --> DASH["Dashboards"]

    AGENTS --> VOICE["/agents/gallery"]
    AGENTS --> TEXT["/text-agents/gallery"]
    AGENTS --> AVATAR["/azure-avatar/gallery"]

    RAG --> UPLOAD["/rag/upload"]
    RAG --> CRAWL["/rag/crawl"]
    RAG --> KB["/rag/knowledge"]
    RAG --> CHAT["/rag/chat-enhanced"]

    DASH --> QUALITY["/quality"]
    DASH --> PROD["/production/"]

    style HOME fill:#4A148C,color:#fff
    style AGENTS fill:#7B1FA2,color:#fff
    style RAG fill:#7B1FA2,color:#fff
    style DASH fill:#7B1FA2,color:#fff
            </div>

            <h3>Tableau R√©capitulatif des Routes</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>√âcran</th><th>Route</th><th>Menu</th></tr>
                    </thead>
                    <tbody>
                        <tr><td>Dashboard Accueil</td><td><code>/</code></td><td>Accueil</td></tr>
                        <tr><td>Upload Documents</td><td><code>/rag/upload</code></td><td>Waka AXIOM</td></tr>
                        <tr><td>Crawler Web</td><td><code>/rag/crawl</code></td><td>Waka AXIOM</td></tr>
                        <tr><td>SharePoint</td><td><code>/rag/sharepoint</code></td><td>Waka AXIOM</td></tr>
                        <tr><td>Base de Connaissances</td><td><code>/rag/knowledge</code></td><td>Waka AXIOM</td></tr>
                        <tr><td>Chat RAG</td><td><code>/rag/chat-enhanced</code></td><td>Waka AXIOM</td></tr>
                        <tr><td>Cr√©er Agent</td><td><code>/agents/unified/create</code></td><td>Cr√©ation</td></tr>
                        <tr><td>Cr√©er Voix</td><td><code>/creer-une-voix</code></td><td>Cr√©ation</td></tr>
                        <tr><td>Cr√©er Campagne</td><td><code>/campaigns/create/step1</code></td><td>Cr√©ation</td></tr>
                        <tr><td>Cr√©er Tool</td><td><code>/tools/add</code></td><td>Cr√©ation</td></tr>
                        <tr><td>Galerie Voix</td><td><code>/agents/gallery</code></td><td>Galeries</td></tr>
                        <tr><td>Galerie Texte</td><td><code>/text-agents/gallery</code></td><td>Galeries</td></tr>
                        <tr><td>Galerie Avatar</td><td><code>/azure-avatar/gallery</code></td><td>Galeries</td></tr>
                        <tr><td>Historique Voix</td><td><code>/agents/voice-history</code></td><td>Galeries</td></tr>
                        <tr><td>Galerie Campagnes</td><td><code>/agents/campaigns/gallery</code></td><td>Galeries</td></tr>
                        <tr><td>Galerie Voix Perso</td><td><code>/creer-une-voix/gallery</code></td><td>Galeries</td></tr>
                        <tr><td>Galerie Tools</td><td><code>/tools/</code></td><td>Galeries</td></tr>
                        <tr><td>Dashboard Qualit√©</td><td><code>/quality</code></td><td>Dashboards</td></tr>
                        <tr><td>Dashboard Production</td><td><code>/production/</code></td><td>Dashboards</td></tr>
                    </tbody>
                </table>
            </div>

        </section>

        <!-- ==========================================
             CHAPITRE 13: CODE ET FRAMEWORK
             ========================================== -->
        <section id="code-framework" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-code-slash"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 13: Code et Framework</h1>
                    <p class="section-subtitle">Architecture technique, arborescence et infrastructure cloud</p>
                </div>
            </div>

            <!-- 13.1 Stack Technique -->
            <h2>13.1 Stack Technique</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Couche</th><th>Technologie</th><th>Version</th><th>R√¥le</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Backend</strong></td><td>Python / Flask</td><td>3.11+ / 3.0</td><td>API REST, WebSocket, SSE</td></tr>
                        <tr><td><strong>Frontend</strong></td><td>Jinja2 + Bootstrap 5</td><td>-</td><td>Templates HTML, CSS, JS</td></tr>
                        <tr><td><strong>Temps r√©el</strong></td><td>WebSocket / WebRTC</td><td>-</td><td>Audio bidirectionnel, Avatar vid√©o</td></tr>
                        <tr><td><strong>Base de donn√©es</strong></td><td>Azure Cosmos DB</td><td>NoSQL</td><td>Agents, Sessions, Tools, Projets</td></tr>
                        <tr><td><strong>Recherche</strong></td><td>Azure AI Search</td><td>-</td><td>Indexation RAG, recherche s√©mantique</td></tr>
                        <tr><td><strong>Stockage</strong></td><td>Azure Blob Storage</td><td>-</td><td>Documents, audio, avatars</td></tr>
                        <tr><td><strong>IA</strong></td><td>Azure OpenAI</td><td>GPT-4o, GPT-5</td><td>LLM, Realtime API</td></tr>
                        <tr><td><strong>Voix</strong></td><td>Azure Speech Services</td><td>-</td><td>STT, TTS, Personal Voice</td></tr>
                        <tr><td><strong>Avatar</strong></td><td>Azure Avatar Service</td><td>-</td><td>Rendu vid√©o temps r√©el</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 13.2 Arborescence du Projet -->
            <h2>13.2 Arborescence du Projet</h2>

            <pre><code class="language-plaintext">wakavoice/
‚îú‚îÄ‚îÄ app.py                          # Point d'entr√©e Flask
‚îú‚îÄ‚îÄ requirements.txt                # D√©pendances Python
‚îú‚îÄ‚îÄ .env                            # Variables d'environnement
‚îÇ
‚îú‚îÄ‚îÄ Blueprints/                     # Routes Flask (Blueprints)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ agents_config_routes.py     # CRUD agents voix (~122k)
‚îÇ   ‚îú‚îÄ‚îÄ unified_agent_routes.py     # Cr√©ation unifi√©e agents (~106k)
‚îÇ   ‚îú‚îÄ‚îÄ text_agents_routes.py       # Agents texte + chat SSE (~178k)
‚îÇ   ‚îú‚îÄ‚îÄ avatar_routes.py            # Agents avatar (~69k)
‚îÇ   ‚îú‚îÄ‚îÄ avatar_live_proxy.py        # WebSocket proxy avatar (~78k)
‚îÇ   ‚îú‚îÄ‚îÄ voice_live_proxy.py         # WebSocket proxy voix (~101k)
‚îÇ   ‚îú‚îÄ‚îÄ campaign_routes.py          # Campagnes d'appels (~29k)
‚îÇ   ‚îú‚îÄ‚îÄ conversation_history_routes.py  # Historique sessions (~34k)
‚îÇ   ‚îú‚îÄ‚îÄ crawl_routes.py             # Crawler web RAG (~22k)
‚îÇ   ‚îú‚îÄ‚îÄ personal_voice_routes.py    # Clonage vocal (~87k)
‚îÇ   ‚îú‚îÄ‚îÄ prompt_builder_routes.py    # G√©n√©rateur prompts (~31k)
‚îÇ   ‚îú‚îÄ‚îÄ quality_dashboard_routes.py # Dashboard qualit√© (~50k)
‚îÇ   ‚îú‚îÄ‚îÄ production_dashboard_routes.py  # Dashboard business (~28k)
‚îÇ   ‚îú‚îÄ‚îÄ project_routes.py           # Projets RAG (~12k)
‚îÇ   ‚îú‚îÄ‚îÄ api_document_upload.py      # Upload documents RAG (~75k)
‚îÇ   ‚îú‚îÄ‚îÄ api_process_message_stream.py   # Chat RAG SSE (~57k)
‚îÇ   ‚îú‚îÄ‚îÄ api_rag_search.py           # Recherche s√©mantique (~10k)
‚îÇ   ‚îú‚îÄ‚îÄ api_kickoff_indexation.py   # Indexation documents (~34k)
‚îÇ   ‚îî‚îÄ‚îÄ tools/                      # Routes gestion tools
‚îÇ       ‚îî‚îÄ‚îÄ tools_routes.py         # CRUD tools dynamiques
‚îÇ
‚îú‚îÄ‚îÄ configuration/                  # Managers Cosmos DB
‚îÇ   ‚îú‚îÄ‚îÄ cosmos_config.py            # Client Cosmos principal (~102k)
‚îÇ   ‚îú‚îÄ‚îÄ cosmos_agent_manager.py     # CRUD agents voix (~28k)
‚îÇ   ‚îú‚îÄ‚îÄ cosmos_text_agent_manager.py    # CRUD agents texte (~36k)
‚îÇ   ‚îú‚îÄ‚îÄ cosmos_unified_manager.py   # Manager unifi√© (~30k)
‚îÇ   ‚îú‚îÄ‚îÄ cosmos_azure_avatar_manager_v2.py   # Agents avatar (~31k)
‚îÇ   ‚îú‚îÄ‚îÄ cosmos_tools_manager.py     # CRUD tools (~30k)
‚îÇ   ‚îú‚îÄ‚îÄ cosmos_session_manager.py   # Sessions voix (~14k)
‚îÇ   ‚îú‚îÄ‚îÄ cosmos_campaign_manager.py  # Campagnes (~13k)
‚îÇ   ‚îú‚îÄ‚îÄ cosmos_project_manager.py   # Projets RAG (~8k)
‚îÇ   ‚îú‚îÄ‚îÄ unified_session_manager.py  # Gestion sessions (~18k)
‚îÇ   ‚îú‚îÄ‚îÄ unified_session_closure.py  # Cl√¥ture sessions + r√©sum√© AI + sentiment (~23k)
‚îÇ   ‚îú‚îÄ‚îÄ voice_live_config.py        # Config Azure Realtime (~18k)
‚îÇ   ‚îú‚îÄ‚îÄ voice_live_session_builder.py   # Builder sessions (~19k)
‚îÇ   ‚îú‚îÄ‚îÄ cost_calculator.py          # Calcul co√ªts Azure (~9k)
‚îÇ   ‚îú‚îÄ‚îÄ sentiment_analysis.py       # Analyse sentiment (~9k)
‚îÇ   ‚îú‚îÄ‚îÄ model_mapping.py            # Mapping mod√®les (~4k)
‚îÇ   ‚îî‚îÄ‚îÄ personal_voice_storage.py   # Stockage voix perso (~15k)
‚îÇ
‚îú‚îÄ‚îÄ tools/                          # Outils syst√®me (built-in)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                 # Registry des tools (~14k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_weather.py             # M√©t√©o (~5k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_calculator.py          # Calculatrice (~3k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_email.py               # Envoi email (~11k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_translator.py          # Traduction (~8k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_search_web.py          # Recherche web (~6k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_places.py              # Google Places (~8k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_flight_search.py       # Recherche vols (~16k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_hotel_search.py        # Recherche h√¥tels (~16k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_knowledge_base.py      # RAG search (~7k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_end_conversation.py    # Fin conversation (~7k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_prayer_times.py        # Horaires pri√®res (~8k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_pharmacy_locator.py    # Pharmacies (~10k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_tax_calculator.py      # Calcul imp√¥ts (~13k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_news.py                # Actualit√©s (~8k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_currency.py            # Conversion devises (~7k)
‚îÇ   ‚îú‚îÄ‚îÄ tool_cv.py                  # Analyse CV (~25k)
‚îÇ   ‚îî‚îÄ‚îÄ ... (30+ tools)
‚îÇ
‚îú‚îÄ‚îÄ utils/                          # Utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ indexation.py               # Indexation Azure Search (~75k)
‚îÇ   ‚îú‚îÄ‚îÄ chat.py                     # Helpers chat (~19k)
‚îÇ   ‚îú‚îÄ‚îÄ prompt_generator.py         # G√©n√©ration prompts IA (~12k)
‚îÇ   ‚îú‚îÄ‚îÄ session_watchdog.py         # Monitoring sessions (~13k)
‚îÇ   ‚îú‚îÄ‚îÄ lead_capture.py             # Capture leads (~17k)
‚îÇ   ‚îî‚îÄ‚îÄ tools/                      # Ex√©cuteurs tools
‚îÇ       ‚îî‚îÄ‚îÄ dynamic_tool_executor.py    # Ex√©cution tools dynamiques
‚îÇ
‚îú‚îÄ‚îÄ templates/                      # Templates Jinja2
‚îÇ   ‚îú‚îÄ‚îÄ base.html                   # Layout principal
‚îÇ   ‚îú‚îÄ‚îÄ agents/                     # Pages agents voix
‚îÇ   ‚îú‚îÄ‚îÄ text_agents/                # Pages agents texte
‚îÇ   ‚îú‚îÄ‚îÄ azure-avatar/               # Pages avatar
‚îÇ   ‚îú‚îÄ‚îÄ unified/                    # Cr√©ation unifi√©e
‚îÇ   ‚îú‚îÄ‚îÄ campaigns/                  # Pages campagnes
‚îÇ   ‚îú‚îÄ‚îÄ RAG/                        # Pages RAG/AXIOM
‚îÇ   ‚îú‚îÄ‚îÄ tools/                      # Pages tools
‚îÇ   ‚îú‚îÄ‚îÄ personal_voice/             # Clonage vocal
‚îÇ   ‚îú‚îÄ‚îÄ prompt_builder/             # Prompt builder
‚îÇ   ‚îî‚îÄ‚îÄ errors/                     # Pages erreur
‚îÇ
‚îú‚îÄ‚îÄ static/                         # Assets statiques
‚îÇ   ‚îú‚îÄ‚îÄ css/                        # Feuilles de style
‚îÇ   ‚îú‚îÄ‚îÄ js/                         # JavaScript client
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voice_live_session.js   # Client WebSocket voix (~55k)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ voice_session.js        # Session voix legacy (~63k)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ agent_voice_session.js  # Session voix agent avec AudioSession (~29k)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ avatar_immersive.js     # Client avatar WebRTC (~64k)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ personal_voice.js       # Clonage vocal UI (~76k)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ prompt_builder.js       # Prompt builder UI (~37k)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ flow_builder.js         # Flow builder (~34k)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ crawl.js                # Crawler UI (~23k)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ upload_file.js          # Upload documents (~22k)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tools/                  # JS gestion tools
‚îÇ   ‚îú‚îÄ‚îÄ images/                     # Images, logos
‚îÇ   ‚îú‚îÄ‚îÄ fonts/                      # Polices
‚îÇ   ‚îî‚îÄ‚îÄ data/                       # Donn√©es statiques
‚îÇ
‚îú‚îÄ‚îÄ translations/                   # Internationalisation
‚îÇ   ‚îú‚îÄ‚îÄ fr/                         # Fran√ßais
‚îÇ   ‚îú‚îÄ‚îÄ en/                         # English
‚îÇ   ‚îî‚îÄ‚îÄ es/                         # Espa√±ol
‚îÇ
‚îú‚îÄ‚îÄ scripts/                        # Scripts utilitaires
‚îÇ   ‚îî‚îÄ‚îÄ doc_generator/              # G√©n√©ration documentation
‚îÇ
‚îî‚îÄ‚îÄ docs/                           # Documentation
    ‚îî‚îÄ‚îÄ WAKAVOICE_DOCUMENTATION_COMPLETE.html
</code></pre>

            <!-- 13.3 Infrastructure Cloud Azure -->
            <h2>13.3 Infrastructure Cloud Azure</h2>

            <div class="mermaid">
flowchart TB
    subgraph Client["Client (Navigateur)"]
        UI[Interface Web]
        WS[WebSocket Client]
        WebRTC[WebRTC Client]
    end

    subgraph Azure["Azure Cloud"]
        subgraph AppService["Azure App Service"]
            Flask[Flask Application]
            Gunicorn[Gunicorn Workers]
        end

        subgraph Cognitive["Azure Cognitive Services"]
            OpenAI[Azure OpenAI<br/>GPT-4o / GPT-5 / Realtime]
            Speech[Azure Speech<br/>STT / TTS / Personal Voice]
            Avatar[Azure Avatar Service<br/>Video Rendering]
        end

        subgraph Data["Azure Data Services"]
            Cosmos[(Cosmos DB<br/>NoSQL)]
            Search[(Azure AI Search<br/>Vector Index)]
            Blob[(Blob Storage<br/>Documents / Media)]
        end
    end

    UI --> Flask
    WS --> Flask
    WebRTC --> Avatar

    Flask --> OpenAI
    Flask --> Speech
    Flask --> Avatar
    Flask --> Cosmos
    Flask --> Search
    Flask --> Blob

    style Client fill:#E3F2FD,stroke:#1976D2
    style Azure fill:#FFF3E0,stroke:#F57C00
    style AppService fill:#E8F5E9,stroke:#4CAF50
    style Cognitive fill:#FCE4EC,stroke:#E91E63
    style Data fill:#F3E5F5,stroke:#9C27B0
            </div>

            <!-- 13.4 Services Azure Utilis√©s -->
            <h2>13.4 Services Azure Utilis√©s</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Service</th><th>Usage</th><th>R√©gion</th><th>SKU</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Azure App Service</strong></td>
                            <td>H√©bergement application Flask</td>
                            <td>France Central</td>
                            <td>P1v3 (Production)</td>
                        </tr>
                        <tr>
                            <td><strong>Azure Cosmos DB</strong></td>
                            <td>Base de donn√©es NoSQL</td>
                            <td>France Central</td>
                            <td>Serverless</td>
                        </tr>
                        <tr>
                            <td><strong>Azure OpenAI</strong></td>
                            <td>Mod√®les LLM (GPT-4o, GPT-5, Realtime)</td>
                            <td>Sweden Central / West US 2</td>
                            <td>S0</td>
                        </tr>
                        <tr>
                            <td><strong>Azure Speech Services</strong></td>
                            <td>STT, TTS, Personal Voice</td>
                            <td>West Europe</td>
                            <td>S0</td>
                        </tr>
                        <tr>
                            <td><strong>Azure Avatar Service</strong></td>
                            <td>Rendu avatar vid√©o temps r√©el</td>
                            <td>West US 2</td>
                            <td>Standard</td>
                        </tr>
                        <tr>
                            <td><strong>Azure AI Search</strong></td>
                            <td>Indexation et recherche vectorielle RAG</td>
                            <td>France Central</td>
                            <td>Standard</td>
                        </tr>
                        <tr>
                            <td><strong>Azure Blob Storage</strong></td>
                            <td>Documents, audio, avatars</td>
                            <td>France Central</td>
                            <td>Hot</td>
                        </tr>
                        <tr>
                            <td><strong>Azure Key Vault</strong></td>
                            <td>Gestion des secrets</td>
                            <td>France Central</td>
                            <td>Standard</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 13.5 Containers Cosmos DB -->
            <h2>13.5 Containers Cosmos DB</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Container</th><th>Partition Key</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>AgentConfigurations</code></td><td>/id</td><td>Agents voix (mod√®le, voix, tools, instructions)</td></tr>
                        <tr><td><code>TextAgentConfigurations</code></td><td>/id</td><td>Agents texte (chatbots)</td></tr>
                        <tr><td><code>AvatarConfigurations</code></td><td>/id</td><td>Agents avatar (vid√©o/photo)</td></tr>
                        <tr><td><code>UnifiedAgents</code></td><td>/id</td><td>Agents cr√©√©s via interface unifi√©e</td></tr>
                        <tr><td><code>ToolsConfigurations</code></td><td>/id</td><td>Outils dynamiques (OpenAPI, REST, Python, RAG)</td></tr>
                        <tr><td><code>VoiceSessions</code></td><td>/agent_id</td><td>Historique sessions voix</td></tr>
                        <tr><td><code>TextSessions</code></td><td>/agent_id</td><td>Historique sessions texte</td></tr>
                        <tr><td><code>Campaigns</code></td><td>/id</td><td>Campagnes d'appels sortants</td></tr>
                        <tr><td><code>RAGProjects</code></td><td>/id</td><td>Projets RAG (configuration indexation)</td></tr>
                        <tr><td><code>Documents</code></td><td>/project_id</td><td>M√©tadonn√©es documents index√©s</td></tr>
                        <tr><td><code>PersonalVoices</code></td><td>/id</td><td>Voix personnelles clon√©es</td></tr>
                        <tr><td><code>AvatarPreferences</code></td><td>/user_id</td><td>Pr√©f√©rences avatar utilisateur</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 13.6 Flux de Donn√©es -->
            <h2>13.6 Flux de Donn√©es</h2>

            <h3>13.6.1 Session Voix Temps R√©el</h3>
            <div class="mermaid">
sequenceDiagram
    participant Browser
    participant Flask
    participant Azure_OpenAI as Azure OpenAI<br/>Realtime API
    participant Tools

    Browser->>Flask: WebSocket Connect
    Flask->>Azure_OpenAI: WebSocket Connect (proxy)
    Azure_OpenAI-->>Flask: session.created

    loop Conversation
        Browser->>Flask: audio.data (PCM16)
        Flask->>Azure_OpenAI: audio.data
        Azure_OpenAI-->>Flask: transcript.user
        Azure_OpenAI-->>Flask: response.audio.delta
        Flask-->>Browser: audio.delta

        opt Tool Call
            Azure_OpenAI-->>Flask: tool.call
            Flask->>Tools: Execute tool
            Tools-->>Flask: Result
            Flask->>Azure_OpenAI: tool.result
        end
    end

    Browser->>Flask: session.end
    Flask->>Azure_OpenAI: WebSocket Close
            </div>

            <h3>13.6.2 Indexation RAG</h3>
            <div class="mermaid">
sequenceDiagram
    participant User
    participant Flask
    participant Blob as Azure Blob
    participant Search as Azure AI Search
    participant OpenAI as Azure OpenAI

    User->>Flask: Upload document
    Flask->>Blob: Store file
    Flask->>Flask: Extract text (PDF/DOCX)
    Flask->>Flask: Chunk text (512 tokens)
    Flask->>OpenAI: Generate embeddings
    OpenAI-->>Flask: Vectors
    Flask->>Search: Index chunks + vectors
    Search-->>Flask: Indexation complete
    Flask-->>User: Success
            </div>

            <!-- 13.7 Variables d'Environnement -->
            <h2>13.7 Variables d'Environnement</h2>

            <pre><code class="language-bash"># ===== Azure OpenAI =====
AZURE_OPENAI_ENDPOINT=https://&lt;resource&gt;.openai.azure.com/
AZURE_OPENAI_KEY=&lt;api-key&gt;
AZURE_OPENAI_API_VERSION=2025-10-01

# ===== Azure Speech Services =====
AZURE_SPEECH_KEY=&lt;api-key&gt;
AZURE_SPEECH_REGION=westeurope

# ===== Azure Voice Live (Realtime API) =====
VOICE_LIVE_ENDPOINT=https://&lt;resource&gt;.openai.azure.com/
VOICE_LIVE_KEY=&lt;api-key&gt;
VOICE_LIVE_REGION=swedencentral

# ===== Azure Avatar Service =====
AZURE_AVATAR_ENDPOINT=https://westus2.api.cognitive.microsoft.com/
AZURE_AVATAR_KEY=&lt;api-key&gt;
AZURE_AVATAR_REGION=westus2

# ===== Azure Cosmos DB =====
COSMOS_URI=https://&lt;account&gt;.documents.azure.com:443/
COSMOS_KEY=&lt;primary-key&gt;
COSMOS_DATABASE_NAME=ConversationsDB

# ===== Azure AI Search =====
AZURE_SEARCH_ENDPOINT=https://&lt;service&gt;.search.windows.net
AZURE_SEARCH_KEY=&lt;admin-key&gt;
AZURE_SEARCH_INDEX=rag-index

# ===== Azure Blob Storage =====
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;...
AZURE_STORAGE_CONTAINER=documents

# ===== Azure Communication Services (Email) =====
AZURE_COMMUNICATION_EMAIL_CONNECTION_STRING=endpoint=https://&lt;resource&gt;.communication.azure.com/;accesskey=&lt;key&gt;
AZURE_COMMUNICATION_EMAIL_SENDER=DoNotReply@&lt;domain&gt;.azurecomm.net

# ===== Azure OpenAI Summary (G√©n√©ration r√©sum√©s) =====
AZURE_OPENAI_SUMMARY_ENDPOINT=https://&lt;resource&gt;.openai.azure.com/
AZURE_OPENAI_SUMMARY_KEY=&lt;api-key&gt;
AZURE_OPENAI_SUMMARY_DEPLOYMENT=gpt-5-mini
AZURE_OPENAI_SUMMARY_API_VERSION=2025-01-01-preview

# ===== Azure Text Analytics (Analyse sentiment) =====
TEXT_ANALYTICS_ENDPOINT=https://&lt;resource&gt;.cognitiveservices.azure.com/
TEXT_ANALYTICS_KEY=&lt;api-key&gt;

# ===== Application =====
FLASK_SECRET_KEY=&lt;random-secret&gt;
FLASK_ENV=production</code></pre>

            <!-- 13.8 D√©ploiement -->
            <h2>13.8 D√©ploiement</h2>

            <h3>13.8.1 Pr√©requis</h3>
            <ul>
                <li>Python 3.11+</li>
                <li>Compte Azure avec les services activ√©s</li>
                <li>Azure CLI install√©</li>
            </ul>

            <h3>13.8.2 Installation Locale</h3>
            <pre><code class="language-bash"># Cloner le repository
git clone https://github.com/your-org/wakavoice.git
cd wakavoice

# Cr√©er environnement virtuel
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
.venv\Scripts\activate     # Windows

# Installer d√©pendances
pip install -r requirements.txt

# Configurer variables d'environnement
cp .env.example .env
# √âditer .env avec vos cl√©s Azure

# Lancer l'application
flask run --host=0.0.0.0 --port=5000</code></pre>

            <h3>13.8.3 D√©ploiement Azure App Service</h3>
            <pre><code class="language-bash"># Login Azure
az login

# Cr√©er resource group
az group create --name rg-wakavoice --location francecentral

# Cr√©er App Service Plan
az appservice plan create \
    --name plan-wakavoice \
    --resource-group rg-wakavoice \
    --sku P1V3 \
    --is-linux

# Cr√©er Web App
az webapp create \
    --name wakavoice-app \
    --resource-group rg-wakavoice \
    --plan plan-wakavoice \
    --runtime "PYTHON:3.11"

# Configurer variables d'environnement
az webapp config appsettings set \
    --name wakavoice-app \
    --resource-group rg-wakavoice \
    --settings @appsettings.json

# D√©ployer le code
az webapp deployment source config-local-git \
    --name wakavoice-app \
    --resource-group rg-wakavoice

git remote add azure &lt;git-url&gt;
git push azure master</code></pre>

            <!-- 13.9 T√©l√©charger le Code Source -->
            <h2>13.9 T√©l√©charger le Code Source</h2>

            <div class="callout callout-info">
                <i class="bi bi-cloud-download callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Acc√®s au Repository</div>
                    <p>Le code source complet de Waka Voice est h√©berg√© sur Azure DevOps. Cliquez sur le bouton ci-dessous pour acc√©der au repository et t√©l√©charger le code.</p>
                </div>
            </div>

            <div style="text-align: center; margin: 2rem 0;">
                <a href="https://dev.azure.com/your-org/wakavoice/_git/wakavoice"
                   target="_blank"
                   class="btn-download-code"
                   style="display: inline-flex; align-items: center; gap: 12px; background: linear-gradient(135deg, #4A148C, #7B1FA2); color: white; padding: 16px 32px; border-radius: 12px; text-decoration: none; font-size: 1.1rem; font-weight: 600; box-shadow: 0 4px 15px rgba(74, 20, 140, 0.4); transition: all 0.3s ease;">
                    <i class="bi bi-download" style="font-size: 1.4rem;"></i>
                    T√©l√©charger le Code depuis Azure DevOps
                    <i class="bi bi-box-arrow-up-right" style="font-size: 0.9rem; opacity: 0.8;"></i>
                </a>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>M√©thode</th><th>Commande / Action</th></tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Git Clone (HTTPS)</strong></td>
                            <td><code>git clone https://dev.azure.com/your-org/wakavoice/_git/wakavoice</code></td>
                        </tr>
                        <tr>
                            <td><strong>Git Clone (SSH)</strong></td>
                            <td><code>git clone git@ssh.dev.azure.com:v3/your-org/wakavoice/wakavoice</code></td>
                        </tr>
                        <tr>
                            <td><strong>Download ZIP</strong></td>
                            <td>Azure DevOps ‚Üí Repository ‚Üí "..." ‚Üí Download as ZIP</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </section>

        <!-- ==========================================
             CHAPITRE 14: ARCHITECTURE AVANC√âE
             ========================================== -->
        <section id="advanced-architecture" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-diagram-3"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 14: Architecture Avanc√©e</h1>
                    <p class="section-subtitle">Diagrammes d√©taill√©s des flux syst√®me</p>
                </div>
            </div>

            <!-- 14.1 Flux Session Avatar (WebRTC + ICE) -->
            <h2>14.1 Flux Complet Session Avatar (WebRTC + ICE)</h2>

            <p>Ce diagramme illustre le flux complet d'√©tablissement d'une session avatar avec n√©gociation WebRTC, signaling ICE et streaming vid√©o/audio.</p>

            <div class="mermaid">
sequenceDiagram
    autonumber
    participant Browser as üñ•Ô∏è Navigateur
    participant Flask as üêç Flask Server
    participant Azure_Avatar as üé≠ Azure Avatar Service
    participant TURN as üîÑ TURN Server
    participant OpenAI as ü§ñ Azure OpenAI

    Note over Browser,OpenAI: Phase 1: Initialisation Session

    Browser->>Flask: POST /azure-avatar/session/start
    Flask->>Azure_Avatar: Create Avatar Session
    Azure_Avatar-->>Flask: session_id, ice_servers[]
    Flask-->>Browser: {session_id, ice_config}

    Note over Browser,TURN: Phase 2: N√©gociation WebRTC

    Browser->>Browser: createPeerConnection(ice_servers)
    Browser->>Browser: getUserMedia(audio: true)
    Browser->>Browser: addTrack(audioTrack)
    Browser->>Browser: createOffer()

    Browser->>Flask: WS: {type: "offer", sdp: "..."}
    Flask->>Azure_Avatar: Forward SDP Offer
    Azure_Avatar-->>Flask: SDP Answer
    Flask-->>Browser: WS: {type: "answer", sdp: "..."}

    Browser->>Browser: setRemoteDescription(answer)

    Note over Browser,TURN: Phase 3: ICE Candidate Exchange

    loop ICE Gathering
        Browser->>Flask: WS: {type: "ice", candidate: "..."}
        Flask->>Azure_Avatar: Forward ICE Candidate
        Azure_Avatar-->>Flask: Remote ICE Candidate
        Flask-->>Browser: WS: {type: "ice", candidate: "..."}
    end

    Browser->>TURN: STUN Binding Request
    TURN-->>Browser: STUN Binding Response (srflx candidate)

    Browser->>TURN: TURN Allocate Request
    TURN-->>Browser: TURN Allocate Response (relay candidate)

    Note over Browser,OpenAI: Phase 4: Streaming Actif

    Browser->>Azure_Avatar: üé§ Audio Stream (WebRTC)
    Azure_Avatar->>OpenAI: Transcription + LLM
    OpenAI-->>Azure_Avatar: Response Text
    Azure_Avatar->>Azure_Avatar: TTS + Lip Sync Generation
    Azure_Avatar-->>Browser: üìπ Video Stream (WebRTC)
    Azure_Avatar-->>Browser: üîä Audio Stream (WebRTC)

    Note over Browser,OpenAI: Phase 5: Fermeture

    Browser->>Flask: WS: {type: "end_session"}
    Flask->>Azure_Avatar: Close Session
    Azure_Avatar-->>Flask: Session Closed
    Browser->>Browser: peerConnection.close()
            </div>

            <h3>Composants ICE/TURN</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Composant</th><th>R√¥le</th><th>Ports</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>STUN Server</strong></td><td>D√©couverte IP publique (NAT traversal)</td><td>UDP 3478</td></tr>
                        <tr><td><strong>TURN Server</strong></td><td>Relais m√©dia si connexion directe impossible</td><td>UDP/TCP 3478, 5349 (TLS)</td></tr>
                        <tr><td><strong>ICE Candidates</strong></td><td>host, srflx (server reflexive), relay</td><td>Dynamiques</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 14.2 Pipeline RAG D√©taill√© -->
            <h2>14.2 Pipeline RAG D√©taill√© (Chunking ‚Üí Embedding ‚Üí Search)</h2>

            <p>Architecture compl√®te du syst√®me RAG (Retrieval-Augmented Generation) depuis l'ingestion des documents jusqu'√† la g√©n√©ration de r√©ponses.</p>

            <div class="mermaid">
flowchart TB
    subgraph Ingestion["üì• Phase 1: Ingestion"]
        A[üìÑ Document Upload] --> B{Type?}
        B -->|PDF| C[PyPDF2 Extract]
        B -->|DOCX| D[python-docx Extract]
        B -->|HTML| E[BeautifulSoup Parse]
        B -->|TXT| F[Direct Read]

        C --> G[Raw Text]
        D --> G
        E --> G
        F --> G
    end

    subgraph Processing["‚öôÔ∏è Phase 2: Processing"]
        G --> H[Text Cleaning]
        H --> I[Sentence Tokenization]
        I --> J[Chunking Strategy]

        J --> K["Chunk 1<br/>(512 tokens)"]
        J --> L["Chunk 2<br/>(512 tokens)"]
        J --> M["Chunk N<br/>(512 tokens)"]

        K --> N[Overlap 50 tokens]
        L --> N
        M --> N
    end

    subgraph Embedding["üß† Phase 3: Embedding"]
        N --> O[Azure OpenAI<br/>text-embedding-ada-002]
        O --> P["Vector 1<br/>[1536 dims]"]
        O --> Q["Vector 2<br/>[1536 dims]"]
        O --> R["Vector N<br/>[1536 dims]"]
    end

    subgraph Storage["üíæ Phase 4: Storage"]
        P --> S[(Azure AI Search<br/>Vector Index)]
        Q --> S
        R --> S

        K --> T[(Azure Blob<br/>Original Docs)]
        L --> T
        M --> T

        S --> U[(Cosmos DB<br/>Metadata)]
    end

    subgraph Query["üîç Phase 5: Query"]
        V[User Question] --> W[Query Embedding]
        W --> X[Azure OpenAI<br/>text-embedding-ada-002]
        X --> Y["Query Vector<br/>[1536 dims]"]
        Y --> Z[Vector Similarity Search]
        Z --> S
        S --> AA[Top-K Chunks<br/>k=5, threshold=0.7]
    end

    subgraph Generation["üí¨ Phase 6: Generation"]
        AA --> AB[Context Assembly]
        V --> AB
        AB --> AC[Prompt Template]
        AC --> AD[Azure OpenAI<br/>GPT-4o / GPT-5]
        AD --> AE[Response + Citations]
    end

    style Ingestion fill:#E3F2FD,stroke:#1976D2
    style Processing fill:#FFF3E0,stroke:#F57C00
    style Embedding fill:#FCE4EC,stroke:#E91E63
    style Storage fill:#F3E5F5,stroke:#9C27B0
    style Query fill:#E8F5E9,stroke:#4CAF50
    style Generation fill:#FFFDE7,stroke:#FBC02D
            </div>

            <h3>Param√®tres de Chunking</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Param√®tre</th><th>Valeur</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Chunk Size</strong></td><td>512 tokens</td><td>Taille optimale pour contexte LLM</td></tr>
                        <tr><td><strong>Chunk Overlap</strong></td><td>50 tokens</td><td>Continuit√© s√©mantique entre chunks</td></tr>
                        <tr><td><strong>Embedding Model</strong></td><td>text-embedding-ada-002</td><td>1536 dimensions, optimis√© recherche</td></tr>
                        <tr><td><strong>Similarity Metric</strong></td><td>Cosine</td><td>Distance angulaire entre vecteurs</td></tr>
                        <tr><td><strong>Top-K</strong></td><td>5</td><td>Nombre de chunks retourn√©s</td></tr>
                        <tr><td><strong>Score Threshold</strong></td><td>0.7</td><td>Score minimum de similarit√©</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- 14.3 Architecture Multi-Tenant -->
            <h2>14.3 Architecture Multi-Tenant</h2>

            <p>Waka Voice supporte une architecture multi-tenant o√π chaque organisation dispose de ses propres agents, donn√©es et configurations isol√©es.</p>

            <div class="mermaid">
flowchart TB
    subgraph Clients["üåê Clients"]
        C1[Tenant A<br/>Entreprise 1]
        C2[Tenant B<br/>Entreprise 2]
        C3[Tenant C<br/>Entreprise 3]
    end

    subgraph Gateway["üö™ API Gateway"]
        LB[Load Balancer<br/>Azure Front Door]
        Auth[Authentication<br/>JWT + Tenant ID]
    end

    subgraph App["‚öôÔ∏è Application Layer"]
        direction TB
        F1[Flask Instance 1]
        F2[Flask Instance 2]
        F3[Flask Instance N]

        F1 --> TM[Tenant Middleware<br/>Isolation Context]
        F2 --> TM
        F3 --> TM
    end

    subgraph Data["üíæ Data Layer (Isolated)"]
        subgraph CosmosDB["Cosmos DB"]
            DB1[(Tenant A Data<br/>Partition: tenant_a)]
            DB2[(Tenant B Data<br/>Partition: tenant_b)]
            DB3[(Tenant C Data<br/>Partition: tenant_c)]
        end

        subgraph BlobStorage["Blob Storage"]
            B1[üìÅ tenant-a/]
            B2[üìÅ tenant-b/]
            B3[üìÅ tenant-c/]
        end

        subgraph SearchIndex["AI Search"]
            S1[Index: tenant-a-rag]
            S2[Index: tenant-b-rag]
            S3[Index: tenant-c-rag]
        end
    end

    subgraph Azure["‚òÅÔ∏è Azure Services (Shared)"]
        OpenAI[Azure OpenAI<br/>Shared Pool]
        Speech[Azure Speech<br/>Shared Pool]
        Avatar[Azure Avatar<br/>Shared Pool]
    end

    C1 --> LB
    C2 --> LB
    C3 --> LB

    LB --> Auth
    Auth --> F1
    Auth --> F2
    Auth --> F3

    TM --> DB1
    TM --> DB2
    TM --> DB3

    TM --> B1
    TM --> B2
    TM --> B3

    TM --> S1
    TM --> S2
    TM --> S3

    F1 --> OpenAI
    F2 --> Speech
    F3 --> Avatar

    style Clients fill:#E3F2FD,stroke:#1976D2
    style Gateway fill:#FFF3E0,stroke:#F57C00
    style App fill:#E8F5E9,stroke:#4CAF50
    style Data fill:#F3E5F5,stroke:#9C27B0
    style Azure fill:#FFFDE7,stroke:#FBC02D
            </div>

            <h3>Strat√©gie d'Isolation</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr><th>Ressource</th><th>Strat√©gie</th><th>Isolation</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><strong>Cosmos DB</strong></td><td>Partition Key = tenant_id</td><td>Donn√©es logiquement isol√©es</td></tr>
                        <tr><td><strong>Blob Storage</strong></td><td>Container par tenant</td><td>R√©pertoires s√©par√©s</td></tr>
                        <tr><td><strong>AI Search</strong></td><td>Index par tenant</td><td>Index d√©di√©s</td></tr>
                        <tr><td><strong>Azure OpenAI</strong></td><td>Pool partag√© + quotas</td><td>Rate limiting par tenant</td></tr>
                        <tr><td><strong>Sessions</strong></td><td>tenant_id dans session</td><td>Contexte isol√©</td></tr>
                        <tr><td><strong>Logs</strong></td><td>Tag tenant_id</td><td>Filtrage par tenant</td></tr>
                    </tbody>
                </table>
            </div>

            <h3>Sch√©ma Cosmos DB Multi-Tenant</h3>
            <pre><code class="language-json">{
    "id": "agent-uuid-123",
    "tenant_id": "tenant_a",           // Partition Key
    "type": "VoiceAgent",
    "name": "Agent Commercial",
    "created_by": "user@tenant-a.com",
    "config": {
        "model_id": "gpt-4o-realtime",
        "voice": "fr-FR-DeniseNeural",
        "tools": ["weather", "email"]
    },
    "_tenant_isolated": true,          // Flag isolation
    "_ts": 1703980800
}</code></pre>

        </section>

        <!-- ==========================================
             CHAPITRE 15: RESSOURCES AZURE
             ========================================== -->
        <section id="azure-resources" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-cloud-fill"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 15: Ressources Azure</h1>
                    <p class="section-subtitle">Services cloud utilis√©s et leurs cas d'usage</p>
                </div>
            </div>

            <div class="intro-text">
                Waka Voice s'appuie sur un ensemble de <strong>services Azure</strong> pour offrir une plateforme
                d'agents conversationnels performante et scalable. Ce chapitre liste toutes les ressources
                utilis√©es avec leurs cas d'usage sp√©cifiques.
            </div>

            <!-- ================================================
                 15.1 VUE D'ENSEMBLE DES RESSOURCES
                 ================================================ -->
            <h2>15.1 Vue d'Ensemble des Ressources</h2>

            <div class="mermaid">
flowchart TB
    subgraph COMPUTE["Compute"]
        APP[Azure App Service]
        FUNC[Azure Functions]
    end

    subgraph AI["Intelligence Artificielle"]
        AOAI[Azure OpenAI]
        SPEECH[Azure Speech Services]
        AVATAR[Azure Avatar Service]
        SEARCH[Azure AI Search]
    end

    subgraph DATA["Donnees"]
        COSMOS[(Cosmos DB)]
        BLOB[(Blob Storage)]
    end

    subgraph NETWORK["Reseau"]
        CDN[Azure CDN]
        DNS[Azure DNS]
    end

    APP --> AOAI & SPEECH & AVATAR
    APP --> COSMOS & BLOB
    FUNC --> SEARCH
    CDN --> APP

    style COMPUTE fill:#E3F2FD,stroke:#1565C0
    style AI fill:#F3E5F5,stroke:#7B1FA2
    style DATA fill:#E8F5E9,stroke:#2E7D32
    style NETWORK fill:#FFF3E0,stroke:#E65100
            </div>

            <!-- ================================================
                 15.2 RESSOURCES DE CALCUL
                 ================================================ -->
            <h2>15.2 Ressources de Calcul</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 180px;">Ressource</th>
                            <th>Description</th>
                            <th>Cas d'Usage dans Waka Voice</th>
                            <th style="width: 120px;">Plan Recommande</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <strong><i class="bi bi-window" style="color: #0078D4;"></i> Azure App Service</strong>
                            </td>
                            <td>Hebergement d'applications web PaaS avec auto-scaling</td>
                            <td>
                                <ul style="margin: 0; padding-left: 15px; font-size: 0.9rem;">
                                    <li>Hebergement de l'application Flask principale</li>
                                    <li>Gestion des WebSockets pour sessions temps reel</li>
                                    <li>Serveur de l'interface utilisateur</li>
                                    <li>API REST pour les operations CRUD</li>
                                </ul>
                            </td>
                            <td>P2v2 / P3v3</td>
                        </tr>
                        <tr>
                            <td>
                                <strong><i class="bi bi-lightning" style="color: #FFB900;"></i> Azure Functions</strong>
                            </td>
                            <td>Compute serverless evenementiel</td>
                            <td>
                                <ul style="margin: 0; padding-left: 15px; font-size: 0.9rem;">
                                    <li>Traitement asynchrone des documents RAG</li>
                                    <li>Chunking et embedding des fichiers uploades</li>
                                    <li>Webhooks pour integrations externes</li>
                                    <li>Taches planifiees (nettoyage, stats)</li>
                                </ul>
                            </td>
                            <td>Consumption / Premium</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 15.3 RESSOURCES IA & COGNITIVE
                 ================================================ -->
            <h2>15.3 Ressources IA & Cognitive</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 180px;">Ressource</th>
                            <th>Description</th>
                            <th>Cas d'Usage dans Waka Voice</th>
                            <th style="width: 120px;">Modeles Utilises</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #F3E5F5;">
                            <td>
                                <strong><i class="bi bi-robot" style="color: #7B1FA2;"></i> Azure OpenAI</strong>
                            </td>
                            <td>Acces aux modeles GPT, embeddings et modeles multimodaux</td>
                            <td>
                                <ul style="margin: 0; padding-left: 15px; font-size: 0.9rem;">
                                    <li><strong>Agents Texte</strong> : Generation de reponses conversationnelles</li>
                                    <li><strong>Agents Voix</strong> : Modeles realtime pour voix bidirectionnelle</li>
                                    <li><strong>RAG</strong> : Embeddings pour vectorisation des documents</li>
                                    <li><strong>Tools</strong> : Function calling pour execution d'actions</li>
                                    <li><strong>Enrichissement</strong> : Generation de descriptions d'outils</li>
                                </ul>
                            </td>
                            <td>
                                GPT-4o<br>
                                GPT-4o-mini<br>
                                GPT-4o-realtime<br>
                                text-embedding-3-large
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <strong><i class="bi bi-mic-fill" style="color: #0078D4;"></i> Azure Speech Services</strong>
                            </td>
                            <td>Reconnaissance vocale (STT) et synthese vocale (TTS)</td>
                            <td>
                                <ul style="margin: 0; padding-left: 15px; font-size: 0.9rem;">
                                    <li><strong>Speech-to-Text</strong> : Transcription temps reel des utilisateurs</li>
                                    <li><strong>Text-to-Speech</strong> : Voix neurales haute qualite (400+ voix)</li>
                                    <li><strong>Personal Voice</strong> : Clonage vocal personnalise</li>
                                    <li><strong>Voice Live</strong> : API conversationnelle temps reel</li>
                                </ul>
                            </td>
                            <td>
                                Neural voices<br>
                                HD voices<br>
                                Personal Voice
                            </td>
                        </tr>
                        <tr style="background: #E3F2FD;">
                            <td>
                                <strong><i class="bi bi-person-video" style="color: #1565C0;"></i> Azure Avatar Service</strong>
                            </td>
                            <td>Avatars video animes avec lip-sync</td>
                            <td>
                                <ul style="margin: 0; padding-left: 15px; font-size: 0.9rem;">
                                    <li><strong>Agents Avatar</strong> : Representation visuelle des agents</li>
                                    <li><strong>Lip-sync</strong> : Synchronisation levres/audio temps reel</li>
                                    <li><strong>Visemes</strong> : Donnees de position des levres</li>
                                    <li><strong>WebRTC</strong> : Streaming video basse latence</li>
                                </ul>
                            </td>
                            <td>
                                Lisa<br>
                                Harry<br>
                                Custom avatars
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <strong><i class="bi bi-search" style="color: #4CAF50;"></i> Azure AI Search</strong>
                            </td>
                            <td>Recherche vectorielle et semantique</td>
                            <td>
                                <ul style="margin: 0; padding-left: 15px; font-size: 0.9rem;">
                                    <li><strong>RAG</strong> : Recherche de contexte dans la base documentaire</li>
                                    <li><strong>Indexation</strong> : Stockage des embeddings vectoriels</li>
                                    <li><strong>Recherche hybride</strong> : Combinaison keyword + semantique</li>
                                    <li><strong>Filtrage</strong> : Par projet, date, type de document</li>
                                </ul>
                            </td>
                            <td>
                                Basic / Standard<br>
                                Vector search
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 15.4 RESSOURCES DE DONNEES
                 ================================================ -->
            <h2>15.4 Ressources de Donnees</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 180px;">Ressource</th>
                            <th>Description</th>
                            <th>Cas d'Usage dans Waka Voice</th>
                            <th style="width: 120px;">Configuration</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E8F5E9;">
                            <td>
                                <strong><i class="bi bi-database" style="color: #2E7D32;"></i> Azure Cosmos DB</strong>
                            </td>
                            <td>Base NoSQL distribuee globalement</td>
                            <td>
                                <ul style="margin: 0; padding-left: 15px; font-size: 0.9rem;">
                                    <li><strong>Agents</strong> : Configuration des agents (voix, texte, avatar)</li>
                                    <li><strong>Sessions</strong> : Historique des conversations</li>
                                    <li><strong>Tools</strong> : Definitions et configurations des outils</li>
                                    <li><strong>Campagnes</strong> : Donnees des campagnes d'appels</li>
                                    <li><strong>Personal Voice</strong> : Metadonnees des voix clonees</li>
                                    <li><strong>Metriques</strong> : Statistiques d'utilisation</li>
                                </ul>
                            </td>
                            <td>
                                Serverless<br>
                                400 RU/s min<br>
                                Multi-region
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <strong><i class="bi bi-cloud-upload" style="color: #0078D4;"></i> Azure Blob Storage</strong>
                            </td>
                            <td>Stockage objet pour fichiers volumineux</td>
                            <td>
                                <ul style="margin: 0; padding-left: 15px; font-size: 0.9rem;">
                                    <li><strong>Documents RAG</strong> : PDF, DOCX, fichiers uploades</li>
                                    <li><strong>Audio Personal Voice</strong> : Echantillons vocaux (16kHz)</li>
                                    <li><strong>Enregistrements</strong> : Audio des sessions (optionnel)</li>
                                    <li><strong>Assets statiques</strong> : Images, CSS, JS</li>
                                </ul>
                            </td>
                            <td>
                                Hot tier<br>
                                LRS / GRS<br>
                                100 GB+
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 15.5 RESSOURCES RESEAU & SECURITE
                 ================================================ -->
            <h2>15.5 Ressources Reseau & Securite</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 180px;">Ressource</th>
                            <th>Description</th>
                            <th>Cas d'Usage dans Waka Voice</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong><i class="bi bi-globe" style="color: #E65100;"></i> Azure CDN</strong></td>
                            <td>Reseau de distribution de contenu</td>
                            <td>Cache des assets statiques, reduction de latence globale, protection DDoS</td>
                        </tr>
                        <tr>
                            <td><strong><i class="bi bi-signpost" style="color: #1565C0;"></i> Azure DNS</strong></td>
                            <td>Gestion des noms de domaine</td>
                            <td>Resolution DNS pour domaines personnalises, certificats SSL/TLS</td>
                        </tr>
                        <tr>
                            <td><strong><i class="bi bi-shield-lock" style="color: #4CAF50;"></i> Azure Key Vault</strong></td>
                            <td>Gestion securisee des secrets</td>
                            <td>Stockage des cles API, connexion strings, certificats</td>
                        </tr>
                        <tr>
                            <td><strong><i class="bi bi-graph-up" style="color: #7B1FA2;"></i> Azure Monitor</strong></td>
                            <td>Monitoring et alerting</td>
                            <td>Metriques applicatives, logs, alertes de performance, dashboards</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 15.6 RECAPITULATIF DES COUTS PAR RESSOURCE
                 ================================================ -->
            <h2>15.6 Recapitulatif des Couts par Ressource</h2>

            <div class="mermaid">
pie showData
    title "Repartition Couts Azure mensuelle"
    "Azure OpenAI" : 45
    "App Service" : 20
    "Cosmos DB" : 15
    "Speech Services" : 10
    "Blob Storage" : 5
    "Autres" : 5
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Ressource</th>
                            <th>Unite de Facturation</th>
                            <th>Prix Indicatif</th>
                            <th>Estimation Mensuelle (PME)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Azure OpenAI</strong></td>
                            <td>Tokens (entree/sortie)</td>
                            <td>$0.005-$0.06 / 1K tokens</td>
                            <td>~600-800 EUR</td>
                        </tr>
                        <tr>
                            <td><strong>App Service P2v2</strong></td>
                            <td>Instance / heure</td>
                            <td>~0.25 EUR / heure</td>
                            <td>~180 EUR</td>
                        </tr>
                        <tr>
                            <td><strong>Cosmos DB</strong></td>
                            <td>RU/s + stockage</td>
                            <td>~0.008 EUR / 100 RU/h</td>
                            <td>~100-150 EUR</td>
                        </tr>
                        <tr>
                            <td><strong>Speech Services</strong></td>
                            <td>Caracteres / heures audio</td>
                            <td>$4 / 1M caracteres TTS</td>
                            <td>~80-120 EUR</td>
                        </tr>
                        <tr>
                            <td><strong>AI Search</strong></td>
                            <td>Instance + stockage</td>
                            <td>~70 EUR / mois (Basic)</td>
                            <td>~70 EUR</td>
                        </tr>
                        <tr>
                            <td><strong>Blob Storage</strong></td>
                            <td>GB stocke + transactions</td>
                            <td>~0.02 EUR / GB</td>
                            <td>~20-30 EUR</td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr style="background: #4A148C; color: white; font-weight: bold;">
                            <td colspan="3">TOTAL ESTIME (PME - 200 sessions/heure)</td>
                            <td>~1 100 - 1 400 EUR/mois</td>
                        </tr>
                    </tfoot>
                </table>
            </div>

        </section>

        <!-- ==========================================
             CHAPITRE 16: MODELES & COMPARAISON
             ========================================== -->
        <section id="models-comparison" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-bar-chart-line"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 16: Modeles & Comparaison</h1>
                    <p class="section-subtitle">Modeles IA utilises dans Waka Voice</p>
                </div>
            </div>

            <div class="intro-text">
                Ce chapitre presente les <strong>modeles IA disponibles</strong> dans Waka Voice,
                organises par famille et par cas d'usage. L'application supporte plusieurs generations
                de modeles pour repondre a differents besoins de performance et de cout.
            </div>

            <!-- ================================================
                 16.1 MODELES TEXTE (CHAT/LLM)
                 ================================================ -->
            <h2>16.1 Modeles Texte (Chat/LLM)</h2>

            <h3>16.1.1 Famille F3 - GPT-5 (Derniere Generation)</h3>

            <div class="callout callout-info">
                <i class="bi bi-stars callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Modeles de Derniere Generation</div>
                    <p>
                        La famille GPT-5 represente les modeles les plus avances disponibles via Azure AI Foundry,
                        offrant des capacites de raisonnement superieures et un support multimodal etendu.
                    </p>
                </div>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Modele</th>
                            <th>Description</th>
                            <th>Cas d'Usage</th>
                            <th>Disponibilite</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #F3E5F5;">
                            <td><strong>gpt-5.2-chat</strong></td>
                            <td>Derniere version GPT-5.2, modele par defaut pour agents texte</td>
                            <td>Agents conversationnels premium, raisonnement complexe</td>
                            <td>Azure AI Foundry</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-5-chat</strong></td>
                            <td>Version stable GPT-5</td>
                            <td>Production, conversations longues</td>
                            <td>Azure AI Foundry</td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong>gpt-5-mini</strong></td>
                            <td>Version allegee GPT-5</td>
                            <td>Volume eleve, cout optimise</td>
                            <td>Azure OpenAI (defaut)</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-5-nano</strong></td>
                            <td>Version ultra-legere</td>
                            <td>Prototypage, tests rapides</td>
                            <td>Azure AI Foundry</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>16.1.2 Famille F2 - GPT-4.x (Generation Precedente)</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Modele</th>
                            <th>Description</th>
                            <th>Cas d'Usage</th>
                            <th>Disponibilite</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E3F2FD;">
                            <td><strong>gpt-4o</strong></td>
                            <td>GPT-4o stable, multimodal (texte, image, audio)</td>
                            <td>Production, analyse multimodale</td>
                            <td>Azure OpenAI</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-4o-mini</strong></td>
                            <td>Version allegee GPT-4o</td>
                            <td>Chatbots, volume eleve</td>
                            <td>Azure OpenAI</td>
                        </tr>
                        <tr style="background: #E3F2FD;">
                            <td><strong>gpt-4.1</strong></td>
                            <td>GPT-4.1 ameliore</td>
                            <td>Raisonnement avance</td>
                            <td>Azure OpenAI</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-4.1-mini</strong></td>
                            <td>Version allegee GPT-4.1</td>
                            <td>Equilibre qualite/cout</td>
                            <td>Azure OpenAI</td>
                        </tr>
                        <tr>
                            <td><strong>phi4-mini</strong></td>
                            <td>Modele Microsoft Phi-4 compact</td>
                            <td>Edge computing, latence ultra-basse</td>
                            <td>Azure OpenAI</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>16.1.3 Modeles Alternatifs (Azure AI Foundry)</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Modele</th>
                            <th>Fournisseur</th>
                            <th>Description</th>
                            <th>Cas d'Usage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #FFF3E0;">
                            <td><strong>claude-opus-4.5</strong></td>
                            <td>Anthropic</td>
                            <td>Alternative a GPT-5.2 pour agents texte</td>
                            <td>Raisonnement, analyse longue</td>
                        </tr>
                        <tr>
                            <td><strong>DeepSeek-V3.1</strong></td>
                            <td>DeepSeek</td>
                            <td>Modele open-source haute performance</td>
                            <td>Inference economique</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 16.2 AZURE VOICE LIVE API
                 ================================================ -->
            <h2>16.2 Azure Voice Live API</h2>

            <div class="callout callout-info">
                <i class="bi bi-cloud-fill callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Voice Live - API Unifiee pour Agents Voix</div>
                    <p>
                        L'API Voice Live de Microsoft Azure AI Foundry simplifie la creation d'agents vocaux
                        en unifiant STT, LLM et TTS dans une seule interface WebSocket. Elle supporte trois familles
                        de modeles (F1, F2, F3) avec des modes audio differents.
                    </p>
                </div>
            </div>

            <h3>16.2.1 Famille F1 - Audio Natif (Realtime)</h3>

            <p>Les modeles F1 traitent l'audio <strong>nativement</strong> sans pipeline STT/TTS separe :</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Modele</th>
                            <th>Tier</th>
                            <th>Mode Audio</th>
                            <th>Voix Supportees</th>
                            <th>Latence E2E</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #F3E5F5;">
                            <td><strong>gpt-realtime</strong></td>
                            <td>Pro</td>
                            <td>Natif</td>
                            <td>OpenAI + Azure TTS</td>
                            <td>~400 ms</td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong>gpt-realtime-mini</strong></td>
                            <td>Basic</td>
                            <td>Natif</td>
                            <td>OpenAI + Azure TTS</td>
                            <td>~300 ms</td>
                        </tr>
                        <tr style="background: #FFF3E0;">
                            <td><strong>phi4-mm-realtime</strong></td>
                            <td>Lite</td>
                            <td>Natif</td>
                            <td>OpenAI + Azure TTS</td>
                            <td>~250 ms</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>16.2.2 Famille F2 - TTS Real-time (GPT-4.x)</h3>

            <p>Les modeles F2 utilisent le mode <strong>TTS Real-time</strong> via Azure Speech Services :</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Modele</th>
                            <th>Tier</th>
                            <th>Mode Audio</th>
                            <th>Voix Supportees</th>
                            <th>Latence E2E</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E3F2FD;">
                            <td><strong>gpt-4o</strong></td>
                            <td>Pro</td>
                            <td>TTS Real-time</td>
                            <td>Azure TTS (600+ voix)</td>
                            <td>~450 ms</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-4o-mini</strong></td>
                            <td>Basic</td>
                            <td>TTS Real-time</td>
                            <td>Azure TTS (600+ voix)</td>
                            <td>~350 ms</td>
                        </tr>
                        <tr style="background: #E3F2FD;">
                            <td><strong>gpt-4.1</strong></td>
                            <td>Pro</td>
                            <td>TTS Real-time</td>
                            <td>Azure TTS (600+ voix)</td>
                            <td>~450 ms</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-4.1-mini</strong></td>
                            <td>Basic</td>
                            <td>TTS Real-time</td>
                            <td>Azure TTS (600+ voix)</td>
                            <td>~350 ms</td>
                        </tr>
                        <tr style="background: #FFF3E0;">
                            <td><strong>phi4-mini</strong></td>
                            <td>Lite</td>
                            <td>TTS Real-time</td>
                            <td>Azure TTS (600+ voix)</td>
                            <td>~300 ms</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>16.2.3 Famille F3 - TTS Real-time (GPT-5)</h3>

            <p>Les modeles F3 (derniere generation) utilisent egalement le mode <strong>TTS Real-time</strong> :</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Modele</th>
                            <th>Tier</th>
                            <th>Mode Audio</th>
                            <th>Voix Supportees</th>
                            <th>Latence E2E</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E8F5E9;">
                            <td><strong>gpt-5</strong></td>
                            <td>Pro</td>
                            <td>TTS Real-time</td>
                            <td>Azure TTS (600+ voix)</td>
                            <td>~400 ms</td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong>gpt-5-chat</strong></td>
                            <td>Pro</td>
                            <td>TTS Real-time</td>
                            <td>Azure TTS (600+ voix)</td>
                            <td>~400 ms</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-5-mini</strong></td>
                            <td>Basic</td>
                            <td>TTS Real-time</td>
                            <td>Azure TTS (600+ voix)</td>
                            <td>~300 ms</td>
                        </tr>
                        <tr style="background: #FFF3E0;">
                            <td><strong>gpt-5-nano</strong></td>
                            <td>Lite</td>
                            <td>TTS Real-time</td>
                            <td>Azure TTS (600+ voix)</td>
                            <td>~250 ms</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>16.2.4 Comparaison des Modes Audio</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Caracteristique</th>
                            <th>F1 - Audio Natif</th>
                            <th>F2/F3 - TTS Real-time</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Pipeline</strong></td>
                            <td>Audio ‚Üí LLM ‚Üí Audio (natif)</td>
                            <td>Audio ‚Üí STT ‚Üí LLM ‚Üí TTS ‚Üí Audio</td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong>Latence</strong></td>
                            <td>Plus faible (~250-400 ms)</td>
                            <td>Legerement plus elevee (~300-450 ms)</td>
                        </tr>
                        <tr>
                            <td><strong>Voix OpenAI</strong></td>
                            <td>alloy, ash, ballad, coral, echo, sage, shimmer, verse</td>
                            <td>Non disponibles</td>
                        </tr>
                        <tr style="background: #E3F2FD;">
                            <td><strong>Voix Azure TTS</strong></td>
                            <td>Supportees (option)</td>
                            <td>600+ voix, 150+ langues, Neural HD</td>
                        </tr>
                        <tr>
                            <td><strong>Personal Voice</strong></td>
                            <td>Non disponible</td>
                            <td>Supportee (clonage vocal)</td>
                        </tr>
                        <tr style="background: #F3E5F5;">
                            <td><strong>Phrase List</strong></td>
                            <td>Non supportee</td>
                            <td>Supportee (amelioration STT)</td>
                        </tr>
                        <tr>
                            <td><strong>VAD Avance</strong></td>
                            <td>server_vad, semantic_vad</td>
                            <td>azure_semantic_vad, multilingual_semantic_vad</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>16.2.5 Voix Natives OpenAI (F1 uniquement)</h3>

            <p>Les modeles F1 incluent des voix synthetiques natives de haute qualite :</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Voix</th>
                            <th>Genre</th>
                            <th>Style</th>
                            <th>Recommandation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E8F5E9;">
                            <td><strong>alloy</strong></td>
                            <td>Neutre</td>
                            <td>Equilibree, professionnelle</td>
                            <td>Usage general, service client</td>
                        </tr>
                        <tr>
                            <td><strong>ash</strong></td>
                            <td>Masculin</td>
                            <td>Chaleureuse, accueillante</td>
                            <td>Support, assistance</td>
                        </tr>
                        <tr>
                            <td><strong>ballad</strong></td>
                            <td>Masculin</td>
                            <td>Melodique, apaisante</td>
                            <td>Narration, bien-etre</td>
                        </tr>
                        <tr style="background: #E3F2FD;">
                            <td><strong>coral</strong></td>
                            <td>Feminin</td>
                            <td>Claire, articulee</td>
                            <td>Information, tutoriels</td>
                        </tr>
                        <tr>
                            <td><strong>echo</strong></td>
                            <td>Masculin</td>
                            <td>Profonde, autoritaire</td>
                            <td>Annonces, IVR</td>
                        </tr>
                        <tr>
                            <td><strong>sage</strong></td>
                            <td>Feminin</td>
                            <td>Calme, reflechie</td>
                            <td>Conseils, coaching</td>
                        </tr>
                        <tr style="background: #F3E5F5;">
                            <td><strong>shimmer</strong></td>
                            <td>Feminin</td>
                            <td>Brillante, energique</td>
                            <td>Marketing, ventes</td>
                        </tr>
                        <tr>
                            <td><strong>verse</strong></td>
                            <td>Masculin</td>
                            <td>Expressive, dynamique</td>
                            <td>Divertissement, gaming</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>16.2.6 Tiers de Tarification Voice Live</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Tier</th>
                            <th>Modeles Inclus</th>
                            <th>Cout Relatif</th>
                            <th>Cas d'Usage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #F3E5F5;">
                            <td><strong>Pro</strong></td>
                            <td>gpt-realtime, gpt-4o, gpt-4.1, gpt-5, gpt-5-chat</td>
                            <td>Eleve</td>
                            <td>Production premium, raisonnement complexe</td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong>Basic</strong></td>
                            <td>gpt-realtime-mini, gpt-4o-mini, gpt-4.1-mini, gpt-5-mini</td>
                            <td>Moyen</td>
                            <td>Production standard, volume eleve</td>
                        </tr>
                        <tr style="background: #FFF3E0;">
                            <td><strong>Lite</strong></td>
                            <td>gpt-5-nano, phi4-mm-realtime, phi4-mini</td>
                            <td>Faible</td>
                            <td>Prototypage, tests, edge computing</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>16.2.7 Prix Unitaires par Token (Voice Live)</h3>

            <div class="callout callout-info">
                <i class="bi bi-currency-dollar callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Tarification Voice Live - Mise √† jour Janvier 2026</div>
                    <p>
                        Les prix sont exprim√©s en USD par token. Le calcul des co√ªts est effectu√©
                        automatiquement par le Session Watchdog dans <code>utils/session_watchdog.py</code>.
                    </p>
                </div>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Type de Token</th>
                            <th style="background: #F3E5F5;">Pro</th>
                            <th style="background: #E8F5E9;">Standard</th>
                            <th style="background: #FFF3E0;">Lite</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Input Text Token</strong></td>
                            <td style="background: #F3E5F5;">0,00000055</td>
                            <td style="background: #E8F5E9;">0,000000066</td>
                            <td style="background: #FFF3E0;">0,000000011</td>
                        </tr>
                        <tr>
                            <td><strong>Input Audio Token</strong></td>
                            <td style="background: #F3E5F5;">0,00000044</td>
                            <td style="background: #E8F5E9;">0,0000015</td>
                            <td style="background: #FFF3E0;">0,0000015</td>
                        </tr>
                        <tr>
                            <td><strong>Output Text Token</strong></td>
                            <td style="background: #F3E5F5;">0,0000022</td>
                            <td style="background: #E8F5E9;">0,00000264</td>
                            <td style="background: #FFF3E0;">0,00000044</td>
                        </tr>
                        <tr>
                            <td><strong>Output Audio Token</strong></td>
                            <td style="background: #F3E5F5;">0,00000055</td>
                            <td style="background: #E8F5E9;">0,0000033</td>
                            <td style="background: #FFF3E0;">0,0000033</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4>Mod√®les par Tier</h4>
            <ul>
                <li><strong>Pro</strong>: gpt-4o-realtime, gpt-4.1, gpt-5, gpt-5-realtime, gpt-5-chat</li>
                <li><strong>Standard</strong>: gpt-4o-mini, gpt-4o-realtime-mini, gpt-4.1-mini, gpt-5-mini</li>
                <li><strong>Lite</strong>: gpt-5-nano, phi4-mm-realtime, phi-4-multimodal-instruct</li>
            </ul>

            <h3>16.2.8 Prix Unitaires par Token (Mod√®les Texte/Chat)</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Mod√®le</th>
                            <th>Prompt Token</th>
                            <th>Cached Token</th>
                            <th>Completion Token</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E3F2FD;">
                            <td><strong>GPT-5.2</strong></td>
                            <td>0,0000000175</td>
                            <td>0,0000000175</td>
                            <td>0,0000014</td>
                        </tr>
                        <tr style="background: #F3E5F5;">
                            <td><strong>Claude Opus 4.5</strong></td>
                            <td>0,00000005</td>
                            <td>0,00000005</td>
                            <td>0,0000025</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>16.2.9 Avantages Tarifaires</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Programme</th>
                            <th>R√©duction</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E8F5E9;">
                            <td><strong>ISV Advantage</strong></td>
                            <td>33% du co√ªt standard</td>
                            <td>Programme partenaire ISV Microsoft Azure</td>
                        </tr>
                        <tr style="background: #FFF3E0;">
                            <td><strong>Provisioned Throughput</strong></td>
                            <td>50% du co√ªt standard</td>
                            <td>D√©bit r√©serv√© avec engagement</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 16.3 MODELES TTS/STT
                 ================================================ -->
            <h2>16.3 Modeles TTS/STT (Azure Speech)</h2>

            <h3>16.3.1 Modeles de Transcription (STT)</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Modele</th>
                            <th>Service</th>
                            <th>Description</th>
                            <th>Cas d'Usage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E8F5E9;">
                            <td><strong>whisper-1</strong></td>
                            <td>Azure OpenAI</td>
                            <td>Transcription haute precision</td>
                            <td>Analyse post-conversation</td>
                        </tr>
                        <tr>
                            <td><strong>gpt-4o-transcribe</strong></td>
                            <td>Azure OpenAI</td>
                            <td>Transcription via GPT-4o</td>
                            <td>Transcription enrichie avec contexte</td>
                        </tr>
                        <tr style="background: #E3F2FD;">
                            <td><strong>azure-speech</strong></td>
                            <td>Azure Speech Services</td>
                            <td>STT temps reel Azure</td>
                            <td>Pipeline Voice Live</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>16.3.2 Voix Personal Voice (TTS Custom)</h3>

            <div class="callout callout-warning">
                <i class="bi bi-person-badge callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Personal Voice</div>
                    <p>
                        Waka Voice supporte le clonage vocal via Azure Personal Voice,
                        permettant de creer des voix personnalisees a partir d'echantillons audio.
                    </p>
                </div>
            </div>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Voix</th>
                            <th>Type</th>
                            <th>Qualite</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>DragonLatestNeural</strong></td>
                            <td>Neural Standard</td>
                            <td>Excellente</td>
                            <td>Voix Dragon standard pour production</td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong>PhoenixLatestNeural</strong></td>
                            <td>Neural Expressif</td>
                            <td>Premium</td>
                            <td>Voix Phoenix avec emotions avancees</td>
                        </tr>
                        <tr style="background: #F3E5F5;">
                            <td><strong>DragonHDLatestNeural</strong></td>
                            <td>Neural HD</td>
                            <td>Ultra Premium</td>
                            <td>Dragon haute definition pour experiences premium</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 16.4 MODELES EMBEDDING
                 ================================================ -->
            <h2>16.4 Modeles Embedding (RAG)</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Modele</th>
                            <th>Dimensions</th>
                            <th>Description</th>
                            <th>Cas d'Usage</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #E8F5E9;">
                            <td><strong>text-embedding-3-small</strong></td>
                            <td>1536</td>
                            <td>Modele d'embedding par defaut</td>
                            <td>Vectorisation documents, RAG, recherche semantique</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- ================================================
                 16.5 CONFIGURATION PAR FAMILLE (VOICE LIVE)
                 ================================================ -->
            <h2>16.5 Configuration par Famille (Voice Live)</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Famille</th>
                            <th>Mode Audio</th>
                            <th>Modeles Inclus</th>
                            <th>Types de Voix</th>
                            <th>Max Tokens</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #F3E5F5;">
                            <td><strong>F1 (Realtime)</strong></td>
                            <td>Audio Natif</td>
                            <td>gpt-realtime, gpt-realtime-mini, phi4-mm-realtime</td>
                            <td>OpenAI, Azure Standard, Azure Custom</td>
                            <td>4096</td>
                        </tr>
                        <tr style="background: #E3F2FD;">
                            <td><strong>F2 (GPT-4.x)</strong></td>
                            <td>TTS Real-time</td>
                            <td>gpt-4o, gpt-4o-mini, gpt-4.1, gpt-4.1-mini, phi4-mini</td>
                            <td>Azure Standard, Azure Custom</td>
                            <td>2100</td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong>F3 (GPT-5)</strong></td>
                            <td>TTS Real-time</td>
                            <td>gpt-5, gpt-5-chat, gpt-5-mini, gpt-5-nano</td>
                            <td>Azure Standard, Azure Custom</td>
                            <td>16000</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>16.5.1 Fonctionnalites par Famille</h3>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Fonctionnalite</th>
                            <th>F1</th>
                            <th>F2</th>
                            <th>F3</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Transcription</strong></td>
                            <td>whisper-1, gpt-4o-transcribe</td>
                            <td>azure-speech, whisper-1, gpt-4o-transcribe</td>
                            <td>azure-speech</td>
                        </tr>
                        <tr style="background: #E8F5E9;">
                            <td><strong>Phrase List (STT)</strong></td>
                            <td>Non</td>
                            <td>Oui</td>
                            <td>Partiel (phi4-mini: Oui)</td>
                        </tr>
                        <tr>
                            <td><strong>VAD Types</strong></td>
                            <td>server_vad, semantic_vad, azure_semantic_vad</td>
                            <td>server_vad, azure_semantic_vad, multilingual</td>
                            <td>server_vad, azure_semantic_vad, multilingual</td>
                        </tr>
                        <tr style="background: #E3F2FD;">
                            <td><strong>End of Utterance Detection</strong></td>
                            <td>Non</td>
                            <td>Oui</td>
                            <td>Oui</td>
                        </tr>
                        <tr>
                            <td><strong>Temperature</strong></td>
                            <td>0.6 - 1.2 (defaut: 0.8)</td>
                            <td>0.6 - 1.2 (defaut: 0.8)</td>
                            <td>0.6 - 1.2 (defaut: 0.8)</td>
                        </tr>
                        <tr style="background: #F3E5F5;">
                            <td><strong>Personal Voice</strong></td>
                            <td>Non</td>
                            <td>Oui</td>
                            <td>Oui</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="callout callout-success">
                <i class="bi bi-lightbulb callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Recommandations Voice Live</div>
                    <p>
                        <strong>Latence minimale :</strong> Utilisez F1 avec <code>gpt-realtime-mini</code> (~300ms).<br>
                        <strong>Voix personnalisee :</strong> Utilisez F2/F3 avec Azure Personal Voice.<br>
                        <strong>Multilingue :</strong> Preferez F2/F3 avec <code>azure_multilingual_semantic_vad</code>.<br>
                        <strong>Production standard :</strong> Utilisez F2 avec <code>gpt-4o-mini</code> pour equilibre qualite/cout.<br>
                        <strong>Raisonnement complexe :</strong> Utilisez F3 avec <code>gpt-5-mini</code> ou <code>gpt-5-chat</code>.
                    </p>
                </div>
            </div>

        </section>

        <!-- ==========================================
             CHAPITRE 17: CHANGELOG ET PERSPECTIVES
             ========================================== -->
        <section id="changelog" class="content-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-clock-history"></i></div>
                <div class="section-title-group">
                    <h1 class="section-title">Chapitre 17: Changelog et Perspectives</h1>
                    <p class="section-subtitle">Historique du projet et feuille de route 2026</p>
                </div>
            </div>

            <div class="intro-text">
                Cette section retrace l'√©volution du projet Waka Voice depuis son lancement en octobre 2025,
                d√©taille les jalons techniques majeurs et pr√©sente la feuille de route pour 2026.
            </div>

            <!-- TIMELINE VISUELLE -->
            <h2>15.1 Chronologie du Projet</h2>

            <div class="mermaid">
flowchart LR
    subgraph OCT["üöÄ Oct 2025"]
        O1[POC Initial]
        O2[Azure OpenAI Realtime]
    end

    subgraph NOV["‚ö° Nov 2025"]
        N1[Azure Voice Live]
        N2[RAG + Multi-Agents]
    end

    subgraph DEC["üõ†Ô∏è Dec 2025"]
        D1[Tools & Functions]
        D2[Personal Voice]
    end

    subgraph JAN["üì¶ Jan 2026"]
        J1[Core Multi-Projet]
        J2[Multi-Client/R√©gion]
    end

    subgraph FEB["üîê Fev 2026"]
        F1[Authentification]
        F2[Multi-Tenant]
    end

    subgraph MAR["üìû Mar 2026"]
        M1[Dialer Multicanal]
        M2[7 Canaux]
    end

    OCT --> NOV --> DEC --> JAN --> FEB --> MAR

    style OCT fill:#FFCDD2,stroke:#C62828
    style NOV fill:#FFE0B2,stroke:#E65100
    style DEC fill:#FFF9C4,stroke:#F9A825
    style JAN fill:#C8E6C9,stroke:#2E7D32
    style FEB fill:#BBDEFB,stroke:#1565C0
    style MAR fill:#E1BEE7,stroke:#7B1FA2
            </div>

            <!-- HISTORIQUE D√âTAILL√â -->
            <h2>15.2 Historique D√©taill√©</h2>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 120px;">P√©riode</th>
                            <th>Jalons & R√©alisations</th>
                            <th style="width: 150px;">Technologies</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Octobre 2025</strong><br/><span style="font-size: 0.8rem; color: #666;">D√©marrage</span></td>
                            <td>
                                <ul style="margin: 0; padding-left: 1.2rem;">
                                    <li><strong>Cr√©ation du POC initial</strong> - Proof of Concept minimaliste</li>
                                    <li>Architecture mono-projet sans personnalisation</li>
                                    <li>Pas de support Tools ni Function Calls</li>
                                    <li>Utilisation de l'API Azure OpenAI Realtime directement</li>
                                    <li>Version tr√®s l√©g√®re pour validation du concept</li>
                                </ul>
                            </td>
                            <td>
                                <span class="tech-badge" style="font-size: 0.7rem;"><i class="bi bi-cloud"></i> Azure OpenAI Realtime API</span>
                                <span class="tech-badge" style="font-size: 0.7rem;"><i class="bi bi-filetype-py"></i> Flask</span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Novembre 2025</strong><br/><span style="font-size: 0.8rem; color: #666;">Migration</span></td>
                            <td>
                                <ul style="margin: 0; padding-left: 1.2rem;">
                                    <li><strong>Migration vers Azure Voice Live</strong> - R√©duction de co√ªt de 60%</li>
                                    <li>Ajout de multiples options de personnalisation</li>
                                    <li><strong>Int√©gration du module RAG</strong> - Retrieval-Augmented Generation</li>
                                    <li>Introduction du concept <strong>Multi-Agents</strong></li>
                                    <li>Support de plusieurs langues et voix Azure</li>
                                </ul>
                            </td>
                            <td>
                                <span class="tech-badge" style="font-size: 0.7rem;"><i class="bi bi-mic"></i> Azure Voice Live</span>
                                <span class="tech-badge" style="font-size: 0.7rem;"><i class="bi bi-search"></i> Azure AI Search</span>
                                <span class="tech-badge" style="font-size: 0.7rem;"><i class="bi bi-database"></i> Cosmos DB</span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>D√©cembre 2025</strong><br/><span style="font-size: 0.8rem; color: #666;">Enrichissement</span></td>
                            <td>
                                <ul style="margin: 0; padding-left: 1.2rem;">
                                    <li><strong>Int√©gration compl√®te des Tools</strong> - 4 types support√©s</li>
                                    <li>Support des Function Calls dynamiques</li>
                                    <li>Module Personal Voice (clonage vocal)</li>
                                    <li>Agents Avatar avec WebRTC et lip-sync</li>
                                    <li>Documentation technique exhaustive</li>
                                </ul>
                            </td>
                            <td>
                                <span class="tech-badge" style="font-size: 0.7rem;"><i class="bi bi-tools"></i> Azure Functions</span>
                                <span class="tech-badge" style="font-size: 0.7rem;"><i class="bi bi-person-video"></i> Azure Avatar</span>
                                <span class="tech-badge" style="font-size: 0.7rem;"><i class="bi bi-camera-video"></i> WebRTC</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- COMPARATIF √âCONOMIQUE -->
            <div class="callout callout-success">
                <i class="bi bi-graph-down-arrow callout-icon"></i>
                <div class="callout-content">
                    <div class="callout-title">Impact √âconomique - Migration Azure Voice Live</div>
                    <p>
                        La migration d'Azure OpenAI Realtime API vers Azure Voice Live a permis une <strong>r√©duction des co√ªts de 60%</strong>
                        tout en offrant plus de fonctionnalit√©s : meilleure qualit√© audio, latence r√©duite, et personnalisation avanc√©e des voix.
                    </p>
                </div>
            </div>

            <!-- ROADMAP 2026 -->
            <h2>15.3 Feuille de Route 2026</h2>

            <div class="mermaid">
flowchart LR
    subgraph Q1["Q1 2026"]
        J[üéØ Janvier<br/>Core Multi-Projet]
        F[üîê F√©vrier<br/>Auth & Multi-Tenant]
        M[üìû Mars<br/>Dialer Multicanal]
    end

    J --> F --> M

    style J fill:#E3F2FD,stroke:#1976D2
    style F fill:#E8F5E9,stroke:#4CAF50
    style M fill:#FFF3E0,stroke:#FF9800
            </div>

            <!-- JANVIER 2026 -->
            <h3>15.3.1 Janvier 2026 : Core Multi-Projet / Client / R√©gion</h3>

            <div style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #1976D2;">
                <h4 style="color: #1976D2; margin-bottom: 15px;"><i class="bi bi-layers"></i> Objectifs</h4>
                <ul style="margin: 0; padding-left: 1.2rem; color: #333;">
                    <li><strong>Architecture Core</strong> - Cr√©ation d'un noyau modulaire r√©utilisable</li>
                    <li><strong>Multi-Projet</strong> - Support de plusieurs projets ind√©pendants par instance</li>
                    <li><strong>Multi-Client</strong> - Isolation des donn√©es par client/organisation</li>
                    <li><strong>Multi-R√©gion</strong> - D√©ploiement g√©ographique pour optimisation latence</li>
                    <li><strong>Configuration centralis√©e</strong> - Gestion unifi√©e des param√®tres</li>
                </ul>
            </div>

            <!-- F√âVRIER 2026 -->
            <h3>15.3.2 F√©vrier 2026 : Authentification & Multi-Tenant</h3>

            <div style="background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #4CAF50;">
                <h4 style="color: #4CAF50; margin-bottom: 15px;"><i class="bi bi-shield-lock"></i> Objectifs</h4>
                <ul style="margin: 0; padding-left: 1.2rem; color: #333;">
                    <li><strong>Syst√®me d'authentification</strong> - Login/Register/SSO</li>
                    <li><strong>Gestion des r√¥les</strong> - Admin, Manager, User, Viewer</li>
                    <li><strong>Multi-Tenant complet</strong> - Isolation totale des donn√©es par tenant</li>
                    <li><strong>Quotas & Billing</strong> - Suivi de consommation par tenant</li>
                    <li><strong>Audit Trail</strong> - Journalisation des actions utilisateurs</li>
                </ul>
            </div>

            <!-- MARS 2026 -->
            <h3>15.3.3 Mars 2026 : Dialer Multicanal</h3>

            <div style="background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #FF9800;">
                <h4 style="color: #FF9800; margin-bottom: 15px;"><i class="bi bi-telephone-forward"></i> Objectifs</h4>
                <p style="color: #333; margin-bottom: 15px;">
                    Cr√©ation d'un outil de type <strong>dialer multicanal</strong> permettant d'atteindre les prospects/clients
                    via diff√©rents canaux de communication avec des options de traitement automatis√©.
                </p>

                <h5 style="color: #E65100; margin: 15px 0 10px;">Canaux Support√©s</h5>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
                    <span style="background: #1877F2; color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.85rem;"><i class="bi bi-facebook"></i> Facebook</span>
                    <span style="background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.85rem;"><i class="bi bi-instagram"></i> Instagram</span>
                    <span style="background: #0A66C2; color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.85rem;"><i class="bi bi-linkedin"></i> LinkedIn</span>
                    <span style="background: #000000; color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.85rem;"><i class="bi bi-twitter-x"></i> X (Twitter)</span>
                    <span style="background: #25D366; color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.85rem;"><i class="bi bi-whatsapp"></i> WhatsApp</span>
                    <span style="background: #4CAF50; color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.85rem;"><i class="bi bi-telephone"></i> Phone</span>
                    <span style="background: #9C27B0; color: white; padding: 8px 15px; border-radius: 20px; font-size: 0.85rem;"><i class="bi bi-chat-dots"></i> SMS</span>
                </div>

                <h5 style="color: #E65100; margin: 15px 0 10px;">Modes de Traitement</h5>
                <div class="table-wrapper" style="margin-top: 10px;">
                    <table style="font-size: 0.9rem;">
                        <thead>
                            <tr><th>Mode</th><th>Description</th><th>Cas d'usage</th></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Pr√©dictif</strong></td>
                                <td>Appels automatiques bas√©s sur la disponibilit√© des agents et pr√©dictions de r√©ponse</td>
                                <td>Campagnes outbound massives, prospection commerciale</td>
                            </tr>
                            <tr>
                                <td><strong>Progressif</strong></td>
                                <td>Appels s√©quentiels avec pr√©paration agent avant chaque contact</td>
                                <td>Suivi client personnalis√©, relances qualifi√©es</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </section>

        <!-- SECTION WATCHDOG -->
        <section id="watchdog" class="doc-section">
            <h2 class="section-title"><i class="bi bi-shield-check"></i> Watchdog - Surveillance Automatis√©e</h2>

            <p style="font-size: 1.1rem; opacity: 0.9; margin-bottom: 2rem;">
                Le <strong>Watchdog</strong> est un composant critique de Waka Voice qui assure la surveillance automatis√©e
                des sessions vocales, la gestion des statuts et le calcul pr√©cis des co√ªts d'utilisation.
            </p>

            <!-- SOUS-SECTION 1: CLOTURE DE SESSION ET STATUTS -->
            <h3>14.1 Cl√¥ture de Session et Gestion des Statuts</h3>

            <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #4CAF50;">
                <h4 style="color: #4CAF50; margin-bottom: 15px;"><i class="bi bi-info-circle"></i> Description</h4>
                <p style="color: rgba(255,255,255,0.9); margin-bottom: 15px;">
                    Le Watchdog surveille en permanence les sessions (texte, voix, avatar) pour d√©tecter les sessions inactives
                    et les traiter automatiquement. Cette surveillance s'ex√©cute toutes les <strong>10 secondes</strong>.
                </p>
            </div>

            <h4 style="color: var(--waka-accent-yellow); margin: 25px 0 15px;"><i class="bi bi-diagram-2"></i> Cycle de Vie des Sessions</h4>

            <div class="mermaid" style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 30px; margin: 20px 0;">
flowchart TD
    subgraph INIT["<b>INITIALISATION</b>"]
        START(("D√©but"))
    end

    subgraph ACTIVE["<b>SESSION ACTIVE</b>"]
        A["<b>active</b><br/>Session en cours"]
        LOOP["Activit√©<br/>utilisateur"]
    end

    subgraph CLOTURE["<b>CL√îTURE</b>"]
        C["<b>completed</b><br/>Termin√©e normalement"]
        B["<b>abandoned</b><br/>Abandonn√©e"]
    end

    subgraph WATCHDOG["<b>WATCHDOG</b>"]
        W["Calcul des co√ªts<br/>+ Mise √† jour DB"]
    end

    subgraph FIN["<b>FINALISATION</b>"]
        END(("Fin"))
    end

    START -->|"Cr√©ation session"| A
    A -->|"Interaction"| LOOP
    LOOP -->|"Continue"| A
    A -->|"Cl√¥ture manuelle<br/>par utilisateur"| C
    A -->|"Timeout 90s<br/>+ interactions > 1"| B
    A -->|"Timeout 90s<br/>+ interactions ‚â§ 1"| D["üóëÔ∏è deleted<br/>Supprim√©e"]
    C -->|"Watchdog d√©tecte<br/>status != active"| W
    B -->|"Watchdog d√©tecte<br/>status != active"| W
    D -->|"Session vide<br/>supprim√©e de DB"| END
    W -->|"Co√ªts calcul√©s<br/>et sauvegard√©s"| END

    style D fill:#f44336,stroke:#d32f2f,color:#fff

    style START fill:#9C27B0,stroke:#7B1FA2,color:#fff
    style A fill:#4CAF50,stroke:#388E3C,color:#fff
    style LOOP fill:#8BC34A,stroke:#689F38,color:#fff
    style C fill:#2196F3,stroke:#1976D2,color:#fff
    style B fill:#FF9800,stroke:#F57C00,color:#fff
    style W fill:#673AB7,stroke:#512DA8,color:#fff
    style END fill:#9C27B0,stroke:#7B1FA2,color:#fff
            </div>

            <h4 style="color: var(--waka-accent-yellow); margin: 25px 0 15px;"><i class="bi bi-list-check"></i> D√©finition des Statuts</h4>

            <div class="table-wrapper">
                <table style="color: #333;">
                    <thead>
                        <tr>
                            <th style="width: 15%; color: white;">Statut</th>
                            <th style="width: 25%; color: white;">Description</th>
                            <th style="width: 30%; color: white;">Conditions de Transition</th>
                            <th style="width: 30%; color: white;">Actions D√©clench√©es</th>
                        </tr>
                    </thead>
                    <tbody style="background: rgba(255,255,255,0.95);">
                        <tr>
                            <td><span style="background: #4CAF50; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;"><i class="bi bi-circle-fill"></i> active</span></td>
                            <td style="color: #333;">Session en cours d'utilisation</td>
                            <td style="color: #333;">Cr√©ation de session ou activit√© r√©cente (< 2 min)</td>
                            <td style="color: #333;">Aucune - Surveillance continue</td>
                        </tr>
                        <tr>
                            <td><span style="background: #2196F3; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;"><i class="bi bi-check-circle-fill"></i> completed</span></td>
                            <td style="color: #333;">Session termin√©e normalement</td>
                            <td style="color: #333;">L'utilisateur a cl√¥tur√© la session manuellement</td>
                            <td style="color: #333;">Calcul des co√ªts via Watchdog</td>
                        </tr>
                        <tr>
                            <td><span style="background: #FF9800; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;"><i class="bi bi-exclamation-triangle-fill"></i> abandoned</span></td>
                            <td style="color: #333;">Session abandonn√©e</td>
                            <td style="color: #333;">Inactivit√© ‚â• 90s <strong>ET</strong> interactions > 1</td>
                            <td style="color: #333;">Cl√¥ture automatique + Calcul des co√ªts</td>
                        </tr>
                        <tr>
                            <td><span style="background: #f44336; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem;"><i class="bi bi-trash-fill"></i> deleted</span></td>
                            <td style="color: #333;">Session supprim√©e</td>
                            <td style="color: #333;">Inactivit√© ‚â• 90s <strong>ET</strong> interactions ‚â§ 1</td>
                            <td style="color: #333;">Suppression d√©finitive de la base de donn√©es</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4 style="color: var(--waka-accent-yellow); margin: 25px 0 15px;"><i class="bi bi-clock-history"></i> Param√®tres de Surveillance</h4>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 20px 0;">
                <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 2rem; color: var(--waka-accent-yellow); margin-bottom: 10px;"><i class="bi bi-stopwatch"></i></div>
                    <h5 style="color: white; margin-bottom: 8px;">Intervalle de V√©rification</h5>
                    <p style="font-size: 1.5rem; color: var(--waka-accent-yellow); font-weight: 700;">10 secondes</p>
                    <p style="font-size: 0.85rem; opacity: 0.7;">Fr√©quence de scan des sessions actives</p>
                </div>
                <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 2rem; color: #FF9800; margin-bottom: 10px;"><i class="bi bi-hourglass-split"></i></div>
                    <h5 style="color: white; margin-bottom: 8px;">Timeout d'Inactivit√©</h5>
                    <p style="font-size: 1.5rem; color: #FF9800; font-weight: 700;">90 secondes</p>
                    <p style="font-size: 0.85rem; opacity: 0.7;">D√©lai avant traitement automatique</p>
                </div>
                <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 2rem; color: #4CAF50; margin-bottom: 10px;"><i class="bi bi-database-check"></i></div>
                    <h5 style="color: white; margin-bottom: 8px;">Base de Donn√©es</h5>
                    <p style="font-size: 1.5rem; color: #4CAF50; font-weight: 700;">CosmosDB</p>
                    <p style="font-size: 0.85rem; opacity: 0.7;">Stockage des sessions et m√©triques</p>
                </div>
            </div>

            <div class="code-block" style="margin: 25px 0;">
                <div class="code-header"><i class="bi bi-file-code"></i> utils/session_watchdog.py - Logique de traitement</div>
                <pre><code class="language-python"># Configuration Watchdog
WATCHDOG_INTERVAL = 10      # V√©rification toutes les 10 secondes
INACTIVITY_THRESHOLD = 90   # Seuil d'inactivit√©: 90 secondes

# Logique de traitement des sessions inactives
for session in inactive_sessions:
    interaction_count = session.get('interaction_count', 0) or 0
    
    if interaction_count <= 1:
        # Sessions vides (0-1 interactions) ‚Üí SUPPRIMER
        delete_empty_session(container, session)
    else:
        # Sessions avec contenu (>1 interactions) ‚Üí CL√îTURER
        close_inactive_session(session)  # status = "abandoned"</code></pre>
            </div>

            <!-- SOUS-SECTION 2: CALCUL DES CO√õTS -->
            <h3>14.2 Calcul des Co√ªts</h3>

            <div style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(33, 150, 243, 0.05) 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #2196F3;">
                <h4 style="color: #2196F3; margin-bottom: 15px;"><i class="bi bi-calculator"></i> Description</h4>
                <p style="color: rgba(255,255,255,0.9); margin-bottom: 15px;">
                    Le calcul des co√ªts est effectu√© <strong>exclusivement par le Watchdog</strong> pour les sessions
                    dont le statut n'est pas "active". Cette t√¢che s'ex√©cute toutes les <strong>30 secondes</strong>.
                </p>
                <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                    <i class="bi bi-exclamation-circle"></i> Important : Le calcul n'est jamais effectu√© pour les sessions actives
                    afin d'√©viter les calculs interm√©diaires inutiles.
                </p>
            </div>

            <h4 style="color: var(--waka-accent-yellow); margin: 25px 0 15px;"><i class="bi bi-diagram-3"></i> Sch√©ma de Calcul des Co√ªts</h4>

            <div class="mermaid" style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
flowchart TD
    A[Session Termin√©e<br/>status != 'active'] --> B{Type de Session}

    B -->|Voice| C[R√©cup√©rer M√©triques Voice]
    B -->|Text| D[R√©cup√©rer M√©triques Text]

    C --> E[Calculer Tokens Facturables]
    D --> E

    E --> F["input_text_billable = input_text - cached_text"]
    F --> G[Appliquer Tarification]

    G --> H[Calculer Co√ªt Total]
    H --> I[Calculer Co√ªt/Minute]

    I --> J[Calculer Avantage ISV<br/>33% de co√ªt/minute]
    I --> K[Calculer Avantage Provisioned<br/>50% de co√ªt/minute]

    J --> L[Sauvegarder en Base]
    K --> L

    L --> M[Session Mise √† Jour]

    style A fill:#FF9800,color:#fff
    style M fill:#4CAF50,color:#fff
    style F fill:#2196F3,color:#fff
    style J fill:#9C27B0,color:#fff
    style K fill:#9C27B0,color:#fff
            </div>

            <h4 style="color: var(--waka-accent-yellow); margin: 25px 0 15px;"><i class="bi bi-book"></i> D√©finitions et Formules</h4>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 20%;">Terme</th>
                            <th style="width: 40%;">D√©finition</th>
                            <th style="width: 40%;">Formule / Valeur</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>input_text</strong></td>
                            <td>Nombre total de tokens texte en entr√©e</td>
                            <td><code>Compteur brut de tokens</code></td>
                        </tr>
                        <tr>
                            <td><strong>cached_text</strong></td>
                            <td>Tokens texte mis en cache (non refactur√©s)</td>
                            <td><code>Tokens r√©utilis√©s depuis le cache</code></td>
                        </tr>
                        <tr>
                            <td><strong>input_text_billable</strong></td>
                            <td>Tokens texte r√©ellement facturables</td>
                            <td><code>max(0, input_text - cached_text)</code></td>
                        </tr>
                        <tr>
                            <td><strong>input_audio</strong></td>
                            <td>Tokens audio en entr√©e (parole utilisateur)</td>
                            <td><code>Compteur de tokens audio</code></td>
                        </tr>
                        <tr>
                            <td><strong>output_text</strong></td>
                            <td>Tokens texte g√©n√©r√©s en sortie</td>
                            <td><code>R√©ponse textuelle de l'agent</code></td>
                        </tr>
                        <tr>
                            <td><strong>output_audio</strong></td>
                            <td>Tokens audio g√©n√©r√©s en sortie</td>
                            <td><code>Parole synth√©tis√©e</code></td>
                        </tr>
                        <tr>
                            <td><strong>total_cost</strong></td>
                            <td>Co√ªt total de la session</td>
                            <td><code>Œ£ (tokens √ó prix_unitaire)</code></td>
                        </tr>
                        <tr>
                            <td><strong>cost_per_minute</strong></td>
                            <td>Co√ªt moyen par minute d'utilisation</td>
                            <td><code>total_cost / dur√©e_minutes</code></td>
                        </tr>
                        <tr>
                            <td><strong>cost_with_isv_advantage</strong></td>
                            <td>Co√ªt/minute avec r√©duction partenaire ISV</td>
                            <td><code>cost_per_minute √ó 0.33</code></td>
                        </tr>
                        <tr>
                            <td><strong>cost_with_provisioned_advantage</strong></td>
                            <td>Co√ªt/minute avec capacit√© provisionn√©e</td>
                            <td><code>cost_per_minute √ó 0.50</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4 style="color: var(--waka-accent-yellow); margin: 25px 0 15px;"><i class="bi bi-currency-dollar"></i> Grille Tarifaire Voice (par token)</h4>

            <div class="table-wrapper">
                <table style="color: #333;">
                    <thead>
                        <tr>
                            <th style="color: white;">Tier</th>
                            <th style="color: white;">Input Text</th>
                            <th style="color: white;">Input Audio</th>
                            <th style="color: white;">Output Text</th>
                            <th style="color: white;">Output Audio</th>
                        </tr>
                    </thead>
                    <tbody style="background: rgba(255,255,255,0.95);">
                        <tr>
                            <td><span style="background: linear-gradient(135deg, #FFD700, #FFA000); color: #333; padding: 4px 12px; border-radius: 12px; font-weight: 600;">Pro</span></td>
                            <td style="color: #333;">$0.0000055</td>
                            <td style="color: #333;">$0.000044</td>
                            <td style="color: #333;">$0.000022</td>
                            <td style="color: #333;">$0.000055</td>
                        </tr>
                        <tr>
                            <td><span style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white; padding: 4px 12px; border-radius: 12px; font-weight: 600;">Standard</span></td>
                            <td style="color: #333;">$0.00000066</td>
                            <td style="color: #333;">$0.000015</td>
                            <td style="color: #333;">$0.00000264</td>
                            <td style="color: #333;">$0.000033</td>
                        </tr>
                        <tr>
                            <td><span style="background: linear-gradient(135deg, #4CAF50, #388E3C); color: white; padding: 4px 12px; border-radius: 12px; font-weight: 600;">Lite</span></td>
                            <td style="color: #333;">$0.00000011</td>
                            <td style="color: #333;">$0.000015</td>
                            <td style="color: #333;">$0.00000044</td>
                            <td style="color: #333;">$0.000033</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h4 style="color: var(--waka-accent-yellow); margin: 25px 0 15px;"><i class="bi bi-cpu"></i> Grille Tarifaire Mod√®les Texte (par token)</h4>

            <div class="table-wrapper">
                <table style="color: #333;">
                    <thead>
                        <tr>
                            <th style="color: white;">Mod√®le</th>
                            <th style="color: white;">Prompt (Input)</th>
                            <th style="color: white;">Cached</th>
                            <th style="color: white;">Completion (Output)</th>
                        </tr>
                    </thead>
                    <tbody style="background: rgba(255,255,255,0.95);">
                        <tr>
                            <td style="color: #333;"><strong>GPT-5.2</strong></td>
                            <td style="color: #333;">$0.00000175</td>
                            <td style="color: #333;">$0.000000175</td>
                            <td style="color: #333;">$0.000014</td>
                        </tr>
                        <tr>
                            <td style="color: #333;"><strong>Claude Opus 4.5</strong></td>
                            <td style="color: #333;">$0.000005</td>
                            <td style="color: #333;">$0.00000625</td>
                            <td style="color: #333;">$0.000025</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="code-block" style="margin: 25px 0;">
                <div class="code-header"><i class="bi bi-file-code"></i> utils/session_watchdog.py - Formules de calcul</div>
                <pre><code class="language-python"># Calcul des tokens facturables (soustraction du cache)
input_text_billable = max(0, input_text_raw - cached_text)

# Calcul des co√ªts par type de token
input_text_cost = input_text_billable * pricing["input_text"]
input_audio_cost = input_audio * pricing["input_audio"]
output_text_cost = output_text * pricing["output_text"]
output_audio_cost = output_audio * pricing["output_audio"]

# Co√ªt total
total_cost = input_text_cost + input_audio_cost + output_text_cost + output_audio_cost

# Co√ªt par minute
duration_minutes = max(1, session_duration_seconds / 60)
cost_per_minute = total_cost / duration_minutes

# Avantages partenaires (appliqu√©s sur cost_per_minute)
cost_per_minute_isv = cost_per_minute * 0.33        # R√©duction ISV 67%
cost_per_minute_provisioned = cost_per_minute * 0.50  # R√©duction Provisioned 50%</code></pre>
            </div>

            <h4 style="color: var(--waka-accent-yellow); margin: 25px 0 15px;"><i class="bi bi-graph-up"></i> Exemple de Calcul</h4>

            <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 25px; margin: 20px 0; border: 1px solid rgba(255,255,255,0.1);">
                <h5 style="color: white; margin-bottom: 15px;">Session Voice - Tier Standard (5 minutes)</h5>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <p style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 5px;">M√©triques de session</p>
                        <ul style="list-style: none; padding: 0; font-size: 0.9rem;">
                            <li><i class="bi bi-dot"></i> Input Text: 15,000 tokens</li>
                            <li><i class="bi bi-dot"></i> Cached Text: 5,000 tokens</li>
                            <li><i class="bi bi-dot"></i> Input Audio: 8,000 tokens</li>
                            <li><i class="bi bi-dot"></i> Output Text: 12,000 tokens</li>
                            <li><i class="bi bi-dot"></i> Output Audio: 10,000 tokens</li>
                        </ul>
                    </div>
                    <div>
                        <p style="font-size: 0.85rem; opacity: 0.7; margin-bottom: 5px;">Calcul d√©taill√©</p>
                        <ul style="list-style: none; padding: 0; font-size: 0.9rem;">
                            <li><i class="bi bi-arrow-right"></i> Input Text Billable: 15,000 - 5,000 = <strong>10,000</strong></li>
                            <li><i class="bi bi-arrow-right"></i> Co√ªt Input Text: 10,000 √ó $0.00000066 = $0.0066</li>
                            <li><i class="bi bi-arrow-right"></i> Co√ªt Input Audio: 8,000 √ó $0.000015 = $0.12</li>
                            <li><i class="bi bi-arrow-right"></i> Co√ªt Output Text: 12,000 √ó $0.00000264 = $0.0317</li>
                            <li><i class="bi bi-arrow-right"></i> Co√ªt Output Audio: 10,000 √ó $0.000033 = $0.33</li>
                        </ul>
                    </div>
                </div>

                <div style="background: rgba(76, 175, 80, 0.2); border-radius: 10px; padding: 15px; border: 1px solid rgba(76, 175, 80, 0.3);">
                    <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <p style="font-size: 0.8rem; opacity: 0.7;">Total Cost</p>
                            <p style="font-size: 1.3rem; font-weight: 700; color: #4CAF50;">$0.4883</p>
                        </div>
                        <div>
                            <p style="font-size: 0.8rem; opacity: 0.7;">Cost/Minute</p>
                            <p style="font-size: 1.3rem; font-weight: 700; color: #2196F3;">$0.0977</p>
                        </div>
                        <div>
                            <p style="font-size: 0.8rem; opacity: 0.7;">Avec ISV (33%)</p>
                            <p style="font-size: 1.3rem; font-weight: 700; color: #9C27B0;">$0.0322</p>
                        </div>
                        <div>
                            <p style="font-size: 0.8rem; opacity: 0.7;">Avec Provisioned (50%)</p>
                            <p style="font-size: 1.3rem; font-weight: 700; color: #FF9800;">$0.0488</p>
                        </div>
                    </div>
                </div>
            </div>

            <h4 style="color: var(--waka-accent-yellow); margin: 25px 0 15px;"><i class="bi bi-gear"></i> Architecture du Watchdog</h4>

            <div class="mermaid" style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; margin: 20px 0;">
flowchart LR
    subgraph Watchdog["Watchdog Service"]
        T1[Task: Session Monitor<br/>Every 10s]
        T2[Task: Cost Calculator<br/>Every 30s]
    end

    subgraph DB["CosmosDB"]
        S[(Sessions)]
    end

    T1 -->|Query active sessions| S
    T1 -->|Update status| S

    T2 -->|Query non-active sessions<br/>without costs| S
    T2 -->|Store calculated costs| S

    style Watchdog fill:#4A148C,color:#fff
    style DB fill:#0078D4,color:#fff
            </div>

            <div style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 152, 0, 0.1) 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid var(--waka-accent-yellow);">
                <h4 style="color: var(--waka-accent-yellow); margin-bottom: 15px;"><i class="bi bi-lightbulb"></i> Points Cl√©s</h4>
                <ul style="color: rgba(255,255,255,0.9); margin: 0; padding-left: 20px;">
                    <li>Le calcul des co√ªts est <strong>centralis√©</strong> dans le Watchdog uniquement</li>
                    <li>Les sessions actives ne sont <strong>jamais</strong> calcul√©es (√©vite les calculs interm√©diaires)</li>
                    <li>Les tokens en cache sont <strong>soustraits</strong> avant le calcul du co√ªt</li>
                    <li>Les avantages ISV et Provisioned s'appliquent sur le <strong>co√ªt par minute</strong></li>
                    <li>Le Watchdog s'ex√©cute de mani√®re <strong>asynchrone</strong> sans impact sur les performances</li>
                    <li><strong>Sessions vides</strong> (0-1 interactions) sont supprim√©es d√©finitivement pour √©conomiser l'espace</li>
                    <li><strong>Sessions avec contenu</strong> (>1 interactions) sont cl√¥tur√©es comme "abandoned" et conserv√©es</li>
                </ul>
            </div>

        </section>

        <!-- SECTION TOOL VALIDATOR -->
        <section id="tool-validator" class="doc-section">
            <h2 class="section-title"><i class="bi bi-check2-circle"></i> Tool Validator - Assurance Qualit√© des Tools</h2>

            <p style="font-size: 1.1rem; opacity: 0.9; margin-bottom: 2rem;">
                Le <strong>Tool Validator</strong> est un syst√®me d'assurance qualit√© bas√© sur <strong>Claude Opus 4.5</strong> 
                qui valide et optimise automatiquement les descriptions des tools pour garantir leur compatibilit√© 
                avec les agents IA et √©viter les probl√®mes d'hallucination.
            </p>

            <!-- SOUS-SECTION 1: PROBL√âMATIQUE -->
            <h3>15.1 Probl√©matique R√©solue</h3>

            <div style="background: linear-gradient(135deg, rgba(244, 67, 54, 0.1) 0%, rgba(244, 67, 54, 0.05) 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #f44336;">
                <h4 style="color: #f44336; margin-bottom: 15px;"><i class="bi bi-exclamation-octagon"></i> Le Probl√®me</h4>
                <p style="color: rgba(255,255,255,0.9); margin-bottom: 15px;">
                    Lorsqu'un agent IA utilise de nombreux tools (ex: 115 tools), des descriptions trop longues ou contenant 
                    des exemples de donn√©es peuvent <strong>saturer le contexte</strong> du mod√®le et provoquer des <strong>hallucinations</strong> 
                    (l'agent g√©n√®re du JSON au lieu de parler naturellement).
                </p>
                <ul style="color: rgba(255,255,255,0.7); font-size: 0.9rem; margin: 0; padding-left: 20px;">
                    <li>Descriptions avec exemples JSON verbeux</li>
                    <li>Param√®tres avec valeurs d'exemple d√©taill√©es</li>
                    <li>Consommation excessive de tokens syst√®me</li>
                </ul>
            </div>

            <!-- SOUS-SECTION 2: SOLUTION -->
            <h3>15.2 Solution Impl√©ment√©e</h3>

            <div style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(76, 175, 80, 0.05) 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid #4CAF50;">
                <h4 style="color: #4CAF50; margin-bottom: 15px;"><i class="bi bi-check-circle"></i> Validation Automatique</h4>
                <p style="color: rgba(255,255,255,0.9);">
                    Le Tool Validator utilise <strong>Claude Opus 4.5</strong> pour analyser chaque tool et s'assurer que 
                    les descriptions respectent les limites strictes de caract√®res et ne contiennent aucun exemple.
                </p>
            </div>

            <h4 style="color: var(--waka-accent-yellow); margin: 25px 0 15px;"><i class="bi bi-rulers"></i> Limites Strictes</h4>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 20px 0;">
                <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 2rem; color: var(--waka-accent-yellow); margin-bottom: 10px;"><i class="bi bi-card-text"></i></div>
                    <h5 style="color: white; margin-bottom: 8px;">Description du Tool</h5>
                    <p style="font-size: 1.5rem; color: var(--waka-accent-yellow); font-weight: 700;">‚â§ 400 caract√®res</p>
                    <p style="font-size: 0.85rem; opacity: 0.7;">Concis, fonctionnel, sans exemples</p>
                </div>
                <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 2rem; color: #2196F3; margin-bottom: 10px;"><i class="bi bi-sliders"></i></div>
                    <h5 style="color: white; margin-bottom: 8px;">Description Param√®tre</h5>
                    <p style="font-size: 1.5rem; color: #2196F3; font-weight: 700;">‚â§ 120 caract√®res</p>
                    <p style="font-size: 0.85rem; opacity: 0.7;">Type et r√¥le seulement</p>
                </div>
                <div style="background: rgba(255,255,255,0.05); border-radius: 15px; padding: 20px; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 2rem; color: #f44336; margin-bottom: 10px;"><i class="bi bi-x-octagon"></i></div>
                    <h5 style="color: white; margin-bottom: 8px;">Exemples</h5>
                    <p style="font-size: 1.5rem; color: #f44336; font-weight: 700;">INTERDITS</p>
                    <p style="font-size: 0.85rem; opacity: 0.7;">Pas de JSON, pas de valeurs</p>
                </div>
            </div>

            <!-- SOUS-SECTION 3: FICHIERS -->
            <h3>15.3 Fichiers du Syst√®me</h3>

            <div class="table-wrapper">
                <table style="color: #333;">
                    <thead>
                        <tr>
                            <th style="width: 35%; color: white;">Fichier</th>
                            <th style="width: 65%; color: white;">Description</th>
                        </tr>
                    </thead>
                    <tbody style="background: rgba(255,255,255,0.95);">
                        <tr>
                            <td style="color: #333;"><code>utils/tools/tool_validator.py</code></td>
                            <td style="color: #333;">Module principal de validation utilisant Claude Opus 4.5. Contient les fonctions <code>validate_and_enrich_tool()</code>, <code>validate_tools_batch()</code>, et <code>enforce_description_limits()</code>.</td>
                        </tr>
                        <tr>
                            <td style="color: #333;"><code>run_full_validation.py</code></td>
                            <td style="color: #333;">Script de validation en masse de tous les tools existants. Traite par lots de 10 et envoie un rapport QA par email.</td>
                        </tr>
                        <tr>
                            <td style="color: #333;"><code>configuration/cosmos_tools_manager.py</code></td>
                            <td style="color: #333;">Manager Cosmos DB pour la persistance des tools valid√©s.</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- SOUS-SECTION 4: WORKFLOW -->
            <h3>15.4 Workflow de Validation</h3>

            <div class="mermaid" style="background: rgba(255,255,255,0.95); border-radius: 15px; padding: 30px; margin: 20px 0;">
flowchart TD
    A["üì• Tool √† valider"] --> B["ü§ñ Claude Opus 4.5<br/>Analyse"]
    B --> C{"Conforme ?"}
    C -->|"Oui"| D["‚úÖ valid<br/>Aucune modification"]
    C -->|"Non"| E["‚úèÔ∏è Claude corrige<br/>les descriptions"]
    E --> F["üìè enforce_description_limits()<br/>Post-processing"]
    F --> G["üíæ Sauvegarde<br/>Cosmos DB"]
    D --> G
    G --> H["üìä Rapport QA<br/>par email"]

    style A fill:#E3F2FD,stroke:#1976D2,color:#333
    style B fill:#7B1FA2,stroke:#4A148C,color:#fff
    style D fill:#E8F5E9,stroke:#4CAF50,color:#333
    style E fill:#FFF3E0,stroke:#FF9800,color:#333
    style F fill:#FCE4EC,stroke:#E91E63,color:#333
    style G fill:#E8F5E9,stroke:#4CAF50,color:#333
    style H fill:#F3E5F5,stroke:#9C27B0,color:#333
            </div>

            <!-- SOUS-SECTION 5: UTILISATION -->
            <h3>15.5 Ex√©cution du Script</h3>

            <div class="code-block" style="margin: 25px 0;">
                <div class="code-header"><i class="bi bi-terminal"></i> Commande de validation</div>
                <pre><code class="language-bash"># Validation compl√®te de tous les tools
python run_full_validation.py

# Sortie typique:
# ============================================================
# VALIDATION COMPLETE DES TOOLS - WakaVoice QA
# ============================================================
# Total de 192 tools √† valider
# 
# === Lot 1/20 (10 tools) ===
#   [1/10] get_weather - corrected
#   [2/10] search_documents - valid
#   ...
# 
# R√âSULTATS FINAUX
# Total analys√©: 192
# Conformes: 0
# Corrig√©s: 192
# √âchecs: 0
# 
# Envoi du rapport QA...</code></pre>
            </div>

            <h4 style="color: var(--waka-accent-yellow); margin: 25px 0 15px;"><i class="bi bi-code-slash"></i> R√®gles de Validation (Prompt Syst√®me)</h4>

            <div class="code-block" style="margin: 25px 0;">
                <div class="code-header"><i class="bi bi-file-code"></i> utils/tools/tool_validator.py - Extrait du prompt</div>
                <pre><code class="language-python">VALIDATION_SYSTEM_PROMPT = """
Tu es un expert en validation de tools pour agents IA.

## R√àGLES STRICTES
1. Description du tool: maximum 400 caract√®res
2. Description de chaque param√®tre: maximum 120 caract√®res  
3. INTERDICTION ABSOLUE d'inclure des exemples
4. Chaque description doit √™tre concise et fonctionnelle

## CE QUI EST INTERDIT
- "Example: ..." ou "Ex: ..."
- "For instance: ..."  
- "Like: ..." ou "Such as: ..."
- Valeurs JSON ou structures de donn√©es
- Listes de valeurs possibles d√©taill√©es

## FORMAT DE SORTIE
Retourner uniquement le JSON du tool corrig√©.
"""</code></pre>
            </div>

            <div style="background: linear-gradient(135deg, rgba(255, 193, 7, 0.1) 0%, rgba(255, 152, 0, 0.1) 100%); border-radius: 15px; padding: 25px; margin: 20px 0; border-left: 5px solid var(--waka-accent-yellow);">
                <h4 style="color: var(--waka-accent-yellow); margin-bottom: 15px;"><i class="bi bi-lightbulb"></i> Points Cl√©s</h4>
                <ul style="color: rgba(255,255,255,0.9); margin: 0; padding-left: 20px;">
                    <li>Validation automatique via <strong>Claude Opus 4.5</strong> (Azure AI Foundry)</li>
                    <li>Double s√©curit√©: validation LLM + post-processing Python</li>
                    <li>Traitement par lots de 10 pour √©viter les rate limits</li>
                    <li>Sauvegarde automatique dans <strong>Cosmos DB</strong></li>
                    <li>Rapport QA envoy√© par email apr√®s chaque validation</li>
                    <li>Pr√©vient les hallucinations des agents avec beaucoup de tools</li>
                </ul>
            </div>

        </section>

        <!-- FOOTER -->
        <footer class="doc-footer">
            <div class="footer-content">
                <!-- Logo et Slogan -->
                <div class="footer-logo-section">
                    <div class="footer-logo">Waka AI</div>
                </div>

                <p class="footer-tagline">
                    Plateforme d'Agents Conversationnels IA Multimodaux
                </p>

                <p class="footer-description">
                    Solution compl√®te pour cr√©er, d√©ployer et g√©rer des agents conversationnels<br>
                    propuls√©s par l'Intelligence Artificielle Azure OpenAI.
                </p>

                <!-- Technologies -->
                <div class="footer-tech" style="display: flex; justify-content: center; gap: 15px; margin: 25px 0; flex-wrap: wrap;">
                    <span class="tech-badge" style="background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 20px; font-size: 0.85rem;">
                        <i class="bi bi-microsoft"></i> Azure Cloud
                    </span>
                    <span class="tech-badge" style="background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 20px; font-size: 0.85rem;">
                        <i class="bi bi-robot"></i> IA Agentique
                    </span>
                    <span class="tech-badge" style="background: rgba(255,255,255,0.1); padding: 8px 16px; border-radius: 20px; font-size: 0.85rem;">
                        <i class="bi bi-telephone-fill"></i> Call Center IA
                    </span>
                </div>

                <div style="width: 60%; height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); margin: 25px auto;"></div>

                <!-- Microsoft Partner Badge -->
                <div class="microsoft-partner" style="margin: 20px 0;">
                    <div style="display: inline-flex; align-items: center; gap: 10px; background: rgba(0,120,215,0.2); padding: 10px 20px; border-radius: 25px; border: 1px solid rgba(0,120,215,0.4);">
                        <i class="bi bi-patch-check-fill" style="color: #0078D4; font-size: 1.2rem;"></i>
                        <span style="font-size: 0.9rem;">Microsoft Partner ‚Ä¢ Partner ID: 6960001</span>
                    </div>
                </div>

                <p class="footer-meta" style="margin-top: 25px; opacity: 0.7; font-size: 0.85rem;">
                    &copy; 2025 Waka AI - Tous droits r√©serv√©s
                </p>
            </div>
        </footer>
    </main>

    <!-- BACK TO TOP -->
    <button class="back-to-top" id="backToTop" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
        <i class="bi bi-arrow-up"></i>
    </button>

    <script>
        // Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#E8F5E9',
                primaryTextColor: '#1a1a1a',
                primaryBorderColor: '#4CAF50',
                lineColor: '#666666',
                secondaryColor: '#E3F2FD',
                tertiaryColor: '#FFF3E0',
                noteBkgColor: '#fff9c4',
                noteTextColor: '#333333',
                actorTextColor: '#1a1a1a',
                actorBkg: '#E3F2FD',
                actorBorder: '#1976D2',
                signalColor: '#333333',
                signalTextColor: '#333333',
                labelTextColor: '#333333',
                loopTextColor: '#333333',
                activationBorderColor: '#1976D2',
                activationBkgColor: '#E3F2FD',
                sequenceNumberColor: '#ffffff'
            },
            sequence: {
                actorMargin: 50,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: false,
                useMaxWidth: true
            }
        });

        // Back to top
        window.addEventListener('scroll', function() {
            document.getElementById('backToTop').classList.toggle('visible', window.scrollY > 500);
        });

        // Active nav
        const sections = document.querySelectorAll('section[id]');
        const navLinks = document.querySelectorAll('.nav-link');
        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                if (scrollY >= section.offsetTop - 200) current = section.getAttribute('id');
            });
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + current) link.classList.add('active');
            });
        });
    </script>
</body>
</html>
